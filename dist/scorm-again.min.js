!function(){"use strict";const e="true",t="false",i={cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",core_children:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",score_children:"raw,min,max",comments_children:"content,location,time",objectives_children:"id,score,status",correct_responses_children:"pattern",student_data_children:"mastery_score,max_time_allowed,time_limit_action",student_preference_children:"audio,language,speed,text",interactions_children:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",error_descriptions:{101:{basicMessage:"General Exception",detailMessage:"No specific error code exists to describe the error."},201:{basicMessage:"Invalid argument error",detailMessage:"Indicates that an argument represents an invalid data model element or is otherwise incorrect."},202:{basicMessage:"Element cannot have children",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_children" for a data model element that does not support the "_children" suffix.'},203:{basicMessage:"Element not an array - cannot have count",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_count" for a data model element that does not support the "_count" suffix.'},301:{basicMessage:"Not initialized",detailMessage:"Indicates that an API call was made before the call to lmsInitialize."},401:{basicMessage:"Not implemented error",detailMessage:"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement."},402:{basicMessage:"Invalid set value, element is a keyword",detailMessage:'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in "_children" and "_count").'},403:{basicMessage:"Element is read only",detailMessage:"LMSSetValue was called with a data model element that can only be read."},404:{basicMessage:"Element is write only",detailMessage:"LMSGetValue was called on a data model element that can only be written to."},405:{basicMessage:"Incorrect Data Type",detailMessage:"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element."},407:{basicMessage:"Element Value Out Of Range",detailMessage:"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element."},408:{basicMessage:"Data Model Dependency Not Established",detailMessage:"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element."}}},s={...i,cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation",student_preference_children:"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows",student_data_children:"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action",student_demographics_children:"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience",tries_children:"time,status,score",attempt_records_children:"score,lesson_status",paths_children:"location_id,date,time,status,why_left,time_in_element"},n={cmi_children:"_version,comments_from_learner,comments_from_lms,completion_status,credit,entry,exit,interactions,launch_data,learner_id,learner_name,learner_preference,location,max_time_allowed,mode,objectives,progress_measure,scaled_passing_score,score,session_time,success_status,suspend_data,time_limit_action,total_time",comments_children:"comment,timestamp,location",score_children:"max,raw,scaled,min",objectives_children:"progress_measure,completion_status,success_status,description,score,id",correct_responses_children:"pattern",student_preference_children:"audio_level,audio_captioning,delivery_speed,language",interactions_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",adl_data_children:"id,store",error_descriptions:{0:{basicMessage:"No Error",detailMessage:"No error occurred, the previous API call was successful."},101:{basicMessage:"General Exception",detailMessage:"No specific error code exists to describe the error."},102:{basicMessage:"General Initialization Failure",detailMessage:"Call to Initialize failed for an unknown reason."},103:{basicMessage:"Already Initialized",detailMessage:"Call to Initialize failed because Initialize was already called."},104:{basicMessage:"Content Instance Terminated",detailMessage:"Call to Initialize failed because Terminate was already called."},111:{basicMessage:"General Termination Failure",detailMessage:"Call to Terminate failed for an unknown reason."},112:{basicMessage:"Termination Before Initialization",detailMessage:"Call to Terminate failed because it was made before the call to Initialize."},113:{basicMessage:"Termination After Termination",detailMessage:"Call to Terminate failed because Terminate was already called."},122:{basicMessage:"Retrieve Data Before Initialization",detailMessage:"Call to GetValue failed because it was made before the call to Initialize."},123:{basicMessage:"Retrieve Data After Termination",detailMessage:"Call to GetValue failed because it was made after the call to Terminate."},132:{basicMessage:"Store Data Before Initialization",detailMessage:"Call to SetValue failed because it was made before the call to Initialize."},133:{basicMessage:"Store Data After Termination",detailMessage:"Call to SetValue failed because it was made after the call to Terminate."},142:{basicMessage:"Commit Before Initialization",detailMessage:"Call to Commit failed because it was made before the call to Initialize."},143:{basicMessage:"Commit After Termination",detailMessage:"Call to Commit failed because it was made after the call to Terminate."},201:{basicMessage:"General Argument Error",detailMessage:"An invalid argument was passed to an API method (usually indicates that Initialize, Commit or Terminate did not receive the expected empty string argument."},301:{basicMessage:"General Get Failure",detailMessage:"Indicates a failed GetValue call where no other specific error code is applicable. Use GetDiagnostic for more information."},351:{basicMessage:"General Set Failure",detailMessage:"Indicates a failed SetValue call where no other specific error code is applicable. Use GetDiagnostic for more information."},391:{basicMessage:"General Commit Failure",detailMessage:"Indicates a failed Commit call where no other specific error code is applicable. Use GetDiagnostic for more information."},401:{basicMessage:"Undefined Data Model Element",detailMessage:"The data model element name passed to GetValue or SetValue is not a valid SCORM data model element."},402:{basicMessage:"Unimplemented Data Model Element",detailMessage:"The data model element indicated in a call to GetValue or SetValue is valid, but was not implemented by this LMS. In SCORM 2004, this error would indicate an LMS that is not fully SCORM conformant."},403:{basicMessage:"Data Model Element Value Not Initialized",detailMessage:"Attempt to read a data model element that has not been initialized by the LMS or through a SetValue call. This error condition is often reached during normal execution of a SCO."},404:{basicMessage:"Data Model Element Is Read Only",detailMessage:"SetValue was called with a data model element that can only be read."},405:{basicMessage:"Data Model Element Is Write Only",detailMessage:"GetValue was called on a data model element that can only be written to."},406:{basicMessage:"Data Model Element Type Mismatch",detailMessage:"SetValue was called with a value that is not consistent with the data format of the supplied data model element."},407:{basicMessage:"Data Model Element Value Out Of Range",detailMessage:"The numeric value supplied to a SetValue call is outside of the numeric range allowed for the supplied data model element."},408:{basicMessage:"Data Model Dependency Not Established",detailMessage:"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element."}}},r={GENERAL:101,INITIALIZATION_FAILED:101,INITIALIZED:101,TERMINATED:101,TERMINATION_FAILURE:101,TERMINATION_BEFORE_INIT:101,MULTIPLE_TERMINATION:101,RETRIEVE_BEFORE_INIT:101,RETRIEVE_AFTER_TERM:101,STORE_BEFORE_INIT:101,STORE_AFTER_TERM:101,COMMIT_BEFORE_INIT:101,COMMIT_AFTER_TERM:101,ARGUMENT_ERROR:101,CHILDREN_ERROR:101,COUNT_ERROR:101,GENERAL_GET_FAILURE:101,GENERAL_SET_FAILURE:101,GENERAL_COMMIT_FAILURE:101,UNDEFINED_DATA_MODEL:101,UNIMPLEMENTED_ELEMENT:101,VALUE_NOT_INITIALIZED:101,INVALID_SET_VALUE:101,READ_ONLY_ELEMENT:101,WRITE_ONLY_ELEMENT:101,TYPE_MISMATCH:101,VALUE_OUT_OF_RANGE:101,DEPENDENCY_NOT_ESTABLISHED:101},o={...r,RETRIEVE_BEFORE_INIT:301,STORE_BEFORE_INIT:301,COMMIT_BEFORE_INIT:301,ARGUMENT_ERROR:201,CHILDREN_ERROR:202,COUNT_ERROR:203,UNDEFINED_DATA_MODEL:401,UNIMPLEMENTED_ELEMENT:401,VALUE_NOT_INITIALIZED:301,INVALID_SET_VALUE:402,READ_ONLY_ELEMENT:403,WRITE_ONLY_ELEMENT:404,TYPE_MISMATCH:405,VALUE_OUT_OF_RANGE:407,DEPENDENCY_NOT_ESTABLISHED:408},a={...r,INITIALIZATION_FAILED:102,INITIALIZED:103,TERMINATED:104,TERMINATION_FAILURE:111,TERMINATION_BEFORE_INIT:112,MULTIPLE_TERMINATIONS:113,RETRIEVE_BEFORE_INIT:122,RETRIEVE_AFTER_TERM:123,STORE_BEFORE_INIT:132,STORE_AFTER_TERM:133,COMMIT_BEFORE_INIT:142,COMMIT_AFTER_TERM:143,ARGUMENT_ERROR:201,GENERAL_GET_FAILURE:301,GENERAL_SET_FAILURE:351,GENERAL_COMMIT_FAILURE:391,UNDEFINED_DATA_MODEL:401,UNIMPLEMENTED_ELEMENT:402,VALUE_NOT_INITIALIZED:403,READ_ONLY_ELEMENT:404,WRITE_ONLY_ELEMENT:405,TYPE_MISMATCH:406,VALUE_OUT_OF_RANGE:407,DEPENDENCY_NOT_ESTABLISHED:408},c={CMIString256:"^.{0,255}$",CMIString4096:"^.{0,4096}$",CMITime:"^(?:[01]\\d|2[0123]):(?:[012345]\\d):(?:[012345]\\d)$",CMITimespan:"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",CMIInteger:"^\\d+$",CMISInteger:"^-?([0-9]+)$",CMIDecimal:"^-?([0-9]{0,3})(.[0-9]*)?$",CMIIdentifier:"^[\\u0021-\\u007E\\s]{0,255}$",CMIFeedback:"^.{0,255}$",CMIIndex:"[._](\\d+).",CMIStatus:"^(passed|completed|failed|incomplete|browsed)$",CMIStatus2:"^(passed|completed|failed|incomplete|browsed|not attempted)$",CMIExit:"^(time-out|suspend|logout|)$",CMIType:"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$",CMIResult:"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\.[0-9]*)?)$",NAVEvent:"^(previous|continue)$",score_range:"0#100",audio_range:"-1#100",speed_range:"-100#100",weighting_range:"-100#100",text_range:"-1#1"},l={...c,CMIIdentifier:"^\\w{1,255}$"},h="^[\\u0000-\\uFFFF]{0,4000}$",_="^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,250}$)?$",u="^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,4000}$)?$",d="^(19[7-9]{1}[0-9]{1}|20[0-2]{1}[0-9]{1}|203[0-8]{1})((-(0[1-9]{1}|1[0-2]{1}))((-(0[1-9]{1}|[1-2]{1}[0-9]{1}|3[0-1]{1}))(T([0-1]{1}[0-9]{1}|2[0-3]{1})((:[0-5]{1}[0-9]{1})((:[0-5]{1}[0-9]{1})((\\.[0-9]{1,6})((Z|([+|-]([0-1]{1}[0-9]{1}|2[0-3]{1})))(:[0-5]{1}[0-9]{1})?)?)?)?)?)?)?)?$",m="^P(?:([.,\\d]+)Y)?(?:([.,\\d]+)M)?(?:([.,\\d]+)W)?(?:([.,\\d]+)D)?(?:T?(?:([.,\\d]+)H)?(?:([.,\\d]+)M)?(?:([.,\\d]+)S)?)?$",g="^-?([0-9]{1,5})(\\.[0-9]{1,18})?$",p="^[\\w\\.\\-\\_]{1,250}$",E="^(?:(?!urn:)\\S{1,4000}|urn:[A-Za-z0-9-]{1,31}:\\S{1,4000}|.{1,4000})$",f="^(completed|incomplete|not attempted|unknown)$",S="^(passed|failed|unknown)$",v="^(previous|continue|exit|exitAll|abandon|abandonAll|suspendAll|_none_|(\\{target=(?<choice_target>\\S{0,}[a-zA-Z0-9-_]+)})?choice|(\\{target=(?<jump_target>\\S{0,}[a-zA-Z0-9-_]+)})?jump)$",C="^(unknown|true|false$)",w="^{target=\\S{0,}[a-zA-Z0-9-_]+}$";class M extends Error{constructor(e,t){super(`${e} : ${""+t}`),this._errorCode=t,Object.setPrototypeOf(this,M.prototype)}get errorCode(){return this._errorCode}}class T extends M{constructor(e,t,i,s){super(e,t),this._detailedMessage="",this.message=`${e} : ${i}`,this._errorMessage=i,s&&(this._detailedMessage=s),Object.setPrototypeOf(this,T.prototype)}get errorMessage(){return this._errorMessage}get detailedMessage(){return this._detailedMessage}}const I=i.error_descriptions;class R extends T{constructor(e,t){!{}.hasOwnProperty.call(I,t+"")?super(e,101,I[101].basicMessage,I[101].detailMessage):super(e,t,I[t+""].basicMessage,I[t+""].detailMessage),Object.setPrototypeOf(this,R.prototype)}}class y{constructor(e){this.jsonString=!1,this._initialized=!1,this._cmi_element=e}get initialized(){return this._initialized}initialize(){this._initialized=!0}}class O extends y{get start_time(){return this._start_time}setStartTime(){if(void 0!==this._start_time)throw Error("Start time has already been set.");this._start_time=(new Date).getTime()}}const A={D:86400,H:3600,M:60,S:1},N=P((e=>{if(!e||0>=e)return"00:00:00";const t=Math.floor(e/3600),i=new Date(1e3*e),s=i.getUTCMinutes(),n=i.getSeconds(),r=e%1;let o="";return z(r)>0&&(o=z(r)>2?r.toFixed(2):r+"",o="."+o.split(".")[1]),(t+":"+s+":"+n).replace(/\b\d\b/g,"0$&")+o})),L=P((e=>{if(!e||0>=e)return"PT0S";let t="P",i=e;return Object.entries(A).forEach((e=>{let[s,n]=e,r=Math.floor(i/n);i%=n,z(i)>2&&(i=+(+i).toFixed(2)),"S"===s&&i>0&&(r+=i),r&&((t.indexOf("D")>0||["H","M","S"].includes(s))&&-1===t.indexOf("T")&&(t+="T"),t+=`${r}${s}`)})),t})),b=P(((e,t)=>{if("number"!=typeof e&&"boolean"!=typeof e||(e+=""),"string"==typeof t&&(t=RegExp(t)),!e||!e?.match?.(t))return 0;const i=e.split(":");return 3600*+i[0]+60*+i[1]+ +i[2]}),((e,t)=>`${"string"==typeof e?e:(e??"")+""}:${"string"==typeof t?t:t?.toString()??""}`)),x=P(((e,t)=>{if("string"==typeof t&&(t=RegExp(t)),!e||!e?.match?.(t))return 0;const[,i,s,,n,r,o,a]=RegExp(t).exec?.(e)??[];let result=0;return result+=+a||0,result+=60*+o||0,result+=3600*+r||0,result+=86400*+n||0,result+=31536e3*+i||0,result}),((e,t)=>`${e??""}:${"string"==typeof t?t:t?.toString()??""}`));function j(e){const result={};return function e(t,i){if(Object(t)!==t)result[i]=t;else if(Array.isArray(t))t.forEach(((t,s)=>{e(t,`${i}[${s}]`)})),0===t.length&&(result[i]=[]);else{const s=Object.keys(t).filter((e=>({}.hasOwnProperty.call(t,e)))),n=0===s.length;s.forEach((s=>{e(t[s],i?`${i}.${s}`:s)})),n&&i&&(result[i]={})}}(e,""),result}function z(e){if(Math.floor(e)===e||0>(e+"")?.indexOf?.("."))return 0;const t=(""+e).split(".")?.[1];return t?.length??0}function D(e,t){return null!==e?.match(t)}function P(e,t){const i=new Map;return function(){for(var s=arguments.length,n=Array(s),r=0;s>r;r++)n[r]=arguments[r];const o=t?t(...n):JSON.stringify(n);return i.has(o)?i.get(o):(()=>{const result=e(...n);return i.set(o,result),result})()}}const q=P(((e,t,i,s,n,r)=>{if("string"!=typeof t)return!1;const o=RegExp(i),a=t.match(o);if(r&&""===t)return!0;if(void 0===t||!a||""===a[0])throw new n(e,s);return!0}),((e,t,i,s,n,r)=>`${e}:${"string"==typeof t?t:`[${typeof t}]`}:${i}:${s}:${r||!1}`)),F=P(((e,t,i,s,n)=>{const r=i.split("#");if(r[0]>(t*=1))throw new n(e,s);if("*"!==r[1]&&t>r[1])throw new n(e,s);return!0}),((e,t,i,s,n)=>`${e}:${t}:${i}:${s}`));function V(e,t,i,s){return q(e,t,i,o.TYPE_MISMATCH,R,s)}function Y(e,t,i,s){if(""===t)throw new R(e,o.VALUE_OUT_OF_RANGE);return F(e,t,i,o.VALUE_OUT_OF_RANGE,R)}const k=new class{validateScore(e,t,i,s,n,r,o){return q(e,t,i,n,o)&&(!s||F(e,t,s,r,o))}validateScorm12Audio(e,t){return V(e,t,c.CMISInteger)&&Y(e,t,"-1#100")}validateScorm12Language(e,t){return V(e,t,"^.{0,255}$")}validateScorm12Speed(e,t){return V(e,t,c.CMISInteger)&&Y(e,t,"-100#100")}validateScorm12Text(e,t){return V(e,t,c.CMISInteger)&&Y(e,t,"-1#1")}validateReadOnly(e,t){if(t)throw new R(e,o.READ_ONLY_ELEMENT)}};class $ extends y{constructor(e){super(e.CMIElement),this._raw="",this._min="",this.__children=e.score_children||i.score_children,this.__score_range=!!e.score_range&&"0#100",this._max=e.max||""===e.max?e.max:"100",this.__invalid_error_code=e.invalidErrorCode||o.INVALID_SET_VALUE,this.__invalid_type_code=e.invalidTypeCode||o.TYPE_MISMATCH,this.__invalid_range_code=e.invalidRangeCode||o.VALUE_OUT_OF_RANGE,this.__decimal_regex=e.decimalRegex||c.CMIDecimal,this.__error_class=e.errorClass}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new this.__error_class(this._cmi_element+"._children",this.__invalid_error_code)}get raw(){return this._raw}set raw(e){k.validateScore(this._cmi_element+".raw",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._raw=e)}get min(){return this._min}set min(e){k.validateScore(this._cmi_element+".min",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._min=e)}get max(){return this._max}set max(e){k.validateScore(this._cmi_element+".max",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._max=e)}getScoreObject(){const e={};return Number.isNaN(Number.parseFloat(this.raw))||(e.raw=Number.parseFloat(this.raw)),Number.isNaN(Number.parseFloat(this.min))||(e.min=Number.parseFloat(this.min)),Number.isNaN(Number.parseFloat(this.max))||(e.max=Number.parseFloat(this.max)),e}toJSON(){this.jsonString=!0;const result={raw:this.raw,min:this.min,max:this.max};return this.jsonString=!1,result}}class H extends y{constructor(){super("cmi.core"),this.__children=i.core_children,this._student_id="",this._student_name="",this._lesson_location="",this._credit="",this._lesson_status="not attempted",this._entry="",this._total_time="",this._lesson_mode="normal",this._exit="",this._session_time="00:00:00",this._suspend_data="",this.score=new $({CMIElement:"cmi.core.score",score_children:i.score_children,score_range:"0#100",invalidErrorCode:o.INVALID_SET_VALUE,invalidTypeCode:o.TYPE_MISMATCH,invalidRangeCode:o.VALUE_OUT_OF_RANGE,errorClass:R})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._exit="",this._entry="",this._session_time="00:00:00",this.score?.reset()}get _children(){return this.__children}set _children(_children){throw new R(this._cmi_element+"._children",o.INVALID_SET_VALUE)}get student_id(){return this._student_id}set student_id(student_id){if(this.initialized)throw new R(this._cmi_element+".student_id",o.READ_ONLY_ELEMENT);this._student_id=student_id}get student_name(){return this._student_name}set student_name(student_name){if(this.initialized)throw new R(this._cmi_element+".student_name",o.READ_ONLY_ELEMENT);this._student_name=student_name}get lesson_location(){return this._lesson_location}set lesson_location(lesson_location){V(this._cmi_element+".lesson_location",lesson_location,"^.{0,255}$",!0)&&(this._lesson_location=lesson_location)}get credit(){return this._credit}set credit(credit){if(this.initialized)throw new R(this._cmi_element+".credit",o.READ_ONLY_ELEMENT);this._credit=credit}get lesson_status(){return this._lesson_status}set lesson_status(lesson_status){this.initialized?V(this._cmi_element+".lesson_status",lesson_status,c.CMIStatus)&&(this._lesson_status=lesson_status):V(this._cmi_element+".lesson_status",lesson_status,c.CMIStatus2)&&(this._lesson_status=lesson_status)}get entry(){return this._entry}set entry(entry){if(this.initialized)throw new R(this._cmi_element+".entry",o.READ_ONLY_ELEMENT);this._entry=entry}get total_time(){return this._total_time}set total_time(total_time){if(this.initialized)throw new R(this._cmi_element+".total_time",o.READ_ONLY_ELEMENT);this._total_time=total_time}get lesson_mode(){return this._lesson_mode}set lesson_mode(lesson_mode){if(this.initialized)throw new R(this._cmi_element+".lesson_mode",o.READ_ONLY_ELEMENT);this._lesson_mode=lesson_mode}get exit(){if(!this.jsonString)throw new R(this._cmi_element+".exit",o.WRITE_ONLY_ELEMENT);return this._exit}set exit(exit){V(this._cmi_element+".exit",exit,c.CMIExit,!0)&&(this._exit=exit)}get session_time(){if(!this.jsonString)throw new R(this._cmi_element+".session_time",o.WRITE_ONLY_ELEMENT);return this._session_time}set session_time(session_time){V(this._cmi_element+".session_time",session_time,c.CMITimespan)&&(this._session_time=session_time)}get suspend_data(){return this._suspend_data}set suspend_data(suspend_data){V(this._cmi_element+".suspend_data",suspend_data,"^.{0,4096}$",!0)&&(this._suspend_data=suspend_data)}getCurrentTotalTime(e){let t=this._session_time;if(null!=e){const i=(new Date).getTime()-e;t=N(i/1e3)}return i=this._total_time,s=t,"string"==typeof(n=RegExp(c.CMITimespan))&&(n=RegExp(n)),N(b(i,n)+b(s,n));var i,s,n}toJSON(){this.jsonString=!0;const result={student_id:this.student_id,student_name:this.student_name,lesson_location:this.lesson_location,credit:this.credit,lesson_status:this.lesson_status,entry:this.entry,lesson_mode:this.lesson_mode,exit:this.exit,session_time:this.session_time,score:this.score};return this.jsonString=!1,result}}class G extends y{constructor(e){super(e.CMIElement),this.__children=e.children,this._errorCode=e.errorCode||o.GENERAL,this._errorClass=e.errorClass||M,this.childArray=[]}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._initialized=!1,e)this.childArray=[];else for(let e=0;this.childArray.length>e;e++)this.childArray[e].reset()}get _children(){return this.__children}set _children(_children){throw new this._errorClass(this._cmi_element+"._children",this._errorCode)}get _count(){return this.childArray.length}set _count(_count){throw new this._errorClass(this._cmi_element+"._count",this._errorCode)}toJSON(){this.jsonString=!0;const result={};for(let e=0;this.childArray.length>e;e++)result[e+""]=this.childArray[e];return this.jsonString=!1,result}}let U=class extends G{constructor(){super({CMIElement:"cmi.objectives",children:i.objectives_children,errorCode:o.INVALID_SET_VALUE,errorClass:R})}},J=class extends y{constructor(){super("cmi.objectives.n"),this._id="",this._status="",this.score=new $({CMIElement:"cmi.objectives.n.score",score_children:i.score_children,score_range:"0#100",invalidErrorCode:o.INVALID_SET_VALUE,invalidTypeCode:o.TYPE_MISMATCH,invalidRangeCode:o.VALUE_OUT_OF_RANGE,errorClass:R})}reset(){this._initialized=!1,this._id="",this._status="",this.score?.reset()}get id(){return this._id}set id(id){V(this._cmi_element+".id",id,c.CMIIdentifier)&&(this._id=id)}get status(){return this._status}set status(status){V(this._cmi_element+".status",status,c.CMIStatus2)&&(this._status=status)}toJSON(){this.jsonString=!0;const result={id:this.id,status:this.status,score:this.score};return this.jsonString=!1,result}};class B extends y{constructor(e){super("cmi.student_data"),this._mastery_score="",this._max_time_allowed="",this._time_limit_action="",this.__children=e||i.student_data_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new R(this._cmi_element+"._children",o.INVALID_SET_VALUE)}get mastery_score(){return this._mastery_score}set mastery_score(mastery_score){k.validateReadOnly(this._cmi_element+".mastery_score",this.initialized),this._mastery_score=mastery_score}get max_time_allowed(){return this._max_time_allowed}set max_time_allowed(max_time_allowed){k.validateReadOnly(this._cmi_element+".max_time_allowed",this.initialized),this._max_time_allowed=max_time_allowed}get time_limit_action(){return this._time_limit_action}set time_limit_action(time_limit_action){k.validateReadOnly(this._cmi_element+".time_limit_action",this.initialized),this._time_limit_action=time_limit_action}toJSON(){this.jsonString=!0;const result={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action};return this.jsonString=!1,result}}class W extends y{constructor(e){super("cmi.student_preference"),this._audio="",this._language="",this._speed="",this._text="",this.__children=e||i.student_preference_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new R(this._cmi_element+"._children",o.INVALID_SET_VALUE)}get audio(){return this._audio}set audio(audio){k.validateScorm12Audio(this._cmi_element+".audio",audio)&&(this._audio=audio)}get language(){return this._language}set language(language){k.validateScorm12Language(this._cmi_element+".language",language)&&(this._language=language)}get speed(){return this._speed}set speed(speed){k.validateScorm12Speed(this._cmi_element+".speed",speed)&&(this._speed=speed)}get text(){return this._text}set text(text){k.validateScorm12Text(this._cmi_element+".text",text)&&(this._text=text)}toJSON(){this.jsonString=!0;const result={audio:this.audio,language:this.language,speed:this.speed,text:this.text};return this.jsonString=!1,result}}let Z=class extends G{constructor(){super({CMIElement:"cmi.interactions",children:i.interactions_children,errorCode:o.INVALID_SET_VALUE,errorClass:R})}},K=class extends y{constructor(){super("cmi.interactions.n"),this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives=new G({CMIElement:"cmi.interactions.n.objectives",errorCode:o.INVALID_SET_VALUE,errorClass:R,children:i.objectives_children}),this.correct_responses=new G({CMIElement:"cmi.interactions.correct_responses",errorCode:o.INVALID_SET_VALUE,errorClass:R,children:i.correct_responses_children})}initialize(){super.initialize(),this.objectives?.initialize(),this.correct_responses?.initialize()}reset(){this._initialized=!1,this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives?.reset(),this.correct_responses?.reset()}get id(){if(!this.jsonString)throw new R(this._cmi_element+".id",o.WRITE_ONLY_ELEMENT);return this._id}set id(id){V(this._cmi_element+".id",id,c.CMIIdentifier)&&(this._id=id)}get time(){if(!this.jsonString)throw new R(this._cmi_element+".time",o.WRITE_ONLY_ELEMENT);return this._time}set time(time){V(this._cmi_element+".time",time,c.CMITime)&&(this._time=time)}get type(){if(!this.jsonString)throw new R(this._cmi_element+".type",o.WRITE_ONLY_ELEMENT);return this._type}set type(type){V(this._cmi_element+".type",type,c.CMIType)&&(this._type=type)}get weighting(){if(!this.jsonString)throw new R(this._cmi_element+".weighting",o.WRITE_ONLY_ELEMENT);return this._weighting}set weighting(weighting){V(this._cmi_element+".weighting",weighting,c.CMIDecimal)&&Y(this._cmi_element+".weighting",weighting,"-100#100")&&(this._weighting=weighting)}get student_response(){if(!this.jsonString)throw new R(this._cmi_element+".student_response",o.WRITE_ONLY_ELEMENT);return this._student_response}set student_response(student_response){V(this._cmi_element+".student_response",student_response,"^.{0,255}$",!0)&&(this._student_response=student_response)}get result(){if(!this.jsonString)throw new R(this._cmi_element+".result",o.WRITE_ONLY_ELEMENT);return this._result}set result(result){V(this._cmi_element+".result",result,c.CMIResult)&&(this._result=result)}get latency(){if(!this.jsonString)throw new R(this._cmi_element+".latency",o.WRITE_ONLY_ELEMENT);return this._latency}set latency(latency){V(this._cmi_element+".latency",latency,c.CMITimespan)&&(this._latency=latency)}toJSON(){this.jsonString=!0;const result={id:this.id,time:this.time,type:this.type,weighting:this.weighting,student_response:this.student_response,result:this.result,latency:this.latency,objectives:this.objectives,correct_responses:this.correct_responses};return this.jsonString=!1,result}},X=class extends y{constructor(){super("cmi.interactions.n.objectives.n"),this._id=""}reset(){this._initialized=!1,this._id=""}get id(){return this._id}set id(id){V(this._cmi_element+".id",id,c.CMIIdentifier)&&(this._id=id)}toJSON(){this.jsonString=!0;const result={id:this.id};return this.jsonString=!1,result}},Q=class extends y{constructor(){super("cmi.interactions.correct_responses.n"),this._pattern=""}reset(){this._initialized=!1,this._pattern=""}get pattern(){if(!this.jsonString)throw new R(this._cmi_element+".pattern",o.WRITE_ONLY_ELEMENT);return this._pattern}set pattern(pattern){V(this._cmi_element+".pattern",pattern,"^.{0,255}$",!0)&&(this._pattern=pattern)}toJSON(){this.jsonString=!0;const result={pattern:this._pattern};return this.jsonString=!1,result}},ee=class extends O{constructor(e,student_data,t){super("cmi"),this.__children="",this.__version="3.4",this._launch_data="",this._comments="",this._comments_from_lms="",t&&this.initialize(),this.__children=e||i.cmi_children,this.core=new H,this.objectives=new U,this.student_data=student_data||new B,this.student_preference=new W,this.interactions=new Z}reset(){this._initialized=!1,this._launch_data="",this._comments="",this.core?.reset(),this.objectives=new U,this.interactions=new Z,this.student_data?.reset(),this.student_preference?.reset()}initialize(){super.initialize(),this.core?.initialize(),this.objectives?.initialize(),this.student_data?.initialize(),this.student_preference?.initialize(),this.interactions?.initialize()}toJSON(){this.jsonString=!0;const result={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,interactions:this.interactions};return this.jsonString=!1,result}get _version(){return this.__version}set _version(_version){throw new R(this._cmi_element+"._version",o.INVALID_SET_VALUE)}get _children(){return this.__children}set _children(_children){throw new R(this._cmi_element+"._children",o.INVALID_SET_VALUE)}get suspend_data(){return this.core?.suspend_data}set suspend_data(suspend_data){this.core&&(this.core.suspend_data=suspend_data)}get launch_data(){return this._launch_data}set launch_data(launch_data){if(this.initialized)throw new R(this._cmi_element+".launch_data",o.READ_ONLY_ELEMENT);this._launch_data=launch_data}get comments(){return this._comments}set comments(comments){V(this._cmi_element+".comments",comments,"^.{0,4096}$",!0)&&(this._comments=comments)}get comments_from_lms(){return this._comments_from_lms}set comments_from_lms(comments_from_lms){if(this.initialized)throw new R(this._cmi_element+".comments_from_lms",o.READ_ONLY_ELEMENT);this._comments_from_lms=comments_from_lms}getCurrentTotalTime(){return this.core.getCurrentTotalTime(this.start_time)}};class te extends y{constructor(){super("cmi.nav"),this._event=""}reset(){this._event="",this._initialized=!1}get event(){return this._event}set event(e){(""===e||V(this._cmi_element+".event",e,c.NAVEvent))&&(this._event=e)}toJSON(){this.jsonString=!0;const result={event:this.event};return this.jsonString=!1,result}}const ie="unknown",se="true",ne="false",re="passed",oe="failed",ae="unknown",ce="completed",le="incomplete",he="unknown",_e={_:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},ue={autocommit:!1,autocommitSeconds:10,asyncCommit:!1,sendFullCommit:!0,lmsCommitUrl:!1,dataCommitFormat:"json",commitRequestDataType:"application/json;charset=UTF-8",autoProgress:!1,logLevel:_e.ERROR,selfReportSessionTime:!1,alwaysSendTotalTime:!1,renderCommonCommitFields:!1,strict_errors:!0,xhrHeaders:{},xhrWithCredentials:!1,fetchMode:"cors",useBeaconInsteadOfFetch:"never",responseHandler:async function(i){if(void 0!==i){let s=null;try{if("function"==typeof i.json)s=await i.json();else if("function"==typeof i.text){const e=await i.text();e&&(s=JSON.parse(e))}}catch(e){}return null!==s&&{}.hasOwnProperty.call(s,"result")?{result:s.result,errorCode:s.errorCode?s.errorCode:s.result===e?0:101}:200===i.status?{result:e,errorCode:0}:{result:t,errorCode:101}}return{result:t,errorCode:101}},requestHandler:function(e){return e},onLogMessage:de,scoItemIds:[],scoItemIdValidator:!1,globalObjectiveIds:[],enableOfflineSupport:!1,courseId:"",syncOnInitialize:!0,syncOnTerminate:!0,maxSyncAttempts:5};function de(e,t){switch(e){case"4":case 4:case"ERROR":case _e.ERROR:console.error(t);break;case"3":case 3:case"WARN":case _e.WARN:console.warn(t);break;case"2":case 2:case"INFO":case _e.INFO:console.info(t);break;case"1":case 1:case"DEBUG":case _e.DEBUG:console.debug?console.debug(t):console.log(t)}}class me{constructor(e,t,i){this._cancelled=!1,this._API=e,this._timeout=setTimeout(this.wrapper.bind(this),t),this._callback=i}cancel(){this._cancelled=!0,this._timeout&&clearTimeout(this._timeout)}wrapper(){this._cancelled||(async()=>{await this._API.commit(this._callback)})()}}class ge{constructor(e,t){this.settings=e,this.error_codes=t}async processHttpRequest(e,i){let s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;const r={result:t,errorCode:this.error_codes.GENERAL};if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return this._handleImmediateRequest(e,i,n);try{const t=this.settings.requestHandler(i),s=await this.performFetch(e,t);return this.transformResponse(s,n)}catch(e){return s("processHttpRequest",e,_e.ERROR),n("CommitError"),r}}_handleImmediateRequest(t,i,s){if("never"!==this.settings.useBeaconInsteadOfFetch){const{body:e,contentType:s}=this._prepareRequestBody(i);navigator.sendBeacon(t,new Blob([e],{type:s}))}else this.performFetch(t,i).then((async e=>{await this.transformResponse(e,s)}));return{result:e,errorCode:0}}_prepareRequestBody(e){return{body:e instanceof Array?e.join("&"):JSON.stringify(e),contentType:e instanceof Array?"application/x-www-form-urlencoded":this.settings.commitRequestDataType}}async performFetch(e,t){if("always"===this.settings.useBeaconInsteadOfFetch)return this.performBeacon(e,t);const{body:i,contentType:s}=this._prepareRequestBody(t),n={method:"POST",mode:this.settings.fetchMode,body:i,headers:{...this.settings.xhrHeaders,"Content-Type":s},keepalive:!0};return this.settings.xhrWithCredentials&&(n.credentials="include"),fetch(e,n)}async performBeacon(e,t){const{body:i,contentType:s}=this._prepareRequestBody(t),n=navigator.sendBeacon(e,new Blob([i],{type:s}));return Promise.resolve({status:n?200:0,ok:n,json:async()=>({result:n?"true":"false",errorCode:n?0:this.error_codes.GENERAL}),text:async()=>JSON.stringify({result:n?"true":"false",errorCode:n?0:this.error_codes.GENERAL})})}async transformResponse(e,t){const result="function"==typeof this.settings.responseHandler?await this.settings.responseHandler(e):await e.json();return Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=this._isSuccessResponse(e,result)?0:this.error_codes.GENERAL),this._isSuccessResponse(e,result)?t("CommitSuccess"):t("CommitError",void 0,result.errorCode),result}_isSuccessResponse(t,result){return!(200>t.status||t.status>299||"true"!==result.result&&result.result!==e)}updateSettings(e){this.settings=e}}class pe{constructor(e){this.listenerMap=new Map,this.listenerCount=0,this.apiLog=e}parseListenerName(e){const t=e.split(".");if(0===t.length)return null;const i=t[0];let s=null;return t.length>1&&(s=e.replace(i+".","")),{functionName:i,CMIElement:s}}on(e,t){if(!t)return;const i=e.split(" ");for(const e of i){const i=this.parseListenerName(e);if(!i)continue;const{functionName:s,CMIElement:n}=i,r=this.listenerMap.get(s)??[];r.push({functionName:s,CMIElement:n,callback:t}),this.listenerMap.set(s,r),this.listenerCount++,this.apiLog("on","Added event listener: "+this.listenerCount,_e.INFO,s)}}off(e,t){if(!t)return;const i=e.split(" ");for(const e of i){const i=this.parseListenerName(e);if(!i)continue;const{functionName:s,CMIElement:n}=i,r=this.listenerMap.get(s);if(!r)continue;const o=r.findIndex((e=>e.CMIElement===n&&e.callback===t));-1!==o&&(r.splice(o,1),this.listenerCount--,0===r.length?this.listenerMap.delete(s):this.listenerMap.set(s,r),this.apiLog("off","Removed event listener: "+this.listenerCount,_e.INFO,s))}}clear(e){const t=e.split(" ");for(const e of t){const t=this.parseListenerName(e);if(!t)continue;const{functionName:i,CMIElement:s}=t;if(this.listenerMap.has(i)){const e=this.listenerMap.get(i),t=e.filter((e=>e.CMIElement!==s));this.listenerCount-=e.length-t.length,0===t.length?this.listenerMap.delete(i):this.listenerMap.set(i,t)}}}processListeners(e,t,i){this.apiLog(e,i,_e.INFO,t);const s=this.listenerMap.get(e);if(s)for(const n of s){const s=!!n.CMIElement;let r=!1;if(t&&n.CMIElement)if(n.CMIElement.endsWith("*")){const e=n.CMIElement.slice(0,-1);r=t.startsWith(e)}else r=n.CMIElement===t;s&&!r||(this.apiLog("processListeners","Processing listener: "+n.functionName,_e.DEBUG,t),e.startsWith("Sequence")||"CommitError"===e?n.callback(i):"CommitSuccess"===e?n.callback():n.callback(t,i))}}reset(){this.listenerMap.clear(),this.listenerCount=0}}class Ee{loadFromFlattenedJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!s())return void console.error("loadFromFlattenedJSON can only be called before the call to lmsInitialize.");const r=/^(cmi\.interactions\.)(\d+)\.(.*)$/,o=/^(cmi\.objectives\.)(\d+)\.(.*)$/,interactions=[],objectives=[],a=[];for(const t in e)if({}.hasOwnProperty.call(e,t)){const i=t.match(r);if(i){interactions.push({key:t,value:e[t],index:+i[2],field:i[3]});continue}const s=t.match(o);if(s){objectives.push({key:t,value:e[t],index:+s[2],field:s[3]});continue}a.push({key:t,value:e[t]})}interactions.sort(((e,t)=>e.index!==t.index?e.index-t.index:"id"===e.field?-1:"id"===t.field?1:"type"===e.field?-1:"type"===t.field?1:e.field.localeCompare(t.field))),objectives.sort(((e,t)=>e.index!==t.index?e.index-t.index:"id"===e.field?-1:"id"===t.field?1:e.field.localeCompare(t.field))),a.sort(((e,t)=>e.key.localeCompare(t.key)));const c=e=>{e.forEach((e=>{const r={};r[e.key]=e.value,this.loadFromJSON(function(e){if(Object(e)!==e||Array.isArray(e))return e;const result={},pattern=/\.?([^.[\]]+)|\[(\d+)]/g;return Object.keys(e).filter((t=>({}.hasOwnProperty.call(e,t)))).forEach((t=>{let i=result,s="";const n=RegExp(pattern);Array.from({length:t.match(RegExp(pattern,"g"))?.length??0},(()=>n.exec(t))).forEach((e=>{e&&(i=i[s]??(i[s]=e[2]?[]:{}),s=e[2]||e[1])})),i[s]=e[t]})),result[""]??result}(r),t,i,s,n)}))};c(interactions),c(objectives),c(a)}loadFromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(s()){t=void 0!==t?t:"cmi",n(e);for(const r in e)if({}.hasOwnProperty.call(e,r)&&e[r]){const o=(t?t+".":"")+r,a=e[r];if(a.constructor===Array){for(let e=0;a.length>e;e++)if(a[e]){const t=a[e],r=`${o}.${e}`;t.constructor===Object?this.loadFromJSON(t,r,i,s,n):i(r,t)}}else a.constructor===Object?this.loadFromJSON(a,o,i,s,n):i(o,a)}}else console.error("loadFromJSON can only be called before the call to lmsInitialize.")}renderCMIToJSONString(cmi,e){return e?JSON.stringify({cmi:cmi}):JSON.stringify({cmi:cmi},((e,t)=>void 0===t?null:t),2)}renderCMIToJSONObject(cmi,e){return JSON.parse(this.renderCMIToJSONString(cmi,e))}getCommitObject(e,t,i,s,n,r){const o=t||e,a=i?s(e,o):n(e,o);return[_e.DEBUG,"1",1,"DEBUG"].includes(r)&&(console.debug("Commit (terminated: "+(e?"yes":"no")+"): "),console.debug(a)),a}}class fe{constructor(){this._logLevel=_e.ERROR,this._logHandler=de}static getInstance(){return fe._instance||(fe._instance=new fe),fe._instance}setLogLevel(e){this._logLevel=e}getLogLevel(){return this._logLevel}setLogHandler(e){this._logHandler=e}log(e,t){this.shouldLog(e)&&this._logHandler(e,t)}error(e){this.log(_e.ERROR,e)}warn(e){this.log(_e.WARN,e)}info(e){this.log(_e.INFO,e)}debug(e){this.log(_e.DEBUG,e)}shouldLog(e){return this.getNumericLevel(e)>=this.getNumericLevel(this._logLevel)}getNumericLevel(e){if(void 0===e)return _e.NONE;if("number"==typeof e)return e;switch(e){case"1":case"DEBUG":return _e.DEBUG;case"2":case"INFO":return _e.INFO;case"3":case"WARN":return _e.WARN;case"4":case"ERROR":default:return _e.ERROR;case"5":case"NONE":return _e.NONE}}}function Se(){return fe.getInstance()}class ve{constructor(e,t,i,s){this._lastErrorCode="0",this._errorCodes=e,this._apiLog=t,this._getLmsErrorMessageDetails=i,this._loggingService=s||Se()}get lastErrorCode(){return this._lastErrorCode}set lastErrorCode(e){this._lastErrorCode=e}throwSCORMError(e,t,i){i||(i=this._getLmsErrorMessageDetails(t,!0));const s=`SCORM Error ${t}: ${i}${e?` [Element: ${e}]`:""}`;this._apiLog("throwSCORMError",t+": "+i,_e.ERROR,e),this._loggingService.error(s),this._lastErrorCode=t+""}clearSCORMError(e){void 0!==e&&e!==t&&(this._lastErrorCode="0")}handleValueAccessException(e,i,s){if(i instanceof T){const n=i;this._lastErrorCode=n.errorCode+"",this._loggingService.warn(`Validation Error ${n.errorCode}: ${n.message} [Element: ${e}]`),s=t}else if(i instanceof Error){const t=i.constructor.name;this._loggingService.error(`${t}: ${i.message} [Element: ${e}]\n${i.stack||""}`),this.throwSCORMError(e,this._errorCodes.GENERAL,`${t}: ${i.message}`)}else{this._loggingService.error(`Unknown error occurred while accessing [Element: ${e}]`);try{const e=JSON.stringify(i);this._loggingService.error("Error details: "+e)}catch(e){this._loggingService.error("Could not stringify error object for details")}this.throwSCORMError(e,this._errorCodes.GENERAL,"Unknown error")}return s}get errorCodes(){return this._errorCodes}}class Ce{constructor(e,t,i){this.apiLog=i,this.storeName="scorm_again_offline_data",this.syncQueue="scorm_again_sync_queue",this.isOnline=navigator.onLine,this.syncInProgress=!1,this.settings=e,this.error_codes=t,window.addEventListener("online",this.handleOnlineStatusChange.bind(this)),window.addEventListener("offline",this.handleOnlineStatusChange.bind(this))}handleOnlineStatusChange(){const e=this.isOnline;this.isOnline=navigator.onLine,!e&&this.isOnline?(this.apiLog("OfflineStorageService","Device is back online, attempting to sync...",_e.INFO),this.syncOfflineData().then((e=>{e?this.apiLog("OfflineStorageService","Sync completed successfully",_e.INFO):this.apiLog("OfflineStorageService","Sync failed",_e.ERROR)}),(e=>{this.apiLog("OfflineStorageService","Error during sync: "+e,_e.ERROR)}))):e&&!this.isOnline&&this.apiLog("OfflineStorageService","Device is offline, data will be stored locally",_e.INFO)}async storeOffline(i,s){try{const t={id:`${i}_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,courseId:i,timestamp:Date.now(),data:s,syncAttempts:0},n=await this.getFromStorage(this.syncQueue)||[];return n.push(t),await this.saveToStorage(this.syncQueue,n),await this.saveToStorage(`${this.storeName}_${i}`,s),this.apiLog("OfflineStorageService","Stored data offline for course "+i,_e.INFO),{result:e,errorCode:0}}catch(e){return this.apiLog("OfflineStorageService","Error storing offline data: "+e,_e.ERROR),{result:t,errorCode:this.error_codes.GENERAL}}}async getOfflineData(e){try{return await this.getFromStorage(`${this.storeName}_${e}`)||null}catch(e){return this.apiLog("OfflineStorageService","Error retrieving offline data: "+e,_e.ERROR),null}}async syncOfflineData(){if(this.syncInProgress||!this.isOnline)return!1;this.syncInProgress=!0;try{const t=await this.getFromStorage(this.syncQueue)||[];if(0===t.length)return this.syncInProgress=!1,!0;this.apiLog("OfflineStorageService",`Found ${t.length} items to sync`,_e.INFO);const i=[];for(const s of t)if(5>s.syncAttempts)try{(await this.sendDataToLMS(s.data)).result===e?this.apiLog("OfflineStorageService","Successfully synced item "+s.id,_e.INFO):(s.syncAttempts++,i.push(s),this.apiLog("OfflineStorageService",`Failed to sync item ${s.id}, attempt #${s.syncAttempts}`,_e.WARN))}catch(e){s.syncAttempts++,i.push(s),this.apiLog("OfflineStorageService",`Error syncing item ${s.id}: ${e}`,_e.ERROR)}else this.apiLog("OfflineStorageService",`Skipping item ${s.id} after 5 failed attempts`,_e.WARN);return await this.saveToStorage(this.syncQueue,i),this.apiLog("OfflineStorageService",`Sync completed. ${t.length-i.length} items synced, ${i.length} items remaining`,_e.INFO),this.syncInProgress=!1,!0}catch(e){return this.apiLog("OfflineStorageService","Error during sync process: "+e,_e.ERROR),this.syncInProgress=!1,!1}}async sendDataToLMS(i){if(!this.settings.lmsCommitUrl)return{result:t,errorCode:this.error_codes.GENERAL};try{const t=this.settings.requestHandler(i),s={method:"POST",mode:this.settings.fetchMode,body:JSON.stringify(t),headers:{...this.settings.xhrHeaders,"Content-Type":this.settings.commitRequestDataType}};this.settings.xhrWithCredentials&&(s.credentials="include");const n=await fetch(this.settings.lmsCommitUrl,s),result="function"==typeof this.settings.responseHandler?await this.settings.responseHandler(n):await n.json();return 200>n.status||n.status>299||!0!==result.result&&result.result!==e?(Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=this.error_codes.GENERAL),result):(Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=0),result)}catch(e){return this.apiLog("OfflineStorageService","Error sending data to LMS: "+e,_e.ERROR),{result:t,errorCode:this.error_codes.GENERAL}}}isDeviceOnline(){return this.isOnline}async getFromStorage(e){const t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return null}return null}async saveToStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}async hasPendingOfflineData(e){return(await this.getFromStorage(this.syncQueue)||[]).some((t=>t.courseId===e))}updateSettings(e){this.settings=e}}class we{constructor(e,t,i,s,n,r,o,a,c){if(this._settings=ue,this._courseId="",new.target===we)throw new TypeError("Cannot construct BaseAPI instances directly");this.currentState=0,this._error_codes=e,t&&(this.settings={...ue,...t}),this._loggingService=a||Se(),this._loggingService.setLogLevel(this.settings.logLevel),this.settings.onLogMessage&&this._loggingService.setLogHandler(this.settings.onLogMessage),this._httpService=i||new ge(this.settings,this._error_codes),this._eventService=s||new pe(((e,t,i,s)=>this.apiLog(e,t,i,s))),this._serializationService=n||new Ee,this._errorHandlingService=o||new ve(this._error_codes,((e,t,i,s)=>this.apiLog(e,t,i,s)),((e,t)=>this.getLmsErrorMessageDetails(e,t)),void 0),this.settings.enableOfflineSupport&&(this._offlineStorageService=c||new Ce(this.settings,this._error_codes,((e,t,i,s)=>this.apiLog(e,t,i,s))),this.settings.courseId&&(this._courseId=this.settings.courseId),this._offlineStorageService&&this._courseId&&this._offlineStorageService.getOfflineData(this._courseId).then((e=>{e&&(this.apiLog("constructor","Found offline data to restore",_e.INFO),this.loadFromJSON(e.runtimeData))})).catch((e=>{this.apiLog("constructor","Error retrieving offline data: "+e,_e.ERROR)})))}get lastErrorCode(){return this._errorHandlingService?.lastErrorCode??"0"}set lastErrorCode(e){this._errorHandlingService&&(this._errorHandlingService.lastErrorCode=e)}commonReset(e){this.apiLog("reset","Called",_e.INFO),this.settings={...this.settings,...e},this.clearScheduledCommit(),this.currentState=0,this.lastErrorCode="0",this._eventService.reset(),this.startingData={},this._offlineStorageService&&(this._offlineStorageService.updateSettings(this.settings),e?.courseId&&(this._courseId=e.courseId))}initialize(i,s,n){let r=t;return this.isInitialized()?this.throwSCORMError("api",this._error_codes.INITIALIZED,s):this.isTerminated()?this.throwSCORMError("api",this._error_codes.TERMINATED,n):(this.settings.selfReportSessionTime&&this.cmi.setStartTime(),this.currentState=1,this.lastErrorCode="0",r=e,this.processListeners(i),this.settings.enableOfflineSupport&&this._offlineStorageService&&this._courseId&&this.settings.syncOnInitialize&&this._offlineStorageService.isDeviceOnline()&&this._offlineStorageService.hasPendingOfflineData(this._courseId).then((e=>{e&&(this.apiLog(i,"Syncing pending offline data on initialization",_e.INFO),this._offlineStorageService?.syncOfflineData().then((e=>{e&&(this.apiLog(i,"Successfully synced offline data",_e.INFO),this.processListeners("OfflineDataSynced"))})))}))),this.apiLog(i,"returned: "+r,_e.INFO),this.clearSCORMError(r),r}apiLog(e,t,i,s){t=function(e,t,i){let s=e.padEnd(20)+": ";return i&&(s+=i,s=s.padEnd(70)),s+=t??"",s}(e,t,s),this.settings.logLevel>i||this._loggingService.log(i,t)}get settings(){return this._settings}set settings(e){const t=this._settings;this._settings={...this._settings,...e},this._httpService?.updateSettings(this._settings),void 0!==e.logLevel&&e.logLevel!==t.logLevel&&(this.settings.logLevel=e.logLevel,this._loggingService?.setLogLevel(e.logLevel)),void 0!==e.onLogMessage&&e.onLogMessage!==t.onLogMessage&&this._loggingService?.setLogHandler(e.onLogMessage)}async terminate(i,s){let n=t;if(this.checkState(s,this._error_codes.TERMINATION_BEFORE_INIT,this._error_codes.MULTIPLE_TERMINATION)){this.currentState=2,this.settings.enableOfflineSupport&&this._offlineStorageService&&this._courseId&&this.settings.syncOnTerminate&&this._offlineStorageService.isDeviceOnline()&&await this._offlineStorageService.hasPendingOfflineData(this._courseId)&&(this.apiLog(i,"Syncing pending offline data before termination",_e.INFO),await this._offlineStorageService.syncOfflineData());const result=await this.storeData(!0);(result.errorCode??0)>0&&this.throwSCORMError("api",result.errorCode),n=result?.result??t,s&&(this.lastErrorCode="0"),n=e,this.processListeners(i)}return this.apiLog(i,"returned: "+n,_e.INFO),this.clearSCORMError(n),n}getValue(e,t,i){let s="";if(this.checkState(t,this._error_codes.RETRIEVE_BEFORE_INIT,this._error_codes.RETRIEVE_AFTER_TERM)){try{s=this.getCMIValue(i)}catch(e){s=this.handleValueAccessException(i,e,s)}this.processListeners(e,i)}return this.apiLog(e,": returned: "+s,_e.INFO,i),void 0===s?"":("0"===this.lastErrorCode&&this.clearSCORMError(s),s)}setValue(e,i,s,n,r){void 0!==r&&(r+="");let o=t;if(this.checkState(s,this._error_codes.STORE_BEFORE_INIT,this._error_codes.STORE_AFTER_TERM)){try{o=this.setCMIValue(n,r)}catch(e){o=this.handleValueAccessException(n,e,o)}this.processListeners(e,n,r)}return void 0===o&&(o=t),this.lastErrorCode+""=="0"&&this.settings.autocommit&&this.scheduleCommit(1e3*this.settings.autocommitSeconds,i),this.apiLog(e,": "+r+": result: "+o,_e.INFO,n),"0"===this.lastErrorCode&&this.clearSCORMError(o),o}async commit(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.clearScheduledCommit();let s=t;if(this.checkState(i,this._error_codes.COMMIT_BEFORE_INIT,this._error_codes.COMMIT_AFTER_TERM)){const result=await this.storeData(!1);(result.errorCode??0)>0&&this.throwSCORMError("api",result.errorCode),s=result?.result??t,this.apiLog(e," Result: "+s,_e.DEBUG,"HttpRequest"),i&&(this.lastErrorCode="0"),this.processListeners(e),this.settings.enableOfflineSupport&&this._offlineStorageService&&this._offlineStorageService.isDeviceOnline()&&this._courseId&&this._offlineStorageService.hasPendingOfflineData(this._courseId).then((t=>{t&&(this.apiLog(e,"Syncing pending offline data",_e.INFO),this._offlineStorageService?.syncOfflineData().then((t=>{t?(this.apiLog(e,"Successfully synced offline data",_e.INFO),this.processListeners("OfflineDataSynced")):this.apiLog(e,"Failed to sync some offline data",_e.WARN)})))}))}return this.apiLog(e,"returned: "+s,_e.INFO),"0"===this.lastErrorCode&&this.clearSCORMError(s),s}getLastError(e){const t=this.lastErrorCode+"";return this.processListeners(e),this.apiLog(e,"returned: "+t,_e.INFO),t}getErrorString(e,t){let i="";return null!==t&&""!==t&&(i=this.getLmsErrorMessageDetails(t),this.processListeners(e)),this.apiLog(e,"returned: "+i,_e.INFO),i}getDiagnostic(e,t){let i="";return null!==t&&""!==t&&(i=this.getLmsErrorMessageDetails(t,!0),this.processListeners(e)),this.apiLog(e,"returned: "+i,_e.INFO),i}checkState(e,t,i){return this.isNotInitialized()?(this.throwSCORMError("api",t),!1):!e||!this.isTerminated()||(this.throwSCORMError("api",i),!1)}getLmsErrorMessageDetails(e){throw Error("The getLmsErrorMessageDetails method has not been implemented")}getCMIValue(e){throw Error("The getCMIValue method has not been implemented")}setCMIValue(e,t){throw Error("The setCMIValue method has not been implemented")}_commonSetCMIValue(i,s,n,r){if(!n||""===n)return t;this.lastErrorCode="0";const o=n.split(".");let a=this,c=t,l=!1;const h=`The data model element passed to ${i} (${n}) is not a valid SCORM data model element.`,_=s?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let t=0;o.length>t;t++){const i=o[t];if(t===o.length-1)if(s&&"{target="===i.substring(0,8)){if(this.isInitialized()){this.throwSCORMError(n,this._error_codes.READ_ONLY_ELEMENT);break}a={...a,attribute:r}}else{if(!this._checkObjectHasProperty(a,i)){this.throwSCORMError(n,_,h);break}if(D(n,"\\.correct_responses\\.\\d+$")&&this.isInitialized()&&"pattern"!==i&&(this.validateCorrectResponse(n,r),"0"!==this.lastErrorCode)){this.throwSCORMError(n,this._error_codes.TYPE_MISMATCH);break}if(!s||"0"===this._errorHandlingService.lastErrorCode){if("__proto__"===i||"constructor"===i){this.throwSCORMError(n,_,h);break}a[i]=r,c=e}}else{if(a=a[i],!a){this.throwSCORMError(n,_,h);break}if(a instanceof G){const e=parseInt(o[t+1],10);if(!isNaN(e)){const i=a.childArray[e];if(i)a=i,l=!0;else{const t=this.getChildElement(n,r,l);if(l=!0,!t){"0"===this.lastErrorCode&&this.throwSCORMError(n,_,h);break}a.initialized&&t.initialize(),a.childArray[e]=t,a=t}t++}}}}return c===t&&this.apiLog(i,`There was an error setting the value for: ${n}, value of: ${r}`,_e.WARN),c}_commonGetCMIValue(e,t,i){if(!i||""===i)return"";const s=i.split(".");let n=this,r=null;const o=`The data model element passed to ${e} (${i}) has not been initialized.`,a=`The data model element passed to ${e} (${i}) is not a valid SCORM data model element.`,c=t?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let e=0;s.length>e;e++){if(r=s[e],t){if("{target="===(r+"").substring(0,8)&&"function"==typeof n._isTargetValid)return n._isTargetValid((r+"").substring(8,(r+"").length-9));if(!this._checkObjectHasProperty(n,r))return void this.throwSCORMError(i,c,a)}else if(e===s.length-1&&!this._checkObjectHasProperty(n,r))return void this.throwSCORMError(i,c,a);if(n=n[r],void 0===n){this.throwSCORMError(i,c,a);break}if(n instanceof G){const t=parseInt(s[e+1],10);if(!isNaN(t)){const s=n.childArray[t];if(!s){this.throwSCORMError(i,this._error_codes.VALUE_NOT_INITIALIZED,o);break}n=s,e++}}}if(null!=n)return n;t||("_children"===r?this.throwSCORMError(i,this._error_codes.CHILDREN_ERROR,void 0):"_count"===r&&this.throwSCORMError(i,this._error_codes.COUNT_ERROR,void 0))}isInitialized(){return 1===this.currentState}isNotInitialized(){return 0===this.currentState}isTerminated(){return 2===this.currentState}on(e,t){this._eventService.on(e,t)}off(e,t){this._eventService.off(e,t)}clear(e){this._eventService.clear(e)}processListeners(e,t,i){this._eventService.processListeners(e,t,i)}throwSCORMError(e,t,i){this._errorHandlingService.throwSCORMError(e,t,i)}clearSCORMError(e){this._errorHandlingService.clearSCORMError(e)}loadFromFlattenedJSON(e,t){t||(t=""),this._serializationService.loadFromFlattenedJSON(e,t,((e,t)=>this.setCMIValue(e,t)),(()=>this.isNotInitialized()),(e=>{this.startingData=e}))}getFlattenedCMI(){return j(this.renderCMIToJSONObject())}loadFromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&""!==t||Object.hasOwnProperty.call(e,"cmi")||Object.hasOwnProperty.call(e,"adl")||(t="cmi"),this._serializationService.loadFromJSON(e,t,((e,t)=>this.setCMIValue(e,t)),(()=>this.isNotInitialized()),(e=>{this.startingData=e}))}renderCMIToJSONString(){return this._serializationService.renderCMIToJSONString(this.cmi,this.settings.sendFullCommit)}renderCMIToJSONObject(){return this._serializationService.renderCMIToJSONObject(this.cmi,this.settings.sendFullCommit)}async processHttpRequest(e,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.settings.enableOfflineSupport&&this._offlineStorageService&&!this._offlineStorageService.isDeviceOnline()&&this._courseId?(this.apiLog("processHttpRequest","Device is offline, storing data locally",_e.INFO),i&&"object"==typeof i&&"cmi"in i?await this._offlineStorageService.storeOffline(this._courseId,i):(this.apiLog("processHttpRequest","Invalid commit data format for offline storage",_e.ERROR),{result:t,errorCode:this._error_codes.GENERAL})):await this._httpService.processHttpRequest(e,i,s,((e,t,i,s)=>this.apiLog(e,t,i,s)),((e,t,i)=>this.processListeners(e,t,i)))}scheduleCommit(e,t){this._timeout||(this._timeout=new me(this,e,t),this.apiLog("scheduleCommit","scheduled",_e.DEBUG,""))}clearScheduledCommit(){this._timeout&&(this._timeout.cancel(),this._timeout=void 0,this.apiLog("clearScheduledCommit","cleared",_e.DEBUG,""))}_checkObjectHasProperty(e,t){return Object.hasOwnProperty.call(e,t)||null!=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t)||t in e}handleValueAccessException(e,i,s){return i instanceof T?(this.lastErrorCode=i.errorCode+"",s=t,this.throwSCORMError(e,i.errorCode,i.errorMessage)):this.throwSCORMError(e,this._error_codes.GENERAL,i instanceof Error&&i.message?i.message:"Unknown error"),s}getCommitObject(e){return this._serializationService.getCommitObject(e,this.settings.alwaysSendTotalTime,this.settings.renderCommonCommitFields,((e,t)=>this.renderCommitObject(e,t)),((e,t)=>this.renderCommitCMI(e,t)),this.settings.logLevel)}}class Scorm12API extends we{constructor(e){e&&void 0===e.mastery_override&&(e.mastery_override=!1),super(o,e),this.statusSetByModule=!1,this.cmi=new ee,this.nav=new te,this.LMSInitialize=this.lmsInitialize,this.LMSFinish=this.lmsFinish,this.LMSGetValue=this.lmsGetValue,this.LMSSetValue=this.lmsSetValue,this.LMSCommit=this.lmsCommit,this.LMSGetLastError=this.lmsGetLastError,this.LMSGetErrorString=this.lmsGetErrorString,this.LMSGetDiagnostic=this.lmsGetDiagnostic}reset(e){this.commonReset(e),this.cmi?.reset(),this.nav?.reset()}lmsInitialize(){return this.cmi.initialize(),this.cmi.core.lesson_status?this.statusSetByModule=!0:this.cmi.core.lesson_status="not attempted",this.initialize("LMSInitialize","LMS was already initialized!","LMS is already finished!")}lmsFinish(){return(async()=>{await this.internalFinish()})(),e}async internalFinish(){const result=await this.terminate("LMSFinish",!0);return result===e&&(""!==this.nav.event?this.processListeners("continue"===this.nav.event?"SequenceNext":"SequencePrevious"):this.settings.autoProgress&&this.processListeners("SequenceNext")),result}lmsGetValue(e){return this.getValue("LMSGetValue",!1,e)}lmsSetValue(e,t){return"cmi.core.lesson_status"===e&&(this.statusSetByModule=!0),this.setValue("LMSSetValue","LMSCommit",!1,e,t)}lmsCommit(){return this.settings.asyncCommit?this.scheduleCommit(500,"LMSCommit"):(async()=>{await this.commit("LMSCommit",!1)})(),e}lmsGetLastError(){return this.getLastError("LMSGetLastError")}lmsGetErrorString(e){return this.getErrorString("LMSGetErrorString",e)}lmsGetDiagnostic(e){return this.getDiagnostic("LMSGetDiagnostic",e)}setCMIValue(e,t){return this._commonSetCMIValue("LMSSetValue",!1,e,t)}getCMIValue(e){return this._commonGetCMIValue("getCMIValue",!1,e)}getChildElement(e,t,i){return D(e,"cmi\\.objectives\\.\\d+")?new J:i&&D(e,"cmi\\.interactions\\.\\d+\\.correct_responses\\.\\d+")?new Q:i&&D(e,"cmi\\.interactions\\.\\d+\\.objectives\\.\\d+")?new X:!i&&D(e,"cmi\\.interactions\\.\\d+")?new K:null}validateCorrectResponse(e,t){}getLmsErrorMessageDetails(e,t){let s="No Error",n="No Error";return i.error_descriptions[e+=""]&&(s=i.error_descriptions[e].basicMessage,n=i.error_descriptions[e].detailMessage),t?n:s}replaceWithAnotherScormAPI(e){this.cmi=e.cmi}renderCommitCMI(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.renderCMIToJSONObject();(e||t)&&(i.cmi.core.total_time=this.cmi.getCurrentTotalTime());const result=[],s=j(i);switch(this.settings.dataCommitFormat){case"flattened":return j(i);case"params":for(const e in s)({}).hasOwnProperty.call(s,e)&&result.push(`${e}=${s[e]}`);return result;default:return i}}renderCommitObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.renderCommitCMI(e,t),s=e||t?this.cmi.getCurrentTotalTime():"",n=b(s,c.CMITimespan),r=this.cmi.core.lesson_status;let o=he,a=ae;r&&(o="completed"===r||"passed"===r?ce:le,"passed"===r?a=re:"failed"===r&&(a=oe));const l=this.cmi?.core?.score?.getScoreObject()||{},h={successStatus:a,completionStatus:o,runtimeData:i,totalTimeSeconds:n};return l&&(h.score=l),h}async storeData(t){if(t){const e=this.cmi.core.lesson_status;this.cmi.core.lesson_status&&(this.statusSetByModule||"not attempted"!==this.cmi.core.lesson_status)||(this.cmi.core.lesson_status="completed"),"normal"===this.cmi.core.lesson_mode?"credit"===this.cmi.core.credit&&this.settings.mastery_override&&""!==this.cmi.student_data.mastery_score&&""!==this.cmi.core.score.raw&&(this.cmi.core.lesson_status=parseFloat(this.cmi.student_data.mastery_score)>parseFloat(this.cmi.core.score.raw)?"failed":"passed"):"browse"===this.cmi.core.lesson_mode&&""===(this.startingData?.cmi?.core?.lesson_status||"")&&"not attempted"===e&&(this.cmi.core.lesson_status="browsed")}const i=this.getCommitObject(t);return"string"==typeof this.settings.lmsCommitUrl?await this.processHttpRequest(this.settings.lmsCommitUrl,i,t):{result:e,errorCode:0}}}const Me=s.error_descriptions;class Te extends T{constructor(e,t){!{}.hasOwnProperty.call(Me,t+"")?super(e,101,Me[101].basicMessage,Me[101].detailMessage):super(e,t,Me[t+""].basicMessage,Me[t+""].detailMessage),Object.setPrototypeOf(this,Te.prototype)}}function Ie(e,t,i,s){return q(e,t,i,o.TYPE_MISMATCH,Te,s)}class Re extends y{constructor(){super("cmi.evaluation"),this.comments=new ye}initialize(){super.initialize(),this.comments?.initialize()}reset(){this._initialized=!1,this.comments?.reset()}toJSON(){this.jsonString=!0;const result={comments:this.comments};return this.jsonString=!1,result}}class ye extends G{constructor(){super({CMIElement:"cmi.evaluation.comments",children:s.comments_children,errorCode:o.INVALID_SET_VALUE,errorClass:Te})}}class Oe extends y{constructor(){super("cmi.evaluation.comments.n"),this._content="",this._location="",this._time=""}reset(){this._initialized=!1,this._content="",this._location="",this._time=""}get content(){return this._content}set content(content){Ie(this._cmi_element+".content",content,l.CMIString256)&&(this._content=content)}get location(){return this._location}set location(location){Ie(this._cmi_element+".location",location,l.CMIString256)&&(this._location=location)}get time(){return this._time}set time(time){Ie(this._cmi_element+".time",time,l.CMITime)&&(this._time=time)}toJSON(){this.jsonString=!0;const result={content:this.content,location:this.location,time:this.time};return this.jsonString=!1,result}}class Ae extends W{constructor(){super(s.student_preference_children),this._lesson_type="",this._text_color="",this._text_location="",this._text_size="",this._video="",this.windows=new G({CMIElement:"cmi.student_preference.windows",errorCode:o.INVALID_SET_VALUE,errorClass:Te,children:""})}initialize(){super.initialize(),this.windows?.initialize()}get lesson_type(){return this._lesson_type}set lesson_type(e){Ie(this._cmi_element+".lesson_type",e,l.CMIString256)&&(this._lesson_type=e)}get text_color(){return this._text_color}set text_color(e){Ie(this._cmi_element+".text_color",e,l.CMIString256)&&(this._text_color=e)}get text_location(){return this._text_location}set text_location(e){Ie(this._cmi_element+".text_location",e,l.CMIString256)&&(this._text_location=e)}get text_size(){return this._text_size}set text_size(e){Ie(this._cmi_element+".text_size",e,l.CMIString256)&&(this._text_size=e)}get video(){return this._video}set video(e){Ie(this._cmi_element+".video",e,l.CMIString256)&&(this._video=e)}toJSON(){this.jsonString=!0;const result={audio:this.audio,language:this.language,lesson_type:this.lesson_type,speed:this.speed,text:this.text,text_color:this.text_color,text_location:this.text_location,text_size:this.text_size,video:this.video,windows:this.windows};return this.jsonString=!1,result}}class Ne extends y{constructor(){super("cmi.student_demographics"),this.__children=s.student_demographics_children,this._city="",this._class="",this._company="",this._country="",this._experience="",this._familiar_name="",this._instructor_name="",this._title="",this._native_language="",this._state="",this._street_address="",this._telephone="",this._years_experience=""}reset(){this._initialized=!1}get _children(){return this.__children}get city(){return this._city}set city(e){if(this.initialized)throw new Te("cmi.student_demographics.city",o.READ_ONLY_ELEMENT);this._city=e}get class(){return this._class}set class(e){if(this.initialized)throw new Te("cmi.student_demographics.class",o.READ_ONLY_ELEMENT);this._class=e}get company(){return this._company}set company(e){if(this.initialized)throw new Te("cmi.student_demographics.company",o.READ_ONLY_ELEMENT);this._company=e}get country(){return this._country}set country(e){if(this.initialized)throw new Te("cmi.student_demographics.country",o.READ_ONLY_ELEMENT);this._country=e}get experience(){return this._experience}set experience(e){if(this.initialized)throw new Te("cmi.student_demographics.experience",o.READ_ONLY_ELEMENT);this._experience=e}get familiar_name(){return this._familiar_name}set familiar_name(e){if(this.initialized)throw new Te("cmi.student_demographics.familiar_name",o.READ_ONLY_ELEMENT);this._familiar_name=e}get instructor_name(){return this._instructor_name}set instructor_name(e){if(this.initialized)throw new Te("cmi.student_demographics.instructor_name",o.READ_ONLY_ELEMENT);this._instructor_name=e}get title(){return this._title}set title(e){if(this.initialized)throw new Te("cmi.student_demographics.title",o.READ_ONLY_ELEMENT);this._title=e}get native_language(){return this._native_language}set native_language(e){if(this.initialized)throw new Te("cmi.student_demographics.native_language",o.READ_ONLY_ELEMENT);this._native_language=e}get state(){return this._state}set state(e){if(this.initialized)throw new Te("cmi.student_demographics.state",o.READ_ONLY_ELEMENT);this._state=e}get street_address(){return this._street_address}set street_address(e){if(this.initialized)throw new Te("cmi.student_demographics.street_address",o.READ_ONLY_ELEMENT);this._street_address=e}get telephone(){return this._telephone}set telephone(e){if(this.initialized)throw new Te("cmi.student_demographics.telephone",o.READ_ONLY_ELEMENT);this._telephone=e}get years_experience(){return this._years_experience}set years_experience(e){if(this.initialized)throw new Te("cmi.student_demographics.years_experience",o.READ_ONLY_ELEMENT);this._years_experience=e}toJSON(){this.jsonString=!0;const result={city:this.city,class:this.class,company:this.company,country:this.country,experience:this.experience,familiar_name:this.familiar_name,instructor_name:this.instructor_name,title:this.title,native_language:this.native_language,state:this.state,street_address:this.street_address,telephone:this.telephone,years_experience:this.years_experience};return this.jsonString=!1,result}}class Le extends G{constructor(){super({CMIElement:"cmi.student_data.tries",children:s.tries_children})}}class be extends y{constructor(){super("cmi.student_data.tries.n"),this._status="",this._time="",this.score=new $({CMIElement:"cmi.student_data.tries.n.score",score_children:s.score_children,score_range:l.score_range,invalidErrorCode:o.INVALID_SET_VALUE,invalidTypeCode:o.TYPE_MISMATCH,invalidRangeCode:o.VALUE_OUT_OF_RANGE,errorClass:Te})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._status="",this._time="",this.score?.reset()}get status(){return this._status}set status(status){Ie(this._cmi_element+".status",status,l.CMIStatus2)&&(this._status=status)}get time(){return this._time}set time(time){Ie(this._cmi_element+".time",time,l.CMITime)&&(this._time=time)}toJSON(){this.jsonString=!0;const result={status:this.status,time:this.time,score:this.score};return this.jsonString=!1,result}}class xe extends G{constructor(){super({CMIElement:"cmi.student_data.attempt_records",children:s.attempt_records_children})}}class je extends y{constructor(){super("cmi.student_data.attempt_records.n"),this._lesson_status="",this.score=new $({CMIElement:"cmi.student_data.attempt_records.n.score",score_children:s.score_children,score_range:l.score_range,invalidErrorCode:o.INVALID_SET_VALUE,invalidTypeCode:o.TYPE_MISMATCH,invalidRangeCode:o.VALUE_OUT_OF_RANGE,errorClass:Te})}initialize(){super.initialize(),this._lesson_status="",this.score?.initialize()}reset(){this._initialized=!1,this.score?.reset()}get lesson_status(){return this._lesson_status}set lesson_status(lesson_status){Ie(this._cmi_element+".lesson_status",lesson_status,l.CMIStatus2)&&(this._lesson_status=lesson_status)}toJSON(){this.jsonString=!0;const result={lesson_status:this.lesson_status,score:this.score};return this.jsonString=!1,result}}class ze extends B{constructor(){super(s.student_data_children),this._tries_during_lesson="",this.tries=new Le,this.attempt_records=new xe}initialize(){super.initialize(),this.tries?.initialize(),this.attempt_records?.initialize()}reset(){this._initialized=!1,this.tries?.reset(!0),this.attempt_records?.reset(!0)}get tries_during_lesson(){return this._tries_during_lesson}set tries_during_lesson(e){if(this.initialized)throw new Te("cmi.student_data.tries_during_lesson",o.READ_ONLY_ELEMENT);this._tries_during_lesson=e}toJSON(){this.jsonString=!0;const result={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action,tries:this.tries,attempt_records:this.attempt_records};return this.jsonString=!1,result}}class De extends G{constructor(){super({CMIElement:"cmi.paths",children:s.paths_children})}}class Pe extends y{constructor(){super("cmi.paths.n"),this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}reset(){this._initialized=!1,this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}get location_id(){return this._location_id}set location_id(e){Ie(this._cmi_element+".location_id",e,l.CMIString256)&&(this._location_id=e)}get date(){return this._date}set date(e){Ie(this._cmi_element+".date",e,l.CMIString256)&&(this._date=e)}get time(){return this._time}set time(time){Ie(this._cmi_element+".time",time,l.CMITime)&&(this._time=time)}get status(){return this._status}set status(status){Ie(this._cmi_element+".status",status,l.CMIStatus2)&&(this._status=status)}get why_left(){return this._why_left}set why_left(e){Ie(this._cmi_element+".why_left",e,l.CMIString256)&&(this._why_left=e)}get time_in_element(){return this._time_in_element}set time_in_element(e){Ie(this._cmi_element+".time_in_element",e,l.CMITime)&&(this._time_in_element=e)}toJSON(){this.jsonString=!0;const result={location_id:this.location_id,date:this.date,time:this.time,status:this.status,why_left:this.why_left,time_in_element:this.time_in_element};return this.jsonString=!1,result}}let qe=class extends ee{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(s.cmi_children),e&&this.initialize(),this.student_preference=new Ae,this.student_data=new ze,this.student_demographics=new Ne,this.evaluation=new Re,this.paths=new De}initialize(){super.initialize(),this.student_preference?.initialize(),this.student_data?.initialize(),this.student_demographics?.initialize(),this.evaluation?.initialize(),this.paths?.initialize()}toJSON(){this.jsonString=!0;const result={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,student_demographics:this.student_demographics,interactions:this.interactions,evaluation:this.evaluation,paths:this.paths};return this.jsonString=!1,result}};const Fe=n.error_descriptions;class Ve extends T{constructor(e,t){!{}.hasOwnProperty.call(Fe,t+"")?super(e,101,Fe[101].basicMessage,Fe[101].detailMessage):super(e,t,Fe[t+""].basicMessage,Fe[t+""].detailMessage),Object.setPrototypeOf(this,Ve.prototype)}}function Ye(e,t,i,s){return q(e,t,i,a.TYPE_MISMATCH,Ve,s)}function ke(e,t,i){return F(e,t,i,a.VALUE_OUT_OF_RANGE,Ve)}class $e extends y{constructor(){super("cmi.learner_preference"),this.__children=n.student_preference_children,this._audio_level="1",this._language="",this._delivery_speed="1",this._audio_captioning="0"}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new Ve(this._cmi_element+"._children",a.READ_ONLY_ELEMENT)}get audio_level(){return this._audio_level}set audio_level(audio_level){Ye(this._cmi_element+".audio_level",audio_level,g)&&ke(this._cmi_element+".audio_level",audio_level,"0#999.9999999")&&(this._audio_level=audio_level)}get language(){return this._language}set language(language){Ye(this._cmi_element+".language",language,"^([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?$|^$")&&(this._language=language)}get delivery_speed(){return this._delivery_speed}set delivery_speed(delivery_speed){Ye(this._cmi_element+".delivery_speed",delivery_speed,g)&&ke(this._cmi_element+".delivery_speed",delivery_speed,"0#999.9999999")&&(this._delivery_speed=delivery_speed)}get audio_captioning(){return this._audio_captioning}set audio_captioning(audio_captioning){Ye(this._cmi_element+".audio_captioning",audio_captioning,"^-?([0-9]+)$")&&ke(this._cmi_element+".audio_captioning",audio_captioning,"-1#1")&&(this._audio_captioning=audio_captioning)}toJSON(){this.jsonString=!0;const result={audio_level:this.audio_level,language:this.language,delivery_speed:this.delivery_speed,audio_captioning:this.audio_captioning};return this.jsonString=!1,result}}const He={"true-false":{format:"^true$|^false$",max:1,delimiter:"",unique:!1},choice:{format:E,max:36,delimiter:"[,]",unique:!0},"fill-in":{format:_,max:10,delimiter:"[,]",unique:!1},"long-fill-in":{format:u,max:1,delimiter:"",unique:!1},matching:{format:p,format2:p,max:36,delimiter:"[,]",delimiter2:"[.]",unique:!1},performance:{format:"^$|"+p,format2:g+"|^$|"+p,max:250,delimiter:"[,]",delimiter2:"[.]",unique:!1},sequencing:{format:p,max:36,delimiter:"[,]",unique:!1},likert:{format:p,max:1,delimiter:"",unique:!1},numeric:{format:g,max:1,delimiter:"",unique:!1},other:{format:h,max:1,delimiter:"",unique:!1}},Ge={"true-false":{max:1,delimiter:"",unique:!1,duplicate:!1,format:"^true$|^false$",limit:1},choice:{max:36,delimiter:"[,]",unique:!0,duplicate:!1,format:E},"fill-in":{max:10,delimiter:"[,]",unique:!1,duplicate:!1,format:"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?})?(.{0,250})?)?$"},"long-fill-in":{max:1,delimiter:"",unique:!1,duplicate:!0,format:u},matching:{max:36,delimiter:"[,]",delimiter2:"[.]",unique:!1,duplicate:!1,format:p,format2:p},performance:{max:250,delimiter:"[,]",delimiter2:"[.]",delimiter3:"[:]",unique:!1,duplicate:!1,format:p,format2:`^(${p})$|^(?:\\d+(?:\\.\\d+)?(?::\\d+(?:\\.\\d+)?)?)$`},sequencing:{max:36,delimiter:"[,]",unique:!1,duplicate:!1,format:p},likert:{max:1,delimiter:"",unique:!1,duplicate:!1,format:p,limit:1},numeric:{max:2,delimiter:"[:]",unique:!1,duplicate:!1,format:g,limit:1},other:{max:1,delimiter:"",unique:!1,duplicate:!1,format:h,limit:1}};class Ue extends G{constructor(){super({CMIElement:"cmi.interactions",children:n.interactions_children,errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve})}}class Je extends y{constructor(){super("cmi.interactions.n"),this._id="",this._type="",this._timestamp="",this._weighting="",this._learner_response="",this._result="",this._latency="",this._description="",this.objectives=new G({CMIElement:"cmi.interactions.n.objectives",errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve,children:n.objectives_children}),this.correct_responses=new G({CMIElement:"cmi.interactions.n.correct_responses",errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve,children:n.correct_responses_children})}initialize(){super.initialize(),this.objectives?.initialize(),this.correct_responses?.initialize()}reset(){this._initialized=!1,this._id="",this._type="",this._timestamp="",this._weighting="",this._learner_response="",this._result="",this._latency="",this._description="",this.objectives=new G({CMIElement:"cmi.interactions.n.objectives",errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve,children:n.objectives_children}),this.correct_responses=new G({CMIElement:"cmi.interactions.n.correct_responses",errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve,children:n.correct_responses_children})}get id(){return this._id}set id(id){Ye(this._cmi_element+".id",id,E)&&(this._id=id)}get type(){return this._type}set type(type){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".type",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".type",type,"^(true-false|choice|fill-in|long-fill-in|matching|performance|sequencing|likert|numeric|other)$")&&(this._type=type)}get timestamp(){return this._timestamp}set timestamp(timestamp){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".timestamp",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".timestamp",timestamp,d)&&(this._timestamp=timestamp)}get weighting(){return this._weighting}set weighting(weighting){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".weighting",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".weighting",weighting,g)&&(this._weighting=weighting)}get learner_response(){return this._learner_response}set learner_response(learner_response){if(this.initialized&&(""===this._type||""===this._id))throw new Ve(this._cmi_element+".learner_response",a.DEPENDENCY_NOT_ESTABLISHED);{let e=[];const t=He[this.type];if(!t)throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH);if(t?.delimiter?e=learner_response.split("[,]"===t.delimiter?",":t.delimiter):e[0]=learner_response,0>=e.length||e.length>t.max)throw new Ve(this._cmi_element+".learner_response",a.GENERAL_SET_FAILURE);{const i=RegExp(t.format);for(let s=0;e.length>s;s++)if(t?.delimiter2){const n=e[s].split("[.]"===t.delimiter2?".":t.delimiter2);if(2!==n.length)throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH);if("performance"===this.type&&(""===n[0]||""===n[1]))throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH);if(!n[0].match(i))throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH);if(!t.format2||!n[1].match(RegExp(t.format2)))throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH)}else{if(!e[s].match(i))throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH);if(""!==e[s]&&t.unique)for(let t=0;s>t;t++)if(e[s]===e[t])throw new Ve(this._cmi_element+".learner_response",a.TYPE_MISMATCH)}}this._learner_response=learner_response}}get result(){return this._result}set result(result){Ye(this._cmi_element+".result",result,"^(correct|incorrect|unanticipated|neutral|-?([0-9]{1,4})(\\.[0-9]{1,18})?)$")&&(this._result=result)}get latency(){return this._latency}set latency(latency){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".latency",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".latency",latency,m)&&(this._latency=latency)}get description(){return this._description}set description(description){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".description",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".description",description,_,!0)&&(this._description=description)}toJSON(){this.jsonString=!0;const result={id:this.id,type:this.type,objectives:this.objectives,timestamp:this.timestamp,weighting:this.weighting,learner_response:this.learner_response,result:this.result,latency:this.latency,description:this.description,correct_responses:this.correct_responses};return this.jsonString=!1,result}}class Be extends y{constructor(){super("cmi.interactions.n.objectives.n"),this._id=""}reset(){this._initialized=!1,this._id=""}get id(){return this._id}set id(id){Ye(this._cmi_element+".id",id,E)&&(this._id=id)}toJSON(){this.jsonString=!0;const result={id:this.id};return this.jsonString=!1,result}}function We(e){return e.replace(/[[\]]/g,"")}function Ze(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ke(text,e){const t=Ze(e),i=RegExp("(?<!\\\\)"+t,"g"),s=RegExp("\\\\"+t,"g");return text.split(i).map((t=>t.replace(s,e)))}class Xe extends y{constructor(e){super("cmi.interactions.n.correct_responses.n"),this._pattern="",this._interactionType=e}reset(){this._initialized=!1,this._pattern=""}get pattern(){return this._pattern}set pattern(pattern){if("fill-in"!==this._interactionType||""!==pattern){if(Ye(this._cmi_element+".pattern",pattern,"^.*$")){if(this._interactionType){const e=Ge[this._interactionType];e&&("matching"===this._interactionType&&/\\[.,]/.test(pattern)||function(type,pattern,e){if(pattern.trim()!==pattern)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);const t=e.delimiter?We(e.delimiter):null,i=t?Ke(pattern,t):[pattern];for(const e of i)if(e.trim()!==e)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if("fill-in"===type&&""===pattern)return;const s=e.delimiter?We(e.delimiter):null;let n;if(n=s?Ke(pattern,s):[pattern],!e.delimiter&&pattern.includes(","))throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if((e.unique||!1===e.duplicate)&&new Set(n).size!==n.length)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if(0===n.length||n.length>e.max)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.GENERAL_SET_FAILURE);const r=RegExp(e.format),o=e.format2?RegExp(e.format2):null,c=e=>{if(!r.test(e))throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH)},l=(e,t)=>{if(!t)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);const i=We(t),s=e.split(RegExp("(?<!\\\\)"+Ze(i),"g")).map((e=>e.replace(RegExp("\\\\"+Ze(i),"g"),i)));if(2!==s.length||""===s[0]||""===s[1])throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if(!r.test(s[0])||o&&!o.test(s[1]))throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH)};for(const t of n)switch(type){case"numeric":{const i=e.delimiter?We(e.delimiter):":",s=t.split(i);if(1>s.length||s.length>2)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);s.forEach(c);break}case"performance":{const i=e.delimiter2;if(!i)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);const s=We(i),n=Ke(t,s);if(!t.includes(":")&&2!==n.length)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);const[c,l]=Ke(t,s);if(""===c||""===l||c===l)throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if(!r.test(c))throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);if(o&&!o.test(l))throw new Ve("cmi.interactions.n.correct_responses.n.pattern",a.TYPE_MISMATCH);break}default:e.delimiter2?l(t,e.delimiter2):c(t)}}(this._interactionType,pattern,e))}this._pattern=pattern}}else this._pattern=""}toJSON(){this.jsonString=!0;const result={pattern:this.pattern};return this.jsonString=!1,result}}class Qe extends ${constructor(){super({CMIElement:"cmi.score",score_children:n.score_children,max:"",invalidErrorCode:a.READ_ONLY_ELEMENT,invalidTypeCode:a.TYPE_MISMATCH,invalidRangeCode:a.VALUE_OUT_OF_RANGE,decimalRegex:g,errorClass:Ve}),this._scaled=""}reset(){this._initialized=!1,this._scaled="",this._raw="",this._min="",this._max=""}get scaled(){return this._scaled}set scaled(e){Ye(this._cmi_element+".scaled",e,g)&&ke(this._cmi_element+".scaled",e,"-1#1")&&(this._scaled=e)}getScoreObject(){const e=super.getScoreObject();return Number.isNaN(Number.parseFloat(this.scaled))||(e.scaled=Number.parseFloat(this.scaled)),e}toJSON(){this.jsonString=!0;const result={scaled:this.scaled,raw:this.raw,min:this.min,max:this.max};return this.jsonString=!1,result}}class et extends G{constructor(){super({CMIElement:"cmi.comments_from_lms",children:n.comments_children,errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve})}}class tt extends G{constructor(){super({CMIElement:"cmi.comments_from_learner",children:n.comments_children,errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve})}}class it extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super("cmi.comments_from_learner.n"),this._comment="",this._location="",this._timestamp="",this._comment="",this._location="",this._timestamp="",this._readOnlyAfterInit=e}reset(){this._initialized=!1}get comment(){return this._comment}set comment(comment){if(this.initialized&&this._readOnlyAfterInit)throw new Ve(this._cmi_element+".comment",a.READ_ONLY_ELEMENT);Ye(this._cmi_element+".comment",comment,u,!0)&&(this._comment=comment)}get location(){return this._location}set location(location){if(this.initialized&&this._readOnlyAfterInit)throw new Ve(this._cmi_element+".location",a.READ_ONLY_ELEMENT);Ye(this._cmi_element+".location",location,"^[\\u0000-\\uFFFF]{0,250}$")&&(this._location=location)}get timestamp(){return this._timestamp}set timestamp(timestamp){if(this.initialized&&this._readOnlyAfterInit)throw new Ve(this._cmi_element+".timestamp",a.READ_ONLY_ELEMENT);Ye(this._cmi_element+".timestamp",timestamp,d)&&(this._timestamp=timestamp)}toJSON(){this.jsonString=!0;const result={comment:this.comment,location:this.location,timestamp:this.timestamp};return this.jsonString=!1,result}}class st extends G{constructor(){super({CMIElement:"cmi.objectives",children:n.objectives_children,errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve})}findObjectiveById(id){return this.childArray.find((e=>e.id===id))}findObjectiveByIndex(e){return this.childArray[e]}setObjectiveByIndex(e,t){this.childArray[e]=t}}class nt extends y{constructor(){super("cmi.objectives.n"),this._id="",this._success_status="unknown",this._completion_status="unknown",this._progress_measure="",this._description="",this.score=new Qe}reset(){this._initialized=!1}initialize(){super.initialize(),this.score?.initialize()}get id(){return this._id}set id(id){Ye(this._cmi_element+".id",id,E)&&(this._id=id)}get success_status(){return this._success_status}set success_status(success_status){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".success_status",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".success_status",success_status,S)&&(this._success_status=success_status)}get completion_status(){return this._completion_status}set completion_status(completion_status){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".completion_status",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".completion_status",completion_status,f)&&(this._completion_status=completion_status)}get progress_measure(){return this._progress_measure}set progress_measure(progress_measure){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".progress_measure",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".progress_measure",progress_measure,g)&&ke(this._cmi_element+".progress_measure",progress_measure,"0#1")&&(this._progress_measure=progress_measure)}get description(){return this._description}set description(description){if(this.initialized&&""===this._id)throw new Ve(this._cmi_element+".description",a.DEPENDENCY_NOT_ESTABLISHED);Ye(this._cmi_element+".description",description,_,!0)&&(this._description=description)}toJSON(){this.jsonString=!0;const result={id:this.id,success_status:this.success_status,completion_status:this.completion_status,progress_measure:this.progress_measure,description:this.description,score:this.score};return this.jsonString=!1,result}}class rt extends y{constructor(){super("cmi"),this.__version="1.0",this.__children=n.cmi_children}get _version(){return this.__version}set _version(_version){throw new Ve(this._cmi_element+"._version",a.READ_ONLY_ELEMENT)}get _children(){return this.__children}set _children(_children){throw new Ve(this._cmi_element+"._children",a.READ_ONLY_ELEMENT)}reset(){this._initialized=!1}}class ot extends y{constructor(){super("cmi"),this._learner_id="",this._learner_name=""}get learner_id(){return this._learner_id}set learner_id(learner_id){if(this.initialized)throw new Ve(this._cmi_element+".learner_id",a.READ_ONLY_ELEMENT);this._learner_id=learner_id}get learner_name(){return this._learner_name}set learner_name(learner_name){if(this.initialized)throw new Ve(this._cmi_element+".learner_name",a.READ_ONLY_ELEMENT);this._learner_name=learner_name}reset(){this._initialized=!1}}class at extends y{constructor(){super("cmi"),this._completion_status="unknown",this._success_status="unknown",this._progress_measure=""}get completion_status(){return this._completion_status}set completion_status(completion_status){Ye(this._cmi_element+".completion_status",completion_status,f)&&(this._completion_status=completion_status)}get success_status(){return this._success_status}set success_status(success_status){Ye(this._cmi_element+".success_status",success_status,S)&&(this._success_status=success_status)}get progress_measure(){return this._progress_measure}set progress_measure(progress_measure){Ye(this._cmi_element+".progress_measure",progress_measure,g)&&ke(this._cmi_element+".progress_measure",progress_measure,"0#1")&&(this._progress_measure=progress_measure)}reset(){this._initialized=!1,this._completion_status="unknown",this._success_status="unknown",this._progress_measure=""}}class ct extends y{constructor(){super("cmi"),this._entry="",this._exit="",this._session_time="PT0H0M0S",this._total_time=""}get entry(){return this._entry}set entry(entry){if(this.initialized)throw new Ve(this._cmi_element+".entry",a.READ_ONLY_ELEMENT);this._entry=entry}get exit(){if(!this.jsonString)throw new Ve(this._cmi_element+".exit",a.WRITE_ONLY_ELEMENT);return this._exit}set exit(exit){Ye(this._cmi_element+".exit",exit,"^(time-out|suspend|logout|normal)$",!0)&&(this._exit=exit)}get session_time(){if(!this.jsonString)throw new Ve(this._cmi_element+".session_time",a.WRITE_ONLY_ELEMENT);return this._session_time}set session_time(session_time){Ye(this._cmi_element+".session_time",session_time,m)&&(this._session_time=session_time)}get total_time(){return this._total_time}set total_time(total_time){if(this.initialized)throw new Ve(this._cmi_element+".total_time",a.READ_ONLY_ELEMENT);this._total_time=total_time}getCurrentTotalTime(e){let t=this._session_time;if(null!=e){const i=(new Date).getTime()-e;t=L(i/1e3)}return function(e,t,i){const s=RegExp(i);return L(x(e,s)+x(t,s))}(this._total_time,t,m)}reset(){this._initialized=!1,this._entry="",this._exit="",this._session_time="PT0H0M0S"}}class lt extends y{constructor(){super("cmi"),this._location="",this._launch_data="",this._suspend_data=""}get location(){return this._location}set location(location){Ye(this._cmi_element+".location",location,"^[\\u0000-\\uFFFF]{0,1000}$")&&(this._location=location)}get launch_data(){return this._launch_data}set launch_data(launch_data){if(this.initialized)throw new Ve(this._cmi_element+".launch_data",a.READ_ONLY_ELEMENT);this._launch_data=launch_data}get suspend_data(){return this._suspend_data}set suspend_data(suspend_data){Ye(this._cmi_element+".suspend_data",suspend_data,"^[\\u0000-\\uFFFF]{0,64000}$",!0)&&(this._suspend_data=suspend_data)}reset(){this._initialized=!1,this._location="",this._suspend_data=""}}class ht extends y{constructor(){super("cmi"),this._credit="credit",this._mode="normal",this._time_limit_action="continue,no message",this._max_time_allowed=""}get credit(){return this._credit}set credit(credit){if(this.initialized)throw new Ve(this._cmi_element+".credit",a.READ_ONLY_ELEMENT);this._credit=credit}get mode(){return this._mode}set mode(mode){if(this.initialized)throw new Ve(this._cmi_element+".mode",a.READ_ONLY_ELEMENT);this._mode=mode}get time_limit_action(){return this._time_limit_action}set time_limit_action(time_limit_action){if(this.initialized)throw new Ve(this._cmi_element+".time_limit_action",a.READ_ONLY_ELEMENT);this._time_limit_action=time_limit_action}get max_time_allowed(){return this._max_time_allowed}set max_time_allowed(max_time_allowed){if(this.initialized)throw new Ve(this._cmi_element+".max_time_allowed",a.READ_ONLY_ELEMENT);this._max_time_allowed=max_time_allowed}reset(){this._initialized=!1}}class _t extends y{constructor(){super("cmi"),this._scaled_passing_score="",this._completion_threshold=""}get scaled_passing_score(){return this._scaled_passing_score}set scaled_passing_score(scaled_passing_score){if(this.initialized)throw new Ve(this._cmi_element+".scaled_passing_score",a.READ_ONLY_ELEMENT);this._scaled_passing_score=scaled_passing_score}get completion_threshold(){return this._completion_threshold}set completion_threshold(e){if(this.initialized)throw new Ve(this._cmi_element+".completion_threshold",a.READ_ONLY_ELEMENT);this._completion_threshold=e}reset(){this._initialized=!1}}class ut extends O{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super("cmi"),this.metadata=new rt,this.learner=new ot,this.status=new at,this.session=new ct,this.content=new lt,this.settings=new ht,this.thresholds=new _t,this.learner_preference=new $e,this.score=new Qe,this.comments_from_learner=new tt,this.comments_from_lms=new et,this.interactions=new Ue,this.objectives=new st,e&&this.initialize()}initialize(){super.initialize(),this.metadata?.initialize(),this.learner?.initialize(),this.status?.initialize(),this.session?.initialize(),this.content?.initialize(),this.settings?.initialize(),this.thresholds?.initialize(),this.learner_preference?.initialize(),this.score?.initialize(),this.comments_from_learner?.initialize(),this.comments_from_lms?.initialize(),this.interactions?.initialize(),this.objectives?.initialize()}reset(){this._initialized=!1,this.metadata?.reset(),this.learner?.reset(),this.status?.reset(),this.session?.reset(),this.content?.reset(),this.settings?.reset(),this.thresholds?.reset(),this.objectives?.reset(!1),this.interactions?.reset(!0),this.score?.reset(),this.comments_from_learner?.reset(),this.comments_from_lms?.reset(),this.learner_preference?.reset()}get _version(){return this.metadata._version}set _version(_version){this.metadata._version=_version}get _children(){return this.metadata._children}set _children(_children){this.metadata._children=_children}get completion_status(){return this.status.completion_status}set completion_status(completion_status){this.status.completion_status=completion_status}get completion_threshold(){return this.thresholds.completion_threshold}set completion_threshold(e){this.thresholds.completion_threshold=e}get credit(){return this.settings.credit}set credit(credit){this.settings.credit=credit}get entry(){return this.session.entry}set entry(entry){this.session.entry=entry}get exit(){return this.session.jsonString=this.jsonString,this.session.exit}set exit(exit){this.session.exit=exit}get launch_data(){return this.content.launch_data}set launch_data(launch_data){this.content.launch_data=launch_data}get learner_id(){return this.learner.learner_id}set learner_id(learner_id){this.learner.learner_id=learner_id}get learner_name(){return this.learner.learner_name}set learner_name(learner_name){this.learner.learner_name=learner_name}get location(){return this.content.location}set location(location){this.content.location=location}get max_time_allowed(){return this.settings.max_time_allowed}set max_time_allowed(max_time_allowed){this.settings.max_time_allowed=max_time_allowed}get mode(){return this.settings.mode}set mode(mode){this.settings.mode=mode}get progress_measure(){return this.status.progress_measure}set progress_measure(progress_measure){this.status.progress_measure=progress_measure}get scaled_passing_score(){return this.thresholds.scaled_passing_score}set scaled_passing_score(scaled_passing_score){this.thresholds.scaled_passing_score=scaled_passing_score}get session_time(){return this.session.jsonString=this.jsonString,this.session.session_time}set session_time(session_time){this.session.session_time=session_time}get success_status(){return this.status.success_status}set success_status(success_status){this.status.success_status=success_status}get suspend_data(){return this.content.suspend_data}set suspend_data(suspend_data){this.content.suspend_data=suspend_data}get time_limit_action(){return this.settings.time_limit_action}set time_limit_action(time_limit_action){this.settings.time_limit_action=time_limit_action}get total_time(){return this.session.total_time}set total_time(total_time){this.session.total_time=total_time}getCurrentTotalTime(){return this.session.getCurrentTotalTime(this.start_time)}toJSON(){this.jsonString=!0,this.session.jsonString=!0;const result={comments_from_learner:this.comments_from_learner,comments_from_lms:this.comments_from_lms,completion_status:this.completion_status,completion_threshold:this.completion_threshold,credit:this.credit,entry:this.entry,exit:this.exit,interactions:this.interactions,launch_data:this.launch_data,learner_id:this.learner_id,learner_name:this.learner_name,learner_preference:this.learner_preference,location:this.location,max_time_allowed:this.max_time_allowed,mode:this.mode,objectives:this.objectives,progress_measure:this.progress_measure,scaled_passing_score:this.scaled_passing_score,score:this.score,session_time:this.session_time,success_status:this.success_status,suspend_data:this.suspend_data,time_limit_action:this.time_limit_action};return this.jsonString=!1,this.session.jsonString=!1,result}}class dt extends y{constructor(){super("adl"),this.data=new gt,this._sequencing=null,this.nav=new mt,this.data=new gt}initialize(){super.initialize(),this.nav?.initialize()}reset(){this._initialized=!1,this.nav?.reset()}get sequencing(){return this._sequencing}set sequencing(e){this._sequencing=e,e&&(e.adlNav=this.nav,this.nav.sequencing=e)}toJSON(){this.jsonString=!0;const result={nav:this.nav,data:this.data};return this.jsonString=!1,result}}class mt extends y{constructor(){super("adl.nav"),this._request="_none_",this._sequencing=null,this.request_valid=new Et}get sequencing(){return this._sequencing}set sequencing(e){this._sequencing=e}initialize(){super.initialize(),this.request_valid?.initialize()}reset(){this._initialized=!1,this._request="_none_",this._sequencing=null,this.request_valid?.reset()}get request(){return this._request}set request(request){Ye(this._cmi_element+".request",request,v)&&this._request!==request&&(this._request=request,this._sequencing&&this._sequencing.processNavigationRequest(request))}toJSON(){this.jsonString=!0;const result={request:this.request};return this.jsonString=!1,result}}class gt extends G{constructor(){super({CMIElement:"adl.data",children:n.adl_data_children,errorCode:a.READ_ONLY_ELEMENT,errorClass:Ve})}}class pt extends y{constructor(){super("adl.data.n"),this._id="",this._store=""}reset(){this._initialized=!1}get id(){return this._id}set id(id){Ye(this._cmi_element+".id",id,E)&&(this._id=id)}get store(){return this._store}set store(e){Ye(this._cmi_element+".store",e,u)&&(this._store=e)}toJSON(){this.jsonString=!0;const result={id:this._id,store:this._store};return this.jsonString=!1,result}}class Et extends y{constructor(){super("adl.nav.request_valid"),this._continue="unknown",this._previous="unknown",this._choice={},this._jump={}}reset(){this._initialized=!1,this._continue="unknown",this._previous="unknown"}get continue(){return this._continue}set continue(e){if(this.initialized)throw new Ve(this._cmi_element+".continue",a.READ_ONLY_ELEMENT);Ye(this._cmi_element+".continue",e,C)&&(this._continue=e)}get previous(){return this._previous}set previous(e){if(this.initialized)throw new Ve(this._cmi_element+".previous",a.READ_ONLY_ELEMENT);Ye(this._cmi_element+".previous",e,C)&&(this._previous=e)}get choice(){return this._choice}set choice(e){if(this.initialized)throw new Ve(this._cmi_element+".choice",a.READ_ONLY_ELEMENT);if("object"!=typeof e)throw new Ve(this._cmi_element+".choice",a.TYPE_MISMATCH);for(const t in e)if({}.hasOwnProperty.call(e,t)&&Ye(this._cmi_element+".choice."+t,e[t],C)&&Ye(this._cmi_element+".choice."+t,t,w)){const i=e[t];"true"===i?this._choice[t]=se:"false"===i?this._choice[t]=ne:"unknown"===i&&(this._choice[t]=ie)}}get jump(){return this._jump}set jump(e){if(this.initialized)throw new Ve(this._cmi_element+".jump",a.READ_ONLY_ELEMENT);if("object"!=typeof e)throw new Ve(this._cmi_element+".jump",a.TYPE_MISMATCH);for(const t in e)if({}.hasOwnProperty.call(e,t)&&Ye(this._cmi_element+".jump."+t,e[t],C)&&Ye(this._cmi_element+".jump."+t,t,w)){const i=e[t];"true"===i?this._jump[t]=se:"false"===i?this._jump[t]=ne:"unknown"===i&&(this._jump[t]=ie)}}toJSON(){this.jsonString=!0;const result={previous:this._previous,continue:this._continue,choice:this._choice,jump:this._jump};return this.jsonString=!1,result}}var ft=(e=>(e.SKIP="skip",e.DISABLED="disabled",e.HIDE_FROM_CHOICE="hideFromChoice",e.STOP_FORWARD_TRAVERSAL="stopForwardTraversal",e.EXIT_PARENT="exitParent",e.EXIT_ALL="exitAll",e.RETRY="retry",e.RETRY_ALL="retryAll",e.CONTINUE="continue",e.PREVIOUS="previous",e.EXIT="exit",e))(ft||{});class St extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;super("ruleCondition"),this._condition="always",this._operator=null,this._parameters=new Map,this._condition=e,this._operator=t,this._parameters=i}reset(){this._initialized=!1,this._condition="always",this._operator=null,this._parameters=new Map}get condition(){return this._condition}set condition(e){this._condition=e}get operator(){return this._operator}set operator(e){this._operator=e}get parameters(){return this._parameters}set parameters(e){this._parameters=e}evaluate(e){let result;switch(this._condition){case"satisfied":result=e.successStatus===re;break;case"objectiveStatusKnown":case"objectiveMeasureKnown":result=!!e.objectiveMeasureStatus;break;case"objectiveMeasureGreaterThan":{const t=this._parameters.get("threshold")||0;result=e.objectiveMeasureStatus&&e.objectiveNormalizedMeasure>t;break}case"objectiveMeasureLessThan":{const t=this._parameters.get("threshold")||0;result=e.objectiveMeasureStatus&&t>e.objectiveNormalizedMeasure;break}case"completed":result=e.isCompleted;break;case"progressKnown":result="unknown"!==e.completionStatus;break;case"attempted":result=e.attemptCount>0;break;case"attemptLimitExceeded":{const t=this._parameters.get("attemptLimit")||0;result=e.attemptCount>=t;break}case"timeLimitExceeded":case"outsideAvailableTimeRange":default:result=!1;break;case"always":result=!0}return"not"===this._operator&&(result=!result),result}toJSON(){this.jsonString=!0;const result={condition:this._condition,operator:this._operator,parameters:Object.fromEntries(this._parameters)};return this.jsonString=!1,result}}class vt extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"skip",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"and";super("sequencingRule"),this._conditions=[],this._action="skip",this._conditionCombination="and",this._action=e,this._conditionCombination=t}reset(){this._initialized=!1,this._conditions=[],this._action="skip",this._conditionCombination="and"}get conditions(){return this._conditions}addCondition(e){if(!(e instanceof St))throw new Ve(this._cmi_element+".conditions",a.TYPE_MISMATCH);this._conditions.includes(e)||this._conditions.push(e)}removeCondition(e){if(!(e instanceof St))throw new Ve(this._cmi_element+".conditions",a.TYPE_MISMATCH);const t=this._conditions.indexOf(e);return-1!==t&&(this._conditions.splice(t,1),!0)}get action(){return this._action}set action(e){this._action=e}get conditionCombination(){return this._conditionCombination}set conditionCombination(e){this._conditionCombination=e}evaluate(e){return 0===this._conditions.length||("all"===this._conditionCombination||"and"===this._conditionCombination?this._conditions.every((t=>t.evaluate(e))):("any"===this._conditionCombination||"or"===this._conditionCombination)&&this._conditions.some((t=>t.evaluate(e))))}toJSON(){this.jsonString=!0;const result={conditions:this._conditions,action:this._action,conditionCombination:this._conditionCombination};return this.jsonString=!1,result}}class Ct extends y{constructor(){super("sequencingRules"),this._preConditionRules=[],this._exitConditionRules=[],this._postConditionRules=[]}reset(){this._initialized=!1,this._preConditionRules=[],this._exitConditionRules=[],this._postConditionRules=[]}get preConditionRules(){return this._preConditionRules}addPreConditionRule(e){if(!(e instanceof vt))throw new Ve(this._cmi_element+".preConditionRules",a.TYPE_MISMATCH);this._preConditionRules.push(e)}get exitConditionRules(){return this._exitConditionRules}addExitConditionRule(e){if(!(e instanceof vt))throw new Ve(this._cmi_element+".exitConditionRules",a.TYPE_MISMATCH);this._exitConditionRules.push(e)}get postConditionRules(){return this._postConditionRules}addPostConditionRule(e){if(!(e instanceof vt))throw new Ve(this._cmi_element+".postConditionRules",a.TYPE_MISMATCH);this._postConditionRules.push(e)}evaluatePreConditionRules(e){for(const t of this._preConditionRules)if(t.evaluate(e))return t.action;return null}evaluateExitConditionRules(e){for(const t of this._exitConditionRules)if(t.evaluate(e))return t.action;return null}evaluatePostConditionRules(e){for(const t of this._postConditionRules)if(t.evaluate(e))return t.action;return null}toJSON(){this.jsonString=!0;const result={preConditionRules:this._preConditionRules,exitConditionRules:this._exitConditionRules,postConditionRules:this._postConditionRules};return this.jsonString=!1,result}}class wt extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;super("rollupCondition"),this._condition="always",this._parameters=new Map,this._condition=e,this._parameters=t}reset(){this._initialized=!1}get condition(){return this._condition}set condition(e){this._condition=e}get parameters(){return this._parameters}set parameters(e){this._parameters=e}evaluate(e){switch(this._condition){case"satisfied":return e.successStatus===re;case"objectiveStatusKnown":case"objectiveMeasureKnown":return e.objectiveMeasureStatus;case"objectiveMeasureGreaterThan":{const t=this._parameters.get("threshold")||0;return e.objectiveMeasureStatus&&e.objectiveNormalizedMeasure>t}case"objectiveMeasureLessThan":{const t=this._parameters.get("threshold")||0;return e.objectiveMeasureStatus&&t>e.objectiveNormalizedMeasure}case"completed":return e.isCompleted;case"progressKnown":return e.completionStatus!==he;case"attempted":return e.attemptCount>0;case"notAttempted":return 0===e.attemptCount;case"always":return!0;default:return!1}}toJSON(){this.jsonString=!0;const result={condition:this._condition,parameters:Object.fromEntries(this._parameters)};return this.jsonString=!1,result}}class Mt extends y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"satisfied",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super("rollupRule"),this._conditions=[],this._action="satisfied",this._consideration="all",this._minimumCount=0,this._minimumPercent=0,this._action=e,this._consideration=t,this._minimumCount=i,this._minimumPercent=s}reset(){this._initialized=!1,this._conditions=[]}get conditions(){return this._conditions}addCondition(e){if(!(e instanceof wt))throw new Ve(this._cmi_element+".conditions",a.TYPE_MISMATCH);this._conditions.push(e)}removeCondition(e){const t=this._conditions.indexOf(e);return-1!==t&&(this._conditions.splice(t,1),!0)}get action(){return this._action}set action(e){this._action=e}get consideration(){return this._consideration}set consideration(e){this._consideration=e}get minimumCount(){return this._minimumCount}set minimumCount(e){0>e||(this._minimumCount=e)}get minimumPercent(){return this._minimumPercent}set minimumPercent(e){0>e||e>100||(this._minimumPercent=e)}evaluate(e){if(0===e.length)return!1;const t=e.filter((e=>this._conditions.every((t=>t.evaluate(e)))));switch(this._consideration){case"all":return t.length===e.length;case"any":return t.length>0;case"none":return 0===t.length;case"atLeastCount":return t.length>=this._minimumCount;case"atLeastPercent":return t.length/e.length*100>=this._minimumPercent;default:return!1}}toJSON(){this.jsonString=!0;const result={conditions:this._conditions,action:this._action,consideration:this._consideration,minimumCount:this._minimumCount,minimumPercent:this._minimumPercent};return this.jsonString=!1,result}}class Tt extends y{constructor(){super("rollupRules"),this._rules=[]}reset(){this._initialized=!1,this._rules=[]}get rules(){return this._rules}addRule(e){if(!(e instanceof Mt))throw new Ve(this._cmi_element+".rules",a.TYPE_MISMATCH);this._rules.push(e)}removeRule(e){const t=this._rules.indexOf(e);return-1!==t&&(this._rules.splice(t,1),!0)}processRollup(e){if(!e||0===e.children.length)return;const t=e.children;let i=!1,s=!1;for(const n of this._rules)if(n.evaluate(t))switch(n.action){case"satisfied":e.successStatus=re,s=!0;break;case"notSatisfied":e.successStatus=oe,s=!0;break;case"completed":e.completionStatus=ce,e.isCompleted=!0,i=!0;break;case"incomplete":e.completionStatus=le,e.isCompleted=!1,i=!0}i||this._defaultCompletionRollup(e,t),s||this._defaultSuccessRollup(e,t)}_defaultCompletionRollup(e,t){t.every((e=>e.isCompleted))?(e.completionStatus=ce,e.isCompleted=!0):t.some((e=>e.completionStatus===le))&&(e.completionStatus=le,e.isCompleted=!1)}_defaultSuccessRollup(e,t){t.every((e=>e.successStatus===re))?e.successStatus=re:t.some((e=>e.successStatus===oe))&&(e.successStatus=oe)}toJSON(){this.jsonString=!0;const result={rules:this._rules};return this.jsonString=!1,result}}const It=["aa","ab","ae","af","ak","am","an","ar","as","av","ay","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","dv","dz","ee","el","en","eo","es","et","eu","fa","ff","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","iu","ja","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lu","lv","mg","mh","mi","mk","ml","mn","mo","mr","ms","mt","my","na","nb","nd","ne","ng","nl","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sc","sd","se","sg","sh","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zu","aar","abk","ave","afr","aka","amh","arg","ara","asm","ava","aym","aze","bak","bel","bul","bih","bis","bam","ben","tib","bod","bre","bos","cat","che","cha","cos","cre","cze","ces","chu","chv","wel","cym","dan","ger","deu","div","dzo","ewe","gre","ell","eng","epo","spa","est","baq","eus","per","fas","ful","fin","fij","fao","fre","fra","fry","gle","gla","glg","grn","guj","glv","hau","heb","hin","hmo","hrv","hat","hun","arm","hye","her","ina","ind","ile","ibo","iii","ipk","ido","ice","isl","ita","iku","jpn","jav","geo","kat","kon","kik","kua","kaz","kal","khm","kan","kor","kau","kas","kur","kom","cor","kir","lat","ltz","lug","lim","lin","lao","lit","lub","lav","mlg","mah","mao","mri","mac","mkd","mal","mon","mol","mar","may","msa","mlt","bur","mya","nau","nob","nde","nep","ndo","dut","nld","nno","nor","nbl","nav","nya","oci","oji","orm","ori","oss","pan","pli","pol","pus","por","que","roh","run","rum","ron","rus","kin","san","srd","snd","sme","sag","slo","sin","slk","slv","smo","sna","som","alb","sqi","srp","ssw","sot","sun","swe","swa","tam","tel","tgk","tha","tir","tuk","tgl","tsn","ton","tur","tso","tat","twi","tah","uig","ukr","urd","uzb","ven","vie","vol","wln","wol","xho","yid","yor","zha","chi","zho","zul"];class Rt extends y{constructor(){let id=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super("activity"),this._id="",this._title="",this._children=[],this._parent=null,this._isVisible=!0,this._isActive=!1,this._isSuspended=!1,this._isCompleted=!1,this._completionStatus=he,this._successStatus=ae,this._attemptCount=0,this._attemptCompletionAmount=0,this._attemptAbsoluteDuration="PT0H0M0S",this._attemptExperiencedDuration="PT0H0M0S",this._activityAbsoluteDuration="PT0H0M0S",this._activityExperiencedDuration="PT0H0M0S",this._objectiveSatisfiedStatus=!1,this._objectiveMeasureStatus=!1,this._objectiveNormalizedMeasure=0,this._id=id,this._title=e}initialize(){super.initialize();for(const e of this._children)e.initialize()}reset(){this._initialized=!1,this._isActive=!1,this._isSuspended=!1,this._isCompleted=!1,this._completionStatus=he,this._successStatus=ae,this._attemptCount=0,this._attemptCompletionAmount=0,this._attemptAbsoluteDuration="PT0H0M0S",this._attemptExperiencedDuration="PT0H0M0S",this._activityAbsoluteDuration="PT0H0M0S",this._activityExperiencedDuration="PT0H0M0S",this._objectiveSatisfiedStatus=!1,this._objectiveMeasureStatus=!1,this._objectiveNormalizedMeasure=0;for(const e of this._children)e.reset()}get id(){return this._id}set id(id){Ye(this._cmi_element+".id",id,E)&&(this._id=id)}get title(){return this._title}set title(e){Ye(this._cmi_element+".title",e,_)&&(this._title=e)}get children(){return this._children}addChild(e){if(!(e instanceof Rt))throw new Ve(this._cmi_element+".children",a.TYPE_MISMATCH);e._parent=this,this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e._parent=null,!0)}get parent(){return this._parent}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e}get isActive(){return this._isActive}set isActive(e){this._isActive=e}get isSuspended(){return this._isSuspended}set isSuspended(e){this._isSuspended=e}get isCompleted(){return this._isCompleted}set isCompleted(e){this._isCompleted=e}get completionStatus(){return this._completionStatus}set completionStatus(e){this._completionStatus=e,this._isCompleted=e===ce}get successStatus(){return this._successStatus}set successStatus(e){this._successStatus=e}get attemptCount(){return this._attemptCount}incrementAttemptCount(){this._attemptCount++}get objectiveMeasureStatus(){return this._objectiveMeasureStatus}set objectiveMeasureStatus(e){this._objectiveMeasureStatus=e}get objectiveNormalizedMeasure(){return this._objectiveNormalizedMeasure}set objectiveNormalizedMeasure(e){this._objectiveNormalizedMeasure=e}toJSON(){this.jsonString=!0;const result={id:this._id,title:this._title,isVisible:this._isVisible,isActive:this._isActive,isSuspended:this._isSuspended,isCompleted:this._isCompleted,completionStatus:this._completionStatus,successStatus:this._successStatus,attemptCount:this._attemptCount,attemptCompletionAmount:this._attemptCompletionAmount,attemptAbsoluteDuration:this._attemptAbsoluteDuration,attemptExperiencedDuration:this._attemptExperiencedDuration,activityAbsoluteDuration:this._activityAbsoluteDuration,activityExperiencedDuration:this._activityExperiencedDuration,objectiveSatisfiedStatus:this._objectiveSatisfiedStatus,objectiveMeasureStatus:this._objectiveMeasureStatus,objectiveNormalizedMeasure:this._objectiveNormalizedMeasure,children:this._children.map((e=>e.toJSON()))};return this.jsonString=!1,result}}class yt extends y{constructor(){super("activityTree"),this._root=null,this._currentActivity=null,this._suspendedActivity=null,this._activities=new Map}initialize(){super.initialize(),this._root&&this._root.initialize()}reset(){this._initialized=!1,this._currentActivity=null,this._suspendedActivity=null,this._root&&this._root.reset()}get root(){return this._root}set root(e){if(null!==e&&!(e instanceof Rt))throw new Ve(this._cmi_element+".root",a.TYPE_MISMATCH);this._root=e,e&&(this._activities.set(e.id,e),this._addActivitiesToMap(e))}_addActivitiesToMap(e){for(const t of e.children)this._activities.set(t.id,t),this._addActivitiesToMap(t)}get currentActivity(){return this._currentActivity}set currentActivity(e){if(null!==e&&!(e instanceof Rt))throw new Ve(this._cmi_element+".currentActivity",a.TYPE_MISMATCH);this._currentActivity&&(this._currentActivity.isActive=!1),this._currentActivity=e,e&&(e.isActive=!0)}get suspendedActivity(){return this._suspendedActivity}set suspendedActivity(e){if(null!==e&&!(e instanceof Rt))throw new Ve(this._cmi_element+".suspendedActivity",a.TYPE_MISMATCH);this._suspendedActivity&&(this._suspendedActivity.isSuspended=!1),this._suspendedActivity=e,e&&(e.isSuspended=!0)}getActivity(id){return this._activities.get(id)}getAllActivities(){return Array.from(this._activities.values())}getParent(e){return e.parent}getChildren(e){return e.children}getSiblings(e){return e.parent?e.parent.children.filter((t=>t!==e)):[]}getNextSibling(e){if(!e.parent)return null;const t=e.parent.children,i=t.indexOf(e);return-1===i||i===t.length-1?null:t[i+1]}getPreviousSibling(e){if(!e.parent)return null;const t=e.parent.children,i=t.indexOf(e);return i>0?t[i-1]:null}getFirstChild(e){return 0===e.children.length?null:e.children[0]}getLastChild(e){return 0===e.children.length?null:e.children[e.children.length-1]}getCommonAncestor(e,t){const i=[];let s=e;for(;s;)i.unshift(s),s=s.parent;for(s=t;s;){if(i.includes(s))return s;s=s.parent}return null}toJSON(){this.jsonString=!0;const result={root:this._root,currentActivity:this._currentActivity?this._currentActivity.id:null,suspendedActivity:this._suspendedActivity?this._suspendedActivity.id:null};return this.jsonString=!1,result}}class Ot extends y{constructor(){super("sequencingControls"),this._enabled=!0,this._choiceExit=!0,this._flow=!1,this._forwardOnly=!1,this._useCurrentAttemptObjectiveInfo=!0,this._useCurrentAttemptProgressInfo=!0,this._preventActivation=!1,this._constrainChoice=!1,this._rollupObjectiveSatisfied=!0,this._rollupProgressCompletion=!0,this._objectiveMeasureWeight=1}reset(){this._initialized=!1,this._enabled=!0,this._choiceExit=!0,this._flow=!1,this._forwardOnly=!1,this._useCurrentAttemptObjectiveInfo=!0,this._useCurrentAttemptProgressInfo=!0,this._preventActivation=!1,this._constrainChoice=!1,this._rollupObjectiveSatisfied=!0,this._rollupProgressCompletion=!0,this._objectiveMeasureWeight=1}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get choiceExit(){return this._choiceExit}set choiceExit(e){this._choiceExit=e}get flow(){return this._flow}set flow(e){this._flow=e}get forwardOnly(){return this._forwardOnly}set forwardOnly(e){this._forwardOnly=e}get useCurrentAttemptObjectiveInfo(){return this._useCurrentAttemptObjectiveInfo}set useCurrentAttemptObjectiveInfo(e){this._useCurrentAttemptObjectiveInfo=e}get useCurrentAttemptProgressInfo(){return this._useCurrentAttemptProgressInfo}set useCurrentAttemptProgressInfo(e){this._useCurrentAttemptProgressInfo=e}get preventActivation(){return this._preventActivation}set preventActivation(e){this._preventActivation=e}get constrainChoice(){return this._constrainChoice}set constrainChoice(e){this._constrainChoice=e}get rollupObjectiveSatisfied(){return this._rollupObjectiveSatisfied}set rollupObjectiveSatisfied(e){this._rollupObjectiveSatisfied=e}get rollupProgressCompletion(){return this._rollupProgressCompletion}set rollupProgressCompletion(e){this._rollupProgressCompletion=e}get objectiveMeasureWeight(){return this._objectiveMeasureWeight}set objectiveMeasureWeight(e){0>e||e>1||(this._objectiveMeasureWeight=e)}isChoiceNavigationAllowed(){return this._enabled&&!this._constrainChoice}isFlowNavigationAllowed(){return this._enabled&&this._flow}isForwardNavigationAllowed(){return this._enabled&&(!this._forwardOnly||this._flow)}isBackwardNavigationAllowed(){return this._enabled&&!this._forwardOnly}toJSON(){this.jsonString=!0;const result={enabled:this._enabled,choiceExit:this._choiceExit,flow:this._flow,forwardOnly:this._forwardOnly,useCurrentAttemptObjectiveInfo:this._useCurrentAttemptObjectiveInfo,useCurrentAttemptProgressInfo:this._useCurrentAttemptProgressInfo,preventActivation:this._preventActivation,constrainChoice:this._constrainChoice,rollupObjectiveSatisfied:this._rollupObjectiveSatisfied,rollupProgressCompletion:this._rollupProgressCompletion,objectiveMeasureWeight:this._objectiveMeasureWeight};return this.jsonString=!1,result}}class At extends y{constructor(){super("sequencing"),this._adlNav=null,this._activityTree=new yt,this._sequencingRules=new Ct,this._sequencingControls=new Ot,this._rollupRules=new Tt}initialize(){super.initialize(),this._activityTree.initialize(),this._sequencingRules.initialize(),this._sequencingControls.initialize(),this._rollupRules.initialize()}reset(){this._initialized=!1,this._activityTree.reset(),this._sequencingRules.reset(),this._sequencingControls.reset(),this._rollupRules.reset()}get activityTree(){return this._activityTree}set activityTree(e){if(!(e instanceof yt))throw new Ve(this._cmi_element+".activityTree",a.TYPE_MISMATCH);this._activityTree=e}get sequencingRules(){return this._sequencingRules}set sequencingRules(e){if(!(e instanceof Ct))throw new Ve(this._cmi_element+".sequencingRules",a.TYPE_MISMATCH);this._sequencingRules=e}get sequencingControls(){return this._sequencingControls}set sequencingControls(e){if(!(e instanceof Ot))throw new Ve(this._cmi_element+".sequencingControls",a.TYPE_MISMATCH);this._sequencingControls=e}get rollupRules(){return this._rollupRules}set rollupRules(e){if(!(e instanceof Tt))throw new Ve(this._cmi_element+".rollupRules",a.TYPE_MISMATCH);this._rollupRules=e}get adlNav(){return this._adlNav}set adlNav(e){this._adlNav=e}processNavigationRequest(request){if(!this._adlNav)return!1;this._adlNav.request=request;const e=this._activityTree.currentActivity;if(!e)return!1;const t=this._sequencingRules.evaluatePreConditionRules(e);if(t)switch(t){case ft.SKIP:case ft.DISABLED:case ft.HIDE_FROM_CHOICE:case ft.STOP_FORWARD_TRAVERSAL:return!1}switch(request){case"continue":return this.processContinueRequest(e);case"previous":return this.processPreviousRequest(e);case"choice":default:return!1;case"exit":return this.processExitRequest(e);case"exitAll":return this.processExitAllRequest();case"abandon":return this.processAbandonRequest(e);case"abandonAll":return this.processAbandonAllRequest();case"suspendAll":return this.processSuspendAllRequest(e)}}processContinueRequest(e){if(!this._sequencingControls.isForwardNavigationAllowed())return!1;const t=this._activityTree.getNextSibling(e);if(!t)return!1;if(this._handleExitConditionAction(e))return!0;this._activityTree.currentActivity=t;const i=this._sequencingRules.evaluatePostConditionRules(t);if(i)switch(i){case ft.RETRY:return t.incrementAttemptCount(),!0;case ft.RETRY_ALL:return this._activityTree.getAllActivities().forEach((e=>{e.incrementAttemptCount()})),!0;case ft.CONTINUE:return this.processContinueRequest(t);case ft.PREVIOUS:return this.processPreviousRequest(t);case ft.EXIT:return this._activityTree.currentActivity=e,!0}return!0}processPreviousRequest(e){if(!this._sequencingControls.isBackwardNavigationAllowed())return!1;const t=this._activityTree.getPreviousSibling(e);if(!t)return!1;if(this._handleExitConditionAction(e))return!0;this._activityTree.currentActivity=t;const i=this._sequencingRules.evaluatePostConditionRules(t);if(i)switch(i){case ft.RETRY:return t.incrementAttemptCount(),!0;case ft.RETRY_ALL:return this._activityTree.getAllActivities().forEach((e=>{e.incrementAttemptCount()})),!0;case ft.CONTINUE:return this.processContinueRequest(t);case ft.PREVIOUS:return this.processPreviousRequest(t);case ft.EXIT:return this._activityTree.currentActivity=e,!0}return!0}processExitRequest(e){if(!this._sequencingControls.choiceExit)return!1;const t=e.parent;return!!t&&(this._activityTree.currentActivity=t,!0)}processExitAllRequest(){return!!this._sequencingControls.choiceExit&&(this._activityTree.currentActivity=null,!0)}processAbandonRequest(e){const t=e.parent;return!!t&&(this._activityTree.currentActivity=t,!0)}processAbandonAllRequest(){return this._activityTree.currentActivity=null,!0}processSuspendAllRequest(e){return this._activityTree.suspendedActivity=e,this._activityTree.currentActivity=null,!0}processRollup(){const e=this._activityTree.root;e&&this._processRollupRecursive(e)}_handleExitConditionAction(e){const t=this._sequencingRules.evaluateExitConditionRules(e);if(t)switch(t){case ft.EXIT_PARENT:{const t=e.parent;return!!t&&(this._activityTree.currentActivity=t,!0)}case ft.EXIT_ALL:return this._activityTree.currentActivity=null,!0}return!1}_processRollupRecursive(e){for(const t of e.children)this._processRollupRecursive(t);this._rollupRules.processRollup(e)}toJSON(){this.jsonString=!0;const result={activityTree:this._activityTree,sequencingRules:this._sequencingRules,sequencingControls:this._sequencingControls,rollupRules:this._rollupRules};return this.jsonString=!1,result}}"undefined"!=typeof window&&(window.AICC=class extends Scorm12API{constructor(e){super(e),this.cmi=new qe,this.nav=new te}getChildElement(e,t,i){let s=super.getChildElement(e,t,i);return s||(D(e,"cmi\\.evaluation\\.comments\\.\\d+")?s=new Oe:D(e,"cmi\\.student_data\\.tries\\.\\d+")?s=new be:D(e,"cmi\\.student_data\\.attempt_records\\.\\d+")?s=new je:D(e,"cmi\\.paths\\.\\d+")&&(s=new Pe)),s}replaceWithAnotherScormAPI(e){this.cmi=e.cmi,this.nav=e.nav}},window.Scorm12API=Scorm12API,window.Scorm2004API=class extends we{constructor(e){e&&void 0===e.mastery_override&&(e.mastery_override=!1),super(a,e),this._version="1.0",this._globalObjectives=[],this._extractedScoItemIds=[],this.cmi=new ut,this.adl=new dt,this._sequencing=new At,this.adl.sequencing=this._sequencing,e?.sequencing&&this.configureSequencing(e.sequencing),this.Initialize=this.lmsInitialize,this.Terminate=this.lmsFinish,this.GetValue=this.lmsGetValue,this.SetValue=this.lmsSetValue,this.Commit=this.lmsCommit,this.GetLastError=this.lmsGetLastError,this.GetErrorString=this.lmsGetErrorString,this.GetDiagnostic=this.lmsGetDiagnostic}reset(e){this.commonReset(e),this.cmi?.reset(),this.adl?.reset(),this._sequencing?.reset()}get version(){return this._version}get globalObjectives(){return this._globalObjectives}lmsInitialize(){return this.cmi.initialize(),this.initialize("Initialize","LMS was already initialized!","LMS is already finished!")}lmsFinish(){return(async()=>{await this.internalFinish()})(),e}async internalFinish(){const result=await this.terminate("Terminate",!0);if(result===e)if("_none_"!==this.adl.nav.request){const e={continue:"SequenceNext",previous:"SequencePrevious",choice:"SequenceChoice",jump:"SequenceJump",exit:"SequenceExit",exitAll:"SequenceExitAll",abandon:"SequenceAbandon",abandonAll:"SequenceAbandonAll"};let request=this.adl.nav.request;const t=RegExp(v),i=request.match(t);let s="";i&&(i.groups?.choice_target?(s=i.groups?.choice_target,request="choice"):i.groups?.jump_target&&(s=i.groups?.jump_target,request="jump"));const n=e[request];n&&this.processListeners(n,"adl.nav.request",s)}else this.settings.autoProgress&&this.processListeners("SequenceNext",void 0,"next");return result}lmsGetValue(e){const t="^adl\\.nav\\.request_valid\\.(choice|jump)\\.{target=\\S{0,}([a-zA-Z0-9-_]+)}$";if(D(e,t)){const i=e.match(t);if(i){const request=i[1],e=i[2].replace(/{target=/g,"").replace(/}/g,"");if("choice"===request||"jump"===request)return this.settings.scoItemIdValidator?this.settings.scoItemIdValidator(e)+"":this._extractedScoItemIds.length>0?this._extractedScoItemIds.includes(e)+"":this.settings?.scoItemIds?.includes(e)+""}}return this.getValue("GetValue",!0,e)}lmsSetValue(e,t){return this.setValue("SetValue","Commit",!0,e,t)}lmsCommit(){return this.settings.asyncCommit?this.scheduleCommit(500,"Commit"):(async()=>{await this.commit("Commit",!1)})(),e}lmsGetLastError(){return this.getLastError("GetLastError")}lmsGetErrorString(e){return this.getErrorString("GetErrorString",e)}lmsGetDiagnostic(e){return this.getDiagnostic("GetDiagnostic",e)}setCMIValue(e,t){if(D(e,"cmi\\.objectives\\.\\d+")){const i=+e.split(".")[2],s="cmi.objectives."+i;let n;if(D(e,"cmi\\.objectives\\.\\d+\\.id"))n=t;else{const e=this.cmi.objectives.findObjectiveByIndex(i);n=e?e.id:void 0}if(n&&this.settings.globalObjectiveIds?.includes(n)){let i=this._globalObjectives.findIndex((e=>e.id===n));if(-1===i){i=this._globalObjectives.length;const e=new nt;e.id=n,this._globalObjectives.push(e)}const r=e.replace(s,"_globalObjectives."+i);this._commonSetCMIValue("SetGlobalObjectiveValue",!0,r,t)}}return this._commonSetCMIValue("SetValue",!0,e,t)}getChildElement(e,t,i){if(D(e,"cmi\\.objectives\\.\\d+"))return new nt;if(i){if(D(e,"cmi\\.interactions\\.\\d+\\.correct_responses\\.\\d+"))return this.createCorrectResponsesObject(e,t);if(D(e,"cmi\\.interactions\\.\\d+\\.objectives\\.\\d+"))return new Be}else if(D(e,"cmi\\.interactions\\.\\d+"))return new Je;return D(e,"cmi\\.comments_from_learner\\.\\d+")?new it:D(e,"cmi\\.comments_from_lms\\.\\d+")?new it(!0):D(e,"adl\\.data\\.\\d+")?new pt:null}createCorrectResponsesObject(e,t){const i=e.split("."),s=this.cmi.interactions.childArray[+i[2]];if(this.isInitialized()){if(void 0===s||!s.type)return this.throwSCORMError(e,a.DEPENDENCY_NOT_ESTABLISHED,e),null;{this.checkDuplicateChoiceResponse(e,s,t);const i=Ge[s.type];if(!i)return this.throwSCORMError(e,a.GENERAL_SET_FAILURE,"Incorrect Response Type: "+s.type),null;this.checkValidResponseType(e,i,t,s.type)}}return"0"===this.lastErrorCode?new Xe(s):null}checkValidResponseType(e,t,i,s){let n=[];t?.delimiter?n=(i+"").split(t.delimiter):n[0]=i,n.length>0&&t.max>=n.length?this.checkCorrectResponseValue(e,s,n,i):n.length>t.max&&this.throwSCORMError(e,a.GENERAL_SET_FAILURE,"Data Model Element Pattern Too Long: "+i)}checkDuplicateChoiceResponse(e,t,i){const s=t.correct_responses._count;if("choice"===t.type)for(let n=0;s>n&&"0"===this.lastErrorCode;n++)t.correct_responses.childArray[n].pattern===i&&this.throwSCORMError(e,a.GENERAL_SET_FAILURE,""+i)}validateCorrectResponse(e,t){const i=e.split("."),s=+i[4],n=this.cmi.interactions.childArray[+i[2]],r=n.correct_responses._count;this.checkDuplicateChoiceResponse(e,n,t);const o=Ge[n.type];void 0!==o.limit&&r>o.limit?this.throwSCORMError(e,a.GENERAL_SET_FAILURE,`Data Model Element Collection Limit Reached: ${e} - ${t}`):(this.checkValidResponseType(e,o,t,n.type),"0"===this.lastErrorCode&&(!o.duplicate||!this.checkDuplicatedPattern(n.correct_responses,s,t))||"0"===this.lastErrorCode&&""===t||"0"===this.lastErrorCode&&this.throwSCORMError(e,a.GENERAL_SET_FAILURE,`Data Model Element Pattern Already Exists: ${e} - ${t}`))}getCMIValue(e){return this._commonGetCMIValue("GetValue",!0,e)}getLmsErrorMessageDetails(e,t){let i="",s="";return n.error_descriptions[e+=""]&&(i=n.error_descriptions[e].basicMessage,s=n.error_descriptions[e].detailMessage),t?s:i}checkDuplicatedPattern(e,t,i){let s=!1;const n=e._count;for(let r=0;n>r&&!s;r++)r!==t&&e.childArray[r]===i&&(s=!0);return s}checkCorrectResponseValue(e,t,i,s){const n=Ge[t];if(!n)return void this.throwSCORMError(e,a.TYPE_MISMATCH,"Incorrect Response Type: "+t);const r=RegExp(n.format);for(let o=0;i.length>o&&"0"===this.lastErrorCode;o++)if(t.match("^(fill-in|long-fill-in|matching|performance|sequencing)$")&&(i[o]=this.removeCorrectResponsePrefixes(e,i[o])),n?.delimiter2){const c=i[o].split(n.delimiter2);2===c.length&&c[0].match(r)&&n.format2&&c[1].match(RegExp(n.format2))||this.throwSCORMError(e,a.TYPE_MISMATCH,`${t}: ${s}`)}else{const c=i[o].match(r);if(!c&&""!==s||!c&&"true-false"===t)this.throwSCORMError(e,a.TYPE_MISMATCH,`${t}: ${s}`);else if("numeric"===t&&i.length>1)+i[0]>+i[1]&&this.throwSCORMError(e,a.TYPE_MISMATCH,`${t}: ${s}`);else if(""!==i[o]&&n.unique)for(let n=0;o>n&&"0"===this.lastErrorCode;n++)i[o]===i[n]&&this.throwSCORMError(e,a.TYPE_MISMATCH,`${t}: ${s}`)}}removeCorrectResponsePrefixes(e,t){let i=!1,s=!1,n=!1;const r=RegExp("^({(lang|case_matters|order_matters)=([^}]+)})");let o=t.match(r),c=null;for(;o;){switch(o[2]){case"lang":if(c=t.match("^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?}))(.*?)$"),c){const i=c[3];void 0!==i&&i.length>0&&(It.includes(i.toLowerCase())||this.throwSCORMError(e,a.TYPE_MISMATCH,""+t))}n=!0;break;case"case_matters":n||i||s||"true"!==o[3]&&"false"!==o[3]&&this.throwSCORMError(e,a.TYPE_MISMATCH,""+t),s=!0;break;case"order_matters":s||n||i||"true"!==o[3]&&"false"!==o[3]&&this.throwSCORMError(e,a.TYPE_MISMATCH,""+t),i=!0}o=(t=t.substring(o[1].length)).match(r)}return t}replaceWithAnotherScormAPI(e){this.cmi=e.cmi,this.adl=e.adl}renderCommitCMI(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.renderCMIToJSONObject();(e||t)&&(i.cmi.total_time=this.cmi.getCurrentTotalTime());const result=[],s=j(i);switch(this.settings.dataCommitFormat){case"flattened":return j(i);case"params":for(const e in s)({}).hasOwnProperty.call(s,e)&&result.push(`${e}=${s[e]}`);return result;default:return i}}renderCommitObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.renderCommitCMI(e,t),s=e||t?this.cmi.getCurrentTotalTime():"",n=x(s,m);let r=he,o=ae;this.cmi.completion_status&&("completed"===this.cmi.completion_status?r=ce:"incomplete"===this.cmi.completion_status&&(r=le)),this.cmi.success_status&&("passed"===this.cmi.success_status?o=re:"failed"===this.cmi.success_status&&(o=oe));const a=this.cmi?.score?.getScoreObject()||{},c={completionStatus:r,successStatus:o,totalTimeSeconds:n,runtimeData:i};return a&&(c.score=a),c}async storeData(t){t&&"normal"===this.cmi.mode&&"credit"===this.cmi.credit&&(this.cmi.completion_threshold&&this.cmi.progress_measure&&(this.cmi.completion_status=this.cmi.completion_threshold>this.cmi.progress_measure?"incomplete":"completed"),this.cmi.scaled_passing_score&&this.cmi.score.scaled&&(this.cmi.success_status=this.cmi.scaled_passing_score>this.cmi.score.scaled?"failed":"passed"));let i=!1;this.adl.nav.request!==this.startingData?.adl?.nav?.request&&"_none_"!==this.adl.nav.request&&(i=!0);const s=this.getCommitObject(t);if("string"==typeof this.settings.lmsCommitUrl){const result=await this.processHttpRequest(this.settings.lmsCommitUrl,s,t);return i&&void 0!==result.navRequest&&""!==result.navRequest&&"string"==typeof result.navRequest?Function(`"use strict";(() => { ${result.navRequest} })()`)():result?.navRequest&&!i&&"object"==typeof result.navRequest&&Object.hasOwnProperty.call(result.navRequest,"name")&&this.processListeners(result.navRequest.name,result.navRequest.data),result}return{result:e,errorCode:0}}configureSequencing(e){e.activityTree&&this.configureActivityTree(e.activityTree),e.sequencingRules&&this.configureSequencingRules(e.sequencingRules),e.sequencingControls&&this.configureSequencingControls(e.sequencingControls),e.rollupRules&&this.configureRollupRules(e.rollupRules)}configureActivityTree(e){const t=this.createActivity(e);this._sequencing.activityTree.root=t,this._extractedScoItemIds=this.extractActivityIds(t)}extractActivityIds(e){const t=[e.id];for(const i of e.children)t.push(...this.extractActivityIds(i));return t}createActivity(e){const t=new Rt(e.id,e.title);if(void 0!==e.isVisible&&(t.isVisible=e.isVisible),void 0!==e.isActive&&(t.isActive=e.isActive),void 0!==e.isSuspended&&(t.isSuspended=e.isSuspended),void 0!==e.isCompleted&&(t.isCompleted=e.isCompleted),e.children)for(const i of e.children){const e=this.createActivity(i);t.addChild(e)}return t}configureSequencingRules(e){const t=this._sequencing.sequencingRules;if(e.preConditionRules)for(const i of e.preConditionRules){const e=this.createSequencingRule(i);t.addPreConditionRule(e)}if(e.exitConditionRules)for(const i of e.exitConditionRules){const e=this.createSequencingRule(i);t.addExitConditionRule(e)}if(e.postConditionRules)for(const i of e.postConditionRules){const e=this.createSequencingRule(i);t.addPostConditionRule(e)}}createSequencingRule(e){const t=new vt(e.action,e.conditionCombination);for(const i of e.conditions){const e=new St(i.condition,i.operator,new Map(Object.entries(i.parameters||{})));t.addCondition(e)}return t}configureSequencingControls(e){const t=this._sequencing.sequencingControls;void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.choiceExit&&(t.choiceExit=e.choiceExit),void 0!==e.flow&&(t.flow=e.flow),void 0!==e.forwardOnly&&(t.forwardOnly=e.forwardOnly),void 0!==e.useCurrentAttemptObjectiveInfo&&(t.useCurrentAttemptObjectiveInfo=e.useCurrentAttemptObjectiveInfo),void 0!==e.useCurrentAttemptProgressInfo&&(t.useCurrentAttemptProgressInfo=e.useCurrentAttemptProgressInfo),void 0!==e.preventActivation&&(t.preventActivation=e.preventActivation),void 0!==e.constrainChoice&&(t.constrainChoice=e.constrainChoice),void 0!==e.rollupObjectiveSatisfied&&(t.rollupObjectiveSatisfied=e.rollupObjectiveSatisfied),void 0!==e.rollupProgressCompletion&&(t.rollupProgressCompletion=e.rollupProgressCompletion),void 0!==e.objectiveMeasureWeight&&(t.objectiveMeasureWeight=e.objectiveMeasureWeight)}configureRollupRules(e){const t=this._sequencing.rollupRules;if(e.rules)for(const i of e.rules){const e=this.createRollupRule(i);t.addRule(e)}}createRollupRule(e){const t=new Mt(e.action,e.consideration,e.minimumCount,e.minimumPercent);for(const i of e.conditions){const e=new wt(i.condition,new Map(Object.entries(i.parameters||{})));t.addCondition(e)}return t}})}();
