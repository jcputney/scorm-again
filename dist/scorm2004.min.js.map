{"version":3,"file":"scorm2004.min.js","mappings":"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1hB,KAAK0hB,OACbC,MAAO3hB,KAAK2hB,MACZC,KAAM5hB,KAAK4hB,KACXP,aAAcrhB,KAAKqhB,aACnBQ,YAAa7hB,KAAK6hB,YAClBC,WAAY9hB,KAAK8hB,WACjBC,aAAc/hB,KAAK+hB,aACnBhB,mBAAoB/gB,KAAK+gB,mBACzBxB,SAAUvf,KAAKuf,SACfyC,iBAAkBhiB,KAAKgiB,iBACvBC,KAAMjiB,KAAKiiB,KACX/E,WAAYld,KAAKkd,WACjB6C,iBAAkB/f,KAAK+f,iBACvBmC,qBAAsBliB,KAAKkiB,qBAC3BvC,MAAO3f,KAAK2f,MACZwC,aAAcniB,KAAKmiB,aACnBtC,eAAgB7f,KAAK6f,eACrBuC,aAAcpiB,KAAKoiB,aACnBC,kBAAmBriB,KAAKqiB,mBAG1B,cADOriB,KAAKgD,WACLtB,CACT,EACF,EAtkBA,CAAyBmhB,GCyXzB,GAzYiC,CAC/B,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,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","sources":["webpack://scorm-again/./node_modules/tslib/tslib.es6.mjs","webpack://scorm-again/./src/cmi/common/base_cmi.ts","webpack://scorm-again/./src/constants/error_codes.ts","webpack://scorm-again/./src/constants/api_constants.ts","webpack://scorm-again/./src/exceptions.ts","webpack://scorm-again/./src/cmi/common/array.ts","webpack://scorm-again/./src/utilities.ts","webpack://scorm-again/./src/constants/default_settings.ts","webpack://scorm-again/./src/helpers/scheduled_commit.ts","webpack://scorm-again/./src/BaseAPI.ts","webpack://scorm-again/./src/utilities/debounce.ts","webpack://scorm-again/./src/constants/regex.ts","webpack://scorm-again/./src/cmi/common/validation.ts","webpack://scorm-again/./src/cmi/scorm2004/validation.ts","webpack://scorm-again/./src/cmi/scorm2004/learner_preference.ts","webpack://scorm-again/./src/constants/enums.ts","webpack://scorm-again/./src/constants/response_constants.ts","webpack://scorm-again/./src/cmi/scorm2004/interactions.ts","webpack://scorm-again/./src/cmi/common/score.ts","webpack://scorm-again/./src/cmi/scorm2004/score.ts","webpack://scorm-again/./src/cmi/scorm2004/comments.ts","webpack://scorm-again/./src/cmi/scorm2004/objectives.ts","webpack://scorm-again/./src/cmi/scorm2004/cmi.ts","webpack://scorm-again/./src/constants/language_constants.ts","webpack://scorm-again/./src/cmi/scorm2004/adl.ts","webpack://scorm-again/./src/Scorm2004API.ts","webpack://scorm-again/./src/exports/scorm2004.js"],"sourcesContent":["/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","/**\n * Base class for API cmi objects\n */\nexport abstract class BaseCMI {\n  jsonString? = false;\n  private _initialized = false;\n  private _start_time: number | undefined;\n\n  /**\n   * Getter for _initialized\n   * @return {boolean}\n   */\n  get initialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Getter for _start_time\n   * @return {number | undefined}\n   */\n  get start_time(): number | undefined {\n    return this._start_time;\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize(): void {\n    this._initialized = true;\n  }\n\n  /**\n   * Called when the player should override the 'session_time' provided by\n   * the module\n   */\n  setStartTime(): void {\n    this._start_time = new Date().getTime();\n  }\n}\n\n/**\n * Base class for cmi root objects\n */\nexport abstract class BaseRootCMI extends BaseCMI {\n  abstract getCurrentTotalTime(): string;\n}\n","export type ErrorCode = {\n  [key: string]: number;\n};\n\nconst global: ErrorCode = {\n  GENERAL: 101,\n  INITIALIZATION_FAILED: 101,\n  INITIALIZED: 101,\n  TERMINATED: 101,\n  TERMINATION_FAILURE: 101,\n  TERMINATION_BEFORE_INIT: 101,\n  MULTIPLE_TERMINATION: 101,\n  RETRIEVE_BEFORE_INIT: 101,\n  RETRIEVE_AFTER_TERM: 101,\n  STORE_BEFORE_INIT: 101,\n  STORE_AFTER_TERM: 101,\n  COMMIT_BEFORE_INIT: 101,\n  COMMIT_AFTER_TERM: 101,\n  ARGUMENT_ERROR: 101,\n  CHILDREN_ERROR: 101,\n  COUNT_ERROR: 101,\n  GENERAL_GET_FAILURE: 101,\n  GENERAL_SET_FAILURE: 101,\n  GENERAL_COMMIT_FAILURE: 101,\n  UNDEFINED_DATA_MODEL: 101,\n  UNIMPLEMENTED_ELEMENT: 101,\n  VALUE_NOT_INITIALIZED: 101,\n  INVALID_SET_VALUE: 101,\n  READ_ONLY_ELEMENT: 101,\n  WRITE_ONLY_ELEMENT: 101,\n  TYPE_MISMATCH: 101,\n  VALUE_OUT_OF_RANGE: 101,\n  DEPENDENCY_NOT_ESTABLISHED: 101,\n};\n\nconst scorm12: ErrorCode = {\n  ...global,\n  RETRIEVE_BEFORE_INIT: 301,\n  STORE_BEFORE_INIT: 301,\n  COMMIT_BEFORE_INIT: 301,\n  ARGUMENT_ERROR: 201,\n  CHILDREN_ERROR: 202,\n  COUNT_ERROR: 203,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 401,\n  VALUE_NOT_INITIALIZED: 301,\n  INVALID_SET_VALUE: 402,\n  READ_ONLY_ELEMENT: 403,\n  WRITE_ONLY_ELEMENT: 404,\n  TYPE_MISMATCH: 405,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n\nconst scorm2004: ErrorCode = {\n  ...global,\n  INITIALIZATION_FAILED: 102,\n  INITIALIZED: 103,\n  TERMINATED: 104,\n  TERMINATION_FAILURE: 111,\n  TERMINATION_BEFORE_INIT: 112,\n  MULTIPLE_TERMINATIONS: 113,\n  RETRIEVE_BEFORE_INIT: 122,\n  RETRIEVE_AFTER_TERM: 123,\n  STORE_BEFORE_INIT: 132,\n  STORE_AFTER_TERM: 133,\n  COMMIT_BEFORE_INIT: 142,\n  COMMIT_AFTER_TERM: 143,\n  ARGUMENT_ERROR: 201,\n  GENERAL_GET_FAILURE: 301,\n  GENERAL_SET_FAILURE: 351,\n  GENERAL_COMMIT_FAILURE: 391,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 402,\n  VALUE_NOT_INITIALIZED: 403,\n  READ_ONLY_ELEMENT: 404,\n  WRITE_ONLY_ELEMENT: 405,\n  TYPE_MISMATCH: 406,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n\nconst ErrorCodes = {\n  scorm12,\n  scorm2004,\n};\n\nexport default ErrorCodes;\n","interface ErrorDescription {\n  basicMessage: string;\n  detailMessage: string;\n}\n\ninterface ErrorDescriptions {\n  [key: string]: ErrorDescription;\n}\n\ninterface ScormConstants {\n  cmi_children: string;\n  core_children: string;\n  score_children: string;\n  comments_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface AiccConstants extends ScormConstants {\n  student_demographics_children: string;\n  tries_children: string;\n  attempt_records_children: string;\n  paths_children: string;\n}\n\ninterface Scorm2004Constants {\n  cmi_children: string;\n  comments_children: string;\n  score_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface GlobalConstants {\n  SCORM_TRUE: string;\n  SCORM_FALSE: string;\n  STATE_NOT_INITIALIZED: number;\n  STATE_INITIALIZED: number;\n  STATE_TERMINATED: number;\n  LOG_LEVEL_DEBUG: number;\n  LOG_LEVEL_INFO: number;\n  LOG_LEVEL_WARNING: number;\n  LOG_LEVEL_ERROR: number;\n  LOG_LEVEL_NONE: number;\n}\n\ninterface APIConstants {\n  global: GlobalConstants;\n  scorm12: ScormConstants;\n  aicc: AiccConstants;\n  scorm2004: Scorm2004Constants;\n}\n\nconst global: GlobalConstants = {\n  SCORM_TRUE: \"true\",\n  SCORM_FALSE: \"false\",\n  STATE_NOT_INITIALIZED: 0,\n  STATE_INITIALIZED: 1,\n  STATE_TERMINATED: 2,\n  LOG_LEVEL_DEBUG: 1,\n  LOG_LEVEL_INFO: 2,\n  LOG_LEVEL_WARNING: 3,\n  LOG_LEVEL_ERROR: 4,\n  LOG_LEVEL_NONE: 5,\n};\n\nconst scorm12: ScormConstants = {\n  // Children lists\n  cmi_children:\n    \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions\",\n  core_children:\n    \"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time\",\n  score_children: \"raw,min,max\",\n  comments_children: \"content,location,time\",\n  objectives_children: \"id,score,status\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children: \"audio,language,speed,text\",\n  interactions_children:\n    \"id,objectives,time,type,correct_responses,weighting,student_response,result,latency\",\n  error_descriptions: {\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use LMSGetDiagnostic for more information\",\n    },\n    \"201\": {\n      basicMessage: \"Invalid argument error\",\n      detailMessage:\n        \"Indicates that an argument represents an invalid data model element or is otherwise incorrect.\",\n    },\n    \"202\": {\n      basicMessage: \"Element cannot have children\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_children\" for a data model element that does not support the \"_children\" suffix.',\n    },\n    \"203\": {\n      basicMessage: \"Element not an array - cannot have count\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_count\" for a data model element that does not support the \"_count\" suffix.',\n    },\n    \"301\": {\n      basicMessage: \"Not initialized\",\n      detailMessage:\n        \"Indicates that an API call was made before the call to lmsInitialize.\",\n    },\n    \"401\": {\n      basicMessage: \"Not implemented error\",\n      detailMessage:\n        \"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement.\",\n    },\n    \"402\": {\n      basicMessage: \"Invalid set value, element is a keyword\",\n      detailMessage:\n        'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in \"_children\" and \"_count\").',\n    },\n    \"403\": {\n      basicMessage: \"Element is read only\",\n      detailMessage:\n        \"LMSSetValue was called with a data model element that can only be read.\",\n    },\n    \"404\": {\n      basicMessage: \"Element is write only\",\n      detailMessage:\n        \"LMSGetValue was called on a data model element that can only be written to.\",\n    },\n    \"405\": {\n      basicMessage: \"Incorrect Data Type\",\n      detailMessage:\n        \"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\nconst aicc: AiccConstants = {\n  ...scorm12,\n  ...{\n    cmi_children:\n      \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation\",\n    student_preference_children:\n      \"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows\",\n    student_data_children:\n      \"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action\",\n    student_demographics_children:\n      \"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience\",\n    tries_children: \"time,status,score\",\n    attempt_records_children: \"score,lesson_status\",\n    paths_children: \"location_id,date,time,status,why_left,time_in_element\",\n  },\n};\nconst scorm2004: Scorm2004Constants = {\n  // Children lists\n  cmi_children:\n    \"_version,comments_from_learner,comments_from_lms,completion_status,credit,entry,exit,interactions,launch_data,learner_id,learner_name,learner_preference,location,max_time_allowed,mode,objectives,progress_measure,scaled_passing_score,score,session_time,success_status,suspend_data,time_limit_action,total_time\",\n  comments_children: \"comment,timestamp,location\",\n  score_children: \"max,raw,scaled,min\",\n  objectives_children:\n    \"progress_measure,completion_status,success_status,description,score,id\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children:\n    \"audio_level,audio_captioning,delivery_speed,language\",\n  interactions_children:\n    \"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description\",\n  error_descriptions: {\n    \"0\": {\n      basicMessage: \"No Error\",\n      detailMessage: \"No error occurred, the previous API call was successful.\",\n    },\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use GetDiagnostic for more information.\",\n    },\n    \"102\": {\n      basicMessage: \"General Initialization Failure\",\n      detailMessage: \"Call to Initialize failed for an unknown reason.\",\n    },\n    \"103\": {\n      basicMessage: \"Already Initialized\",\n      detailMessage:\n        \"Call to Initialize failed because Initialize was already called.\",\n    },\n    \"104\": {\n      basicMessage: \"Content Instance Terminated\",\n      detailMessage:\n        \"Call to Initialize failed because Terminate was already called.\",\n    },\n    \"111\": {\n      basicMessage: \"General Termination Failure\",\n      detailMessage: \"Call to Terminate failed for an unknown reason.\",\n    },\n    \"112\": {\n      basicMessage: \"Termination Before Initialization\",\n      detailMessage:\n        \"Call to Terminate failed because it was made before the call to Initialize.\",\n    },\n    \"113\": {\n      basicMessage: \"Termination After Termination\",\n      detailMessage:\n        \"Call to Terminate failed because Terminate was already called.\",\n    },\n    \"122\": {\n      basicMessage: \"Retrieve Data Before Initialization\",\n      detailMessage:\n        \"Call to GetValue failed because it was made before the call to Initialize.\",\n    },\n    \"123\": {\n      basicMessage: \"Retrieve Data After Termination\",\n      detailMessage:\n        \"Call to GetValue failed because it was made after the call to Terminate.\",\n    },\n    \"132\": {\n      basicMessage: \"Store Data Before Initialization\",\n      detailMessage:\n        \"Call to SetValue failed because it was made before the call to Initialize.\",\n    },\n    \"133\": {\n      basicMessage: \"Store Data After Termination\",\n      detailMessage:\n        \"Call to SetValue failed because it was made after the call to Terminate.\",\n    },\n    \"142\": {\n      basicMessage: \"Commit Before Initialization\",\n      detailMessage:\n        \"Call to Commit failed because it was made before the call to Initialize.\",\n    },\n    \"143\": {\n      basicMessage: \"Commit After Termination\",\n      detailMessage:\n        \"Call to Commit failed because it was made after the call to Terminate.\",\n    },\n    \"201\": {\n      basicMessage: \"General Argument Error\",\n      detailMessage:\n        \"An invalid argument was passed to an API method (usually indicates that Initialize, Commit or Terminate did not receive the expected empty string argument.\",\n    },\n    \"301\": {\n      basicMessage: \"General Get Failure\",\n      detailMessage:\n        \"Indicates a failed GetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"351\": {\n      basicMessage: \"General Set Failure\",\n      detailMessage:\n        \"Indicates a failed SetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"391\": {\n      basicMessage: \"General Commit Failure\",\n      detailMessage:\n        \"Indicates a failed Commit call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"401\": {\n      basicMessage: \"Undefined Data Model Element\",\n      detailMessage:\n        \"The data model element name passed to GetValue or SetValue is not a valid SCORM data model element.\",\n    },\n    \"402\": {\n      basicMessage: \"Unimplemented Data Model Element\",\n      detailMessage:\n        \"The data model element indicated in a call to GetValue or SetValue is valid, but was not implemented by this LMS. In SCORM 2004, this error would indicate an LMS that is not fully SCORM conformant.\",\n    },\n    \"403\": {\n      basicMessage: \"Data Model Element Value Not Initialized\",\n      detailMessage:\n        \"Attempt to read a data model element that has not been initialized by the LMS or through a SetValue call. This error condition is often reached during normal execution of a SCO.\",\n    },\n    \"404\": {\n      basicMessage: \"Data Model Element Is Read Only\",\n      detailMessage:\n        \"SetValue was called with a data model element that can only be read.\",\n    },\n    \"405\": {\n      basicMessage: \"Data Model Element Is Write Only\",\n      detailMessage:\n        \"GetValue was called on a data model element that can only be written to.\",\n    },\n    \"406\": {\n      basicMessage: \"Data Model Element Type Mismatch\",\n      detailMessage:\n        \"SetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Data Model Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a SetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\nconst APIConstants: APIConstants = {\n  global: global,\n  scorm12: scorm12,\n  aicc: aicc,\n  scorm2004: scorm2004,\n};\nexport default APIConstants;\n","import APIConstants from \"./constants/api_constants\";\n\nconst scorm12_errors = APIConstants.scorm12.error_descriptions;\nconst aicc_errors = APIConstants.aicc.error_descriptions;\nconst scorm2004_errors = APIConstants.scorm2004.error_descriptions;\n\ntype APIError = {\n  errorCode: number;\n  errorMessage: string;\n  detailedMessage: string;\n};\n\nexport class BaseScormValidationError extends Error {\n  constructor(errorCode: number) {\n    super(errorCode.toString());\n    this._errorCode = errorCode;\n    this.name = \"ScormValidationError\";\n  }\n\n  private readonly _errorCode: number;\n\n  /**\n   * Getter for _errorCode\n   * @return {number}\n   */\n  get errorCode(): number {\n    return this._errorCode;\n  }\n\n  setMessage(message: string) {\n    this.message = message;\n  }\n}\n\n/**\n * Base Validation Exception\n */\nexport class ValidationError\n  extends BaseScormValidationError\n  implements APIError\n{\n  /**\n   * Constructor to take in an error message and code\n   * @param {number} errorCode\n   * @param {string} errorMessage\n   * @param {string} detailedMessage\n   */\n  constructor(\n    errorCode: number,\n    errorMessage: string,\n    detailedMessage?: string,\n  ) {\n    super(errorCode);\n    this.setMessage(errorMessage);\n    this._errorMessage = errorMessage;\n    if (detailedMessage) {\n      this._detailedMessage = detailedMessage;\n    }\n  }\n\n  private readonly _errorMessage: string;\n  private readonly _detailedMessage: string = \"\";\n\n  /**\n   * Getter for _errorMessage\n   * @return {string}\n   */\n  get errorMessage(): string {\n    return this._errorMessage;\n  }\n\n  /**\n   * Getter for _detailedMessage\n   * @return {string}\n   */\n  get detailedMessage(): string {\n    return this._detailedMessage;\n  }\n}\n\n/**\n * SCORM 1.2 Validation Error\n */\nexport class Scorm12ValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {number} errorCode\n   */\n  constructor(errorCode: number) {\n    if ({}.hasOwnProperty.call(scorm12_errors, String(errorCode))) {\n      super(\n        errorCode,\n        scorm12_errors[String(errorCode)].basicMessage,\n        scorm12_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        101,\n        scorm12_errors[\"101\"].basicMessage,\n        scorm12_errors[\"101\"].detailMessage,\n      );\n    }\n  }\n}\n\n/**\n * AICC Validation Error\n */\nexport class AICCValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {number} errorCode\n   */\n  constructor(errorCode: number) {\n    if ({}.hasOwnProperty.call(aicc_errors, String(errorCode))) {\n      super(\n        errorCode,\n        aicc_errors[String(errorCode)].basicMessage,\n        aicc_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        101,\n        aicc_errors[\"101\"].basicMessage,\n        aicc_errors[\"101\"].detailMessage,\n      );\n    }\n  }\n}\n\n/**\n * SCORM 2004 Validation Error\n */\nexport class Scorm2004ValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {number} errorCode\n   */\n  constructor(errorCode: number) {\n    if ({}.hasOwnProperty.call(scorm2004_errors, String(errorCode))) {\n      super(\n        errorCode,\n        scorm2004_errors[String(errorCode)].basicMessage,\n        scorm2004_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        101,\n        scorm2004_errors[\"101\"].basicMessage,\n        scorm2004_errors[\"101\"].detailMessage,\n      );\n    }\n  }\n}\n","import { BaseCMI } from \"./base_cmi\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { BaseScormValidationError } from \"../../exceptions\";\n\nexport const scorm12_error_codes = ErrorCodes.scorm12;\n\n/**\n * Base class for cmi *.n objects\n */\nexport class CMIArray extends BaseCMI {\n  private readonly _errorCode: number;\n  private readonly _errorClass: typeof BaseScormValidationError;\n  private readonly __children: string;\n  childArray: any[];\n\n  /**\n   * Constructor cmi *.n arrays\n   * @param {object} params\n   */\n  constructor(params: {\n    children: string;\n    errorCode?: number;\n    errorClass?: typeof BaseScormValidationError;\n  }) {\n    super();\n    this.__children = params.children;\n    this._errorCode = params.errorCode || scorm12_error_codes.GENERAL;\n    this._errorClass = params.errorClass || BaseScormValidationError;\n    this.childArray = [];\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this._errorClass(this._errorCode);\n  }\n\n  /**\n   * Getter for _count\n   * @return {number}\n   */\n  get _count(): number {\n    return this.childArray.length;\n  }\n\n  /**\n   * Setter for _count. Just throws an error.\n   * @param {number} _count\n   */\n  set _count(_count: number) {\n    throw new this._errorClass(this._errorCode);\n  }\n\n  /**\n   * toJSON for *.n arrays\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result: { [key: string]: any } = {};\n    for (let i = 0; i < this.childArray.length; i++) {\n      result[i + \"\"] = this.childArray[i];\n    }\n    delete this.jsonString;\n    return result;\n  }\n}\n","export const SECONDS_PER_SECOND = 1.0;\nexport const SECONDS_PER_MINUTE = 60;\nexport const SECONDS_PER_HOUR = 60 * SECONDS_PER_MINUTE;\nexport const SECONDS_PER_DAY = 24 * SECONDS_PER_HOUR;\n\ntype Designation = {\n  [key: string]: number;\n};\n\ntype StringKeyMap = {\n  [key: string]: any;\n};\n\nconst designations: Designation = {\n  D: SECONDS_PER_DAY,\n  H: SECONDS_PER_HOUR,\n  M: SECONDS_PER_MINUTE,\n  S: SECONDS_PER_SECOND,\n};\n\n/**\n * Converts a Number to a String of HH:MM:SS\n *\n * @param {number} totalSeconds\n * @return {string}\n */\nexport function getSecondsAsHHMMSS(totalSeconds: number | null): string {\n  // SCORM spec does not deal with negative durations, give zero back\n  if (!totalSeconds || totalSeconds <= 0) {\n    return \"00:00:00\";\n  }\n\n  const hours = Math.floor(totalSeconds / SECONDS_PER_HOUR);\n  const dateObj = new Date(totalSeconds * 1000);\n  const minutes = dateObj.getUTCMinutes();\n  // make sure we add any possible decimal value\n  const seconds = dateObj.getSeconds();\n  const ms = totalSeconds % 1.0;\n  let msStr = \"\";\n\n  if (countDecimals(ms) > 0) {\n    if (countDecimals(ms) > 2) {\n      msStr = ms.toFixed(2);\n    } else {\n      msStr = String(ms);\n    }\n\n    msStr = \".\" + msStr.split(\".\")[1];\n  }\n\n  return (\n    (hours + \":\" + minutes + \":\" + seconds).replace(/\\b\\d\\b/g, \"0$&\") + msStr\n  );\n}\n\n/**\n * Calculate the number of seconds from ISO 8601 Duration\n *\n * @param {number} seconds\n * @return {string}\n */\nexport function getSecondsAsISODuration(seconds: number | null): string {\n  // SCORM spec does not deal with negative durations, give zero back\n  if (!seconds || seconds <= 0) {\n    return \"PT0S\";\n  }\n\n  let duration = \"P\";\n  let remainder = seconds;\n  for (const designationsKey in designations) {\n    const current_seconds = designations[designationsKey];\n    let value = Math.floor(remainder / current_seconds);\n    remainder = remainder % current_seconds;\n\n    if (countDecimals(remainder) > 2) {\n      remainder = Number(Number(remainder).toFixed(2));\n    }\n\n    // If we have anything left in the remainder, and we're currently adding\n    // seconds to the duration, go ahead and add the decimal to the seconds\n    if (designationsKey === \"S\" && remainder > 0) {\n      value += remainder;\n    }\n\n    if (value) {\n      if (\n        (duration.indexOf(\"D\") > 0 ||\n          designationsKey === \"H\" ||\n          designationsKey === \"M\" ||\n          designationsKey === \"S\") &&\n        duration.indexOf(\"T\") === -1\n      ) {\n        duration += \"T\";\n      }\n\n      duration += `${value}${designationsKey}`;\n    }\n  }\n  return duration;\n}\n\n/**\n * Calculate the number of seconds from HH:MM:SS.DDDDDD\n *\n * @param {string} timeString\n * @param {RegExp} timeRegex\n * @return {number}\n */\nexport function getTimeAsSeconds(\n  timeString: string | number | boolean | null,\n  timeRegex: RegExp | string,\n): number {\n  if (typeof timeString === \"number\" || typeof timeString === \"boolean\") {\n    timeString = String(timeString);\n  }\n  if (typeof timeRegex === \"string\") {\n    timeRegex = new RegExp(timeRegex);\n  }\n  if (!timeString || !timeString.match(timeRegex)) {\n    return 0;\n  }\n\n  const parts = timeString.split(\":\");\n  const hours = Number(parts[0]);\n  const minutes = Number(parts[1]);\n  const seconds = Number(parts[2]);\n  return hours * 3600 + minutes * 60 + seconds;\n}\n\n/**\n * Calculate the number of seconds from ISO 8601 Duration\n *\n * @param {string} duration\n * @param {RegExp} durationRegex\n * @return {number}\n */\nexport function getDurationAsSeconds(\n  duration: string | null,\n  durationRegex: RegExp | string,\n): number {\n  if (typeof durationRegex === \"string\") {\n    durationRegex = new RegExp(durationRegex);\n  }\n\n  if (!duration || !duration.match(durationRegex)) {\n    return 0;\n  }\n\n  const [, years, _, , days, hours, minutes, seconds] =\n    new RegExp(durationRegex).exec(duration) || [];\n  let result = 0.0;\n  result += Number(seconds) || 0.0;\n  result += Number(minutes) * 60.0 || 0.0;\n  result += Number(hours) * 3600.0 || 0.0;\n  result += Number(days) * (60 * 60 * 24.0) || 0.0;\n  result += Number(years) * (60 * 60 * 24 * 365.0) || 0.0;\n  return result;\n}\n\n/**\n * Adds together two ISO8601 Duration strings\n *\n * @param {string} first\n * @param {string} second\n * @param {RegExp|string} durationRegex\n * @return {string}\n */\nexport function addTwoDurations(\n  first: string,\n  second: string,\n  durationRegex: RegExp | string,\n): string {\n  const regex: RegExp =\n    typeof durationRegex === \"string\"\n      ? new RegExp(durationRegex)\n      : durationRegex;\n  return getSecondsAsISODuration(\n    getDurationAsSeconds(first, regex) + getDurationAsSeconds(second, regex),\n  );\n}\n\n/**\n * Add together two HH:MM:SS.DD strings\n *\n * @param {string} first\n * @param {string} second\n * @param {RegExp} timeRegex\n * @return {string}\n */\nexport function addHHMMSSTimeStrings(\n  first: string,\n  second: string,\n  timeRegex: RegExp | string,\n): string {\n  if (typeof timeRegex === \"string\") {\n    timeRegex = new RegExp(timeRegex);\n  }\n  return getSecondsAsHHMMSS(\n    getTimeAsSeconds(first, timeRegex) + getTimeAsSeconds(second, timeRegex),\n  );\n}\n\n/**\n * Flatten a JSON object down to string paths for each values\n * @param {object} data\n * @return {object}\n */\nexport function flatten(data: StringKeyMap): object {\n  const result: StringKeyMap = {};\n\n  /**\n   * Recurse through the object\n   * @param {*} cur\n   * @param {*} prop\n   */\n  function recurse(cur: any, prop: any) {\n    if (Object(cur) !== cur) {\n      result[prop] = cur;\n    } else if (Array.isArray(cur)) {\n      for (let i = 0, l = cur.length; i < l; i++) {\n        recurse(cur[i], prop + \"[\" + i + \"]\");\n        if (l === 0) result[prop] = [];\n      }\n    } else {\n      let isEmpty = true;\n\n      for (const p in cur) {\n        if ({}.hasOwnProperty.call(cur, p)) {\n          isEmpty = false;\n          recurse(cur[p], prop ? prop + \".\" + p : p);\n        }\n      }\n\n      if (isEmpty && prop) result[prop] = {};\n    }\n  }\n\n  recurse(data, \"\");\n  return result;\n}\n\n/**\n * Un-flatten a flat JSON object\n * @param {object} data\n * @return {object}\n */\nexport function unflatten(data: StringKeyMap): object {\n  \"use strict\";\n\n  if (Object(data) !== data || Array.isArray(data)) return data;\n  const regex = /\\.?([^.[\\]]+)|\\[(\\d+)]/g;\n  const result: StringKeyMap = {};\n\n  for (const p in data) {\n    if ({}.hasOwnProperty.call(data, p)) {\n      let cur = result;\n      let prop = \"\";\n      let m = regex.exec(p);\n\n      while (m) {\n        cur = cur[prop] || (cur[prop] = m[2] ? [] : {});\n        prop = m[2] || m[1];\n        m = regex.exec(p);\n      }\n\n      cur[prop] = data[p];\n    }\n  }\n\n  return result[\"\"] || result;\n}\n\n/**\n * Counts the number of decimal places\n * @param {number} num\n * @return {number}\n */\nexport function countDecimals(num: number): number {\n  if (Math.floor(num) === num || String(num).indexOf(\".\") < 0) return 0;\n  const parts = num.toString().split(\".\")[1];\n  return parts.length || 0;\n}\n\n/**\n * Formats the SCORM messages for easy reading\n *\n * @param {string} functionName\n * @param {string} message\n * @param {string} CMIElement\n * @return {string}\n */\nexport function formatMessage(\n  functionName: string,\n  message: string,\n  CMIElement?: string,\n): string {\n  const baseLength = 20;\n  let messageString = \"\";\n\n  messageString += functionName;\n\n  let fillChars = baseLength - messageString.length;\n\n  for (let i = 0; i < fillChars; i++) {\n    messageString += \" \";\n  }\n\n  messageString += \": \";\n\n  if (CMIElement) {\n    const CMIElementBaseLength = 70;\n\n    messageString += CMIElement;\n\n    fillChars = CMIElementBaseLength - messageString.length;\n\n    for (let j = 0; j < fillChars; j++) {\n      messageString += \" \";\n    }\n  }\n\n  if (message) {\n    messageString += message;\n  }\n\n  return messageString;\n}\n\n/**\n * Checks to see if {str} contains {tester}\n *\n * @param {string} str String to check against\n * @param {string} tester String to check for\n * @return {boolean}\n */\nexport function stringMatches(str: string, tester: string): boolean {\n  return str?.match(tester) !== null;\n}\n","import { ResultObject, Settings } from \"../types/api_types\";\nimport APIConstants from \"./api_constants\";\n\n/**\n * Default settings for the SCORM API\n */\nexport const DefaultSettings: Settings = {\n  autocommit: false,\n  autocommitSeconds: 10,\n  asyncCommit: false,\n  sendFullCommit: true,\n  lmsCommitUrl: false,\n  dataCommitFormat: \"json\",\n  commitRequestDataType: \"application/json;charset=UTF-8\",\n  autoProgress: false,\n  logLevel: APIConstants.global.LOG_LEVEL_ERROR,\n  selfReportSessionTime: false,\n  alwaysSendTotalTime: false,\n  renderCommonCommitFields: false,\n  strict_errors: true,\n  xhrHeaders: {},\n  xhrWithCredentials: false,\n  responseHandler: async function (response: Response): Promise<ResultObject> {\n    if (typeof response !== \"undefined\") {\n      const httpResult = JSON.parse(await response.text());\n      if (\n        httpResult === null ||\n        !{}.hasOwnProperty.call(httpResult, \"result\")\n      ) {\n        if (response.status === 200) {\n          return {\n            result: APIConstants.global.SCORM_TRUE,\n            errorCode: 0,\n          };\n        } else {\n          return {\n            result: APIConstants.global.SCORM_FALSE,\n            errorCode: 101,\n          };\n        }\n      } else {\n        return {\n          result: httpResult.result,\n          errorCode: httpResult.errorCode\n            ? httpResult.errorCode\n            : httpResult.result === APIConstants.global.SCORM_TRUE\n              ? 0\n              : 101,\n        };\n      }\n    }\n    return {\n      result: APIConstants.global.SCORM_FALSE,\n      errorCode: 101,\n    };\n  },\n  requestHandler: function (commitObject) {\n    return commitObject;\n  },\n  onLogMessage: function (messageLevel, logMessage) {\n    switch (messageLevel) {\n      case APIConstants.global.LOG_LEVEL_ERROR:\n        console.error(logMessage);\n        break;\n      case APIConstants.global.LOG_LEVEL_WARNING:\n        console.warn(logMessage);\n        break;\n      case APIConstants.global.LOG_LEVEL_INFO:\n        console.info(logMessage);\n        break;\n      case APIConstants.global.LOG_LEVEL_DEBUG:\n        if (console.debug) {\n          console.debug(logMessage);\n        } else {\n          console.log(logMessage);\n        }\n        break;\n    }\n  },\n  scoItemIds: [],\n  scoItemIdValidator: false,\n};\n","import BaseAPI from \"../BaseAPI\";\n\n/**\n * Private class that wraps a timeout call to the commit() function\n */\nexport class ScheduledCommit {\n  private _API;\n  private _cancelled = false;\n  private readonly _timeout;\n  private readonly _callback;\n\n  /**\n   * Constructor for ScheduledCommit\n   * @param {BaseAPI} API\n   * @param {number} when\n   * @param {string} callback\n   */\n  constructor(API: BaseAPI, when: number, callback: string) {\n    this._API = API;\n    this._timeout = setTimeout(this.wrapper.bind(this), when);\n    this._callback = callback;\n  }\n\n  /**\n   * Cancel any currently scheduled commit\n   */\n  cancel() {\n    this._cancelled = true;\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n  }\n\n  /**\n   * Wrap the API commit call to check if the call has already been cancelled\n   */\n  wrapper() {\n    if (!this._cancelled) {\n      (async () => await this._API.commit(this._callback))();\n    }\n  }\n}\n","import { CMIArray } from \"./cmi/common/array\";\nimport { ValidationError } from \"./exceptions\";\nimport ErrorCodes, { ErrorCode } from \"./constants/error_codes\";\nimport APIConstants from \"./constants/api_constants\";\nimport { formatMessage, stringMatches, unflatten } from \"./utilities\";\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport { debounce } from \"./utilities/debounce\";\nimport {\n  RefObject,\n  CommitObject,\n  ResultObject,\n  Settings,\n} from \"./types/api_types\";\nimport { DefaultSettings } from \"./constants/default_settings\";\nimport { IBaseAPI } from \"./interfaces/IBaseAPI\";\nimport { ScheduledCommit } from \"./helpers/scheduled_commit\";\n\n/**\n * Base API class for AICC, SCORM 1.2, and SCORM 2004. Should be considered\n * abstract, and never initialized on its own.\n */\nexport default abstract class BaseAPI implements IBaseAPI {\n  private _timeout?: ScheduledCommit;\n  private readonly _error_codes: ErrorCode;\n  private _settings: Settings = DefaultSettings;\n\n  /**\n   * Constructor for Base API class. Sets some shared API fields, as well as\n   * sets up options for the API.\n   * @param {ErrorCode} error_codes\n   * @param {Settings} settings\n   */\n  protected constructor(error_codes: ErrorCode, settings?: Settings) {\n    if (new.target === BaseAPI) {\n      throw new TypeError(\"Cannot construct BaseAPI instances directly\");\n    }\n    this.currentState = APIConstants.global.STATE_NOT_INITIALIZED;\n    this.lastErrorCode = \"0\";\n    this.listenerArray = [];\n\n    this._error_codes = error_codes;\n\n    if (settings) {\n      this.settings = settings;\n    }\n    this.apiLogLevel = this.settings.logLevel;\n    this.selfReportSessionTime = this.settings.selfReportSessionTime;\n  }\n\n  public abstract cmi: BaseCMI;\n  public startingData?: RefObject;\n\n  public currentState: number;\n  public lastErrorCode: string;\n  public listenerArray: any[];\n  public apiLogLevel: number;\n  public selfReportSessionTime: boolean;\n\n  abstract reset(settings?: Settings): void;\n\n  /**\n   * Common reset method for all APIs. New settings are merged with the existing settings.\n   * @param {Settings} settings\n   * @protected\n   */\n  commonReset(settings?: Settings): void {\n    this.settings = { ...this.settings, ...settings };\n\n    this.currentState = APIConstants.global.STATE_NOT_INITIALIZED;\n    this.lastErrorCode = \"0\";\n    this.listenerArray = [];\n  }\n\n  /**\n   * Initialize the API\n   * @param {string} callbackName\n   * @param {string} initializeMessage\n   * @param {string} terminationMessage\n   * @return {string}\n   */\n  initialize(\n    callbackName: string,\n    initializeMessage?: string,\n    terminationMessage?: string,\n  ): string {\n    let returnValue = APIConstants.global.SCORM_FALSE;\n\n    if (this.isInitialized()) {\n      this.throwSCORMError(this._error_codes.INITIALIZED, initializeMessage);\n    } else if (this.isTerminated()) {\n      this.throwSCORMError(this._error_codes.TERMINATED, terminationMessage);\n    } else {\n      if (this.selfReportSessionTime) {\n        this.cmi.setStartTime();\n      }\n\n      this.currentState = APIConstants.global.STATE_INITIALIZED;\n      this.lastErrorCode = \"0\";\n      returnValue = APIConstants.global.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  abstract lmsInitialize(): string;\n\n  abstract lmsFinish(): string;\n\n  abstract lmsGetValue(CMIElement: string): string;\n\n  abstract lmsSetValue(CMIElement: string, value: any): string;\n\n  abstract lmsCommit(): string;\n\n  abstract lmsGetLastError(): string;\n\n  abstract lmsGetErrorString(CMIErrorCode: string | number): string;\n\n  abstract lmsGetDiagnostic(CMIErrorCode: string | number): string;\n\n  /**\n   * Abstract method for validating that a response is correct.\n   *\n   * @param {string} _CMIElement\n   * @param {any} _value\n   */\n  abstract validateCorrectResponse(_CMIElement: string, _value: any): void;\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   * APIs that inherit BaseAPI should override this method.\n   *\n   * @param {string} _CMIElement - unused\n   * @param {*} _value - unused\n   * @param {boolean} _foundFirstIndex - unused\n   * @return {BaseCMI|null}\n   * @abstract\n   */\n  abstract getChildElement(\n    _CMIElement: string,\n    _value: any,\n    _foundFirstIndex: boolean,\n  ): BaseCMI | null;\n\n  /**\n   * Attempts to store the data to the LMS, logs data if no LMS configured\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _calculateTotalTime\n   * @return {ResultObject}\n   * @abstract\n   */\n  abstract storeData(_calculateTotalTime: boolean): Promise<ResultObject>;\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _terminateCommit\n   * @return {RefObject|Array}\n   * @abstract\n   */\n  abstract renderCommitCMI(_terminateCommit: boolean): RefObject | Array<any>;\n\n  /**\n   * Render the commit object to the shortened format for LMS commit\n   * @param {boolean} _terminateCommit\n   * @return {CommitObject}\n   */\n  abstract renderCommitObject(_terminateCommit: boolean): CommitObject;\n\n  /**\n   * Logging for all SCORM actions\n   *\n   * @param {string} functionName\n   * @param {string} logMessage\n   * @param {number} messageLevel\n   * @param {string} CMIElement\n   */\n  apiLog(\n    functionName: string,\n    logMessage: string,\n    messageLevel: number,\n    CMIElement?: string,\n  ) {\n    logMessage = formatMessage(functionName, logMessage, CMIElement);\n\n    if (messageLevel >= this.apiLogLevel) {\n      this.settings.onLogMessage(messageLevel, logMessage);\n    }\n  }\n\n  /**\n   * Getter for _error_codes\n   * @return {ErrorCode}\n   */\n  get error_codes(): ErrorCode {\n    return this._error_codes;\n  }\n\n  /**\n   * Getter for _settings\n   * @return {Settings}\n   */\n  get settings(): Settings {\n    return this._settings;\n  }\n\n  /**\n   * Setter for _settings\n   * @param {Settings} settings\n   */\n  set settings(settings: Settings) {\n    this._settings = { ...this._settings, ...settings };\n  }\n\n  /**\n   * Terminates the current run of the API\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async terminate(\n    callbackName: string,\n    checkTerminated: boolean,\n  ): Promise<string> {\n    let returnValue = APIConstants.global.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.TERMINATION_BEFORE_INIT,\n        this._error_codes.MULTIPLE_TERMINATION,\n      )\n    ) {\n      this.currentState = APIConstants.global.STATE_TERMINATED;\n\n      const result: ResultObject = await this.storeData(true);\n      if (typeof result.errorCode !== \"undefined\" && result.errorCode > 0) {\n        this.throwSCORMError(result.errorCode);\n      }\n      returnValue =\n        typeof result !== \"undefined\" && result.result\n          ? result.result\n          : APIConstants.global.SCORM_FALSE;\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      returnValue = APIConstants.global.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Get the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  getValue(\n    callbackName: string,\n    checkTerminated: boolean,\n    CMIElement: string,\n  ): string {\n    let returnValue: string = \"\";\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.RETRIEVE_BEFORE_INIT,\n        this._error_codes.RETRIEVE_AFTER_TERM,\n      )\n    ) {\n      if (checkTerminated) this.lastErrorCode = \"0\";\n      try {\n        returnValue = this.getCMIValue(CMIElement);\n      } catch (e) {\n        returnValue = this.handleValueAccessException(e, returnValue);\n      }\n      this.processListeners(callbackName, CMIElement);\n    }\n\n    this.apiLog(\n      callbackName,\n      \": returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n      CMIElement,\n    );\n\n    if (returnValue === undefined) {\n      return \"\";\n    }\n\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Sets the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {string} commitCallback\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  setValue(\n    callbackName: string,\n    commitCallback: string,\n    checkTerminated: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (value !== undefined) {\n      value = String(value);\n    }\n    let returnValue: string = APIConstants.global.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.STORE_BEFORE_INIT,\n        this._error_codes.STORE_AFTER_TERM,\n      )\n    ) {\n      if (checkTerminated) this.lastErrorCode = \"0\";\n      try {\n        returnValue = this.setCMIValue(CMIElement, value);\n      } catch (e) {\n        this.handleValueAccessException(e, returnValue);\n      }\n      this.processListeners(callbackName, CMIElement, value);\n    }\n\n    if (returnValue === undefined) {\n      returnValue = APIConstants.global.SCORM_FALSE;\n    }\n\n    // If we didn't have any errors while setting the data, go ahead and\n    // schedule a commit, if autocommit is turned on\n    if (String(this.lastErrorCode) === \"0\") {\n      if (this.settings.autocommit && !this._timeout) {\n        this.scheduleCommit(\n          this.settings.autocommitSeconds * 1000,\n          commitCallback,\n        );\n      }\n    }\n\n    this.apiLog(\n      callbackName,\n      \": \" + value + \": result: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n      CMIElement,\n    );\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Orders LMS to store all content parameters\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async commit(\n    callbackName: string,\n    checkTerminated: boolean = false,\n  ): Promise<string> {\n    this.clearScheduledCommit();\n\n    let returnValue = APIConstants.global.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.COMMIT_BEFORE_INIT,\n        this._error_codes.COMMIT_AFTER_TERM,\n      )\n    ) {\n      const result = await this.storeData(false);\n      if (result.errorCode && result.errorCode > 0) {\n        this.throwSCORMError(result.errorCode);\n      }\n      returnValue =\n        typeof result !== \"undefined\" && result.result\n          ? result.result\n          : APIConstants.global.SCORM_FALSE;\n\n      this.apiLog(\n        callbackName,\n        \" Result: \" + returnValue,\n        APIConstants.global.LOG_LEVEL_DEBUG,\n        \"HttpRequest\",\n      );\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Returns last error code\n   * @param {string} callbackName\n   * @return {string}\n   */\n  getLastError(callbackName: string): string {\n    const returnValue = String(this.lastErrorCode);\n\n    this.processListeners(callbackName);\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n\n    return returnValue;\n  }\n\n  /**\n   * Returns the errorNumber error description\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getErrorString(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n\n    return returnValue;\n  }\n\n  /**\n   * Returns a comprehensive description of the errorNumber error.\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getDiagnostic(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode, true);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(\n      callbackName,\n      \"returned: \" + returnValue,\n      APIConstants.global.LOG_LEVEL_INFO,\n    );\n\n    return returnValue;\n  }\n\n  /**\n   * Checks the LMS state and ensures it has been initialized.\n   *\n   * @param {boolean} checkTerminated\n   * @param {number} beforeInitError\n   * @param {number} afterTermError\n   * @return {boolean}\n   */\n  checkState(\n    checkTerminated: boolean,\n    beforeInitError: number,\n    afterTermError: number,\n  ): boolean {\n    if (this.isNotInitialized()) {\n      this.throwSCORMError(beforeInitError);\n      return false;\n    } else if (checkTerminated && this.isTerminated()) {\n      this.throwSCORMError(afterTermError);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {(string|number)} _errorNumber\n   * @param {boolean} _detail\n   * @return {string}\n   * @abstract\n   */\n  getLmsErrorMessageDetails(\n    _errorNumber: string | number,\n    _detail: boolean = false,\n  ): string {\n    throw new Error(\n      \"The getLmsErrorMessageDetails method has not been implemented\",\n    );\n  }\n\n  /**\n   * Gets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @return {string}\n   * @abstract\n   */\n  getCMIValue(_CMIElement: string): string {\n    throw new Error(\"The getCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Sets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @param {any} _value\n   * @return {string}\n   * @abstract\n   */\n  setCMIValue(_CMIElement: string, _value: any): string {\n    throw new Error(\"The setCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Shared API method to set a valid for a given element.\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  _commonSetCMIValue(\n    methodName: string,\n    scorm2004: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (!CMIElement || CMIElement === \"\") {\n      return APIConstants.global.SCORM_FALSE;\n    }\n\n    const structure = CMIElement.split(\".\");\n    let refObject: RefObject = this;\n    let returnValue = APIConstants.global.SCORM_FALSE;\n    let foundFirstIndex = false;\n\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      const attribute = structure[idx];\n\n      if (idx === structure.length - 1) {\n        if (scorm2004 && attribute.substring(0, 8) === \"{target=\") {\n          if (this.isInitialized()) {\n            this.throwSCORMError(this._error_codes.READ_ONLY_ELEMENT);\n          } else {\n            refObject = {\n              ...refObject,\n              attribute: value,\n            };\n          }\n        } else if (!this._checkObjectHasProperty(refObject, attribute)) {\n          this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n        } else {\n          if (\n            stringMatches(CMIElement, \"\\\\.correct_responses\\\\.\\\\d+\") &&\n            this.isInitialized()\n          ) {\n            this.validateCorrectResponse(CMIElement, value);\n          }\n\n          if (!scorm2004 || this.lastErrorCode === \"0\") {\n            refObject[attribute] = value;\n            returnValue = APIConstants.global.SCORM_TRUE;\n          }\n        }\n      } else {\n        refObject = refObject[attribute];\n        if (!refObject) {\n          this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n          break;\n        }\n\n        if (refObject instanceof CMIArray) {\n          const index = parseInt(structure[idx + 1], 10);\n\n          // SCO is trying to set an item on an array\n          if (!isNaN(index)) {\n            const item = refObject.childArray[index];\n\n            if (item) {\n              refObject = item;\n              foundFirstIndex = true;\n            } else {\n              const newChild = this.getChildElement(\n                CMIElement,\n                value,\n                foundFirstIndex,\n              );\n              foundFirstIndex = true;\n\n              if (!newChild) {\n                this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n              } else {\n                if (refObject.initialized) newChild.initialize();\n\n                refObject.childArray.push(newChild);\n                refObject = newChild;\n              }\n            }\n\n            // Have to update idx value to skip the array position\n            idx++;\n          }\n        }\n      }\n    }\n\n    if (returnValue === APIConstants.global.SCORM_FALSE) {\n      this.apiLog(\n        methodName,\n        `There was an error setting the value for: ${CMIElement}, value of: ${value}`,\n        APIConstants.global.LOG_LEVEL_WARNING,\n      );\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @return {any}\n   */\n  _commonGetCMIValue(\n    methodName: string,\n    scorm2004: boolean,\n    CMIElement: string,\n  ): any {\n    if (!CMIElement || CMIElement === \"\") {\n      return \"\";\n    }\n\n    const structure = CMIElement.split(\".\");\n    let refObject: RefObject = this;\n    let attribute = null;\n\n    const uninitializedErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) has not been initialized.`;\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      attribute = structure[idx];\n\n      if (!scorm2004) {\n        if (idx === structure.length - 1) {\n          if (!this._checkObjectHasProperty(refObject, attribute)) {\n            this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n            return;\n          }\n        }\n      } else {\n        if (\n          String(attribute).substring(0, 8) === \"{target=\" &&\n          typeof refObject._isTargetValid == \"function\"\n        ) {\n          const target = String(attribute).substring(\n            8,\n            String(attribute).length - 9,\n          );\n          return refObject._isTargetValid(target);\n        } else if (!this._checkObjectHasProperty(refObject, attribute)) {\n          this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n          return;\n        }\n      }\n\n      refObject = refObject[attribute];\n      if (refObject === undefined) {\n        this.throwSCORMError(invalidErrorCode, invalidErrorMessage);\n        break;\n      }\n\n      if (refObject instanceof CMIArray) {\n        const index = parseInt(structure[idx + 1], 10);\n\n        // SCO is trying to set an item on an array\n        if (!isNaN(index)) {\n          const item = refObject.childArray[index];\n\n          if (item) {\n            refObject = item;\n          } else {\n            this.throwSCORMError(\n              this._error_codes.VALUE_NOT_INITIALIZED,\n              uninitializedErrorMessage,\n            );\n            break;\n          }\n\n          // Have to update idx value to skip the array position\n          idx++;\n        }\n      }\n    }\n\n    if (refObject === null || refObject === undefined) {\n      if (!scorm2004) {\n        if (attribute === \"_children\") {\n          this.throwSCORMError(ErrorCodes.scorm12.CHILDREN_ERROR);\n        } else if (attribute === \"_count\") {\n          this.throwSCORMError(ErrorCodes.scorm12.COUNT_ERROR);\n        }\n      }\n    } else {\n      return refObject;\n    }\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isInitialized(): boolean {\n    return this.currentState === APIConstants.global.STATE_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_NOT_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isNotInitialized(): boolean {\n    return this.currentState === APIConstants.global.STATE_NOT_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_TERMINATED\n   *\n   * @return {boolean}\n   */\n  isTerminated(): boolean {\n    return this.currentState === APIConstants.global.STATE_TERMINATED;\n  }\n\n  /**\n   * Provides a mechanism for attaching to a specific SCORM event\n   *\n   * @param {string} listenerName\n   * @param {function} callback\n   */\n  on(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (let i = 0; i < listenerFunctions.length; i++) {\n      const listenerSplit = listenerFunctions[i].split(\".\");\n      if (listenerSplit.length === 0) return;\n\n      const functionName = listenerSplit[0];\n\n      let CMIElement = null;\n      if (listenerSplit.length > 1) {\n        CMIElement = listenerName.replace(functionName + \".\", \"\");\n      }\n\n      this.listenerArray.push({\n        functionName: functionName,\n        CMIElement: CMIElement,\n        callback: callback,\n      });\n\n      this.apiLog(\n        \"on\",\n        `Added event listener: ${this.listenerArray.length}`,\n        APIConstants.global.LOG_LEVEL_INFO,\n        functionName,\n      );\n    }\n  }\n\n  /**\n   * Provides a mechanism for detaching a specific SCORM event listener\n   *\n   * @param {string} listenerName\n   * @param {function} callback\n   */\n  off(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (let i = 0; i < listenerFunctions.length; i++) {\n      const listenerSplit = listenerFunctions[i].split(\".\");\n      if (listenerSplit.length === 0) return;\n\n      const functionName = listenerSplit[0];\n\n      let CMIElement = null;\n      if (listenerSplit.length > 1) {\n        CMIElement = listenerName.replace(functionName + \".\", \"\");\n      }\n\n      const removeIndex = this.listenerArray.findIndex(\n        (obj) =>\n          obj.functionName === functionName &&\n          obj.CMIElement === CMIElement &&\n          obj.callback === callback,\n      );\n      if (removeIndex !== -1) {\n        this.listenerArray.splice(removeIndex, 1);\n        this.apiLog(\n          \"off\",\n          `Removed event listener: ${this.listenerArray.length}`,\n          APIConstants.global.LOG_LEVEL_INFO,\n          functionName,\n        );\n      }\n    }\n  }\n\n  /**\n   * Provides a mechanism for clearing all listeners from a specific SCORM event\n   *\n   * @param {string} listenerName\n   */\n  clear(listenerName: string) {\n    const listenerFunctions = listenerName.split(\" \");\n    for (let i = 0; i < listenerFunctions.length; i++) {\n      const listenerSplit = listenerFunctions[i].split(\".\");\n      if (listenerSplit.length === 0) return;\n\n      const functionName = listenerSplit[0];\n\n      let CMIElement = null;\n      if (listenerSplit.length > 1) {\n        CMIElement = listenerName.replace(functionName + \".\", \"\");\n      }\n\n      this.listenerArray = this.listenerArray.filter(\n        (obj) =>\n          obj.functionName !== functionName && obj.CMIElement !== CMIElement,\n      );\n    }\n  }\n\n  /**\n   * Processes any 'on' listeners that have been created\n   *\n   * @param {string} functionName\n   * @param {string} CMIElement\n   * @param {any} value\n   */\n  processListeners(functionName: string, CMIElement?: string, value?: any) {\n    this.apiLog(\n      functionName,\n      value,\n      APIConstants.global.LOG_LEVEL_INFO,\n      CMIElement,\n    );\n    for (let i = 0; i < this.listenerArray.length; i++) {\n      const listener = this.listenerArray[i];\n      const functionsMatch = listener.functionName === functionName;\n      const listenerHasCMIElement = !!listener.CMIElement;\n      let CMIElementsMatch = false;\n      if (\n        CMIElement &&\n        listener.CMIElement &&\n        listener.CMIElement.substring(listener.CMIElement.length - 1) === \"*\"\n      ) {\n        CMIElementsMatch =\n          CMIElement.indexOf(\n            listener.CMIElement.substring(0, listener.CMIElement.length - 1),\n          ) === 0;\n      } else {\n        CMIElementsMatch = listener.CMIElement === CMIElement;\n      }\n\n      if (functionsMatch && (!listenerHasCMIElement || CMIElementsMatch)) {\n        this.apiLog(\n          \"processListeners\",\n          `Processing listener: ${listener.functionName}`,\n          APIConstants.global.LOG_LEVEL_INFO,\n          CMIElement,\n        );\n        listener.callback(CMIElement, value);\n      }\n    }\n  }\n\n  /**\n   * Throws a SCORM error\n   *\n   * @param {number} errorNumber\n   * @param {string} message\n   */\n  throwSCORMError(errorNumber: number, message?: string) {\n    if (!message) {\n      message = this.getLmsErrorMessageDetails(errorNumber);\n    }\n\n    this.apiLog(\n      \"throwSCORMError\",\n      errorNumber + \": \" + message,\n      APIConstants.global.LOG_LEVEL_ERROR,\n    );\n\n    this.lastErrorCode = String(errorNumber);\n  }\n\n  /**\n   * Clears the last SCORM error code on success.\n   *\n   * @param {string} success\n   */\n  clearSCORMError(success: string) {\n    if (success !== undefined && success !== APIConstants.global.SCORM_FALSE) {\n      this.lastErrorCode = \"0\";\n    }\n  }\n\n  /**\n   * Load the CMI from a flattened JSON object\n   * @param {RefObject} json\n   * @param {string} CMIElement\n   */\n  loadFromFlattenedJSON(json: RefObject, CMIElement?: string) {\n    if (!CMIElement) {\n      // by default, we start from a blank string because we're expecting each element to start with `cmi`\n      CMIElement = \"\";\n    }\n    if (!this.isNotInitialized()) {\n      console.error(\n        \"loadFromFlattenedJSON can only be called before the call to lmsInitialize.\",\n      );\n      return;\n    }\n\n    /**\n     * Tests two strings against a given regular expression pattern and determines a numeric or null result based on the matching criterion.\n     *\n     * @param {string} a - The first string to be tested against the pattern.\n     * @param {string} c - The second string to be tested against the pattern.\n     * @param {RegExp} a_pattern - The regular expression pattern to test the strings against.\n     * @return {number | null} A numeric result based on the matching criterion, or null if the strings do not match the pattern.\n     */\n    function testPattern(\n      a: string,\n      c: string,\n      a_pattern: RegExp,\n    ): number | null {\n      const a_match = a.match(a_pattern);\n\n      let c_match;\n      if (a_match !== null && (c_match = c.match(a_pattern)) !== null) {\n        const a_num = Number(a_match[2]);\n        const c_num = Number(c_match[2]);\n        if (a_num === c_num) {\n          if (a_match[3] === \"id\") {\n            return -1;\n          } else if (a_match[3] === \"type\") {\n            if (c_match[3] === \"id\") {\n              return 1;\n            } else {\n              return -1;\n            }\n          } else {\n            return 1;\n          }\n        }\n        return a_num - c_num;\n      }\n\n      return null;\n    }\n\n    const int_pattern = /^(cmi\\.interactions\\.)(\\d+)\\.(.*)$/;\n    const obj_pattern = /^(cmi\\.objectives\\.)(\\d+)\\.(.*)$/;\n\n    const result = Object.keys(json).map(function (key) {\n      return [String(key), json[key]];\n    });\n\n    // CMI interactions need to have id and type loaded before any other fields\n    result.sort(function ([a, _b], [c, _d]) {\n      let test;\n      if ((test = testPattern(a, c, int_pattern)) !== null) {\n        return test;\n      }\n      if ((test = testPattern(a, c, obj_pattern)) !== null) {\n        return test;\n      }\n\n      if (a < c) {\n        return -1;\n      }\n      if (a > c) {\n        return 1;\n      }\n      return 0;\n    });\n\n    let obj: RefObject;\n    result.forEach((element) => {\n      obj = {};\n      obj[element[0]] = element[1];\n      this.loadFromJSON(unflatten(obj), CMIElement);\n    });\n  }\n\n  /**\n   * Loads CMI data from a JSON object.\n   *\n   * @param {RefObject} json\n   * @param {string} CMIElement\n   */\n  loadFromJSON(json: RefObject, CMIElement: string) {\n    if (!this.isNotInitialized()) {\n      console.error(\n        \"loadFromJSON can only be called before the call to lmsInitialize.\",\n      );\n      return;\n    }\n\n    CMIElement = CMIElement !== undefined ? CMIElement : \"cmi\";\n\n    this.startingData = json;\n\n    // could this be refactored down to flatten(json) then setCMIValue on each?\n    for (const key in json) {\n      if ({}.hasOwnProperty.call(json, key) && json[key]) {\n        const currentCMIElement = (CMIElement ? CMIElement + \".\" : \"\") + key;\n        const value = json[key];\n\n        if (value[\"childArray\"]) {\n          for (let i = 0; i < value[\"childArray\"].length; i++) {\n            this.loadFromJSON(\n              value[\"childArray\"][i],\n              currentCMIElement + \".\" + i,\n            );\n          }\n        } else if (value.constructor === Object) {\n          this.loadFromJSON(value, currentCMIElement);\n        } else {\n          this.setCMIValue(currentCMIElement, value);\n        }\n      }\n    }\n  }\n\n  /**\n   * Render the CMI object to JSON for sending to an LMS.\n   *\n   * @return {string}\n   */\n  renderCMIToJSONString(): string {\n    const cmi = this.cmi;\n    // Do we want/need to return fields that have no set value?\n    if (this.settings.sendFullCommit) {\n      return JSON.stringify({ cmi });\n    }\n    return JSON.stringify({ cmi }, (k, v) => (v === undefined ? null : v), 2);\n  }\n\n  /**\n   * Returns a JS object representing the current cmi\n   * @return {object}\n   */\n  renderCMIToJSONObject(): object {\n    return JSON.parse(this.renderCMIToJSONString());\n  }\n\n  /**\n   * Send the request to the LMS\n   * @param {string} url\n   * @param {CommitObject|RefObject|Array} params\n   * @param {boolean} immediate\n   * @return {ResultObject}\n   */\n  async processHttpRequest(\n    url: string,\n    params: CommitObject | RefObject | Array<any>,\n    immediate: boolean = false,\n  ): Promise<ResultObject> {\n    const api = this;\n    const genericError: ResultObject = {\n      result: APIConstants.global.SCORM_FALSE,\n      errorCode: this.error_codes.GENERAL,\n    };\n\n    // if we are terminating the module or closing the browser window/tab, we need to make this fetch ASAP.\n    // Some browsers, especially Chrome, do not like synchronous requests to be made when the window is closing.\n    if (immediate) {\n      this.performFetch(url, params).then(async (response) => {\n        await this.transformResponse(response);\n      });\n      return {\n        result: APIConstants.global.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n\n    const process = async (\n      url: string,\n      params: CommitObject | RefObject | Array<any>,\n      settings: Settings,\n    ): Promise<ResultObject> => {\n      try {\n        params = settings.requestHandler(params);\n        const response = await this.performFetch(url, params);\n\n        return this.transformResponse(response);\n      } catch (e) {\n        this.apiLog(\n          \"processHttpRequest\",\n          e,\n          APIConstants.global.LOG_LEVEL_ERROR,\n        );\n        api.processListeners(\"CommitError\");\n        return genericError;\n      }\n    };\n\n    if (this.settings.asyncCommit) {\n      const debouncedProcess = debounce(process, 500, immediate);\n      debouncedProcess(url, params, this.settings);\n\n      return {\n        result: APIConstants.global.SCORM_TRUE,\n        errorCode: 0,\n      };\n    } else {\n      return await process(url, params, this.settings);\n    }\n  }\n\n  /**\n   * Throws a SCORM error\n   *\n   * @param {number} when - the number of milliseconds to wait before committing\n   * @param {string} callback - the name of the commit event callback\n   */\n  scheduleCommit(when: number, callback: string) {\n    this._timeout = new ScheduledCommit(this, when, callback);\n    this.apiLog(\n      \"scheduleCommit\",\n      \"scheduled\",\n      APIConstants.global.LOG_LEVEL_DEBUG,\n      \"\",\n    );\n  }\n\n  /**\n   * Clears and cancels any currently scheduled commits\n   */\n  clearScheduledCommit() {\n    if (this._timeout) {\n      this._timeout.cancel();\n      this._timeout = undefined;\n      this.apiLog(\n        \"clearScheduledCommit\",\n        \"cleared\",\n        APIConstants.global.LOG_LEVEL_DEBUG,\n        \"\",\n      );\n    }\n  }\n\n  /**\n   * Check to see if the specific object has the given property\n   * @param {RefObject} refObject\n   * @param {string} attribute\n   * @return {boolean}\n   * @private\n   */\n  private _checkObjectHasProperty(\n    refObject: RefObject,\n    attribute: string,\n  ): boolean {\n    return (\n      Object.hasOwnProperty.call(refObject, attribute) ||\n      Object.getOwnPropertyDescriptor(\n        Object.getPrototypeOf(refObject),\n        attribute,\n      ) != null ||\n      attribute in refObject\n    );\n  }\n\n  /**\n   * Handles the error that occurs when trying to access a value\n   * @param {any} e\n   * @param {string} returnValue\n   * @return {string}\n   * @private\n   */\n  private handleValueAccessException(e: any, returnValue: string): string {\n    if (e instanceof ValidationError) {\n      this.lastErrorCode = String(e.errorCode);\n      returnValue = APIConstants.global.SCORM_FALSE;\n    } else {\n      if (e instanceof Error && e.message) {\n        console.error(e.message);\n      } else {\n        console.error(e);\n      }\n      this.throwSCORMError(this._error_codes.GENERAL);\n    }\n    return returnValue;\n  }\n\n  /**\n   * Perform the fetch request to the LMS\n   * @param {string} url\n   * @param {RefObject|Array} params\n   * @return {Promise<Response>}\n   * @private\n   */\n  private async performFetch(\n    url: string,\n    params: RefObject | Array<any>,\n  ): Promise<Response> {\n    return fetch(url, {\n      method: \"POST\",\n      body: params instanceof Array ? params.join(\"&\") : JSON.stringify(params),\n      headers: {\n        ...this.settings.xhrHeaders,\n        \"Content-Type\": this.settings.commitRequestDataType,\n      },\n      credentials: this.settings.xhrWithCredentials ? \"include\" : undefined,\n      keepalive: true,\n    });\n  }\n\n  /**\n   * Transforms the response from the LMS to a ResultObject\n   * @param {Response} response\n   * @return {Promise<ResultObject>}\n   * @private\n   */\n  private async transformResponse(response: Response): Promise<ResultObject> {\n    const result =\n      typeof this.settings.responseHandler === \"function\"\n        ? await this.settings.responseHandler(response)\n        : await response.json();\n\n    if (\n      response.status >= 200 &&\n      response.status <= 299 &&\n      (result.result === true ||\n        result.result === APIConstants.global.SCORM_TRUE)\n    ) {\n      this.processListeners(\"CommitSuccess\");\n    } else {\n      this.processListeners(\"CommitError\");\n    }\n    return result;\n  }\n}\n","/**\n * Debounce function to delay the execution of a given function.\n *\n * @param func - The function to debounce.\n * @param wait - The number of milliseconds to delay.\n * @param immediate - If `true`, the function will be triggered on the leading edge instead of the trailing.\n * @returns A debounced version of the provided function.\n */\nexport function debounce<T extends (...args: any[]) => void>(\n  func: T,\n  wait: number,\n  immediate = false,\n): (...args: Parameters<T>) => void {\n  let timeout: ReturnType<typeof setTimeout> | null;\n\n  return function (this: any, ...args: Parameters<T>) {\n    const context = this;\n\n    const later = () => {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n\n    const callNow = immediate && !timeout;\n\n    if (timeout) clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n\n    if (callNow) func.apply(context, args);\n  };\n}\n","const scorm12 = {\n  CMIString256: \"^.{0,255}$\",\n  CMIString4096: \"^.{0,4096}$\",\n  CMITime: \"^(?:[01]\\\\d|2[0123]):(?:[012345]\\\\d):(?:[012345]\\\\d)$\",\n  CMITimespan: \"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$\",\n\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{0,3})(.[0-9]*)?$\",\n\n  CMIIdentifier: \"^[\\\\u0021-\\\\u007E\\\\s]{0,255}$\",\n  CMIFeedback: \"^.{0,255}$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMIStatus: \"^(passed|completed|failed|incomplete|browsed)$\",\n  CMIStatus2: \"^(passed|completed|failed|incomplete|browsed|not attempted)$\",\n  CMIExit: \"^(time-out|suspend|logout|)$\",\n  CMIType:\n    \"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$\",\n  CMIResult:\n    \"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\\\.[0-9]*)?)$\",\n  NAVEvent: \"^(previous|continue)$\",\n  // Data ranges\n  score_range: \"0#100\",\n  audio_range: \"-1#100\",\n  speed_range: \"-100#100\",\n  weighting_range: \"-100#100\",\n  text_range: \"-1#1\",\n};\nconst aicc = {\n  ...scorm12,\n  ...{\n    CMIIdentifier: \"^\\\\w{1,255}$\",\n  },\n};\nconst scorm2004 = {\n  CMIString200: \"^[\\\\u0000-\\\\uFFFF]{0,200}$\",\n  CMIString250: \"^[\\\\u0000-\\\\uFFFF]{0,250}$\",\n  CMIString1000: \"^[\\\\u0000-\\\\uFFFF]{0,1000}$\",\n  CMIString4000: \"^[\\\\u0000-\\\\uFFFF]{0,4000}$\",\n  CMIString64000: \"^[\\\\u0000-\\\\uFFFF]{0,64000}$\",\n  CMILang: \"^([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?$|^$\",\n\n  CMILangString250:\n    \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,250}$)?$\",\n\n  CMILangcr: \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?}))(.*?)$\",\n\n  CMILangString250cr:\n    \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?})?(.{0,250})?)?$\",\n\n  CMILangString4000:\n    \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,4000}$)?$\",\n\n  CMITime:\n    \"^(19[7-9]{1}[0-9]{1}|20[0-2]{1}[0-9]{1}|203[0-8]{1})((-(0[1-9]{1}|1[0-2]{1}))((-(0[1-9]{1}|[1-2]{1}[0-9]{1}|3[0-1]{1}))(T([0-1]{1}[0-9]{1}|2[0-3]{1})((:[0-5]{1}[0-9]{1})((:[0-5]{1}[0-9]{1})((\\\\.[0-9]{1,2})((Z|([+|-]([0-1]{1}[0-9]{1}|2[0-3]{1})))(:[0-5]{1}[0-9]{1})?)?)?)?)?)?)?)?$\",\n  CMITimespan:\n    \"^P(?:([.,\\\\d]+)Y)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)W)?(?:([.,\\\\d]+)D)?(?:T?(?:([.,\\\\d]+)H)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)S)?)?$\",\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{1,5})(\\\\.[0-9]{1,18})?$\",\n  CMIIdentifier: \"^\\\\S{1,250}[a-zA-Z0-9]$\",\n  CMIShortIdentifier: \"^[\\\\w\\\\.\\\\-\\\\_]{1,250}$\",\n  CMILongIdentifier:\n    \"^(?:(?!urn:)\\\\S{1,4000}|urn:[A-Za-z0-9-]{1,31}:\\\\S{1,4000}|.{1,4000})$\",\n  // need to re-examine this\n  CMIFeedback: \"^.*$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  CMIIndexStore: \".N(\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMICStatus: \"^(completed|incomplete|not attempted|unknown)$\",\n  CMISStatus: \"^(passed|failed|unknown)$\",\n  CMIExit: \"^(time-out|suspend|logout|normal)$\",\n  CMIType:\n    \"^(true-false|choice|fill-in|long-fill-in|matching|performance|sequencing|likert|numeric|other)$\",\n  CMIResult:\n    \"^(correct|incorrect|unanticipated|neutral|-?([0-9]{1,4})(\\\\.[0-9]{1,18})?)$\",\n  NAVEvent:\n    \"^(previous|continue|exit|exitAll|abandon|abandonAll|suspendAll|_none_|(\\\\{target=\\\\S{0,}[a-zA-Z0-9-_]+})?choice|(\\\\{target=\\\\S{0,}[a-zA-Z0-9-_]+})?jump)$\",\n\n  NAVBoolean: \"^(unknown|true|false$)\",\n  NAVTarget: \"^{target=\\\\S{0,}[a-zA-Z0-9-_]+}$\",\n  // Data ranges\n  scaled_range: \"-1#1\",\n  audio_range: \"0#*\",\n  speed_range: \"0#*\",\n  text_range: \"-1#1\",\n  progress_range: \"0#1\",\n};\nconst Regex = {\n  aicc: aicc,\n  scorm12: scorm12,\n  scorm2004: scorm2004,\n};\nexport default Regex;\n","import { BaseScormValidationError } from \"../../exceptions\";\n\n/**\n * Check if the value matches the proper format. If not, throw proper error code.\n *\n * @param {string} value\n * @param {string} regexPattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @param {boolean} [allowEmptyString]\n * @return {boolean}\n */\nexport function checkValidFormat(\n  value: string,\n  regexPattern: string,\n  errorCode: number,\n  errorClass: typeof BaseScormValidationError,\n  allowEmptyString?: boolean,\n): boolean {\n  if (typeof value !== \"string\") {\n    return false;\n  }\n  const formatRegex = new RegExp(regexPattern);\n  const matches = value.match(formatRegex);\n  if (allowEmptyString && value === \"\") {\n    return true;\n  }\n  if (value === undefined || !matches || matches[0] === \"\") {\n    throw new errorClass(errorCode);\n  }\n  return true;\n}\n\n/**\n * Check if the value matches the proper range. If not, throw proper error code.\n *\n * @param {any} value\n * @param {string} rangePattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @return {boolean}\n */\nexport function checkValidRange(\n  value: any,\n  rangePattern: string,\n  errorCode: number,\n  errorClass: typeof BaseScormValidationError,\n): boolean {\n  const ranges = rangePattern.split(\"#\");\n  value = value * 1.0;\n  if (value >= ranges[0]) {\n    if (ranges[1] === \"*\" || value <= ranges[1]) {\n      return true;\n    } else {\n      throw new errorClass(errorCode);\n    }\n  } else {\n    throw new errorClass(errorCode);\n  }\n}\n","import { checkValidFormat, checkValidRange } from \"../common/validation\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} value\n * @param {string} regexPattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check2004ValidFormat(\n  value: string,\n  regexPattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  return checkValidFormat(\n    value,\n    regexPattern,\n    ErrorCodes.scorm2004.TYPE_MISMATCH,\n    Scorm2004ValidationError,\n    allowEmptyString,\n  );\n}\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} value\n * @param {string} rangePattern\n * @return {boolean}\n */\nexport function check2004ValidRange(\n  value: string,\n  rangePattern: string,\n): boolean {\n  return checkValidRange(\n    value,\n    rangePattern,\n    ErrorCodes.scorm2004.VALUE_OUT_OF_RANGE,\n    Scorm2004ValidationError,\n  );\n}\n","/**\n * Class for SCORM 2004's cmi.learner_preference object\n */\nimport { BaseCMI } from \"../common/base_cmi\";\nimport APIConstants from \"../../constants/api_constants\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\nimport Regex from \"../../constants/regex\";\n\nexport class CMILearnerPreference extends BaseCMI {\n  private __children = APIConstants.scorm2004.student_preference_children;\n  private _audio_level = \"1\";\n  private _language = \"\";\n  private _delivery_speed = \"1\";\n  private _audio_captioning = \"0\";\n\n  /**\n   * Constructor for cmi.learner_preference\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm2004ValidationError(ErrorCodes.scorm2004.READ_ONLY_ELEMENT);\n  }\n\n  /**\n   * Getter for _audio_level\n   * @return {string}\n   */\n  get audio_level(): string {\n    return this._audio_level;\n  }\n\n  /**\n   * Setter for _audio_level\n   * @param {string} audio_level\n   */\n  set audio_level(audio_level: string) {\n    if (\n      check2004ValidFormat(audio_level, Regex.scorm2004.CMIDecimal) &&\n      check2004ValidRange(audio_level, Regex.scorm2004.audio_range)\n    ) {\n      this._audio_level = audio_level;\n    }\n  }\n\n  /**\n   * Getter for _language\n   * @return {string}\n   */\n  get language(): string {\n    return this._language;\n  }\n\n  /**\n   * Setter for _language\n   * @param {string} language\n   */\n  set language(language: string) {\n    if (check2004ValidFormat(language, Regex.scorm2004.CMILang)) {\n      this._language = language;\n    }\n  }\n\n  /**\n   * Getter for _delivery_speed\n   * @return {string}\n   */\n  get delivery_speed(): string {\n    return this._delivery_speed;\n  }\n\n  /**\n   * Setter for _delivery_speed\n   * @param {string} delivery_speed\n   */\n  set delivery_speed(delivery_speed: string) {\n    if (\n      check2004ValidFormat(delivery_speed, Regex.scorm2004.CMIDecimal) &&\n      check2004ValidRange(delivery_speed, Regex.scorm2004.speed_range)\n    ) {\n      this._delivery_speed = delivery_speed;\n    }\n  }\n\n  /**\n   * Getter for _audio_captioning\n   * @return {string}\n   */\n  get audio_captioning(): string {\n    return this._audio_captioning;\n  }\n\n  /**\n   * Setter for _audio_captioning\n   * @param {string} audio_captioning\n   */\n  set audio_captioning(audio_captioning: string) {\n    if (\n      check2004ValidFormat(audio_captioning, Regex.scorm2004.CMISInteger) &&\n      check2004ValidRange(audio_captioning, Regex.scorm2004.text_range)\n    ) {\n      this._audio_captioning = audio_captioning;\n    }\n  }\n\n  /**\n   * toJSON for cmi.learner_preference\n   *\n   * @return {\n   *    {\n   *      audio_level: string,\n   *      language: string,\n   *      delivery_speed: string,\n   *      audio_captioning: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    audio_level: string;\n    language: string;\n    delivery_speed: string;\n    audio_captioning: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      audio_level: this.audio_level,\n      language: this.language,\n      delivery_speed: this.delivery_speed,\n      audio_captioning: this.audio_captioning,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","export enum NAVBoolean {\n  unknown = \"unknown\",\n  true = \"true\",\n  false = \"false\",\n}\n\nexport enum SuccessStatus {\n  passed = \"passed\",\n  failed = \"failed\",\n  unknown = \"unknown\",\n}\n\nexport enum CompletionStatus {\n  completed = \"completed\",\n  incomplete = \"incomplete\",\n  unknown = \"unknown\",\n}\n","import Regex from \"./regex\";\n\nconst scorm2004_regex = Regex.scorm2004;\nexport const LearnerResponses: Responses = {\n  \"true-false\": {\n    format: \"^true$|^false$\",\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  choice: {\n    format: scorm2004_regex.CMILongIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    unique: true,\n  },\n  \"fill-in\": {\n    format: scorm2004_regex.CMILangString250,\n    max: 10,\n    delimiter: \"[,]\",\n    unique: false,\n  },\n  \"long-fill-in\": {\n    format: scorm2004_regex.CMILangString4000,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  matching: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIShortIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n  },\n  performance: {\n    format: \"^$|\" + scorm2004_regex.CMIShortIdentifier,\n    format2:\n      scorm2004_regex.CMIDecimal + \"|^$|\" + scorm2004_regex.CMIShortIdentifier,\n    max: 250,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n  },\n  sequencing: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    unique: false,\n  },\n  likert: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  numeric: {\n    format: scorm2004_regex.CMIDecimal,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  other: {\n    format: scorm2004_regex.CMIString4000,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n};\nexport const CorrectResponses: Responses = {\n  \"true-false\": {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: \"^true$|^false$\",\n    limit: 1,\n  },\n  choice: {\n    max: 36,\n    delimiter: \"[,]\",\n    unique: true,\n    duplicate: false,\n    format: scorm2004_regex.CMILongIdentifier,\n  },\n  \"fill-in\": {\n    max: 10,\n    delimiter: \"[,]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMILangString250cr,\n  },\n  \"long-fill-in\": {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: true,\n    format: scorm2004_regex.CMILangString4000,\n  },\n  matching: {\n    max: 36,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIShortIdentifier,\n  },\n  performance: {\n    max: 250,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    delimiter3: \"[:]\",\n    unique: false,\n    duplicate: false,\n    format: \"^$|\" + scorm2004_regex.CMIShortIdentifier,\n    format2:\n      scorm2004_regex.CMIDecimal + \"|^$|\" + scorm2004_regex.CMIShortIdentifier,\n  },\n  sequencing: {\n    max: 36,\n    delimiter: \"[,]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n  },\n  likert: {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n    limit: 1,\n  },\n  numeric: {\n    max: 2,\n    delimiter: \"[:]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIDecimal,\n    limit: 1,\n  },\n  other: {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIString4000,\n    limit: 1,\n  },\n};\n\nexport type ResponseType = {\n  format: string;\n  max: number;\n  delimiter: string;\n  unique: boolean;\n  duplicate?: boolean;\n  format2?: string;\n  delimiter2?: string;\n  limit?: number;\n  delimiter3?: string;\n};\n\nexport type Responses = {\n  [key: string]: ResponseType;\n};\n","/**\n * Class representing SCORM 2004's `cmi.interactions` object\n */\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { CMIArray } from \"../common/array\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport APIConstants from \"../../constants/api_constants\";\nimport { check2004ValidFormat } from \"./validation\";\nimport Regex from \"../../constants/regex\";\nimport { LearnerResponses } from \"../../constants/response_constants\";\n\nexport class CMIInteractions extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives` Array\n   */\n  constructor() {\n    super({\n      children: APIConstants.scorm2004.interactions_children,\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class for SCORM 2004's cmi.interaction.n object\n */\n\nexport class CMIInteractionsObject extends BaseCMI {\n  private _id = \"\";\n  private _type = \"\";\n  private _timestamp = \"\";\n  private _weighting = \"\";\n  private _learner_response = \"\";\n  private _result = \"\";\n  private _latency = \"\";\n  private _description = \"\";\n\n  /**\n   * Constructor for cmi.interaction.n\n   */\n  constructor() {\n    super();\n    this.objectives = new CMIArray({\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: APIConstants.scorm2004.objectives_children,\n    });\n    this.correct_responses = new CMIArray({\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: APIConstants.scorm2004.correct_responses_children,\n    });\n  }\n\n  public objectives: CMIArray;\n  public correct_responses: CMIArray;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize() {\n    super.initialize();\n    this.objectives?.initialize();\n    this.correct_responses?.initialize();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (check2004ValidFormat(id, Regex.scorm2004.CMILongIdentifier)) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _type\n   * @return {string}\n   */\n  get type(): string {\n    return this._type;\n  }\n\n  /**\n   * Setter for _type\n   * @param {string} type\n   */\n  set type(type: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(type, Regex.scorm2004.CMIType)) {\n        this._type = type;\n      }\n    }\n  }\n\n  /**\n   * Getter for _timestamp\n   * @return {string}\n   */\n  get timestamp(): string {\n    return this._timestamp;\n  }\n\n  /**\n   * Setter for _timestamp\n   * @param {string} timestamp\n   */\n  set timestamp(timestamp: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(timestamp, Regex.scorm2004.CMITime)) {\n        this._timestamp = timestamp;\n      }\n    }\n  }\n\n  /**\n   * Getter for _weighting\n   * @return {string}\n   */\n  get weighting(): string {\n    return this._weighting;\n  }\n\n  /**\n   * Setter for _weighting\n   * @param {string} weighting\n   */\n  set weighting(weighting: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(weighting, Regex.scorm2004.CMIDecimal)) {\n        this._weighting = weighting;\n      }\n    }\n  }\n\n  /**\n   * Getter for _learner_response\n   * @return {string}\n   */\n  get learner_response(): string {\n    return this._learner_response;\n  }\n\n  /**\n   * Setter for _learner_response. Does type validation to make sure response\n   * matches SCORM 2004's spec\n   * @param {string} learner_response\n   */\n  set learner_response(learner_response: string) {\n    if (this.initialized && (this._type === \"\" || this._id === \"\")) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      let nodes = [];\n      const response_type = LearnerResponses[this.type];\n\n      if (response_type) {\n        if (response_type?.delimiter) {\n          nodes = learner_response.split(response_type.delimiter);\n        } else {\n          nodes[0] = learner_response;\n        }\n\n        if (nodes.length > 0 && nodes.length <= response_type.max) {\n          const formatRegex = new RegExp(response_type.format);\n\n          for (let i = 0; i < nodes.length; i++) {\n            if (response_type?.delimiter2) {\n              const values = nodes[i].split(response_type.delimiter2);\n\n              if (values.length === 2) {\n                if (!values[0].match(formatRegex)) {\n                  throw new Scorm2004ValidationError(\n                    ErrorCodes.scorm2004.TYPE_MISMATCH,\n                  );\n                } else {\n                  if (\n                    !response_type.format2 ||\n                    !values[1].match(new RegExp(response_type.format2))\n                  ) {\n                    throw new Scorm2004ValidationError(\n                      ErrorCodes.scorm2004.TYPE_MISMATCH,\n                    );\n                  }\n                }\n              } else {\n                throw new Scorm2004ValidationError(\n                  ErrorCodes.scorm2004.TYPE_MISMATCH,\n                );\n              }\n            } else {\n              if (!nodes[i].match(formatRegex)) {\n                throw new Scorm2004ValidationError(\n                  ErrorCodes.scorm2004.TYPE_MISMATCH,\n                );\n              } else {\n                if (nodes[i] !== \"\" && response_type.unique) {\n                  for (let j = 0; j < i; j++) {\n                    if (nodes[i] === nodes[j]) {\n                      throw new Scorm2004ValidationError(\n                        ErrorCodes.scorm2004.TYPE_MISMATCH,\n                      );\n                    }\n                  }\n                }\n              }\n            }\n          }\n        } else {\n          throw new Scorm2004ValidationError(\n            ErrorCodes.scorm2004.GENERAL_SET_FAILURE,\n          );\n        }\n\n        this._learner_response = learner_response;\n      } else {\n        throw new Scorm2004ValidationError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n      }\n    }\n  }\n\n  /**\n   * Getter for _result\n   * @return {string}\n   */\n  get result(): string {\n    return this._result;\n  }\n\n  /**\n   * Setter for _result\n   * @param {string} result\n   */\n  set result(result: string) {\n    if (check2004ValidFormat(result, Regex.scorm2004.CMIResult)) {\n      this._result = result;\n    }\n  }\n\n  /**\n   * Getter for _latency\n   * @return {string}\n   */\n  get latency(): string {\n    return this._latency;\n  }\n\n  /**\n   * Setter for _latency\n   * @param {string} latency\n   */\n  set latency(latency: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(latency, Regex.scorm2004.CMITimespan)) {\n        this._latency = latency;\n      }\n    }\n  }\n\n  /**\n   * Getter for _description\n   * @return {string}\n   */\n  get description(): string {\n    return this._description;\n  }\n\n  /**\n   * Setter for _description\n   * @param {string} description\n   */\n  set description(description: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          description,\n          Regex.scorm2004.CMILangString250,\n          true,\n        )\n      ) {\n        this._description = description;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      type: string,\n   *      objectives: CMIArray,\n   *      timestamp: string,\n   *      correct_responses: CMIArray,\n   *      weighting: string,\n   *      learner_response: string,\n   *      result: string,\n   *      latency: string,\n   *      description: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    type: string;\n    objectives: CMIArray;\n    timestamp: string;\n    correct_responses: CMIArray;\n    weighting: string;\n    learner_response: string;\n    result: string;\n    latency: string;\n    description: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      type: this.type,\n      objectives: this.objectives,\n      timestamp: this.timestamp,\n      weighting: this.weighting,\n      learner_response: this.learner_response,\n      result: this.result,\n      latency: this.latency,\n      description: this.description,\n      correct_responses: this.correct_responses,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.interactions.n.objectives.n object\n */\nexport class CMIInteractionsObjectivesObject extends BaseCMI {\n  private _id = \"\";\n\n  /**\n   * Constructor for cmi.interactions.n.objectives.n\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (check2004ValidFormat(id, Regex.scorm2004.CMILongIdentifier)) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n.objectives.n\n   * @return {\n   *    {\n   *      id: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.interactions.n.correct_responses.n object\n */\nexport class CMIInteractionsCorrectResponsesObject extends BaseCMI {\n  private _pattern = \"\";\n\n  /**\n   * Constructor for cmi.interactions.n.correct_responses.n\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Getter for _pattern\n   * @return {string}\n   */\n  get pattern(): string {\n    return this._pattern;\n  }\n\n  /**\n   * Setter for _pattern\n   * @param {string} pattern\n   */\n  set pattern(pattern: string) {\n    if (check2004ValidFormat(pattern, Regex.scorm2004.CMIFeedback)) {\n      this._pattern = pattern;\n    }\n  }\n\n  /**\n   * toJSON cmi.interactions.n.correct_responses.n object\n   * @return {\n   *    {\n   *      pattern: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    pattern: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      pattern: this.pattern,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import APIConstants from \"../../constants/api_constants\";\nimport Regex from \"../../constants/regex\";\nimport { BaseCMI } from \"./base_cmi\";\nimport { checkValidFormat, checkValidRange } from \"./validation\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { BaseScormValidationError } from \"../../exceptions\";\n\nconst scorm12_constants = APIConstants.scorm12;\nconst scorm12_regex = Regex.scorm12;\nexport const scorm12_error_codes = ErrorCodes.scorm12;\n\n/**\n * Base class for cmi *.score objects\n */\nexport class CMIScore extends BaseCMI {\n  private readonly __children: string;\n  private readonly __score_range: string | false;\n  private readonly __invalid_error_code: number;\n  private readonly __invalid_type_code: number;\n  private readonly __invalid_range_code: number;\n  private readonly __decimal_regex: string;\n  private readonly __error_class: typeof BaseScormValidationError;\n  private _raw = \"\";\n  private _min = \"\";\n  private _max: string;\n\n  /**\n   * Constructor for *.score\n   * @param {\n   *     score_children: string,\n   *     score_range: string,\n   *     max: string,\n   *     invalidErrorCode: number,\n   *     invalidTypeCode: number,\n   *     invalidRangeCode: number,\n   *     decimalRegex: string,\n   *     errorClass: typeof BaseScormValidationError\n   * } params\n   */\n  constructor(params: {\n    score_children?: string;\n    score_range?: string;\n    max?: string;\n    invalidErrorCode?: number;\n    invalidTypeCode?: number;\n    invalidRangeCode?: number;\n    decimalRegex?: string;\n    errorClass: typeof BaseScormValidationError;\n  }) {\n    super();\n\n    this.__children = params.score_children || scorm12_constants.score_children;\n    this.__score_range = !params.score_range\n      ? false\n      : scorm12_regex.score_range;\n    this._max = params.max || params.max === \"\" ? params.max : \"100\";\n    this.__invalid_error_code =\n      params.invalidErrorCode || scorm12_error_codes.INVALID_SET_VALUE;\n    this.__invalid_type_code =\n      params.invalidTypeCode || scorm12_error_codes.TYPE_MISMATCH;\n    this.__invalid_range_code =\n      params.invalidRangeCode || scorm12_error_codes.VALUE_OUT_OF_RANGE;\n    this.__decimal_regex = params.decimalRegex || scorm12_regex.CMIDecimal;\n    this.__error_class = params.errorClass;\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this.__error_class(this.__invalid_error_code);\n  }\n\n  /**\n   * Getter for _raw\n   * @return {string}\n   */\n  get raw(): string {\n    return this._raw;\n  }\n\n  /**\n   * Setter for _raw\n   * @param {string} raw\n   */\n  set raw(raw: string) {\n    if (\n      checkValidFormat(\n        raw,\n        this.__decimal_regex,\n        this.__invalid_type_code,\n        this.__error_class,\n      ) &&\n      (!this.__score_range ||\n        checkValidRange(\n          raw,\n          this.__score_range,\n          this.__invalid_range_code,\n          this.__error_class,\n        ))\n    ) {\n      this._raw = raw;\n    }\n  }\n\n  /**\n   * Getter for _min\n   * @return {string}\n   */\n  get min(): string {\n    return this._min;\n  }\n\n  /**\n   * Setter for _min\n   * @param {string} min\n   */\n  set min(min: string) {\n    if (\n      checkValidFormat(\n        min,\n        this.__decimal_regex,\n        this.__invalid_type_code,\n        this.__error_class,\n      ) &&\n      (!this.__score_range ||\n        checkValidRange(\n          min,\n          this.__score_range,\n          this.__invalid_range_code,\n          this.__error_class,\n        ))\n    ) {\n      this._min = min;\n    }\n  }\n\n  /**\n   * Getter for _max\n   * @return {string}\n   */\n  get max(): string {\n    return this._max;\n  }\n\n  /**\n   * Setter for _max\n   * @param {string} max\n   */\n  set max(max: string) {\n    if (\n      checkValidFormat(\n        max,\n        this.__decimal_regex,\n        this.__invalid_type_code,\n        this.__error_class,\n      ) &&\n      (!this.__score_range ||\n        checkValidRange(\n          max,\n          this.__score_range,\n          this.__invalid_range_code,\n          this.__error_class,\n        ))\n    ) {\n      this._max = max;\n    }\n  }\n\n  /**\n   * toJSON for *.score\n   * @return {\n   *    {\n   *      min: string,\n   *      max: string,\n   *      raw: string\n   *    }\n   *    }\n   */\n  toJSON(): {\n    min: string;\n    max: string;\n    raw: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      raw: this.raw,\n      min: this.min,\n      max: this.max,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Class for SCORM 2004's cmi *.score object\n */\nimport { CMIScore } from \"../common/score\";\nimport APIConstants from \"../../constants/api_constants\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport Regex from \"../../constants/regex\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\n\nexport class Scorm2004CMIScore extends CMIScore {\n  private _scaled = \"\";\n\n  /**\n   * Constructor for cmi *.score\n   */\n  constructor() {\n    super({\n      score_children: APIConstants.scorm2004.score_children,\n      max: \"\",\n      invalidErrorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      invalidTypeCode: ErrorCodes.scorm2004.TYPE_MISMATCH,\n      invalidRangeCode: ErrorCodes.scorm2004.VALUE_OUT_OF_RANGE,\n      decimalRegex: Regex.scorm2004.CMIDecimal,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n\n  /**\n   * Getter for _scaled\n   * @return {string}\n   */\n  get scaled(): string {\n    return this._scaled;\n  }\n\n  /**\n   * Setter for _scaled\n   * @param {string} scaled\n   */\n  set scaled(scaled: string) {\n    if (\n      check2004ValidFormat(scaled, Regex.scorm2004.CMIDecimal) &&\n      check2004ValidRange(scaled, Regex.scorm2004.scaled_range)\n    ) {\n      this._scaled = scaled;\n    }\n  }\n\n  /**\n   * toJSON for cmi *.score\n   *\n   * @return {\n   *    {\n   *      scaled: string,\n   *      raw: string,\n   *      min: string,\n   *      max: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    scaled: string;\n    raw: string;\n    min: string;\n    max: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      scaled: this.scaled,\n      raw: this.raw,\n      min: this.min,\n      max: this.max,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport APIConstants from \"../../constants/api_constants\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat } from \"./validation\";\nimport Regex from \"../../constants/regex\";\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_lms object\n * @extends CMIArray\n */\nexport class CMICommentsFromLMS extends CMIArray {\n  /**\n   * Constructor for cmi.comments_from_lms Array\n   */\n  constructor() {\n    super({\n      children: APIConstants.scorm2004.comments_children,\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_learner object\n */\n\nexport class CMICommentsFromLearner extends CMIArray {\n  /**\n   * Constructor for cmi.comments_from_learner Array\n   */\n  constructor() {\n    super({\n      children: APIConstants.scorm2004.comments_children,\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_learner.n and cmi.comments_from_lms.n object\n */\n\nexport class CMICommentsObject extends BaseCMI {\n  private _comment = \"\";\n  private _location = \"\";\n  private _timestamp = \"\";\n  private readonly _readOnlyAfterInit: boolean;\n\n  /**\n   * Constructor for cmi.comments_from_learner.n and cmi.comments_from_lms.n\n   * @param {boolean} readOnlyAfterInit\n   */\n  constructor(readOnlyAfterInit: boolean = false) {\n    super();\n    this._comment = \"\";\n    this._location = \"\";\n    this._timestamp = \"\";\n    this._readOnlyAfterInit = readOnlyAfterInit;\n  }\n\n  /**\n   * Getter for _comment\n   * @return {string}\n   */\n  get comment(): string {\n    return this._comment;\n  }\n\n  /**\n   * Setter for _comment\n   * @param {string} comment\n   */\n  set comment(comment: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (\n        check2004ValidFormat(comment, Regex.scorm2004.CMILangString4000, true)\n      ) {\n        this._comment = comment;\n      }\n    }\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this._location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (check2004ValidFormat(location, Regex.scorm2004.CMIString250)) {\n        this._location = location;\n      }\n    }\n  }\n\n  /**\n   * Getter for _timestamp\n   * @return {string}\n   */\n  get timestamp(): string {\n    return this._timestamp;\n  }\n\n  /**\n   * Setter for _timestamp\n   * @param {string} timestamp\n   */\n  set timestamp(timestamp: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (check2004ValidFormat(timestamp, Regex.scorm2004.CMITime)) {\n        this._timestamp = timestamp;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.comments_from_learner.n object\n   * @return {\n   *    {\n   *      comment: string,\n   *      location: string,\n   *      timestamp: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    comment: string;\n    location: string;\n    timestamp: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      comment: this.comment,\n      location: this.location,\n      timestamp: this.timestamp,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport APIConstants from \"../../constants/api_constants\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { Scorm2004CMIScore } from \"./score\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\nimport Regex from \"../../constants/regex\";\n\n/**\n * Class representing SCORM 2004's `cmi.objectives` object\n * @extends CMIArray\n */\nexport class CMIObjectives extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives` Array\n   */\n  constructor() {\n    super({\n      children: APIConstants.scorm2004.objectives_children,\n      errorCode: ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class for SCORM 2004's cmi.objectives.n object\n */\nexport class CMIObjectivesObject extends BaseCMI {\n  private _id = \"\";\n  private _success_status = \"unknown\";\n  private _completion_status = \"unknown\";\n  private _progress_measure = \"\";\n  private _description = \"\";\n\n  /**\n   * Constructor for cmi.objectives.n\n   */\n  constructor() {\n    super();\n    this.score = new Scorm2004CMIScore();\n  }\n\n  public score: Scorm2004CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize() {\n    super.initialize();\n    this.score?.initialize();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (check2004ValidFormat(id, Regex.scorm2004.CMILongIdentifier)) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _success_status\n   * @return {string}\n   */\n  get success_status(): string {\n    return this._success_status;\n  }\n\n  /**\n   * Setter for _success_status\n   * @param {string} success_status\n   */\n  set success_status(success_status: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(success_status, Regex.scorm2004.CMISStatus)) {\n        this._success_status = success_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _completion_status\n   * @return {string}\n   */\n  get completion_status(): string {\n    return this._completion_status;\n  }\n\n  /**\n   * Setter for _completion_status\n   * @param {string} completion_status\n   */\n  set completion_status(completion_status: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (check2004ValidFormat(completion_status, Regex.scorm2004.CMICStatus)) {\n        this._completion_status = completion_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _progress_measure\n   * @return {string}\n   */\n  get progress_measure(): string {\n    return this._progress_measure;\n  }\n\n  /**\n   * Setter for _progress_measure\n   * @param {string} progress_measure\n   */\n  set progress_measure(progress_measure: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(progress_measure, Regex.scorm2004.CMIDecimal) &&\n        check2004ValidRange(progress_measure, Regex.scorm2004.progress_range)\n      ) {\n        this._progress_measure = progress_measure;\n      }\n    }\n  }\n\n  /**\n   * Getter for _description\n   * @return {string}\n   */\n  get description(): string {\n    return this._description;\n  }\n\n  /**\n   * Setter for _description\n   * @param {string} description\n   */\n  set description(description: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          description,\n          Regex.scorm2004.CMILangString250,\n          true,\n        )\n      ) {\n        this._description = description;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.objectives.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      success_status: string,\n   *      completion_status: string,\n   *      progress_measure: string,\n   *      description: string,\n   *      score: Scorm2004CMIScore\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    success_status: string;\n    completion_status: string;\n    progress_measure: string;\n    description: string;\n    score: Scorm2004CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      success_status: this.success_status,\n      completion_status: this.completion_status,\n      progress_measure: this.progress_measure,\n      description: this.description,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import APIConstants from \"../../constants/api_constants\";\nimport Regex from \"../../constants/regex\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport * as Util from \"../../utilities\";\nimport { BaseRootCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\nimport { CMILearnerPreference } from \"./learner_preference\";\nimport { CMIInteractions } from \"./interactions\";\nimport { Scorm2004CMIScore } from \"./score\";\nimport { CMICommentsFromLearner, CMICommentsFromLMS } from \"./comments\";\nimport { CMIObjectives } from \"./objectives\";\n\n/**\n * Class representing cmi object for SCORM 2004\n */\nexport class CMI extends BaseRootCMI {\n  /**\n   * Constructor for the SCORM 2004 cmi object\n   * @param {boolean} initialized\n   */\n  constructor(initialized: boolean = false) {\n    super();\n    this.learner_preference = new CMILearnerPreference();\n    this.score = new Scorm2004CMIScore();\n    this.comments_from_learner = new CMICommentsFromLearner();\n    this.comments_from_lms = new CMICommentsFromLMS();\n    this.interactions = new CMIInteractions();\n    this.objectives = new CMIObjectives();\n    if (initialized) this.initialize();\n  }\n\n  public learner_preference: CMILearnerPreference;\n  public score: Scorm2004CMIScore;\n  public comments_from_learner: CMICommentsFromLearner;\n  public comments_from_lms: CMICommentsFromLMS;\n  public interactions: CMIInteractions;\n  public objectives: CMIObjectives;\n\n  private __version = \"1.0\";\n  private __children = APIConstants.scorm2004.cmi_children;\n  private _completion_status = \"unknown\";\n  private _completion_threshold = \"\";\n  private _credit = \"credit\";\n  private _entry = \"\";\n  private _exit = \"\";\n  private _launch_data = \"\";\n  private _learner_id = \"\";\n  private _learner_name = \"\";\n  private _location = \"\";\n  private _max_time_allowed = \"\";\n  private _mode = \"normal\";\n  private _progress_measure = \"\";\n  private _scaled_passing_score = \"\";\n  private _session_time = \"PT0H0M0S\";\n  private _success_status = \"unknown\";\n  private _suspend_data = \"\";\n  private _time_limit_action = \"continue,no message\";\n  private _total_time = \"\";\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize() {\n    super.initialize();\n    this.learner_preference?.initialize();\n    this.score?.initialize();\n    this.comments_from_learner?.initialize();\n    this.comments_from_lms?.initialize();\n    this.interactions?.initialize();\n    this.objectives?.initialize();\n  }\n\n  /**\n   * Getter for __version\n   * @return {string}\n   * @private\n   */\n  get _version(): string {\n    return this.__version;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _version\n   * @private\n   */\n  set _version(_version: string) {\n    throw new Scorm2004ValidationError(ErrorCodes.scorm2004.READ_ONLY_ELEMENT);\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {number} _children\n   * @private\n   */\n  set _children(_children: number) {\n    throw new Scorm2004ValidationError(ErrorCodes.scorm2004.READ_ONLY_ELEMENT);\n  }\n\n  /**\n   * Getter for _completion_status\n   * @return {string}\n   */\n  get completion_status(): string {\n    return this._completion_status;\n  }\n\n  /**\n   * Setter for _completion_status\n   * @param {string} completion_status\n   */\n  set completion_status(completion_status: string) {\n    if (check2004ValidFormat(completion_status, Regex.scorm2004.CMICStatus)) {\n      this._completion_status = completion_status;\n    }\n  }\n\n  /**\n   * Getter for _completion_threshold\n   * @return {string}\n   */\n  get completion_threshold(): string {\n    return this._completion_threshold;\n  }\n\n  /**\n   * Setter for _completion_threshold. Can only be called before  initialization.\n   * @param {string} completion_threshold\n   */\n  set completion_threshold(completion_threshold: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._completion_threshold = completion_threshold;\n    }\n  }\n\n  /**\n   * Setter for _credit\n   * @return {string}\n   */\n  get credit(): string {\n    return this._credit;\n  }\n\n  /**\n   * Setter for _credit. Can only be called before  initialization.\n   * @param {string} credit\n   */\n  set credit(credit: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._credit = credit;\n    }\n  }\n\n  /**\n   * Getter for _entry\n   * @return {string}\n   */\n  get entry(): string {\n    return this._entry;\n  }\n\n  /**\n   * Setter for _entry. Can only be called before  initialization.\n   * @param {string} entry\n   */\n  set entry(entry: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._entry = entry;\n    }\n  }\n\n  /**\n   * Getter for _exit. Should only be called during JSON export.\n   * @return {string}\n   */\n  get exit(): string {\n    if (!this.jsonString) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._exit;\n  }\n\n  /**\n   * Getter for _exit\n   * @param {string} exit\n   */\n  set exit(exit: string) {\n    if (check2004ValidFormat(exit, Regex.scorm2004.CMIExit, true)) {\n      this._exit = exit;\n    }\n  }\n\n  /**\n   * Getter for _launch_data\n   * @return {string}\n   */\n  get launch_data(): string {\n    return this._launch_data;\n  }\n\n  /**\n   * Setter for _launch_data. Can only be called before  initialization.\n   * @param {string} launch_data\n   */\n  set launch_data(launch_data: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._launch_data = launch_data;\n    }\n  }\n\n  /**\n   * Getter for _learner_id\n   * @return {string}\n   */\n  get learner_id(): string {\n    return this._learner_id;\n  }\n\n  /**\n   * Setter for _learner_id. Can only be called before  initialization.\n   * @param {string} learner_id\n   */\n  set learner_id(learner_id: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._learner_id = learner_id;\n    }\n  }\n\n  /**\n   * Getter for _learner_name\n   * @return {string}\n   */\n  get learner_name(): string {\n    return this._learner_name;\n  }\n\n  /**\n   * Setter for _learner_name. Can only be called before  initialization.\n   * @param {string} learner_name\n   */\n  set learner_name(learner_name: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._learner_name = learner_name;\n    }\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this._location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    if (check2004ValidFormat(location, Regex.scorm2004.CMIString1000)) {\n      this._location = location;\n    }\n  }\n\n  /**\n   * Getter for _max_time_allowed\n   * @return {string}\n   */\n  get max_time_allowed(): string {\n    return this._max_time_allowed;\n  }\n\n  /**\n   * Setter for _max_time_allowed. Can only be called before  initialization.\n   * @param {string} max_time_allowed\n   */\n  set max_time_allowed(max_time_allowed: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._max_time_allowed = max_time_allowed;\n    }\n  }\n\n  /**\n   * Getter for _mode\n   * @return {string}\n   */\n  get mode(): string {\n    return this._mode;\n  }\n\n  /**\n   * Setter for _mode. Can only be called before  initialization.\n   * @param {string} mode\n   */\n  set mode(mode: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._mode = mode;\n    }\n  }\n\n  /**\n   * Getter for _progress_measure\n   * @return {string}\n   */\n  get progress_measure(): string {\n    return this._progress_measure;\n  }\n\n  /**\n   * Setter for _progress_measure\n   * @param {string} progress_measure\n   */\n  set progress_measure(progress_measure: string) {\n    if (\n      check2004ValidFormat(progress_measure, Regex.scorm2004.CMIDecimal) &&\n      check2004ValidRange(progress_measure, Regex.scorm2004.progress_range)\n    ) {\n      this._progress_measure = progress_measure;\n    }\n  }\n\n  /**\n   * Getter for _scaled_passing_score\n   * @return {string}\n   */\n  get scaled_passing_score(): string {\n    return this._scaled_passing_score;\n  }\n\n  /**\n   * Setter for _scaled_passing_score. Can only be called before  initialization.\n   * @param {string} scaled_passing_score\n   */\n  set scaled_passing_score(scaled_passing_score: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._scaled_passing_score = scaled_passing_score;\n    }\n  }\n\n  /**\n   * Getter for _session_time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get session_time(): string {\n    if (!this.jsonString) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._session_time;\n  }\n\n  /**\n   * Setter for _session_time\n   * @param {string} session_time\n   */\n  set session_time(session_time: string) {\n    if (check2004ValidFormat(session_time, Regex.scorm2004.CMITimespan)) {\n      this._session_time = session_time;\n    }\n  }\n\n  /**\n   * Getter for _success_status\n   * @return {string}\n   */\n  get success_status(): string {\n    return this._success_status;\n  }\n\n  /**\n   * Setter for _success_status\n   * @param {string} success_status\n   */\n  set success_status(success_status: string) {\n    if (check2004ValidFormat(success_status, Regex.scorm2004.CMISStatus)) {\n      this._success_status = success_status;\n    }\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this._suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (\n      check2004ValidFormat(suspend_data, Regex.scorm2004.CMIString64000, true)\n    ) {\n      this._suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Getter for _time_limit_action\n   * @return {string}\n   */\n  get time_limit_action(): string {\n    return this._time_limit_action;\n  }\n\n  /**\n   * Setter for _time_limit_action. Can only be called before  initialization.\n   * @param {string} time_limit_action\n   */\n  set time_limit_action(time_limit_action: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._time_limit_action = time_limit_action;\n    }\n  }\n\n  /**\n   * Getter for _total_time\n   * @return {string}\n   */\n  get total_time(): string {\n    return this._total_time;\n  }\n\n  /**\n   * Setter for _total_time. Can only be called before  initialization.\n   * @param {string} total_time\n   */\n  set total_time(total_time: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._total_time = total_time;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   *\n   * @return {string} ISO8601 Duration\n   */\n  getCurrentTotalTime(): string {\n    let sessionTime = this._session_time;\n    const startTime = this.start_time;\n\n    if (typeof startTime !== \"undefined\" && startTime !== null) {\n      const seconds = new Date().getTime() - startTime;\n      sessionTime = Util.getSecondsAsISODuration(seconds / 1000);\n    }\n\n    return Util.addTwoDurations(\n      this._total_time,\n      sessionTime,\n      Regex.scorm2004.CMITimespan,\n    );\n  }\n\n  /**\n   * toJSON for cmi\n   *\n   * @return {\n   *    {\n   *      comments_from_learner: CMICommentsFromLearner,\n   *      comments_from_lms: CMICommentsFromLMS,\n   *      completion_status: string,\n   *      completion_threshold: string,\n   *      credit: string,\n   *      entry: string,\n   *      exit: string,\n   *      interactions: CMIInteractions,\n   *      launch_data: string,\n   *      learner_id: string,\n   *      learner_name: string,\n   *      learner_preference: CMILearnerPreference,\n   *      location: string,\n   *      max_time_allowed: string,\n   *      mode: string,\n   *      objectives: CMIObjectives,\n   *      progress_measure: string,\n   *      scaled_passing_score: string,\n   *      score: Scorm2004CMIScore,\n   *      session_time: string,\n   *      success_status: string,\n   *      suspend_data: string,\n   *      time_limit_action: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    comments_from_learner: CMICommentsFromLearner;\n    comments_from_lms: CMICommentsFromLMS;\n    completion_status: string;\n    completion_threshold: string;\n    credit: string;\n    entry: string;\n    exit: string;\n    interactions: CMIInteractions;\n    launch_data: string;\n    learner_id: string;\n    learner_name: string;\n    learner_preference: CMILearnerPreference;\n    location: string;\n    max_time_allowed: string;\n    mode: string;\n    objectives: CMIObjectives;\n    progress_measure: string;\n    scaled_passing_score: string;\n    score: Scorm2004CMIScore;\n    session_time: string;\n    success_status: string;\n    suspend_data: string;\n    time_limit_action: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      comments_from_learner: this.comments_from_learner,\n      comments_from_lms: this.comments_from_lms,\n      completion_status: this.completion_status,\n      completion_threshold: this.completion_threshold,\n      credit: this.credit,\n      entry: this.entry,\n      exit: this.exit,\n      interactions: this.interactions,\n      launch_data: this.launch_data,\n      learner_id: this.learner_id,\n      learner_name: this.learner_name,\n      learner_preference: this.learner_preference,\n      location: this.location,\n      max_time_allowed: this.max_time_allowed,\n      mode: this.mode,\n      objectives: this.objectives,\n      progress_measure: this.progress_measure,\n      scaled_passing_score: this.scaled_passing_score,\n      score: this.score,\n      session_time: this.session_time,\n      success_status: this.success_status,\n      suspend_data: this.suspend_data,\n      time_limit_action: this.time_limit_action,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","const ValidLanguages: string[] = [\n  \"aa\",\n  \"ab\",\n  \"ae\",\n  \"af\",\n  \"ak\",\n  \"am\",\n  \"an\",\n  \"ar\",\n  \"as\",\n  \"av\",\n  \"ay\",\n  \"az\",\n  \"ba\",\n  \"be\",\n  \"bg\",\n  \"bh\",\n  \"bi\",\n  \"bm\",\n  \"bn\",\n  \"bo\",\n  \"br\",\n  \"bs\",\n  \"ca\",\n  \"ce\",\n  \"ch\",\n  \"co\",\n  \"cr\",\n  \"cs\",\n  \"cu\",\n  \"cv\",\n  \"cy\",\n  \"da\",\n  \"de\",\n  \"dv\",\n  \"dz\",\n  \"ee\",\n  \"el\",\n  \"en\",\n  \"eo\",\n  \"es\",\n  \"et\",\n  \"eu\",\n  \"fa\",\n  \"ff\",\n  \"fi\",\n  \"fj\",\n  \"fo\",\n  \"fr\",\n  \"fy\",\n  \"ga\",\n  \"gd\",\n  \"gl\",\n  \"gn\",\n  \"gu\",\n  \"gv\",\n  \"ha\",\n  \"he\",\n  \"hi\",\n  \"ho\",\n  \"hr\",\n  \"ht\",\n  \"hu\",\n  \"hy\",\n  \"hz\",\n  \"ia\",\n  \"id\",\n  \"ie\",\n  \"ig\",\n  \"ii\",\n  \"ik\",\n  \"io\",\n  \"is\",\n  \"it\",\n  \"iu\",\n  \"ja\",\n  \"jv\",\n  \"ka\",\n  \"kg\",\n  \"ki\",\n  \"kj\",\n  \"kk\",\n  \"kl\",\n  \"km\",\n  \"kn\",\n  \"ko\",\n  \"kr\",\n  \"ks\",\n  \"ku\",\n  \"kv\",\n  \"kw\",\n  \"ky\",\n  \"la\",\n  \"lb\",\n  \"lg\",\n  \"li\",\n  \"ln\",\n  \"lo\",\n  \"lt\",\n  \"lu\",\n  \"lv\",\n  \"mg\",\n  \"mh\",\n  \"mi\",\n  \"mk\",\n  \"ml\",\n  \"mn\",\n  \"mo\",\n  \"mr\",\n  \"ms\",\n  \"mt\",\n  \"my\",\n  \"na\",\n  \"nb\",\n  \"nd\",\n  \"ne\",\n  \"ng\",\n  \"nl\",\n  \"nn\",\n  \"no\",\n  \"nr\",\n  \"nv\",\n  \"ny\",\n  \"oc\",\n  \"oj\",\n  \"om\",\n  \"or\",\n  \"os\",\n  \"pa\",\n  \"pi\",\n  \"pl\",\n  \"ps\",\n  \"pt\",\n  \"qu\",\n  \"rm\",\n  \"rn\",\n  \"ro\",\n  \"ru\",\n  \"rw\",\n  \"sa\",\n  \"sc\",\n  \"sd\",\n  \"se\",\n  \"sg\",\n  \"sh\",\n  \"si\",\n  \"sk\",\n  \"sl\",\n  \"sm\",\n  \"sn\",\n  \"so\",\n  \"sq\",\n  \"sr\",\n  \"ss\",\n  \"st\",\n  \"su\",\n  \"sv\",\n  \"sw\",\n  \"ta\",\n  \"te\",\n  \"tg\",\n  \"th\",\n  \"ti\",\n  \"tk\",\n  \"tl\",\n  \"tn\",\n  \"to\",\n  \"tr\",\n  \"ts\",\n  \"tt\",\n  \"tw\",\n  \"ty\",\n  \"ug\",\n  \"uk\",\n  \"ur\",\n  \"uz\",\n  \"ve\",\n  \"vi\",\n  \"vo\",\n  \"wa\",\n  \"wo\",\n  \"xh\",\n  \"yi\",\n  \"yo\",\n  \"za\",\n  \"zh\",\n  \"zu\",\n  \"aar\",\n  \"abk\",\n  \"ave\",\n  \"afr\",\n  \"aka\",\n  \"amh\",\n  \"arg\",\n  \"ara\",\n  \"asm\",\n  \"ava\",\n  \"aym\",\n  \"aze\",\n  \"bak\",\n  \"bel\",\n  \"bul\",\n  \"bih\",\n  \"bis\",\n  \"bam\",\n  \"ben\",\n  \"tib\",\n  \"bod\",\n  \"bre\",\n  \"bos\",\n  \"cat\",\n  \"che\",\n  \"cha\",\n  \"cos\",\n  \"cre\",\n  \"cze\",\n  \"ces\",\n  \"chu\",\n  \"chv\",\n  \"wel\",\n  \"cym\",\n  \"dan\",\n  \"ger\",\n  \"deu\",\n  \"div\",\n  \"dzo\",\n  \"ewe\",\n  \"gre\",\n  \"ell\",\n  \"eng\",\n  \"epo\",\n  \"spa\",\n  \"est\",\n  \"baq\",\n  \"eus\",\n  \"per\",\n  \"fas\",\n  \"ful\",\n  \"fin\",\n  \"fij\",\n  \"fao\",\n  \"fre\",\n  \"fra\",\n  \"fry\",\n  \"gle\",\n  \"gla\",\n  \"glg\",\n  \"grn\",\n  \"guj\",\n  \"glv\",\n  \"hau\",\n  \"heb\",\n  \"hin\",\n  \"hmo\",\n  \"hrv\",\n  \"hat\",\n  \"hun\",\n  \"arm\",\n  \"hye\",\n  \"her\",\n  \"ina\",\n  \"ind\",\n  \"ile\",\n  \"ibo\",\n  \"iii\",\n  \"ipk\",\n  \"ido\",\n  \"ice\",\n  \"isl\",\n  \"ita\",\n  \"iku\",\n  \"jpn\",\n  \"jav\",\n  \"geo\",\n  \"kat\",\n  \"kon\",\n  \"kik\",\n  \"kua\",\n  \"kaz\",\n  \"kal\",\n  \"khm\",\n  \"kan\",\n  \"kor\",\n  \"kau\",\n  \"kas\",\n  \"kur\",\n  \"kom\",\n  \"cor\",\n  \"kir\",\n  \"lat\",\n  \"ltz\",\n  \"lug\",\n  \"lim\",\n  \"lin\",\n  \"lao\",\n  \"lit\",\n  \"lub\",\n  \"lav\",\n  \"mlg\",\n  \"mah\",\n  \"mao\",\n  \"mri\",\n  \"mac\",\n  \"mkd\",\n  \"mal\",\n  \"mon\",\n  \"mol\",\n  \"mar\",\n  \"may\",\n  \"msa\",\n  \"mlt\",\n  \"bur\",\n  \"mya\",\n  \"nau\",\n  \"nob\",\n  \"nde\",\n  \"nep\",\n  \"ndo\",\n  \"dut\",\n  \"nld\",\n  \"nno\",\n  \"nor\",\n  \"nbl\",\n  \"nav\",\n  \"nya\",\n  \"oci\",\n  \"oji\",\n  \"orm\",\n  \"ori\",\n  \"oss\",\n  \"pan\",\n  \"pli\",\n  \"pol\",\n  \"pus\",\n  \"por\",\n  \"que\",\n  \"roh\",\n  \"run\",\n  \"rum\",\n  \"ron\",\n  \"rus\",\n  \"kin\",\n  \"san\",\n  \"srd\",\n  \"snd\",\n  \"sme\",\n  \"sag\",\n  \"slo\",\n  \"sin\",\n  \"slk\",\n  \"slv\",\n  \"smo\",\n  \"sna\",\n  \"som\",\n  \"alb\",\n  \"sqi\",\n  \"srp\",\n  \"ssw\",\n  \"sot\",\n  \"sun\",\n  \"swe\",\n  \"swa\",\n  \"tam\",\n  \"tel\",\n  \"tgk\",\n  \"tha\",\n  \"tir\",\n  \"tuk\",\n  \"tgl\",\n  \"tsn\",\n  \"ton\",\n  \"tur\",\n  \"tso\",\n  \"tat\",\n  \"twi\",\n  \"tah\",\n  \"uig\",\n  \"ukr\",\n  \"urd\",\n  \"uzb\",\n  \"ven\",\n  \"vie\",\n  \"vol\",\n  \"wln\",\n  \"wol\",\n  \"xho\",\n  \"yid\",\n  \"yor\",\n  \"zha\",\n  \"chi\",\n  \"zho\",\n  \"zul\",\n];\nexport default ValidLanguages;\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { Scorm2004ValidationError } from \"../../exceptions\";\nimport ErrorCodes from \"../../constants/error_codes\";\nimport { check2004ValidFormat } from \"./validation\";\nimport Regex from \"../../constants/regex\";\nimport { NAVBoolean } from \"../../constants/enums\";\n\n/**\n * Class representing SCORM 2004's adl object\n */\nexport class ADL extends BaseCMI {\n  /**\n   * Constructor for adl\n   */\n  constructor() {\n    super();\n    this.nav = new ADLNav();\n  }\n\n  public nav: ADLNav;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize() {\n    super.initialize();\n    this.nav?.initialize();\n  }\n\n  /**\n   * toJSON for adl\n   * @return {\n   *    {\n   *      nav: ADLNav\n   *    }\n   *  }\n   */\n  toJSON(): {\n    nav: ADLNav;\n  } {\n    this.jsonString = true;\n    const result = {\n      nav: this.nav,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's `adl.nav` object\n */\n\nexport class ADLNav extends BaseCMI {\n  private _request = \"_none_\";\n\n  /**\n   * Constructor for `adl.nav`\n   */\n  constructor() {\n    super();\n    this.request_valid = new ADLNavRequestValid();\n  }\n\n  public request_valid: ADLNavRequestValid;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize() {\n    super.initialize();\n    this.request_valid?.initialize();\n  }\n\n  /**\n   * Getter for _request\n   * @return {string}\n   */\n  get request(): string {\n    return this._request;\n  }\n\n  /**\n   * Setter for _request\n   * @param {string} request\n   */\n  set request(request: string) {\n    if (check2004ValidFormat(request, Regex.scorm2004.NAVEvent)) {\n      this._request = request;\n    }\n  }\n\n  /**\n   * toJSON for adl.nav\n   *\n   * @return {\n   *    {\n   *      request: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    request: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      request: this.request,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's adl.nav.request_valid object\n */\n\nexport class ADLNavRequestValid extends BaseCMI {\n  private _continue = \"unknown\";\n  private _previous = \"unknown\";\n  private _choice: {\n    [key: string]: NAVBoolean;\n  } = {};\n  private _jump: {\n    [key: string]: NAVBoolean;\n  } = {};\n\n  /**\n   * Constructor for adl.nav.request_valid\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Getter for _continue\n   * @return {string}\n   */\n  get continue(): string {\n    return this._continue;\n  }\n\n  /**\n   * Setter for _continue. Just throws an error.\n   * @param {string} _continue\n   */\n  set continue(_continue: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    }\n    if (check2004ValidFormat(_continue, Regex.scorm2004.NAVBoolean)) {\n      this._continue = _continue;\n    }\n  }\n\n  /**\n   * Getter for _previous\n   * @return {string}\n   */\n  get previous(): string {\n    return this._previous;\n  }\n\n  /**\n   * Setter for _previous. Just throws an error.\n   * @param {string} _previous\n   */\n  set previous(_previous: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    }\n    if (check2004ValidFormat(_previous, Regex.scorm2004.NAVBoolean)) {\n      this._previous = _previous;\n    }\n  }\n\n  /**\n   * Getter for _choice\n   * @return {{ [key: string]: NAVBoolean }}\n   */\n  get choice(): { [key: string]: NAVBoolean } {\n    return this._choice;\n  }\n\n  /**\n   * Setter for _choice\n   * @param {{ [key: string]: string }} choice\n   */\n  set choice(choice: { [key: string]: string }) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    }\n    if (typeof choice !== \"object\") {\n      throw new Scorm2004ValidationError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n    }\n    for (const key in choice) {\n      if ({}.hasOwnProperty.call(choice, key)) {\n        if (\n          check2004ValidFormat(choice[key], Regex.scorm2004.NAVBoolean) &&\n          check2004ValidFormat(key, Regex.scorm2004.NAVTarget)\n        ) {\n          this._choice[key] =\n            NAVBoolean[choice[key] as keyof typeof NAVBoolean];\n        }\n      }\n    }\n  }\n\n  /**\n   * Getter for _jump\n   * @return {{ [key: string]: NAVBoolean }}\n   */\n  get jump(): { [key: string]: NAVBoolean } {\n    return this._jump;\n  }\n\n  /**\n   * Setter for _jump\n   * @param {{ [key: string]: string }} jump\n   */\n  set jump(jump: { [key: string]: string }) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        ErrorCodes.scorm2004.READ_ONLY_ELEMENT,\n      );\n    }\n    if (typeof jump !== \"object\") {\n      throw new Scorm2004ValidationError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n    }\n    for (const key in jump) {\n      if ({}.hasOwnProperty.call(jump, key)) {\n        if (\n          check2004ValidFormat(jump[key], Regex.scorm2004.NAVBoolean) &&\n          check2004ValidFormat(key, Regex.scorm2004.NAVTarget)\n        ) {\n          this._jump[key] = NAVBoolean[jump[key] as keyof typeof NAVBoolean];\n        }\n      }\n    }\n  }\n\n  /**\n   * toJSON for adl.nav.request_valid\n   *\n   * @return {\n   *    {\n   *      previous: string,\n   *      continue: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    previous: string;\n    continue: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      previous: this._previous,\n      continue: this._continue,\n      choice: this._choice,\n      jump: this._jump,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import BaseAPI from \"./BaseAPI\";\nimport { CMI } from \"./cmi/scorm2004/cmi\";\nimport * as Utilities from \"./utilities\";\nimport { stringMatches } from \"./utilities\";\nimport APIConstants from \"./constants/api_constants\";\nimport ErrorCodes from \"./constants/error_codes\";\nimport { CorrectResponses, ResponseType } from \"./constants/response_constants\";\nimport ValidLanguages from \"./constants/language_constants\";\nimport Regex from \"./constants/regex\";\nimport regex from \"./constants/regex\";\nimport { CMIArray } from \"./cmi/common/array\";\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport {\n  CMIInteractionsCorrectResponsesObject,\n  CMIInteractionsObject,\n  CMIInteractionsObjectivesObject,\n} from \"./cmi/scorm2004/interactions\";\nimport { CMICommentsObject } from \"./cmi/scorm2004/comments\";\nimport { CMIObjectivesObject } from \"./cmi/scorm2004/objectives\";\nimport { ADL } from \"./cmi/scorm2004/adl\";\nimport {\n  CommitObject,\n  RefObject,\n  ResultObject,\n  ScoreObject,\n  Settings,\n} from \"./types/api_types\";\nimport { CompletionStatus, SuccessStatus } from \"./constants/enums\";\n\n/**\n * API class for SCORM 2004\n */\nexport default class Scorm2004API extends BaseAPI {\n  private _version: string = \"1.0\";\n\n  /**\n   * Constructor for SCORM 2004 API\n   * @param {Settings} settings\n   */\n  constructor(settings?: Settings) {\n    if (settings) {\n      if (settings.mastery_override === undefined) {\n        settings.mastery_override = false;\n      }\n    }\n\n    super(ErrorCodes.scorm2004, settings);\n\n    this.cmi = new CMI();\n    this.adl = new ADL();\n\n    // Rename functions to match 2004 Spec and expose to modules\n    this.Initialize = this.lmsInitialize;\n    this.Terminate = this.lmsFinish;\n    this.GetValue = this.lmsGetValue;\n    this.SetValue = this.lmsSetValue;\n    this.Commit = this.lmsCommit;\n    this.GetLastError = this.lmsGetLastError;\n    this.GetErrorString = this.lmsGetErrorString;\n    this.GetDiagnostic = this.lmsGetDiagnostic;\n  }\n\n  public cmi: CMI;\n  public adl: ADL;\n\n  public Initialize: () => string;\n  public Terminate: () => string;\n  public GetValue: (CMIElement: string) => string;\n  public SetValue: (CMIElement: string, value: any) => string;\n  public Commit: () => string;\n  public GetLastError: () => string;\n  public GetErrorString: (CMIErrorCode: string | number) => string;\n  public GetDiagnostic: (CMIErrorCode: string | number) => string;\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset(settings?: Settings) {\n    this.commonReset(settings);\n\n    this.cmi = new CMI();\n    this.adl = new ADL();\n  }\n\n  /**\n   * Getter for _version\n   * @return {string}\n   */\n  get version(): string {\n    return this._version;\n  }\n\n  /**\n   * @return {string} bool\n   */\n  lmsInitialize(): string {\n    this.cmi.initialize();\n    return this.initialize(\"Initialize\");\n  }\n\n  /**\n   * @return {string} bool\n   */\n  lmsFinish(): string {\n    (async () => {\n      await this.internalFinish();\n    })();\n    return APIConstants.global.SCORM_TRUE;\n  }\n\n  async internalFinish(): Promise<string> {\n    const result = await this.terminate(\"Terminate\", true);\n\n    if (result === APIConstants.global.SCORM_TRUE) {\n      if (this.adl.nav.request !== \"_none_\") {\n        const navActions: { [key: string]: string } = {\n          continue: \"SequenceNext\",\n          previous: \"SequencePrevious\",\n          choice: \"SequenceChoice\",\n          jump: \"SequenceJump\",\n          exit: \"SequenceExit\",\n          exitAll: \"SequenceExitAll\",\n          abandon: \"SequenceAbandon\",\n          abandonAll: \"SequenceAbandonAll\",\n        };\n\n        let request = this.adl.nav.request;\n        const choiceJumpRegex = new RegExp(regex.scorm2004.NAVEvent);\n        const matches = request.match(choiceJumpRegex);\n        let target = \"\";\n        if (matches && matches.length > 2) {\n          target = matches[2];\n          request = matches[1].replace(target, \"\");\n        }\n        const action = navActions[request];\n        if (action) {\n          this.processListeners(action, \"adl.nav.request\", target);\n        }\n      } else if (this.settings.autoProgress) {\n        this.processListeners(\"SequenceNext\");\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  lmsGetValue(CMIElement: string): string {\n    const adlNavRequestRegex =\n      \"^adl\\\\.nav\\\\.request_valid\\\\.(choice|jump)\\\\.{target=\\\\S{0,}([a-zA-Z0-9-_]+)}$\";\n    if (stringMatches(CMIElement, adlNavRequestRegex)) {\n      const matches = CMIElement.match(adlNavRequestRegex);\n      const request = matches[1];\n      const target = matches[2].replace(\"{target=\", \"\").replace(\"}\", \"\");\n      if (request === \"choice\" || request === \"jump\") {\n        if (this.settings.scoItemIdValidator) {\n          return String(this.settings.scoItemIdValidator(target));\n        }\n        return String(this.settings.scoItemIds.includes(target));\n      }\n    }\n    return this.getValue(\"GetValue\", true, CMIElement);\n  }\n\n  /**\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  lmsSetValue(CMIElement: string, value: any): string {\n    return this.setValue(\"SetValue\", \"Commit\", true, CMIElement, value);\n  }\n\n  /**\n   * Orders LMS to store all content parameters\n   *\n   * @return {string} bool\n   */\n  lmsCommit(): string {\n    (async () => {\n      await this.commit(\"Commit\");\n    })();\n    return APIConstants.global.SCORM_TRUE;\n  }\n\n  /**\n   * Returns last error code\n   *\n   * @return {string}\n   */\n  lmsGetLastError(): string {\n    return this.getLastError(\"GetLastError\");\n  }\n\n  /**\n   * Returns the errorNumber error description\n   *\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetErrorString(CMIErrorCode: string | number): string {\n    return this.getErrorString(\"GetErrorString\", CMIErrorCode);\n  }\n\n  /**\n   * Returns a comprehensive description of the errorNumber error.\n   *\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetDiagnostic(CMIErrorCode: string | number): string {\n    return this.getDiagnostic(\"GetDiagnostic\", CMIErrorCode);\n  }\n\n  /**\n   * Sets a value on the CMI Object\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  setCMIValue(CMIElement: string, value: any): string {\n    return this._commonSetCMIValue(\"SetValue\", true, CMIElement, value);\n  }\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @param {boolean} foundFirstIndex\n   * @return {BaseCMI|null}\n   */\n  getChildElement(\n    CMIElement: string,\n    value: any,\n    foundFirstIndex: boolean,\n  ): BaseCMI | null {\n    if (stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\")) {\n      return new CMIObjectivesObject();\n    }\n\n    if (foundFirstIndex) {\n      if (\n        stringMatches(\n          CMIElement,\n          \"cmi\\\\.interactions\\\\.\\\\d+\\\\.correct_responses\\\\.\\\\d+\",\n        )\n      ) {\n        return this.createCorrectResponsesObject(CMIElement, value);\n      } else if (\n        stringMatches(\n          CMIElement,\n          \"cmi\\\\.interactions\\\\.\\\\d+\\\\.objectives\\\\.\\\\d+\",\n        )\n      ) {\n        return new CMIInteractionsObjectivesObject();\n      }\n    } else if (stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\")) {\n      return new CMIInteractionsObject();\n    }\n\n    if (stringMatches(CMIElement, \"cmi\\\\.comments_from_learner\\\\.\\\\d+\")) {\n      return new CMICommentsObject();\n    } else if (stringMatches(CMIElement, \"cmi\\\\.comments_from_lms\\\\.\\\\d+\")) {\n      return new CMICommentsObject(true);\n    }\n\n    return null;\n  }\n\n  private createCorrectResponsesObject(\n    CMIElement: string,\n    value: any,\n  ): BaseCMI | null {\n    const parts = CMIElement.split(\".\");\n    const index = Number(parts[2]);\n    const interaction = this.cmi.interactions.childArray[index];\n\n    if (this.isInitialized()) {\n      if (!interaction.type) {\n        this.throwSCORMError(ErrorCodes.scorm2004.DEPENDENCY_NOT_ESTABLISHED);\n      } else {\n        this.checkDuplicateChoiceResponse(interaction, value);\n        const response_type = CorrectResponses[interaction.type];\n        if (response_type) {\n          this.checkValidResponseType(response_type, value, interaction.type);\n        } else {\n          this.throwSCORMError(\n            ErrorCodes.scorm2004.GENERAL_SET_FAILURE,\n            \"Incorrect Response Type: \" + interaction.type,\n          );\n        }\n      }\n    }\n\n    if (this.lastErrorCode === \"0\") {\n      return new CMIInteractionsCorrectResponsesObject();\n    }\n\n    return null;\n  }\n\n  /**\n   * Checks for valid response types\n   * @param {object} response_type\n   * @param {any} value\n   * @param {string} interaction_type\n   */\n  checkValidResponseType(\n    response_type: ResponseType,\n    value: any,\n    interaction_type: string,\n  ) {\n    let nodes = [];\n    if (response_type?.delimiter) {\n      nodes = String(value).split(response_type.delimiter);\n    } else {\n      nodes[0] = value;\n    }\n\n    if (nodes.length > 0 && nodes.length <= response_type.max) {\n      this.checkCorrectResponseValue(interaction_type, nodes, value);\n    } else if (nodes.length > response_type.max) {\n      this.throwSCORMError(\n        ErrorCodes.scorm2004.GENERAL_SET_FAILURE,\n        \"Data Model Element Pattern Too Long\",\n      );\n    }\n  }\n\n  /**\n   * Checks for duplicate 'choice' responses.\n   * @param {CMIInteractionsObject} interaction\n   * @param {any} value\n   */\n  checkDuplicateChoiceResponse(interaction: CMIInteractionsObject, value: any) {\n    const interaction_count = interaction.correct_responses._count;\n    if (interaction.type === \"choice\") {\n      for (\n        let i = 0;\n        i < interaction_count && this.lastErrorCode === \"0\";\n        i++\n      ) {\n        const response = interaction.correct_responses.childArray[i];\n        if (response.pattern === value) {\n          this.throwSCORMError(ErrorCodes.scorm2004.GENERAL_SET_FAILURE);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validate correct response.\n   * @param {string} CMIElement\n   * @param {*} value\n   */\n  validateCorrectResponse(CMIElement: string, value: any) {\n    const parts = CMIElement.split(\".\");\n    const index = Number(parts[2]);\n    const pattern_index = Number(parts[4]);\n    const interaction = this.cmi.interactions.childArray[index];\n\n    const interaction_count = interaction.correct_responses._count;\n    this.checkDuplicateChoiceResponse(interaction, value);\n\n    const response_type = CorrectResponses[interaction.type];\n    if (\n      typeof response_type.limit === \"undefined\" ||\n      interaction_count <= response_type.limit\n    ) {\n      this.checkValidResponseType(response_type, value, interaction.type);\n\n      if (\n        (this.lastErrorCode === \"0\" &&\n          (!response_type.duplicate ||\n            !this.checkDuplicatedPattern(\n              interaction.correct_responses,\n              pattern_index,\n              value,\n            ))) ||\n        (this.lastErrorCode === \"0\" && value === \"\")\n      ) {\n        // do nothing, we want the inverse\n      } else {\n        if (this.lastErrorCode === \"0\") {\n          this.throwSCORMError(\n            ErrorCodes.scorm2004.GENERAL_SET_FAILURE,\n            \"Data Model Element Pattern Already Exists\",\n          );\n        }\n      }\n    } else {\n      this.throwSCORMError(\n        ErrorCodes.scorm2004.GENERAL_SET_FAILURE,\n        \"Data Model Element Collection Limit Reached\",\n      );\n    }\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} CMIElement\n   * @return {*}\n   */\n  getCMIValue(CMIElement: string): any {\n    return this._commonGetCMIValue(\"GetValue\", true, CMIElement);\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber.\n   *\n   * @param {(string|number)} errorNumber\n   * @param {boolean} detail\n   * @return {string}\n   */\n  getLmsErrorMessageDetails(\n    errorNumber: string | number,\n    detail: boolean,\n  ): string {\n    let basicMessage = \"\";\n    let detailMessage = \"\";\n\n    // Set error number to string since inconsistent from modules if string or number\n    errorNumber = String(errorNumber);\n    if (APIConstants.scorm2004.error_descriptions[errorNumber]) {\n      basicMessage =\n        APIConstants.scorm2004.error_descriptions[errorNumber].basicMessage;\n      detailMessage =\n        APIConstants.scorm2004.error_descriptions[errorNumber].detailMessage;\n    }\n\n    return detail ? detailMessage : basicMessage;\n  }\n\n  /**\n   * Check to see if a correct_response value has been duplicated\n   * @param {CMIArray} correct_response\n   * @param {number} current_index\n   * @param {*} value\n   * @return {boolean}\n   */\n  checkDuplicatedPattern(\n    correct_response: CMIArray,\n    current_index: number,\n    value: any,\n  ): boolean {\n    let found = false;\n    const count = correct_response._count;\n    for (let i = 0; i < count && !found; i++) {\n      if (i !== current_index && correct_response.childArray[i] === value) {\n        found = true;\n      }\n    }\n    return found;\n  }\n\n  /**\n   * Checks for a valid correct_response value\n   * @param {string} interaction_type\n   * @param {Array} nodes\n   * @param {*} value\n   */\n  checkCorrectResponseValue(\n    interaction_type: string,\n    nodes: Array<any>,\n    value: any,\n  ) {\n    const response = CorrectResponses[interaction_type];\n    const formatRegex = new RegExp(response.format);\n    for (let i = 0; i < nodes.length && this.lastErrorCode === \"0\"; i++) {\n      if (\n        interaction_type.match(\n          \"^(fill-in|long-fill-in|matching|performance|sequencing)$\",\n        )\n      ) {\n        nodes[i] = this.removeCorrectResponsePrefixes(nodes[i]);\n      }\n\n      if (response?.delimiter2) {\n        const values = nodes[i].split(response.delimiter2);\n        if (values.length === 2) {\n          const matches = values[0].match(formatRegex);\n          if (!matches) {\n            this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n          } else {\n            if (\n              !response.format2 ||\n              !values[1].match(new RegExp(response.format2))\n            ) {\n              this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n            }\n          }\n        } else {\n          this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n        }\n      } else {\n        const matches = nodes[i].match(formatRegex);\n        if (\n          (!matches && value !== \"\") ||\n          (!matches && interaction_type === \"true-false\")\n        ) {\n          this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n        } else {\n          if (interaction_type === \"numeric\" && nodes.length > 1) {\n            if (Number(nodes[0]) > Number(nodes[1])) {\n              this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n            }\n          } else {\n            if (nodes[i] !== \"\" && response.unique) {\n              for (let j = 0; j < i && this.lastErrorCode === \"0\"; j++) {\n                if (nodes[i] === nodes[j]) {\n                  this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove prefixes from correct_response\n   * @param {string} node\n   * @return {*}\n   */\n  removeCorrectResponsePrefixes(node: string): any {\n    let seenOrder = false;\n    let seenCase = false;\n    let seenLang = false;\n\n    const prefixRegex = new RegExp(\n      \"^({(lang|case_matters|order_matters)=([^}]+)})\",\n    );\n    let matches = node.match(prefixRegex);\n    let langMatches = null;\n    while (matches) {\n      switch (matches[2]) {\n        case \"lang\":\n          langMatches = node.match(Regex.scorm2004.CMILangcr);\n          if (langMatches) {\n            const lang = langMatches[3];\n            if (lang !== undefined && lang.length > 0) {\n              if (!ValidLanguages.includes(lang.toLowerCase())) {\n                this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n              }\n            }\n          }\n          seenLang = true;\n          break;\n        case \"case_matters\":\n          if (!seenLang && !seenOrder && !seenCase) {\n            if (matches[3] !== \"true\" && matches[3] !== \"false\") {\n              this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n            }\n          }\n\n          seenCase = true;\n          break;\n        case \"order_matters\":\n          if (!seenCase && !seenLang && !seenOrder) {\n            if (matches[3] !== \"true\" && matches[3] !== \"false\") {\n              this.throwSCORMError(ErrorCodes.scorm2004.TYPE_MISMATCH);\n            }\n          }\n\n          seenOrder = true;\n          break;\n      }\n      node = node.substring(matches[1].length);\n      matches = node.match(prefixRegex);\n    }\n\n    return node;\n  }\n\n  /**\n   * Replace the whole API with another\n   * @param {Scorm2004API} newAPI\n   */\n  replaceWithAnotherScormAPI(newAPI: Scorm2004API) {\n    // Data Model\n    this.cmi = newAPI.cmi;\n    this.adl = newAPI.adl;\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   *\n   * @param {boolean} terminateCommit\n   * @return {object|Array}\n   */\n  renderCommitCMI(terminateCommit: boolean): object | Array<any> {\n    const cmiExport: RefObject = this.renderCMIToJSONObject();\n\n    if (terminateCommit) {\n      cmiExport.cmi.total_time = this.cmi.getCurrentTotalTime();\n    }\n\n    const result = [];\n    const flattened: RefObject = Utilities.flatten(cmiExport);\n    switch (this.settings.dataCommitFormat) {\n      case \"flattened\":\n        return Utilities.flatten(cmiExport);\n      case \"params\":\n        for (const item in flattened) {\n          if ({}.hasOwnProperty.call(flattened, item)) {\n            result.push(`${item}=${flattened[item]}`);\n          }\n        }\n        return result;\n      case \"json\":\n      default:\n        return cmiExport;\n    }\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * @param {boolean} terminateCommit\n   * @return {CommitObject}\n   */\n  renderCommitObject(terminateCommit: boolean): CommitObject {\n    const cmiExport = this.renderCommitCMI(terminateCommit);\n    const totalTimeDuration = this.cmi.getCurrentTotalTime();\n    const totalTimeSeconds = Utilities.getDurationAsSeconds(\n      totalTimeDuration,\n      Regex.scorm2004.CMITimespan,\n    );\n\n    let completionStatus = CompletionStatus.unknown;\n    let successStatus = SuccessStatus.unknown;\n    if (this.cmi.completion_status) {\n      if (this.cmi.completion_status === \"completed\") {\n        completionStatus = CompletionStatus.completed;\n      } else if (this.cmi.completion_status === \"incomplete\") {\n        completionStatus = CompletionStatus.incomplete;\n      }\n    }\n    if (this.cmi.success_status) {\n      if (this.cmi.success_status === \"passed\") {\n        successStatus = SuccessStatus.passed;\n      } else if (this.cmi.success_status === \"failed\") {\n        successStatus = SuccessStatus.failed;\n      }\n    }\n\n    const score = this.cmi.score;\n    let scoreObject: ScoreObject = null;\n    if (score) {\n      scoreObject = {};\n\n      if (!Number.isNaN(Number.parseFloat(score.raw))) {\n        scoreObject.raw = Number.parseFloat(score.raw);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.min))) {\n        scoreObject.min = Number.parseFloat(score.min);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.max))) {\n        scoreObject.max = Number.parseFloat(score.max);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.scaled))) {\n        scoreObject.scaled = Number.parseFloat(score.scaled);\n      }\n    }\n\n    const commitObject: CommitObject = {\n      completionStatus: completionStatus,\n      successStatus: successStatus,\n      totalTimeSeconds: totalTimeSeconds,\n      runtimeData: cmiExport,\n    };\n    if (scoreObject) {\n      commitObject.score = scoreObject;\n    }\n    return commitObject;\n  }\n\n  /**\n   * Attempts to store the data to the LMS\n   *\n   * @param {boolean} terminateCommit\n   * @return {ResultObject}\n   */\n  async storeData(terminateCommit: boolean): Promise<ResultObject> {\n    if (terminateCommit) {\n      if (this.cmi.mode === \"normal\") {\n        if (this.cmi.credit === \"credit\") {\n          if (this.cmi.completion_threshold && this.cmi.progress_measure) {\n            if (this.cmi.progress_measure >= this.cmi.completion_threshold) {\n              this.cmi.completion_status = \"completed\";\n            } else {\n              this.cmi.completion_status = \"incomplete\";\n            }\n          }\n          if (this.cmi.scaled_passing_score && this.cmi.score.scaled) {\n            if (this.cmi.score.scaled >= this.cmi.scaled_passing_score) {\n              this.cmi.success_status = \"passed\";\n            } else {\n              this.cmi.success_status = \"failed\";\n            }\n          }\n        }\n      }\n    }\n\n    let navRequest = false;\n    if (\n      this.adl.nav.request !== this.startingData?.adl?.nav?.request &&\n      this.adl.nav.request !== \"_none_\"\n    ) {\n      this.adl.nav.request = encodeURIComponent(this.adl.nav.request);\n      navRequest = true;\n    }\n\n    const shouldTerminateCommit =\n      terminateCommit || this.settings.alwaysSendTotalTime;\n    const commitObject = this.settings.renderCommonCommitFields\n      ? this.renderCommitObject(shouldTerminateCommit)\n      : this.renderCommitCMI(shouldTerminateCommit);\n\n    if (this.apiLogLevel === APIConstants.global.LOG_LEVEL_DEBUG) {\n      console.debug(\n        \"Commit (terminated: \" + (terminateCommit ? \"yes\" : \"no\") + \"): \",\n      );\n      console.debug(commitObject);\n    }\n    if (typeof this.settings.lmsCommitUrl === \"string\") {\n      const result = await this.processHttpRequest(\n        this.settings.lmsCommitUrl,\n        commitObject,\n        terminateCommit,\n      );\n\n      // check if this is a sequencing call, and then call the necessary JS\n      {\n        if (\n          navRequest &&\n          result.navRequest !== undefined &&\n          result.navRequest !== \"\"\n        ) {\n          Function(`\"use strict\";(() => { ${result.navRequest} })()`)();\n        }\n      }\n      return result;\n    } else {\n      return {\n        result: APIConstants.global.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n  }\n}\n","import Scorm2004API from \"../Scorm2004API.ts\";\n\nwindow.Scorm2004API = Scorm2004API;\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","Iterator","verb","Symbol","iterator","v","op","pop","push","SuppressedError","jsonString","_initialized","_start_time","initialize","setStartTime","Date","getTime","BaseCMI","global","GENERAL","INITIALIZATION_FAILED","INITIALIZED","TERMINATED","TERMINATION_FAILURE","TERMINATION_BEFORE_INIT","MULTIPLE_TERMINATION","RETRIEVE_BEFORE_INIT","RETRIEVE_AFTER_TERM","STORE_BEFORE_INIT","STORE_AFTER_TERM","COMMIT_BEFORE_INIT","COMMIT_AFTER_TERM","ARGUMENT_ERROR","CHILDREN_ERROR","COUNT_ERROR","GENERAL_GET_FAILURE","GENERAL_SET_FAILURE","GENERAL_COMMIT_FAILURE","UNDEFINED_DATA_MODEL","UNIMPLEMENTED_ELEMENT","VALUE_NOT_INITIALIZED","INVALID_SET_VALUE","READ_ONLY_ELEMENT","WRITE_ONLY_ELEMENT","TYPE_MISMATCH","VALUE_OUT_OF_RANGE","DEPENDENCY_NOT_ESTABLISHED","scorm12","scorm2004","MULTIPLE_TERMINATIONS","cmi_children","core_children","score_children","comments_children","objectives_children","correct_responses_children","student_data_children","student_preference_children","interactions_children","error_descriptions","basicMessage","detailMessage","SCORM_TRUE","SCORM_FALSE","STATE_NOT_INITIALIZED","STATE_INITIALIZED","STATE_TERMINATED","LOG_LEVEL_DEBUG","LOG_LEVEL_INFO","LOG_LEVEL_WARNING","LOG_LEVEL_ERROR","LOG_LEVEL_NONE","aicc","student_demographics_children","tries_children","attempt_records_children","paths_children","scorm12_errors","aicc_errors","scorm2004_errors","errorCode","toString","_errorCode","name","setMessage","message","Error","errorMessage","detailedMessage","_detailedMessage","_errorMessage","BaseScormValidationError","ValidationError","scorm12_error_codes","params","__children","children","_errorClass","errorClass","childArray","_children","_count","toJSON","SECONDS_PER_HOUR","designations","D","H","M","S","getSecondsAsISODuration","seconds","duration","remainder","designationsKey","current_seconds","Math","floor","countDecimals","Number","toFixed","indexOf","getDurationAsSeconds","durationRegex","RegExp","match","exec","years","days","hours","minutes","flatten","data","recurse","cur","prop","isArray","l","isEmpty","num","split","stringMatches","str","tester","DefaultSettings","autocommit","autocommitSeconds","asyncCommit","sendFullCommit","lmsCommitUrl","dataCommitFormat","commitRequestDataType","autoProgress","logLevel","selfReportSessionTime","alwaysSendTotalTime","renderCommonCommitFields","strict_errors","xhrHeaders","xhrWithCredentials","responseHandler","response","JSON","parse","text","httpResult","status","requestHandler","commitObject","onLogMessage","messageLevel","logMessage","console","error","warn","info","debug","log","scoItemIds","scoItemIdValidator","API","when","callback","_cancelled","_API","_timeout","setTimeout","wrapper","bind","_callback","cancel","clearTimeout","commit","error_codes","settings","_settings","BaseAPI","currentState","lastErrorCode","listenerArray","_error_codes","apiLogLevel","commonReset","callbackName","initializeMessage","terminationMessage","returnValue","isInitialized","throwSCORMError","isTerminated","cmi","processListeners","apiLog","clearSCORMError","functionName","CMIElement","messageString","fillChars","j","formatMessage","terminate","checkTerminated","checkState","storeData","getValue","getCMIValue","handleValueAccessException","undefined","setValue","commitCallback","setCMIValue","scheduleCommit","clearScheduledCommit","getLastError","getErrorString","CMIErrorCode","getLmsErrorMessageDetails","getDiagnostic","beforeInitError","afterTermError","isNotInitialized","_errorNumber","_detail","_CMIElement","_value","_commonSetCMIValue","methodName","structure","refObject","foundFirstIndex","invalidErrorMessage","invalidErrorCode","idx","attribute","substring","_checkObjectHasProperty","validateCorrectResponse","CMIArray","index","parseInt","isNaN","item","newChild","getChildElement","initialized","_commonGetCMIValue","uninitializedErrorMessage","_isTargetValid","target","on","listenerName","listenerFunctions","listenerSplit","replace","off","removeIndex","findIndex","obj","splice","clear","filter","listener","functionsMatch","listenerHasCMIElement","CMIElementsMatch","errorNumber","success","loadFromFlattenedJSON","json","int_pattern","obj_pattern","keys","map","key","sort","test","a","c","testPattern","forEach","element","loadFromJSON","regex","m","unflatten","a_pattern","c_match","a_match","a_num","c_num","startingData","currentCMIElement","renderCMIToJSONString","stringify","k","renderCMIToJSONObject","processHttpRequest","url","immediate","api","genericError","performFetch","transformResponse","process","debouncedProcess","func","wait","timeout","context","callNow","args","debounce","ScheduledCommit","getOwnPropertyDescriptor","getPrototypeOf","fetch","method","join","headers","credentials","keepalive","CMIString256","CMIString4096","CMITime","CMITimespan","CMIInteger","CMISInteger","CMIDecimal","CMIIdentifier","CMIFeedback","CMIIndex","CMIStatus","CMIStatus2","CMIExit","CMIType","CMIResult","NAVEvent","score_range","audio_range","speed_range","weighting_range","text_range","CMIString200","CMIString250","CMIString1000","CMIString4000","CMIString64000","CMILang","CMILangString250","CMILangcr","CMILangString250cr","CMILangString4000","CMIShortIdentifier","CMILongIdentifier","CMIIndexStore","CMICStatus","CMISStatus","NAVBoolean","NAVTarget","scaled_range","progress_range","checkValidFormat","regexPattern","allowEmptyString","formatRegex","matches","checkValidRange","rangePattern","ranges","check2004ValidFormat","Scorm2004ValidationError","check2004ValidRange","SuccessStatus","CompletionStatus","_audio_level","_language","_delivery_speed","_audio_captioning","audio_level","language","delivery_speed","audio_captioning","scorm2004_regex","LearnerResponses","format","max","delimiter","unique","choice","matching","format2","delimiter2","performance","sequencing","likert","numeric","other","CorrectResponses","duplicate","limit","delimiter3","_id","_type","_timestamp","_weighting","_learner_response","_result","_latency","_description","objectives","correct_responses","id","type","timestamp","weighting","learner_response","nodes","response_type","values","latency","description","_pattern","pattern","scorm12_constants","scorm12_regex","invalidTypeCode","invalidRangeCode","decimalRegex","_scaled","scaled","raw","min","_raw","_min","__score_range","_max","__invalid_error_code","__invalid_type_code","__invalid_range_code","__decimal_regex","__error_class","readOnlyAfterInit","_comment","_location","_readOnlyAfterInit","comment","location","_success_status","_completion_status","_progress_measure","score","Scorm2004CMIScore","success_status","completion_status","progress_measure","__version","_completion_threshold","_credit","_entry","_exit","_launch_data","_learner_id","_learner_name","_max_time_allowed","_mode","_scaled_passing_score","_session_time","_suspend_data","_time_limit_action","_total_time","learner_preference","CMILearnerPreference","comments_from_learner","CMICommentsFromLearner","comments_from_lms","CMICommentsFromLMS","interactions","CMIInteractions","CMIObjectives","_version","completion_threshold","credit","entry","exit","launch_data","learner_id","learner_name","max_time_allowed","mode","scaled_passing_score","session_time","suspend_data","time_limit_action","total_time","getCurrentTotalTime","sessionTime","startTime","start_time","first","second","BaseRootCMI","nav","ADLNav","_request","request_valid","ADLNavRequestValid","request","_continue","_previous","_choice","_jump","jump","previous","continue","mastery_override","CMI","adl","ADL","Initialize","lmsInitialize","Terminate","lmsFinish","GetValue","lmsGetValue","SetValue","lmsSetValue","Commit","lmsCommit","GetLastError","lmsGetLastError","GetErrorString","lmsGetErrorString","GetDiagnostic","lmsGetDiagnostic","reset","internalFinish","navActions","exitAll","abandon","abandonAll","choiceJumpRegex","action","adlNavRequestRegex","includes","CMIObjectivesObject","createCorrectResponsesObject","CMIInteractionsObjectivesObject","CMIInteractionsObject","CMICommentsObject","parts","interaction","checkDuplicateChoiceResponse","checkValidResponseType","CMIInteractionsCorrectResponsesObject","interaction_type","checkCorrectResponseValue","interaction_count","pattern_index","checkDuplicatedPattern","detail","correct_response","current_index","found","count","removeCorrectResponsePrefixes","node","seenOrder","seenCase","seenLang","prefixRegex","langMatches","lang","toLowerCase","replaceWithAnotherScormAPI","newAPI","renderCommitCMI","terminateCommit","cmiExport","flattened","renderCommitObject","totalTimeSeconds","completionStatus","unknown","successStatus","completed","incomplete","passed","failed","scoreObject","parseFloat","runtimeData","navRequest","encodeURIComponent","shouldTerminateCommit","Function","window","Scorm2004API"],"sourceRoot":""}