{"version":3,"file":"cross-frame-lms.min.js","sources":["../../src/CrossFrameLMS.ts"],"sourcesContent":["// src/CrossFrameLMS.ts\nimport { MessageData, MessageResponse } from \"./types/CrossFrame\";\nimport { IBaseAPI } from \"./interfaces/IBaseAPI\";\n\n/**\n * Server‚Äêside SCORM adapter running in your LMS frame (lms.example.com).\n * Listens for postMessage from child (content) frames, invokes real API,\n * and posts back { messageId, result, error }.\n */\nexport default class CrossFrameLMS {\n  private readonly _api: IBaseAPI;\n  private readonly _origin: string;\n\n  constructor(api: IBaseAPI, targetOrigin: string = \"*\") {\n    this._api = api;\n    this._origin = targetOrigin;\n    window.addEventListener(\"message\", this._onMessage.bind(this));\n  }\n\n  private _onMessage(ev: MessageEvent) {\n    const msg = ev.data as MessageData;\n    if (!msg?.messageId || !msg.method) return;\n    this._process(msg, ev.source as Window);\n  }\n\n  private _process(msg: MessageData, source: Window) {\n    let result: any, error: any;\n    try {\n      const fn = (this._api as any)[msg.method];\n      if (typeof fn !== \"function\") {\n        error = {\n          message: `Method ${msg.method} not found`,\n        };\n      } else {\n        result = fn.apply(this._api, msg.params);\n      }\n    } catch (e: any) {\n      error = { message: e.message, stack: e.stack };\n    }\n    const resp: MessageResponse = {\n      messageId: msg.messageId,\n      result,\n      error,\n    };\n    source.postMessage(resp, this._origin);\n  }\n}\n"],"names":["constructor","api","targetOrigin","this","_api","_origin","window","addEventListener","_onMessage","bind","ev","msg","data","messageId","method","_process","source","result","error","fn","message","apply","params","e","stack","postMessage"],"mappings":"kDASA,MAIE,WAAAA,CAAYC,IAAeC,aAAuB,KAChDC,KAAKC,KAAOH,IACZE,KAAKE,QAAUH,aACfI,OAAOC,iBAAiB,UAAWJ,KAAKK,WAAWC,KAAKN,MAAK,CAGvD,UAAAK,CAAWE,IACjB,MAAMC,IAAMD,GAAGE,MACV,MAAAD,SAAA,EAAAA,IAAKE,YAAcF,IAAIG,QACvBX,KAAAY,SAASJ,IAAKD,GAAGM,OAAgB,CAGhC,QAAAD,CAASJ,IAAkBK,QACjC,IAAIC,OAAaC,MACb,IACF,MAAMC,GAAMhB,KAAKC,KAAaO,IAAIG,QAChB,mBAAPK,GACDD,MAAA,CACNE,QAAS,UAAUT,IAAIG,oBAGzBG,OAASE,GAAGE,MAAMlB,KAAKC,KAAMO,IAAIW,cAE5BC,GACPL,MAAQ,CAAEE,QAASG,EAAEH,QAASI,MAAOD,EAAEC,MAAM,CAOxCR,OAAAS,YALuB,CAC5BZ,UAAWF,IAAIE,UACfI,cACAC,aAEuBf,KAAKE,QAAO"}