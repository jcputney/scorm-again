{"version":3,"file":"cross-frame-lms.js","sources":["../../src/CrossFrameLMS.ts"],"sourcesContent":["// src/CrossFrameLMS.ts\nimport { MessageData, MessageResponse } from \"./types/CrossFrame\";\nimport { IBaseAPI } from \"./interfaces/IBaseAPI\";\n\n/**\n * Server‚Äêside SCORM adapter running in your LMS frame (lms.example.com).\n * Listens for postMessage from child (content) frames, invokes real API,\n * and posts back { messageId, result, error }.\n */\nexport default class CrossFrameLMS {\n  private readonly _api: IBaseAPI;\n  private readonly _origin: string;\n\n  constructor(api: IBaseAPI, targetOrigin: string = \"*\") {\n    this._api = api;\n    this._origin = targetOrigin;\n    window.addEventListener(\"message\", this._onMessage.bind(this));\n  }\n\n  private _onMessage(ev: MessageEvent) {\n    const msg = ev.data as MessageData;\n    if (!msg?.messageId || !msg.method) return;\n    this._process(msg, ev.source as Window);\n  }\n\n  private _process(msg: MessageData, source: Window) {\n    let result: any, error: any;\n    try {\n      const fn = (this._api as any)[msg.method];\n      if (typeof fn !== \"function\") throw new Error(`Method ${msg.method} not found`);\n      result = fn.apply(this._api, msg.params);\n    } catch (e: any) {\n      error = { message: e.message, stack: e.stack };\n    }\n    const resp: MessageResponse = {\n      messageId: msg.messageId,\n      result,\n      error,\n    };\n    source.postMessage(resp, this._origin);\n  }\n}\n"],"names":[],"mappings":";;;EASA,MAAqB,aAAc,CAAA;EAAA,EAIjC,WAAA,CAAY,GAAe,EAAA,YAAA,GAAuB,GAAK,EAAA;EACrD,IAAA,IAAA,CAAK,IAAO,GAAA,GAAA;EACZ,IAAA,IAAA,CAAK,OAAU,GAAA,YAAA;EACf,IAAA,MAAA,CAAO,iBAAiB,SAAW,EAAA,IAAA,CAAK,UAAW,CAAA,IAAA,CAAK,IAAI,CAAC,CAAA;EAAA;EAC/D,EAEQ,WAAW,EAAkB,EAAA;EACnC,IAAA,MAAM,MAAM,EAAG,CAAA,IAAA;EACf,IAAA,IAAI,EAAC,GAAA,IAAA,IAAA,GAAA,MAAA,GAAA,GAAA,CAAK,SAAa,CAAA,IAAA,CAAC,IAAI,MAAQ,EAAA;EACpC,IAAK,IAAA,CAAA,QAAA,CAAS,GAAK,EAAA,EAAA,CAAG,MAAgB,CAAA;EAAA;EACxC,EAEQ,QAAA,CAAS,KAAkB,MAAgB,EAAA;EACjD,IAAA,IAAI,MAAa,EAAA,KAAA;EACjB,IAAI,IAAA;EACF,MAAA,MAAM,EAAM,GAAA,IAAA,CAAK,IAAa,CAAA,GAAA,CAAI,MAAM,CAAA;EACxC,MAAI,IAAA,OAAO,OAAO,UAAY,EAAA,MAAM,IAAI,KAAM,CAAA,CAAA,OAAA,EAAU,GAAI,CAAA,MAAM,CAAY,UAAA,CAAA,CAAA;EAC9E,MAAA,MAAA,GAAS,EAAG,CAAA,KAAA,CAAM,IAAK,CAAA,IAAA,EAAM,IAAI,MAAM,CAAA;EAAA,aAChC,CAAQ,EAAA;EACf,MAAA,KAAA,GAAQ,EAAE,OAAS,EAAA,CAAA,CAAE,OAAS,EAAA,KAAA,EAAO,EAAE,KAAM,EAAA;EAAA;EAE/C,IAAA,MAAM,IAAwB,GAAA;EAAA,MAC5B,WAAW,GAAI,CAAA,SAAA;EAAA,MACf,MAAA;EAAA,MACA;EAAA,KACF;EACA,IAAO,MAAA,CAAA,WAAA,CAAY,IAAM,EAAA,IAAA,CAAK,OAAO,CAAA;EAAA;EAEzC;;;;;;;;"}