this.AICC=function(){"use strict";const e="true",t="false",s={cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",core_children:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",score_children:"raw,min,max",comments_children:"content,location,time",objectives_children:"id,score,status",correct_responses_children:"pattern",student_data_children:"mastery_score,max_time_allowed,time_limit_action",student_preference_children:"audio,language,speed,text",interactions_children:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",error_descriptions:{101:{basicMessage:"General Exception",detailMessage:"No specific error code exists to describe the error. Use LMSGetDiagnostic for more information"},201:{basicMessage:"Invalid argument error",detailMessage:"Indicates that an argument represents an invalid data model element or is otherwise incorrect."},202:{basicMessage:"Element cannot have children",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_children" for a data model element that does not support the "_children" suffix.'},203:{basicMessage:"Element not an array - cannot have count",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_count" for a data model element that does not support the "_count" suffix.'},301:{basicMessage:"Not initialized",detailMessage:"Indicates that an API call was made before the call to lmsInitialize."},401:{basicMessage:"Not implemented error",detailMessage:"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement."},402:{basicMessage:"Invalid set value, element is a keyword",detailMessage:'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in "_children" and "_count").'},403:{basicMessage:"Element is read only",detailMessage:"LMSSetValue was called with a data model element that can only be read."},404:{basicMessage:"Element is write only",detailMessage:"LMSGetValue was called on a data model element that can only be written to."},405:{basicMessage:"Incorrect Data Type",detailMessage:"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element."},407:{basicMessage:"Element Value Out Of Range",detailMessage:"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element."},408:{basicMessage:"Data Model Dependency Not Established",detailMessage:"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element."}}},i={...s,cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation",student_preference_children:"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows",student_data_children:"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action",student_demographics_children:"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience",tries_children:"time,status,score",attempt_records_children:"score,lesson_status",paths_children:"location_id,date,time,status,why_left,time_in_element"},r={GENERAL:101,INITIALIZATION_FAILED:101,INITIALIZED:101,TERMINATED:101,TERMINATION_FAILURE:101,TERMINATION_BEFORE_INIT:101,MULTIPLE_TERMINATION:101,RETRIEVE_BEFORE_INIT:101,RETRIEVE_AFTER_TERM:101,STORE_BEFORE_INIT:101,STORE_AFTER_TERM:101,COMMIT_BEFORE_INIT:101,COMMIT_AFTER_TERM:101,ARGUMENT_ERROR:101,CHILDREN_ERROR:101,COUNT_ERROR:101,GENERAL_GET_FAILURE:101,GENERAL_SET_FAILURE:101,GENERAL_COMMIT_FAILURE:101,UNDEFINED_DATA_MODEL:101,UNIMPLEMENTED_ELEMENT:101,VALUE_NOT_INITIALIZED:101,INVALID_SET_VALUE:101,READ_ONLY_ELEMENT:101,WRITE_ONLY_ELEMENT:101,TYPE_MISMATCH:101,VALUE_OUT_OF_RANGE:101,DEPENDENCY_NOT_ESTABLISHED:101,RETRIEVE_BEFORE_INIT:301,STORE_BEFORE_INIT:301,COMMIT_BEFORE_INIT:301,ARGUMENT_ERROR:201,CHILDREN_ERROR:202,COUNT_ERROR:203,UNDEFINED_DATA_MODEL:401,UNIMPLEMENTED_ELEMENT:401,VALUE_NOT_INITIALIZED:301,INVALID_SET_VALUE:402,READ_ONLY_ELEMENT:403,WRITE_ONLY_ELEMENT:404,TYPE_MISMATCH:405,VALUE_OUT_OF_RANGE:407,DEPENDENCY_NOT_ESTABLISHED:408},n={CMIString256:"^.{0,255}$",CMIString4096:"^.{0,4096}$",CMITime:"^(?:[01]\\d|2[0123]):(?:[012345]\\d):(?:[012345]\\d)$",CMITimespan:"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",CMIInteger:"^\\d+$",CMISInteger:"^-?([0-9]+)$",CMIDecimal:"^-?([0-9]{0,3})(.[0-9]*)?$",CMIIdentifier:"^[\\u0021-\\u007E\\s]{0,255}$",CMIFeedback:"^.{0,255}$",CMIIndex:"[._](\\d+).",CMIStatus:"^(passed|completed|failed|incomplete|browsed)$",CMIStatus2:"^(passed|completed|failed|incomplete|browsed|not attempted)$",CMIExit:"^(time-out|suspend|logout|)$",CMIType:"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$",CMIResult:"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\.[0-9]*)?)$",NAVEvent:"^(previous|continue)$",score_range:"0#100",audio_range:"-1#100",speed_range:"-100#100",weighting_range:"-100#100",text_range:"-1#1"},o={...n,CMIIdentifier:"^\\w{1,255}$"};class a extends Error{constructor(e,t){super(`${e} : ${""+t}`),this._errorCode=t,Object.setPrototypeOf(this,a.prototype)}get errorCode(){return this._errorCode}}class c extends a{constructor(e,t,s,i){super(e,t),this._detailedMessage="",this.message=`${e} : ${s}`,this._errorMessage=s,i&&(this._detailedMessage=i),Object.setPrototypeOf(this,c.prototype)}get errorMessage(){return this._errorMessage}get detailedMessage(){return this._detailedMessage}}const l=s.error_descriptions;class h extends c{constructor(e,t){!{}.hasOwnProperty.call(l,t+"")?super(e,101,l[101].basicMessage,l[101].detailMessage):super(e,t,l[t+""].basicMessage,l[t+""].detailMessage),Object.setPrototypeOf(this,h.prototype)}}class _{constructor(e){this.jsonString=!1,this._initialized=!1,this._cmi_element=e}get initialized(){return this._initialized}get start_time(){return this._start_time}initialize(){this._initialized=!0}setStartTime(){this._start_time=(new Date).getTime()}}class d extends _{}const m=M((e=>{if(!e||0>=e)return"00:00:00";const t=Math.floor(e/3600),s=new Date(1e3*e),i=s.getUTCMinutes(),r=s.getSeconds(),n=e%1;let o="";return E(n)>0&&(o=E(n)>2?n.toFixed(2):n+"",o="."+o.split(".")[1]),(t+":"+i+":"+r).replace(/\b\d\b/g,"0$&")+o})),u=M(((e,t)=>{if("number"!=typeof e&&"boolean"!=typeof e||(e+=""),"string"==typeof t&&(t=RegExp(t)),!e||!e?.match?.(t))return 0;const s=e.split(":");return 3600*+s[0]+60*+s[1]+ +s[2]}),((e,t)=>`${"string"==typeof e?e:(e??"")+""}:${"string"==typeof t?t:t?.toString()??""}`));function g(e){const t={};return function e(s,i){if(Object(s)!==s)t[i]=s;else if(Array.isArray(s))s.forEach(((t,s)=>{e(t,`${i}[${s}]`)})),0===s.length&&(t[i]=[]);else{const r=Object.keys(s).filter((e=>({}.hasOwnProperty.call(s,e)))),n=0===r.length;r.forEach((t=>{e(s[t],i?`${i}.${t}`:t)})),n&&i&&(t[i]={})}}(e,""),t}function E(e){if(Math.floor(e)===e||0>(e+"")?.indexOf?.("."))return 0;const t=(""+e).split(".")?.[1];return t?.length??0}function p(e,t){return null!==e?.match(t)}function M(e,t){const s=new Map;return function(){for(var i=arguments.length,r=Array(i),n=0;i>n;n++)r[n]=arguments[n];const o=t?t(...r):JSON.stringify(r);return s.has(o)?s.get(o):(()=>{const t=e(...r);return s.set(o,t),t})()}}const S=M(((e,t,s,i,r,n)=>{if("string"!=typeof t)return!1;const o=RegExp(s),a=t.match(o);if(n&&""===t)return!0;if(void 0===t||!a||""===a[0])throw new r(e,i);return!0}),((e,t,s,i,r,n)=>`${e}:${"string"==typeof t?t:`[${typeof t}]`}:${s}:${i}:${n||!1}`)),C=M(((e,t,s,i,r)=>{const n=s.split("#");if(n[0]>(t*=1))throw new r(e,i);if("*"!==n[1]&&t>n[1])throw new r(e,i);return!0}),((e,t,s,i,r)=>`${e}:${t}:${s}:${i}`));function I(e,t,s,i){return S(e,t,s,r.TYPE_MISMATCH,h,i)}function f(e,t,s,i){if(""===t)throw new h(e,r.VALUE_OUT_OF_RANGE);return C(e,t,s,r.VALUE_OUT_OF_RANGE,h)}const L=new class{validateScore(e,t,s,i,r,n,o){return S(e,t,s,r,o)&&(!i||C(e,t,i,n,o))}validateScorm12Audio(e,t){return I(e,t,n.CMISInteger)&&f(e,t,"-1#100")}validateScorm12Language(e,t){return I(e,t,"^.{0,255}$")}validateScorm12Speed(e,t){return I(e,t,n.CMISInteger)&&f(e,t,"-100#100")}validateScorm12Text(e,t){return I(e,t,n.CMISInteger)&&f(e,t,"-1#1")}validateReadOnly(e,t){if(t)throw new h(e,r.READ_ONLY_ELEMENT)}};class N extends _{constructor(e){super(e.CMIElement),this._raw="",this._min="",this.__children=e.score_children||s.score_children,this.__score_range=!!e.score_range&&"0#100",this._max=e.max||""===e.max?e.max:"100",this.__invalid_error_code=e.invalidErrorCode||r.INVALID_SET_VALUE,this.__invalid_type_code=e.invalidTypeCode||r.TYPE_MISMATCH,this.__invalid_range_code=e.invalidRangeCode||r.VALUE_OUT_OF_RANGE,this.__decimal_regex=e.decimalRegex||n.CMIDecimal,this.__error_class=e.errorClass}reset(){this._initialized=!1}get _children(){return this.__children}set _children(e){throw new this.__error_class(this._cmi_element+"._children",this.__invalid_error_code)}get raw(){return this._raw}set raw(e){L.validateScore(this._cmi_element+".raw",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._raw=e)}get min(){return this._min}set min(e){L.validateScore(this._cmi_element+".min",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._min=e)}get max(){return this._max}set max(e){L.validateScore(this._cmi_element+".max",e,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._max=e)}toJSON(){this.jsonString=!0;const e={raw:this.raw,min:this.min,max:this.max};return delete this.jsonString,e}}class w extends _{constructor(){super("cmi.core"),this.__children=s.core_children,this._student_id="",this._student_name="",this._lesson_location="",this._credit="",this._lesson_status="not attempted",this._entry="",this._total_time="",this._lesson_mode="normal",this._exit="",this._session_time="00:00:00",this._suspend_data="",this.score=new N({CMIElement:"cmi.core.score",score_children:s.score_children,score_range:"0#100",invalidErrorCode:r.INVALID_SET_VALUE,invalidTypeCode:r.TYPE_MISMATCH,invalidRangeCode:r.VALUE_OUT_OF_RANGE,errorClass:h})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._exit="",this._entry="",this._session_time="00:00:00",this.score?.reset()}get _children(){return this.__children}set _children(e){throw new h(this._cmi_element+"._children",r.INVALID_SET_VALUE)}get student_id(){return this._student_id}set student_id(e){if(this.initialized)throw new h(this._cmi_element+".student_id",r.READ_ONLY_ELEMENT);this._student_id=e}get student_name(){return this._student_name}set student_name(e){if(this.initialized)throw new h(this._cmi_element+".student_name",r.READ_ONLY_ELEMENT);this._student_name=e}get lesson_location(){return this._lesson_location}set lesson_location(e){I(this._cmi_element+".lesson_location",e,"^.{0,255}$",!0)&&(this._lesson_location=e)}get credit(){return this._credit}set credit(e){if(this.initialized)throw new h(this._cmi_element+".credit",r.READ_ONLY_ELEMENT);this._credit=e}get lesson_status(){return this._lesson_status}set lesson_status(e){this.initialized?I(this._cmi_element+".lesson_status",e,n.CMIStatus)&&(this._lesson_status=e):I(this._cmi_element+".lesson_status",e,n.CMIStatus2)&&(this._lesson_status=e)}get entry(){return this._entry}set entry(e){if(this.initialized)throw new h(this._cmi_element+".entry",r.READ_ONLY_ELEMENT);this._entry=e}get total_time(){return this._total_time}set total_time(e){if(this.initialized)throw new h(this._cmi_element+".total_time",r.READ_ONLY_ELEMENT);this._total_time=e}get lesson_mode(){return this._lesson_mode}set lesson_mode(e){if(this.initialized)throw new h(this._cmi_element+".lesson_mode",r.READ_ONLY_ELEMENT);this._lesson_mode=e}get exit(){if(!this.jsonString)throw new h(this._cmi_element+".exit",r.WRITE_ONLY_ELEMENT);return this._exit}set exit(e){I(this._cmi_element+".exit",e,n.CMIExit,!0)&&(this._exit=e)}get session_time(){if(!this.jsonString)throw new h(this._cmi_element+".session_time",r.WRITE_ONLY_ELEMENT);return this._session_time}set session_time(e){I(this._cmi_element+".session_time",e,n.CMITimespan)&&(this._session_time=e)}get suspend_data(){return this._suspend_data}set suspend_data(e){I(this._cmi_element+".suspend_data",e,"^.{0,4096}$",!0)&&(this._suspend_data=e)}getCurrentTotalTime(e){let t=this._session_time;const s=e;if(null!=s){const e=(new Date).getTime()-s;t=m(e/1e3)}return i=this._total_time,r=t,"string"==typeof(o=RegExp(n.CMITimespan))&&(o=RegExp(o)),m(u(i,o)+u(r,o));var i,r,o}toJSON(){this.jsonString=!0;const e={student_id:this.student_id,student_name:this.student_name,lesson_location:this.lesson_location,credit:this.credit,lesson_status:this.lesson_status,entry:this.entry,lesson_mode:this.lesson_mode,exit:this.exit,session_time:this.session_time,score:this.score};return delete this.jsonString,e}}class O extends _{constructor(e){super(e.CMIElement),this.__children=e.children,this._errorCode=e.errorCode||r.GENERAL,this._errorClass=e.errorClass||a,this.childArray=[]}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._initialized=!1,e)this.childArray=[];else for(let e=0;this.childArray.length>e;e++)this.childArray[e].reset()}get _children(){return this.__children}set _children(e){throw new this._errorClass(this._cmi_element+"._children",this._errorCode)}get _count(){return this.childArray.length}set _count(e){throw new this._errorClass(this._cmi_element+"._count",this._errorCode)}toJSON(){this.jsonString=!0;const e={};for(let t=0;this.childArray.length>t;t++)e[t+""]=this.childArray[t];return delete this.jsonString,e}}class T extends O{constructor(){super({CMIElement:"cmi.objectives",children:s.objectives_children,errorCode:r.INVALID_SET_VALUE,errorClass:h})}}class v extends _{constructor(){super("cmi.objectives.n"),this._id="",this._status="",this.score=new N({CMIElement:"cmi.objectives.n.score",score_children:s.score_children,score_range:"0#100",invalidErrorCode:r.INVALID_SET_VALUE,invalidTypeCode:r.TYPE_MISMATCH,invalidRangeCode:r.VALUE_OUT_OF_RANGE,errorClass:h})}reset(){this._initialized=!1,this._id="",this._status="",this.score?.reset()}get id(){return this._id}set id(e){I(this._cmi_element+".id",e,n.CMIIdentifier)&&(this._id=e)}get status(){return this._status}set status(e){I(this._cmi_element+".status",e,n.CMIStatus2)&&(this._status=e)}toJSON(){this.jsonString=!0;const e={id:this.id,status:this.status,score:this.score};return delete this.jsonString,e}}class R extends _{constructor(e){super("cmi.student_data"),this._mastery_score="",this._max_time_allowed="",this._time_limit_action="",this.__children=e||s.student_data_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(e){throw new h(this._cmi_element+"._children",r.INVALID_SET_VALUE)}get mastery_score(){return this._mastery_score}set mastery_score(e){L.validateReadOnly(this._cmi_element+".mastery_score",this.initialized),this._mastery_score=e}get max_time_allowed(){return this._max_time_allowed}set max_time_allowed(e){L.validateReadOnly(this._cmi_element+".max_time_allowed",this.initialized),this._max_time_allowed=e}get time_limit_action(){return this._time_limit_action}set time_limit_action(e){L.validateReadOnly(this._cmi_element+".time_limit_action",this.initialized),this._time_limit_action=e}toJSON(){this.jsonString=!0;const e={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action};return delete this.jsonString,e}}class y extends _{constructor(e){super("cmi.student_preference"),this._audio="",this._language="",this._speed="",this._text="",this.__children=e||s.student_preference_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(e){throw new h(this._cmi_element+"._children",r.INVALID_SET_VALUE)}get audio(){return this._audio}set audio(e){L.validateScorm12Audio(this._cmi_element+".audio",e)&&(this._audio=e)}get language(){return this._language}set language(e){L.validateScorm12Language(this._cmi_element+".language",e)&&(this._language=e)}get speed(){return this._speed}set speed(e){L.validateScorm12Speed(this._cmi_element+".speed",e)&&(this._speed=e)}get text(){return this._text}set text(e){L.validateScorm12Text(this._cmi_element+".text",e)&&(this._text=e)}toJSON(){this.jsonString=!0;const e={audio:this.audio,language:this.language,speed:this.speed,text:this.text};return delete this.jsonString,e}}class A extends O{constructor(){super({CMIElement:"cmi.interactions",children:s.interactions_children,errorCode:r.INVALID_SET_VALUE,errorClass:h})}}class x extends _{constructor(){super("cmi.interactions.n"),this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives=new O({CMIElement:"cmi.interactions.n.objectives",errorCode:r.INVALID_SET_VALUE,errorClass:h,children:s.objectives_children}),this.correct_responses=new O({CMIElement:"cmi.interactions.correct_responses",errorCode:r.INVALID_SET_VALUE,errorClass:h,children:s.correct_responses_children})}initialize(){super.initialize(),this.objectives?.initialize(),this.correct_responses?.initialize()}reset(){this._initialized=!1,this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives?.reset(),this.correct_responses?.reset()}get id(){if(!this.jsonString)throw new h(this._cmi_element+".id",r.WRITE_ONLY_ELEMENT);return this._id}set id(e){I(this._cmi_element+".id",e,n.CMIIdentifier)&&(this._id=e)}get time(){if(!this.jsonString)throw new h(this._cmi_element+".time",r.WRITE_ONLY_ELEMENT);return this._time}set time(e){I(this._cmi_element+".time",e,n.CMITime)&&(this._time=e)}get type(){if(!this.jsonString)throw new h(this._cmi_element+".type",r.WRITE_ONLY_ELEMENT);return this._type}set type(e){I(this._cmi_element+".type",e,n.CMIType)&&(this._type=e)}get weighting(){if(!this.jsonString)throw new h(this._cmi_element+".weighting",r.WRITE_ONLY_ELEMENT);return this._weighting}set weighting(e){I(this._cmi_element+".weighting",e,n.CMIDecimal)&&f(this._cmi_element+".weighting",e,"-100#100")&&(this._weighting=e)}get student_response(){if(!this.jsonString)throw new h(this._cmi_element+".student_response",r.WRITE_ONLY_ELEMENT);return this._student_response}set student_response(e){I(this._cmi_element+".student_response",e,"^.{0,255}$",!0)&&(this._student_response=e)}get result(){if(!this.jsonString)throw new h(this._cmi_element+".result",r.WRITE_ONLY_ELEMENT);return this._result}set result(e){I(this._cmi_element+".result",e,n.CMIResult)&&(this._result=e)}get latency(){if(!this.jsonString)throw new h(this._cmi_element+".latency",r.WRITE_ONLY_ELEMENT);return this._latency}set latency(e){I(this._cmi_element+".latency",e,n.CMITimespan)&&(this._latency=e)}toJSON(){this.jsonString=!0;const e={id:this.id,time:this.time,type:this.type,weighting:this.weighting,student_response:this.student_response,result:this.result,latency:this.latency,objectives:this.objectives,correct_responses:this.correct_responses};return delete this.jsonString,e}}class b extends _{constructor(){super("cmi.interactions.n.objectives.n"),this._id=""}reset(){this._initialized=!1,this._id=""}get id(){return this._id}set id(e){I(this._cmi_element+".id",e,n.CMIIdentifier)&&(this._id=e)}toJSON(){this.jsonString=!0;const e={id:this.id};return delete this.jsonString,e}}class z extends _{constructor(){super("cmi.interactions.correct_responses.n"),this._pattern=""}reset(){this._initialized=!1,this._pattern=""}get pattern(){if(!this.jsonString)throw new h(this._cmi_element+".pattern",r.WRITE_ONLY_ELEMENT);return this._pattern}set pattern(e){I(this._cmi_element+".pattern",e,"^.{0,255}$",!0)&&(this._pattern=e)}toJSON(){this.jsonString=!0;const e={pattern:this._pattern};return delete this.jsonString,e}}let D=class extends d{constructor(e,t,i){super("cmi"),this.__children="",this.__version="3.4",this._launch_data="",this._comments="",this._comments_from_lms="",i&&this.initialize(),this.__children=e||s.cmi_children,this.core=new w,this.objectives=new T,this.student_data=t||new R,this.student_preference=new y,this.interactions=new A}reset(){this._initialized=!1,this._launch_data="",this._comments="",this.core?.reset(),this.objectives=new T,this.interactions=new A,this.student_data?.reset(),this.student_preference?.reset()}initialize(){super.initialize(),this.core?.initialize(),this.objectives?.initialize(),this.student_data?.initialize(),this.student_preference?.initialize(),this.interactions?.initialize()}toJSON(){this.jsonString=!0;const e={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,interactions:this.interactions};return delete this.jsonString,e}get _version(){return this.__version}set _version(e){throw new h(this._cmi_element+"._version",r.INVALID_SET_VALUE)}get _children(){return this.__children}set _children(e){throw new h(this._cmi_element+"._children",r.INVALID_SET_VALUE)}get suspend_data(){return this.core?.suspend_data}set suspend_data(e){this.core&&(this.core.suspend_data=e)}get launch_data(){return this._launch_data}set launch_data(e){if(this.initialized)throw new h(this._cmi_element+".launch_data",r.READ_ONLY_ELEMENT);this._launch_data=e}get comments(){return this._comments}set comments(e){I(this._cmi_element+".comments",e,"^.{0,4096}$",!0)&&(this._comments=e)}get comments_from_lms(){return this._comments_from_lms}set comments_from_lms(e){if(this.initialized)throw new h(this._cmi_element+".comments_from_lms",r.READ_ONLY_ELEMENT);this._comments_from_lms=e}getCurrentTotalTime(){return this.core.getCurrentTotalTime(this.start_time)}};class j extends _{constructor(){super("cmi.nav"),this._event=""}reset(){this._event="",this._initialized=!1}get event(){return this._event}set event(e){(""===e||I(this._cmi_element+".event",e,n.NAVEvent))&&(this._event=e)}toJSON(){this.jsonString=!0;const e={event:this.event};return delete this.jsonString,e}}const V={DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},F={autocommit:!1,autocommitSeconds:10,asyncCommit:!1,sendFullCommit:!0,lmsCommitUrl:!1,dataCommitFormat:"json",commitRequestDataType:"application/json;charset=UTF-8",autoProgress:!1,logLevel:V.ERROR,selfReportSessionTime:!1,alwaysSendTotalTime:!1,renderCommonCommitFields:!1,strict_errors:!0,xhrHeaders:{},xhrWithCredentials:!1,fetchMode:"cors",responseHandler:async function(s){if(void 0!==s){let i=null;try{if("function"==typeof s.json)i=await s.json();else if("function"==typeof s.text){const e=await s.text();e&&(i=JSON.parse(e))}}catch(e){}return null!==i&&{}.hasOwnProperty.call(i,"result")?{result:i.result,errorCode:i.errorCode?i.errorCode:i.result===e?0:101}:200===s.status?{result:e,errorCode:0}:{result:t,errorCode:101}}return{result:t,errorCode:101}},requestHandler:function(e){return e},onLogMessage:U,scoItemIds:[],scoItemIdValidator:!1,globalObjectiveIds:[]};function U(e,t){switch(e){case"4":case 4:case"ERROR":case V.ERROR:console.error(t);break;case"3":case 3:case"WARN":case V.WARN:console.warn(t);break;case"2":case 2:case"INFO":case V.INFO:console.info(t);break;case"1":case 1:case"DEBUG":case V.DEBUG:console.debug?console.debug(t):console.log(t)}}class ${constructor(e,t,s){this._cancelled=!1,this._API=e,this._timeout=setTimeout(this.wrapper.bind(this),t),this._callback=s}cancel(){this._cancelled=!0,this._timeout&&clearTimeout(this._timeout)}wrapper(){this._cancelled||(async()=>{await this._API.commit(this._callback)})()}}class G{constructor(e,t){this.settings=e,this.error_codes=t}async processHttpRequest(s,i){let r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;const o={result:t,errorCode:this.error_codes.GENERAL};return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?(this.performFetch(s,i).then((async e=>{await this.transformResponse(e,n)})),{result:e,errorCode:0}):await(async(e,t,s)=>{try{t=s.requestHandler(t);const i=await this.performFetch(e,t);return this.transformResponse(i,n)}catch(e){return r("processHttpRequest",e,V.ERROR),n("CommitError"),o}})(s,i,this.settings)}async performFetch(e,t){return fetch(e,{method:"POST",mode:this.settings.fetchMode,body:t instanceof Array?t.join("&"):JSON.stringify(t),headers:{...this.settings.xhrHeaders,"Content-Type":this.settings.commitRequestDataType},credentials:this.settings.xhrWithCredentials?"include":void 0,keepalive:!0})}async transformResponse(t,s){const i="function"==typeof this.settings.responseHandler?await this.settings.responseHandler(t):await t.json();return 200>t.status||t.status>299||!0!==i.result&&i.result!==e?(Object.hasOwnProperty.call(i,"errorCode")||(i.errorCode=this.error_codes.GENERAL),s("CommitError",null,i.errorCode)):(s("CommitSuccess"),Object.hasOwnProperty.call(i,"errorCode")||(i.errorCode=0)),i}updateSettings(e){this.settings=e}}class Y{constructor(e){this.listenerMap=new Map,this.listenerCount=0,this.apiLog=e}parseListenerName(e){const t=e.split(".");if(0===t.length)return null;const s=t[0];let i=null;return t.length>1&&(i=e.replace(s+".","")),{functionName:s,CMIElement:i}}on(e,t){if(!t)return;const s=e.split(" ");for(const e of s){const s=this.parseListenerName(e);if(!s)continue;const{functionName:i,CMIElement:r}=s,n=this.listenerMap.get(i)??[];n.push({functionName:i,CMIElement:r,callback:t}),this.listenerMap.set(i,n),this.listenerCount++,this.apiLog("on","Added event listener: "+this.listenerCount,V.INFO,i)}}off(e,t){if(!t)return;const s=e.split(" ");for(const e of s){const s=this.parseListenerName(e);if(!s)continue;const{functionName:i,CMIElement:r}=s,n=this.listenerMap.get(i);if(!n)continue;const o=n.findIndex((e=>e.CMIElement===r&&e.callback===t));-1!==o&&(n.splice(o,1),this.listenerCount--,0===n.length?this.listenerMap.delete(i):this.listenerMap.set(i,n),this.apiLog("off","Removed event listener: "+this.listenerCount,V.INFO,i))}}clear(e){const t=e.split(" ");for(const e of t){const t=this.parseListenerName(e);if(!t)continue;const{functionName:s,CMIElement:i}=t;if(this.listenerMap.has(s)){const e=this.listenerMap.get(s),t=e.filter((e=>e.CMIElement!==i));this.listenerCount-=e.length-t.length,0===t.length?this.listenerMap.delete(s):this.listenerMap.set(s,t)}}}processListeners(e,t,s){this.apiLog(e,s,V.INFO,t);const i=this.listenerMap.get(e);if(i)for(const r of i){const i=!!r.CMIElement;let n=!1;if(t&&r.CMIElement)if(r.CMIElement.endsWith("*")){const e=r.CMIElement.slice(0,-1);n=t.startsWith(e)}else n=r.CMIElement===t;i&&!n||(this.apiLog("processListeners","Processing listener: "+r.functionName,V.DEBUG,t),e.startsWith("Sequence")||"CommitError"===e?r.callback(s):"CommitSuccess"===e?r.callback():r.callback(t,s))}}reset(){this.listenerMap.clear(),this.listenerCount=0}}class P{loadFromFlattenedJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!i())return void console.error("loadFromFlattenedJSON can only be called before the call to lmsInitialize.");const n=/^(cmi\.interactions\.)(\d+)\.(.*)$/,o=/^(cmi\.objectives\.)(\d+)\.(.*)$/,a=[],c=[],l=[];for(const t in e)if({}.hasOwnProperty.call(e,t)){const s=t.match(n);if(s){a.push({key:t,value:e[t],index:+s[2],field:s[3]});continue}const i=t.match(o);if(i){c.push({key:t,value:e[t],index:+i[2],field:i[3]});continue}l.push({key:t,value:e[t]})}a.sort(((e,t)=>e.index!==t.index?e.index-t.index:"id"===e.field?-1:"id"===t.field?1:"type"===e.field?-1:"type"===t.field?1:e.field.localeCompare(t.field))),c.sort(((e,t)=>e.index!==t.index?e.index-t.index:"id"===e.field?-1:"id"===t.field?1:e.field.localeCompare(t.field))),l.sort(((e,t)=>e.key.localeCompare(t.key)));const h=e=>{e.forEach((e=>{const n={};n[e.key]=e.value,this.loadFromJSON(function(e){if(Object(e)!==e||Array.isArray(e))return e;const t={},s=/\.?([^.[\]]+)|\[(\d+)]/g;return Object.keys(e).filter((t=>({}.hasOwnProperty.call(e,t)))).forEach((i=>{let r=t,n="";const o=RegExp(s);Array.from({length:i.match(RegExp(s,"g"))?.length??0},(()=>o.exec(i))).forEach((e=>{e&&(r=r[n]??(r[n]=e[2]?[]:{}),n=e[2]||e[1])})),r[n]=e[i]})),t[""]??t}(n),t,s,i,r)}))};h(a),h(c),h(l)}loadFromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(i()){t=void 0!==t?t:"cmi",r(e);for(const n in e)if({}.hasOwnProperty.call(e,n)&&e[n]){const o=(t?t+".":"")+n,a=e[n];if(a.constructor===Array){for(let e=0;a.length>e;e++)if(a[e]){const t=a[e],n=`${o}.${e}`;t.constructor===Object?this.loadFromJSON(t,n,s,i,r):s(n,t)}}else a.constructor===Object?this.loadFromJSON(a,o,s,i,r):s(o,a)}}else console.error("loadFromJSON can only be called before the call to lmsInitialize.")}renderCMIToJSONString(e,t){return t?JSON.stringify({cmi:e}):JSON.stringify({cmi:e},((e,t)=>void 0===t?null:t),2)}renderCMIToJSONObject(e,t){return JSON.parse(this.renderCMIToJSONString(e,t))}getCommitObject(e,t,s,i,r,n){const o=e||t,a=s?i(o):r(o);return[V.DEBUG,"1",1,"DEBUG"].includes(n)&&(console.debug("Commit (terminated: "+(e?"yes":"no")+"): "),console.debug(a)),a}}class J{constructor(){this._logLevel=V.ERROR,this._logHandler=U}static getInstance(){return J._instance||(J._instance=new J),J._instance}setLogLevel(e){this._logLevel=e}getLogLevel(){return this._logLevel}setLogHandler(e){this._logHandler=e}log(e,t){this.shouldLog(e)&&this._logHandler(e,t)}error(e){this.log(V.ERROR,e)}warn(e){this.log(V.WARN,e)}info(e){this.log(V.INFO,e)}debug(e){this.log(V.DEBUG,e)}shouldLog(e){return this.getNumericLevel(e)>=this.getNumericLevel(this._logLevel)}getNumericLevel(e){if(void 0===e)return V.NONE;if("number"==typeof e)return e;switch(e){case"1":case"DEBUG":return V.DEBUG;case"2":case"INFO":return V.INFO;case"3":case"WARN":return V.WARN;case"4":case"ERROR":default:return V.ERROR;case"5":case"NONE":return V.NONE}}}function k(){return J.getInstance()}class H{constructor(e,t,s,i){this._lastErrorCode="0",this._errorCodes=e,this._apiLog=t,this._getLmsErrorMessageDetails=s,this._loggingService=i||k()}get lastErrorCode(){return this._lastErrorCode}set lastErrorCode(e){this._lastErrorCode=e}throwSCORMError(e,t,s){s||(s=this._getLmsErrorMessageDetails(t,!0));const i=`SCORM Error ${t}: ${s}${e?` [Element: ${e}]`:""}`;this._apiLog("throwSCORMError",t+": "+s,V.ERROR,e),this._loggingService.error(i),this._lastErrorCode=t+""}clearSCORMError(e){void 0!==e&&e!==t&&(this._lastErrorCode="0")}handleValueAccessException(e,s,i){if(s instanceof c){const r=s;this._lastErrorCode=r.errorCode+"",this._loggingService.warn(`Validation Error ${r.errorCode}: ${r.message} [Element: ${e}]`),i=t}else if(s instanceof Error){const t=s.constructor.name;this._loggingService.error(`${t}: ${s.message} [Element: ${e}]\n${s.stack||""}`),this.throwSCORMError(e,this._errorCodes.GENERAL,`${t}: ${s.message}`)}else{this._loggingService.error(`Unknown error occurred while accessing [Element: ${e}]`);try{const e=JSON.stringify(s);this._loggingService.error("Error details: "+e)}catch(e){this._loggingService.error("Could not stringify error object for details")}this.throwSCORMError(e,this._errorCodes.GENERAL,"Unknown error")}return i}get errorCodes(){return this._errorCodes}}class B{constructor(e,t,s,i,r,n,o,a){if(this._settings=F,new.target===B)throw new TypeError("Cannot construct BaseAPI instances directly");this.currentState=0,this._error_codes=e,t&&(this.settings=t),this.apiLogLevel=this.settings.logLevel,this.selfReportSessionTime=this.settings.selfReportSessionTime,void 0===this.apiLogLevel&&(this.apiLogLevel=V.NONE),this._loggingService=a||k(),this._loggingService.setLogLevel(this.apiLogLevel),this.settings.onLogMessage&&this._loggingService.setLogHandler(this.settings.onLogMessage),this._httpService=s||new G(this.settings,this._error_codes),this._eventService=i||new Y(((e,t,s,i)=>this.apiLog(e,t,s,i))),this._serializationService=r||new P,this._errorHandlingService=o||new H(this._error_codes,((e,t,s,i)=>this.apiLog(e,t,s,i)),((e,t)=>this.getLmsErrorMessageDetails(e,t)),void 0)}get lastErrorCode(){return this._errorHandlingService?.lastErrorCode??"0"}set lastErrorCode(e){this._errorHandlingService&&(this._errorHandlingService.lastErrorCode=e)}commonReset(e){this.apiLog("reset","Called",V.INFO),this.settings={...this.settings,...e},this.clearScheduledCommit(),this.currentState=0,this.lastErrorCode="0",this._eventService.reset(),this.startingData=void 0}initialize(s,i,r){let n=t;return this.isInitialized()?this.throwSCORMError("api",this._error_codes.INITIALIZED,i):this.isTerminated()?this.throwSCORMError("api",this._error_codes.TERMINATED,r):(this.selfReportSessionTime&&this.cmi.setStartTime(),this.currentState=1,this.lastErrorCode="0",n=e,this.processListeners(s)),this.apiLog(s,"returned: "+n,V.INFO),this.clearSCORMError(n),n}apiLog(e,t,s,i){t=function(e,t,s){let i=e.padEnd(20)+": ";return s&&(i+=s,i=i.padEnd(70)),i+=t??"",i}(e,t,i),this.apiLogLevel>s||this._loggingService.log(s,t)}get error_codes(){return this._error_codes}get settings(){return this._settings}set settings(e){const t=this._settings;this._settings={...this._settings,...e},this._httpService?.updateSettings(this._settings),void 0!==e.logLevel&&e.logLevel!==t.logLevel&&(this.apiLogLevel=e.logLevel,this._loggingService?.setLogLevel(e.logLevel)),void 0!==e.onLogMessage&&e.onLogMessage!==t.onLogMessage&&this._loggingService?.setLogHandler(e.onLogMessage)}async terminate(s,i){let r=t;if(this.checkState(i,this._error_codes.TERMINATION_BEFORE_INIT,this._error_codes.MULTIPLE_TERMINATION)){this.currentState=2;const n=await this.storeData(!0);(n.errorCode??0)>0&&this.throwSCORMError("api",n.errorCode),r=n?.result??t,i&&(this.lastErrorCode="0"),r=e,this.processListeners(s)}return this.apiLog(s,"returned: "+r,V.INFO),this.clearSCORMError(r),r}getValue(e,t,s){let i="";if(this.checkState(t,this._error_codes.RETRIEVE_BEFORE_INIT,this._error_codes.RETRIEVE_AFTER_TERM)){try{i=this.getCMIValue(s)}catch(e){i=this.handleValueAccessException(s,e,i)}this.processListeners(e,s)}return this.apiLog(e,": returned: "+i,V.INFO,s),void 0===i?"":("0"===this.lastErrorCode&&this.clearSCORMError(i),i)}setValue(e,s,i,r,n){void 0!==n&&(n+="");let o=t;if(this.checkState(i,this._error_codes.STORE_BEFORE_INIT,this._error_codes.STORE_AFTER_TERM)){try{o=this.setCMIValue(r,n)}catch(e){o=this.handleValueAccessException(r,e,o)}this.processListeners(e,r,n)}return void 0===o&&(o=t),this.lastErrorCode+""=="0"&&this.settings.autocommit&&this.scheduleCommit(1e3*this.settings.autocommitSeconds,s),this.apiLog(e,": "+n+": result: "+o,V.INFO,r),"0"===this.lastErrorCode&&this.clearSCORMError(o),o}async commit(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.clearScheduledCommit();let i=t;if(this.checkState(s,this._error_codes.COMMIT_BEFORE_INIT,this._error_codes.COMMIT_AFTER_TERM)){const r=await this.storeData(!1);(r.errorCode??0)>0&&this.throwSCORMError("api",r.errorCode),i=r?.result??t,this.apiLog(e," Result: "+i,V.DEBUG,"HttpRequest"),s&&(this.lastErrorCode="0"),this.processListeners(e)}return this.apiLog(e,"returned: "+i,V.INFO),"0"===this.lastErrorCode&&this.clearSCORMError(i),i}getLastError(e){const t=this.lastErrorCode+"";return this.processListeners(e),this.apiLog(e,"returned: "+t,V.INFO),t}getErrorString(e,t){let s="";return null!==t&&""!==t&&(s=this.getLmsErrorMessageDetails(t),this.processListeners(e)),this.apiLog(e,"returned: "+s,V.INFO),s}getDiagnostic(e,t){let s="";return null!==t&&""!==t&&(s=this.getLmsErrorMessageDetails(t,!0),this.processListeners(e)),this.apiLog(e,"returned: "+s,V.INFO),s}checkState(e,t,s){return this.isNotInitialized()?(this.throwSCORMError("api",t),!1):!e||!this.isTerminated()||(this.throwSCORMError("api",s),!1)}getLmsErrorMessageDetails(e){throw Error("The getLmsErrorMessageDetails method has not been implemented")}getCMIValue(e){throw Error("The getCMIValue method has not been implemented")}setCMIValue(e,t){throw Error("The setCMIValue method has not been implemented")}_commonSetCMIValue(s,i,r,n){if(!r||""===r)return t;this.lastErrorCode="0";const o=r.split(".");let a=this,c=t,l=!1;const h=`The data model element passed to ${s} (${r}) is not a valid SCORM data model element.`,_=i?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let t=0;o.length>t;t++){const s=o[t];if(t===o.length-1)if(i&&"{target="===s.substring(0,8)){if(this.isInitialized()){this.throwSCORMError(r,this._error_codes.READ_ONLY_ELEMENT);break}a={...a,attribute:n}}else{if(!this._checkObjectHasProperty(a,s)){this.throwSCORMError(r,_,h);break}if(p(r,"\\.correct_responses\\.\\d+$")&&this.isInitialized()&&"pattern"!==s&&(this.validateCorrectResponse(r,n),"0"!==this.lastErrorCode)){this.throwSCORMError(r,this._error_codes.TYPE_MISMATCH);break}i&&"0"!==this._errorHandlingService.lastErrorCode||(a[s]=n,c=e)}else{if(a=a[s],!a){this.throwSCORMError(r,_,h);break}if(a instanceof O){const e=parseInt(o[t+1],10);if(!isNaN(e)){const s=a.childArray[e];if(s)a=s,l=!0;else{const t=this.getChildElement(r,n,l);if(l=!0,!t){"0"===this.lastErrorCode&&this.throwSCORMError(r,_,h);break}a.initialized&&t.initialize(),a.childArray[e]=t,a=t}t++}}}}return c===t&&this.apiLog(s,`There was an error setting the value for: ${r}, value of: ${n}`,V.WARN),c}_commonGetCMIValue(e,t,s){if(!s||""===s)return"";const i=s.split(".");let r=this,n=null;const o=`The data model element passed to ${e} (${s}) has not been initialized.`,a=`The data model element passed to ${e} (${s}) is not a valid SCORM data model element.`,c=t?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let e=0;i.length>e;e++){if(n=i[e],t){if("{target="===(n+"").substring(0,8)&&"function"==typeof r._isTargetValid)return r._isTargetValid((n+"").substring(8,(n+"").length-9));if(!this._checkObjectHasProperty(r,n))return void this.throwSCORMError(s,c,a)}else if(e===i.length-1&&!this._checkObjectHasProperty(r,n))return void this.throwSCORMError(s,c,a);if(r=r[n],void 0===r){this.throwSCORMError(s,c,a);break}if(r instanceof O){const t=parseInt(i[e+1],10);if(!isNaN(t)){const i=r.childArray[t];if(!i){this.throwSCORMError(s,this._error_codes.VALUE_NOT_INITIALIZED,o);break}r=i,e++}}}if(null!=r)return r;t||("_children"===n?this.throwSCORMError(s,this._error_codes.CHILDREN_ERROR,void 0):"_count"===n&&this.throwSCORMError(s,this._error_codes.COUNT_ERROR,void 0))}isInitialized(){return 1===this.currentState}isNotInitialized(){return 0===this.currentState}isTerminated(){return 2===this.currentState}on(e,t){this._eventService.on(e,t)}off(e,t){this._eventService.off(e,t)}clear(e){this._eventService.clear(e)}processListeners(e,t,s){this._eventService.processListeners(e,t,s)}throwSCORMError(e,t,s){this._errorHandlingService.throwSCORMError(e,t,s)}clearSCORMError(e){this._errorHandlingService.clearSCORMError(e)}loadFromFlattenedJSON(e,t){t||(t=""),this._serializationService.loadFromFlattenedJSON(e,t,((e,t)=>this.setCMIValue(e,t)),(()=>this.isNotInitialized()),(e=>{this.startingData=e}))}loadFromJSON(e){this._serializationService.loadFromJSON(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",((e,t)=>this.setCMIValue(e,t)),(()=>this.isNotInitialized()),(e=>{this.startingData=e}))}renderCMIToJSONString(){return this._serializationService.renderCMIToJSONString(this.cmi,this.settings.sendFullCommit)}renderCMIToJSONObject(){return this._serializationService.renderCMIToJSONObject(this.cmi,this.settings.sendFullCommit)}async processHttpRequest(e,t){return this._httpService.processHttpRequest(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],((e,t,s,i)=>this.apiLog(e,t,s,i)),((e,t,s)=>this.processListeners(e,t,s)))}scheduleCommit(e,t){this._timeout||(this._timeout=new $(this,e,t),this.apiLog("scheduleCommit","scheduled",V.DEBUG,""))}clearScheduledCommit(){this._timeout&&(this._timeout.cancel(),this._timeout=void 0,this.apiLog("clearScheduledCommit","cleared",V.DEBUG,""))}_checkObjectHasProperty(e,t){return Object.hasOwnProperty.call(e,t)||null!=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t)||t in e}handleValueAccessException(e,s,i){return s instanceof c?(this.lastErrorCode=s.errorCode+"",i=t,this.throwSCORMError(e,s.errorCode,s.errorMessage)):this.throwSCORMError(e,this._error_codes.GENERAL,s instanceof Error&&s.message?s.message:"Unknown error"),i}getCommitObject(e){return this._serializationService.getCommitObject(e,this.settings.alwaysSendTotalTime,this.settings.renderCommonCommitFields,(e=>this.renderCommitObject(e)),(e=>this.renderCommitCMI(e)),this.apiLogLevel)}}class W extends B{constructor(e){e&&void 0===e.mastery_override&&(e.mastery_override=!1),super(r,e),this.statusSetByModule=!1,this.cmi=new D,this.nav=new j,this.LMSInitialize=this.lmsInitialize,this.LMSFinish=this.lmsFinish,this.LMSGetValue=this.lmsGetValue,this.LMSSetValue=this.lmsSetValue,this.LMSCommit=this.lmsCommit,this.LMSGetLastError=this.lmsGetLastError,this.LMSGetErrorString=this.lmsGetErrorString,this.LMSGetDiagnostic=this.lmsGetDiagnostic}reset(e){this.commonReset(e),this.cmi?.reset(),this.nav?.reset()}lmsInitialize(){return this.cmi.initialize(),this.cmi.core.lesson_status?this.statusSetByModule=!0:this.cmi.core.lesson_status="not attempted",this.initialize("LMSInitialize","LMS was already initialized!","LMS is already finished!")}lmsFinish(){return(async()=>{await this.internalFinish()})(),e}async internalFinish(){const t=await this.terminate("LMSFinish",!0);return t===e&&(""!==this.nav.event?this.processListeners("continue"===this.nav.event?"SequenceNext":"SequencePrevious"):this.settings.autoProgress&&this.processListeners("SequenceNext")),t}lmsGetValue(e){return this.getValue("LMSGetValue",!1,e)}lmsSetValue(e,t){return"cmi.core.lesson_status"===e&&(this.statusSetByModule=!0),this.setValue("LMSSetValue","LMSCommit",!1,e,t)}lmsCommit(){return this.settings.asyncCommit?this.scheduleCommit(500,"LMSCommit"):(async()=>{await this.commit("LMSCommit",!1)})(),e}lmsGetLastError(){return this.getLastError("LMSGetLastError")}lmsGetErrorString(e){return this.getErrorString("LMSGetErrorString",e)}lmsGetDiagnostic(e){return this.getDiagnostic("LMSGetDiagnostic",e)}setCMIValue(e,t){return this._commonSetCMIValue("LMSSetValue",!1,e,t)}getCMIValue(e){return this._commonGetCMIValue("getCMIValue",!1,e)}getChildElement(e,t,s){return p(e,"cmi\\.objectives\\.\\d+")?new v:s&&p(e,"cmi\\.interactions\\.\\d+\\.correct_responses\\.\\d+")?new z:s&&p(e,"cmi\\.interactions\\.\\d+\\.objectives\\.\\d+")?new b:!s&&p(e,"cmi\\.interactions\\.\\d+")?new x:null}validateCorrectResponse(e,t){}getLmsErrorMessageDetails(e,t){let i="No Error",r="No Error";return s.error_descriptions[e+=""]&&(i=s.error_descriptions[e].basicMessage,r=s.error_descriptions[e].detailMessage),t?r:i}replaceWithAnotherScormAPI(e){this.cmi=e.cmi}renderCommitCMI(e){const t=this.renderCMIToJSONObject();e&&(t.cmi.core.total_time=this.cmi.getCurrentTotalTime());const s=[],i=g(t);switch(this.settings.dataCommitFormat){case"flattened":return g(t);case"params":for(const e in i)({}).hasOwnProperty.call(i,e)&&s.push(`${e}=${i[e]}`);return s;default:return t}}renderCommitObject(e){const t=this.renderCommitCMI(e),s=this.cmi.getCurrentTotalTime(),i=u(s,n.CMITimespan),r=this.cmi.core.lesson_status;let o="unknown",a="unknown";r&&(o="completed"===r||"passed"===r?"completed":"incomplete","passed"===r?a="passed":"failed"===r&&(a="failed"));const c=this.cmi.core.score;let l=null;c&&(l={},Number.isNaN(Number.parseFloat(c.raw))||(l.raw=Number.parseFloat(c.raw)),Number.isNaN(Number.parseFloat(c.min))||(l.min=Number.parseFloat(c.min)),Number.isNaN(Number.parseFloat(c.max))||(l.max=Number.parseFloat(c.max)));const h={successStatus:a,completionStatus:o,runtimeData:t,totalTimeSeconds:i};return l&&(h.score=l),h}async storeData(t){if(t){const e=this.cmi.core.lesson_status;this.cmi.core.lesson_status&&(this.statusSetByModule||"not attempted"!==this.cmi.core.lesson_status)||(this.cmi.core.lesson_status="completed"),"normal"===this.cmi.core.lesson_mode?"credit"===this.cmi.core.credit&&this.settings.mastery_override&&""!==this.cmi.student_data.mastery_score&&""!==this.cmi.core.score.raw&&(this.cmi.core.lesson_status=parseFloat(this.cmi.student_data.mastery_score)>parseFloat(this.cmi.core.score.raw)?"failed":"passed"):"browse"===this.cmi.core.lesson_mode&&""===(this.startingData?.cmi?.core?.lesson_status||"")&&"not attempted"===e&&(this.cmi.core.lesson_status="browsed")}const s=this.getCommitObject(t);return"string"==typeof this.settings.lmsCommitUrl?await this.processHttpRequest(this.settings.lmsCommitUrl,s,t):{result:e,errorCode:0}}}const q=i.error_descriptions;class Z extends c{constructor(e,t){!{}.hasOwnProperty.call(q,t+"")?super(e,101,q[101].basicMessage,q[101].detailMessage):super(e,t,q[t+""].basicMessage,q[t+""].detailMessage),Object.setPrototypeOf(this,Z.prototype)}}function K(e,t,s,i){return S(e,t,s,r.TYPE_MISMATCH,Z,i)}class Q extends _{constructor(){super("cmi.evaluation"),this.comments=new X}initialize(){super.initialize(),this.comments?.initialize()}reset(){this._initialized=!1,this.comments?.reset()}toJSON(){this.jsonString=!0;const e={comments:this.comments};return delete this.jsonString,e}}class X extends O{constructor(){super({CMIElement:"cmi.evaluation.comments",children:i.comments_children,errorCode:r.INVALID_SET_VALUE,errorClass:Z})}}class ee extends _{constructor(){super("cmi.evaluation.comments.n"),this._content="",this._location="",this._time=""}reset(){this._initialized=!1,this._content="",this._location="",this._time=""}get content(){return this._content}set content(e){K(this._cmi_element+".content",e,o.CMIString256)&&(this._content=e)}get location(){return this._location}set location(e){K(this._cmi_element+".location",e,o.CMIString256)&&(this._location=e)}get time(){return this._time}set time(e){K(this._cmi_element+".time",e,o.CMITime)&&(this._time=e)}toJSON(){this.jsonString=!0;const e={content:this.content,location:this.location,time:this.time};return delete this.jsonString,e}}class te extends y{constructor(){super(i.student_preference_children),this._lesson_type="",this._text_color="",this._text_location="",this._text_size="",this._video="",this.windows=new O({CMIElement:"cmi.student_preference.windows",errorCode:r.INVALID_SET_VALUE,errorClass:Z,children:""})}initialize(){super.initialize(),this.windows?.initialize()}get lesson_type(){return this._lesson_type}set lesson_type(e){K(this._cmi_element+".lesson_type",e,o.CMIString256)&&(this._lesson_type=e)}get text_color(){return this._text_color}set text_color(e){K(this._cmi_element+".text_color",e,o.CMIString256)&&(this._text_color=e)}get text_location(){return this._text_location}set text_location(e){K(this._cmi_element+".text_location",e,o.CMIString256)&&(this._text_location=e)}get text_size(){return this._text_size}set text_size(e){K(this._cmi_element+".text_size",e,o.CMIString256)&&(this._text_size=e)}get video(){return this._video}set video(e){K(this._cmi_element+".video",e,o.CMIString256)&&(this._video=e)}toJSON(){this.jsonString=!0;const e={audio:this.audio,language:this.language,lesson_type:this.lesson_type,speed:this.speed,text:this.text,text_color:this.text_color,text_location:this.text_location,text_size:this.text_size,video:this.video,windows:this.windows};return delete this.jsonString,e}}class se extends _{constructor(){super("cmi.student_demographics"),this.__children=i.student_demographics_children,this._city="",this._class="",this._company="",this._country="",this._experience="",this._familiar_name="",this._instructor_name="",this._title="",this._native_language="",this._state="",this._street_address="",this._telephone="",this._years_experience=""}reset(){this._initialized=!1}get _children(){return this.__children}get city(){return this._city}set city(e){if(this.initialized)throw new Z("cmi.student_demographics.city",r.READ_ONLY_ELEMENT);this._city=e}get class(){return this._class}set class(e){if(this.initialized)throw new Z("cmi.student_demographics.class",r.READ_ONLY_ELEMENT);this._class=e}get company(){return this._company}set company(e){if(this.initialized)throw new Z("cmi.student_demographics.company",r.READ_ONLY_ELEMENT);this._company=e}get country(){return this._country}set country(e){if(this.initialized)throw new Z("cmi.student_demographics.country",r.READ_ONLY_ELEMENT);this._country=e}get experience(){return this._experience}set experience(e){if(this.initialized)throw new Z("cmi.student_demographics.experience",r.READ_ONLY_ELEMENT);this._experience=e}get familiar_name(){return this._familiar_name}set familiar_name(e){if(this.initialized)throw new Z("cmi.student_demographics.familiar_name",r.READ_ONLY_ELEMENT);this._familiar_name=e}get instructor_name(){return this._instructor_name}set instructor_name(e){if(this.initialized)throw new Z("cmi.student_demographics.instructor_name",r.READ_ONLY_ELEMENT);this._instructor_name=e}get title(){return this._title}set title(e){if(this.initialized)throw new Z("cmi.student_demographics.title",r.READ_ONLY_ELEMENT);this._title=e}get native_language(){return this._native_language}set native_language(e){if(this.initialized)throw new Z("cmi.student_demographics.native_language",r.READ_ONLY_ELEMENT);this._native_language=e}get state(){return this._state}set state(e){if(this.initialized)throw new Z("cmi.student_demographics.state",r.READ_ONLY_ELEMENT);this._state=e}get street_address(){return this._street_address}set street_address(e){if(this.initialized)throw new Z("cmi.student_demographics.street_address",r.READ_ONLY_ELEMENT);this._street_address=e}get telephone(){return this._telephone}set telephone(e){if(this.initialized)throw new Z("cmi.student_demographics.telephone",r.READ_ONLY_ELEMENT);this._telephone=e}get years_experience(){return this._years_experience}set years_experience(e){if(this.initialized)throw new Z("cmi.student_demographics.years_experience",r.READ_ONLY_ELEMENT);this._years_experience=e}toJSON(){this.jsonString=!0;const e={city:this.city,class:this.class,company:this.company,country:this.country,experience:this.experience,familiar_name:this.familiar_name,instructor_name:this.instructor_name,title:this.title,native_language:this.native_language,state:this.state,street_address:this.street_address,telephone:this.telephone,years_experience:this.years_experience};return delete this.jsonString,e}}class ie extends O{constructor(){super({CMIElement:"cmi.student_data.tries",children:i.tries_children})}}class re extends _{constructor(){super("cmi.student_data.tries.n"),this._status="",this._time="",this.score=new N({CMIElement:"cmi.student_data.tries.n.score",score_children:i.score_children,score_range:o.score_range,invalidErrorCode:r.INVALID_SET_VALUE,invalidTypeCode:r.TYPE_MISMATCH,invalidRangeCode:r.VALUE_OUT_OF_RANGE,errorClass:Z})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._status="",this._time="",this.score?.reset()}get status(){return this._status}set status(e){K(this._cmi_element+".status",e,o.CMIStatus2)&&(this._status=e)}get time(){return this._time}set time(e){K(this._cmi_element+".time",e,o.CMITime)&&(this._time=e)}toJSON(){this.jsonString=!0;const e={status:this.status,time:this.time,score:this.score};return delete this.jsonString,e}}class ne extends O{constructor(){super({CMIElement:"cmi.student_data.attempt_records",children:i.attempt_records_children})}}class oe extends _{constructor(){super("cmi.student_data.attempt_records.n"),this._lesson_status="",this.score=new N({CMIElement:"cmi.student_data.attempt_records.n.score",score_children:i.score_children,score_range:o.score_range,invalidErrorCode:r.INVALID_SET_VALUE,invalidTypeCode:r.TYPE_MISMATCH,invalidRangeCode:r.VALUE_OUT_OF_RANGE,errorClass:Z})}initialize(){super.initialize(),this._lesson_status="",this.score?.initialize()}reset(){this._initialized=!1,this.score?.reset()}get lesson_status(){return this._lesson_status}set lesson_status(e){K(this._cmi_element+".lesson_status",e,o.CMIStatus2)&&(this._lesson_status=e)}toJSON(){this.jsonString=!0;const e={lesson_status:this.lesson_status,score:this.score};return delete this.jsonString,e}}class ae extends R{constructor(){super(i.student_data_children),this._tries_during_lesson="",this.tries=new ie,this.attempt_records=new ne}initialize(){super.initialize(),this.tries?.initialize(),this.attempt_records?.initialize()}reset(){this._initialized=!1,this.tries?.reset(!0),this.attempt_records?.reset(!0)}get tries_during_lesson(){return this._tries_during_lesson}set tries_during_lesson(e){if(this.initialized)throw new Z("cmi.student_data.tries_during_lesson",r.READ_ONLY_ELEMENT);this._tries_during_lesson=e}toJSON(){this.jsonString=!0;const e={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action,tries:this.tries,attempt_records:this.attempt_records};return delete this.jsonString,e}}class ce extends O{constructor(){super({CMIElement:"cmi.paths",children:i.paths_children})}}class le extends _{constructor(){super("cmi.paths.n"),this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}reset(){this._initialized=!1,this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}get location_id(){return this._location_id}set location_id(e){K(this._cmi_element+".location_id",e,o.CMIString256)&&(this._location_id=e)}get date(){return this._date}set date(e){K(this._cmi_element+".date",e,o.CMIString256)&&(this._date=e)}get time(){return this._time}set time(e){K(this._cmi_element+".time",e,o.CMITime)&&(this._time=e)}get status(){return this._status}set status(e){K(this._cmi_element+".status",e,o.CMIStatus2)&&(this._status=e)}get why_left(){return this._why_left}set why_left(e){K(this._cmi_element+".why_left",e,o.CMIString256)&&(this._why_left=e)}get time_in_element(){return this._time_in_element}set time_in_element(e){K(this._cmi_element+".time_in_element",e,o.CMITime)&&(this._time_in_element=e)}toJSON(){this.jsonString=!0;const e={location_id:this.location_id,date:this.date,time:this.time,status:this.status,why_left:this.why_left,time_in_element:this.time_in_element};return delete this.jsonString,e}}class he extends D{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(i.cmi_children),e&&this.initialize(),this.student_preference=new te,this.student_data=new ae,this.student_demographics=new se,this.evaluation=new Q,this.paths=new ce}initialize(){super.initialize(),this.student_preference?.initialize(),this.student_data?.initialize(),this.student_demographics?.initialize(),this.evaluation?.initialize(),this.paths?.initialize()}toJSON(){this.jsonString=!0;const e={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,student_demographics:this.student_demographics,interactions:this.interactions,evaluation:this.evaluation,paths:this.paths};return delete this.jsonString,e}}return class extends W{constructor(e){super(e),this.cmi=new he,this.nav=new j}getChildElement(e,t,s){let i=super.getChildElement(e,t,s);return i||(p(e,"cmi\\.evaluation\\.comments\\.\\d+")?i=new ee:p(e,"cmi\\.student_data\\.tries\\.\\d+")?i=new re:p(e,"cmi\\.student_data\\.attempt_records\\.\\d+")?i=new oe:p(e,"cmi\\.paths\\.\\d+")&&(i=new le)),i}replaceWithAnotherScormAPI(e){this.cmi=e.cmi,this.nav=e.nav}}}();
//# sourceMappingURL=aicc.min.js.map
