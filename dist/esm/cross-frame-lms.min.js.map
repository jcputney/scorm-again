{"version":3,"file":"cross-frame-lms.min.js","sources":["../../src/CrossFrameLMS.ts"],"sourcesContent":["// src/CrossFrameLMS.ts\nimport { MessageData, MessageResponse } from \"./types/CrossFrame\";\nimport { IBaseAPI } from \"./interfaces/IBaseAPI\";\n\n/**\n * Server‚Äêside SCORM adapter running in your LMS frame (lms.example.com).\n * Listens for postMessage from child (content) frames, invokes real API,\n * and posts back { messageId, result, error }.\n */\nexport default class CrossFrameLMS {\n  private readonly _api: IBaseAPI;\n  private readonly _origin: string;\n\n  constructor(api: IBaseAPI, targetOrigin: string = \"*\") {\n    this._api = api;\n    this._origin = targetOrigin;\n    window.addEventListener(\"message\", this._onMessage.bind(this));\n  }\n\n  private _onMessage(ev: MessageEvent) {\n    // Validate the message origin unless all origins are allowed\n    if (this._origin !== \"*\" && ev.origin !== this._origin) {\n      return;\n    }\n\n    const msg = ev.data as MessageData;\n    if (!msg?.messageId || !msg.method || !ev.source) return;\n\n    this._process(msg, ev.source as Window);\n  }\n\n  private _process(msg: MessageData, source: Window) {\n    let result: any, error: any;\n    try {\n      const fn = (this._api as any)[msg.method];\n      if (typeof fn !== \"function\") {\n        error = {\n          message: `Method ${msg.method} not found`,\n        };\n      } else {\n        result = fn.apply(this._api, msg.params);\n      }\n    } catch (e: any) {\n      error = { message: e.message, stack: e.stack };\n    }\n    const resp: MessageResponse = {\n      messageId: msg.messageId,\n      result,\n      error,\n    };\n    source.postMessage(resp, this._origin);\n  }\n}\n"],"names":["CrossFrameLMS","constructor","api","targetOrigin","this","_api","_origin","window","addEventListener","_onMessage","bind","ev","origin","msg","data","messageId","method","source","_process","result","error","fn","message","apply","params","e","stack","postMessage"],"mappings":"AASA,MAAqBA,EAInB,WAAAC,CAAYC,EAAeC,EAAuB,KAChDC,KAAKC,KAAOH,EACZE,KAAKE,QAAUH,EACfI,OAAOC,iBAAiB,UAAWJ,KAAKK,WAAWC,KAAKN,MAAK,CAGvD,UAAAK,CAAWE,GAEjB,GAAqB,MAAjBP,KAAKE,SAAmBK,EAAGC,SAAWR,KAAKE,QAC7C,OAGF,MAAMO,EAAMF,EAAGG,KACVD,GAAKE,WAAcF,EAAIG,QAAWL,EAAGM,QAErCb,KAAAc,SAASL,EAAKF,EAAGM,OAAgB,CAGhC,QAAAC,CAASL,EAAkBI,GACjC,IAAIE,OAAaC,EACb,IACF,MAAMC,EAAMjB,KAAKC,KAAaQ,EAAIG,QAChB,mBAAPK,EACDD,EAAA,CACNE,QAAS,UAAUT,EAAIG,oBAGzBG,OAASE,EAAGE,MAAMnB,KAAKC,KAAMQ,EAAIW,cAE5BC,GACPL,EAAQ,CAAEE,QAASG,EAAEH,QAASI,MAAOD,EAAEC,MAAM,CAOxCT,EAAAU,YALuB,CAC5BZ,UAAWF,EAAIE,UACfI,cACAC,SAEuBhB,KAAKE,QAAO"}