const scorm12_constants={cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",core_children:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",score_children:"raw,min,max",comments_children:"content,location,time",objectives_children:"id,score,status",correct_responses_children:"pattern",student_data_children:"mastery_score,max_time_allowed,time_limit_action",student_preference_children:"audio,language,speed,text",interactions_children:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",error_descriptions:{101:{basicMessage:"General Exception",detailMessage:"No specific error code exists to describe the error. Use LMSGetDiagnostic for more information"},201:{basicMessage:"Invalid argument error",detailMessage:"Indicates that an argument represents an invalid data model element or is otherwise incorrect."},202:{basicMessage:"Element cannot have children",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_children" for a data model element that does not support the "_children" suffix.'},203:{basicMessage:"Element not an array - cannot have count",detailMessage:'Indicates that LMSGetValue was called with a data model element name that ends in "_count" for a data model element that does not support the "_count" suffix.'},301:{basicMessage:"Not initialized",detailMessage:"Indicates that an API call was made before the call to lmsInitialize."},401:{basicMessage:"Not implemented error",detailMessage:"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement."},402:{basicMessage:"Invalid set value, element is a keyword",detailMessage:'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in "_children" and "_count").'},403:{basicMessage:"Element is read only",detailMessage:"LMSSetValue was called with a data model element that can only be read."},404:{basicMessage:"Element is write only",detailMessage:"LMSGetValue was called on a data model element that can only be written to."},405:{basicMessage:"Incorrect Data Type",detailMessage:"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element."},407:{basicMessage:"Element Value Out Of Range",detailMessage:"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element."},408:{basicMessage:"Data Model Dependency Not Established",detailMessage:"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element."}}},aicc_constants={...scorm12_constants,cmi_children:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation",student_preference_children:"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows",student_data_children:"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action",student_demographics_children:"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience",tries_children:"time,status,score",attempt_records_children:"score,lesson_status",paths_children:"location_id,date,time,status,why_left,time_in_element"},scorm2004_constants={cmi_children:"_version,comments_from_learner,comments_from_lms,completion_status,credit,entry,exit,interactions,launch_data,learner_id,learner_name,learner_preference,location,max_time_allowed,mode,objectives,progress_measure,scaled_passing_score,score,session_time,success_status,suspend_data,time_limit_action,total_time",comments_children:"comment,timestamp,location",score_children:"max,raw,scaled,min",objectives_children:"progress_measure,completion_status,success_status,description,score,id",correct_responses_children:"pattern",student_preference_children:"audio_level,audio_captioning,delivery_speed,language",interactions_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",adl_data_children:"id,store",error_descriptions:{0:{basicMessage:"No Error",detailMessage:"No error occurred, the previous API call was successful."},101:{basicMessage:"General Exception",detailMessage:"No specific error code exists to describe the error. Use GetDiagnostic for more information."},102:{basicMessage:"General Initialization Failure",detailMessage:"Call to Initialize failed for an unknown reason."},103:{basicMessage:"Already Initialized",detailMessage:"Call to Initialize failed because Initialize was already called."},104:{basicMessage:"Content Instance Terminated",detailMessage:"Call to Initialize failed because Terminate was already called."},111:{basicMessage:"General Termination Failure",detailMessage:"Call to Terminate failed for an unknown reason."},112:{basicMessage:"Termination Before Initialization",detailMessage:"Call to Terminate failed because it was made before the call to Initialize."},113:{basicMessage:"Termination After Termination",detailMessage:"Call to Terminate failed because Terminate was already called."},122:{basicMessage:"Retrieve Data Before Initialization",detailMessage:"Call to GetValue failed because it was made before the call to Initialize."},123:{basicMessage:"Retrieve Data After Termination",detailMessage:"Call to GetValue failed because it was made after the call to Terminate."},132:{basicMessage:"Store Data Before Initialization",detailMessage:"Call to SetValue failed because it was made before the call to Initialize."},133:{basicMessage:"Store Data After Termination",detailMessage:"Call to SetValue failed because it was made after the call to Terminate."},142:{basicMessage:"Commit Before Initialization",detailMessage:"Call to Commit failed because it was made before the call to Initialize."},143:{basicMessage:"Commit After Termination",detailMessage:"Call to Commit failed because it was made after the call to Terminate."},201:{basicMessage:"General Argument Error",detailMessage:"An invalid argument was passed to an API method (usually indicates that Initialize, Commit or Terminate did not receive the expected empty string argument."},301:{basicMessage:"General Get Failure",detailMessage:"Indicates a failed GetValue call where no other specific error code is applicable. Use GetDiagnostic for more information."},351:{basicMessage:"General Set Failure",detailMessage:"Indicates a failed SetValue call where no other specific error code is applicable. Use GetDiagnostic for more information."},391:{basicMessage:"General Commit Failure",detailMessage:"Indicates a failed Commit call where no other specific error code is applicable. Use GetDiagnostic for more information."},401:{basicMessage:"Undefined Data Model Element",detailMessage:"The data model element name passed to GetValue or SetValue is not a valid SCORM data model element."},402:{basicMessage:"Unimplemented Data Model Element",detailMessage:"The data model element indicated in a call to GetValue or SetValue is valid, but was not implemented by this LMS. In SCORM 2004, this error would indicate an LMS that is not fully SCORM conformant."},403:{basicMessage:"Data Model Element Value Not Initialized",detailMessage:"Attempt to read a data model element that has not been initialized by the LMS or through a SetValue call. This error condition is often reached during normal execution of a SCO."},404:{basicMessage:"Data Model Element Is Read Only",detailMessage:"SetValue was called with a data model element that can only be read."},405:{basicMessage:"Data Model Element Is Write Only",detailMessage:"GetValue was called on a data model element that can only be written to."},406:{basicMessage:"Data Model Element Type Mismatch",detailMessage:"SetValue was called with a value that is not consistent with the data format of the supplied data model element."},407:{basicMessage:"Data Model Element Value Out Of Range",detailMessage:"The numeric value supplied to a SetValue call is outside of the numeric range allowed for the supplied data model element."},408:{basicMessage:"Data Model Dependency Not Established",detailMessage:"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element."}}},global_errors={GENERAL:101,INITIALIZATION_FAILED:101,INITIALIZED:101,TERMINATED:101,TERMINATION_FAILURE:101,TERMINATION_BEFORE_INIT:101,MULTIPLE_TERMINATION:101,RETRIEVE_BEFORE_INIT:101,RETRIEVE_AFTER_TERM:101,STORE_BEFORE_INIT:101,STORE_AFTER_TERM:101,COMMIT_BEFORE_INIT:101,COMMIT_AFTER_TERM:101,ARGUMENT_ERROR:101,CHILDREN_ERROR:101,COUNT_ERROR:101,GENERAL_GET_FAILURE:101,GENERAL_SET_FAILURE:101,GENERAL_COMMIT_FAILURE:101,UNDEFINED_DATA_MODEL:101,UNIMPLEMENTED_ELEMENT:101,VALUE_NOT_INITIALIZED:101,INVALID_SET_VALUE:101,READ_ONLY_ELEMENT:101,WRITE_ONLY_ELEMENT:101,TYPE_MISMATCH:101,VALUE_OUT_OF_RANGE:101,DEPENDENCY_NOT_ESTABLISHED:101},scorm12_errors$1={...global_errors,RETRIEVE_BEFORE_INIT:301,STORE_BEFORE_INIT:301,COMMIT_BEFORE_INIT:301,ARGUMENT_ERROR:201,CHILDREN_ERROR:202,COUNT_ERROR:203,UNDEFINED_DATA_MODEL:401,UNIMPLEMENTED_ELEMENT:401,VALUE_NOT_INITIALIZED:301,INVALID_SET_VALUE:402,READ_ONLY_ELEMENT:403,WRITE_ONLY_ELEMENT:404,TYPE_MISMATCH:405,VALUE_OUT_OF_RANGE:407,DEPENDENCY_NOT_ESTABLISHED:408},scorm2004_errors$1={...global_errors,INITIALIZATION_FAILED:102,INITIALIZED:103,TERMINATED:104,TERMINATION_FAILURE:111,TERMINATION_BEFORE_INIT:112,MULTIPLE_TERMINATIONS:113,RETRIEVE_BEFORE_INIT:122,RETRIEVE_AFTER_TERM:123,STORE_BEFORE_INIT:132,STORE_AFTER_TERM:133,COMMIT_BEFORE_INIT:142,COMMIT_AFTER_TERM:143,ARGUMENT_ERROR:201,GENERAL_GET_FAILURE:301,GENERAL_SET_FAILURE:351,GENERAL_COMMIT_FAILURE:391,UNDEFINED_DATA_MODEL:401,UNIMPLEMENTED_ELEMENT:402,VALUE_NOT_INITIALIZED:403,READ_ONLY_ELEMENT:404,WRITE_ONLY_ELEMENT:405,TYPE_MISMATCH:406,VALUE_OUT_OF_RANGE:407,DEPENDENCY_NOT_ESTABLISHED:408},scorm12_regex={CMIString256:"^.{0,255}$",CMIString4096:"^.{0,4096}$",CMITime:"^(?:[01]\\d|2[0123]):(?:[012345]\\d):(?:[012345]\\d)$",CMITimespan:"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",CMIInteger:"^\\d+$",CMISInteger:"^-?([0-9]+)$",CMIDecimal:"^-?([0-9]{0,3})(.[0-9]*)?$",CMIIdentifier:"^[\\u0021-\\u007E\\s]{0,255}$",CMIFeedback:"^.{0,255}$",CMIIndex:"[._](\\d+).",CMIStatus:"^(passed|completed|failed|incomplete|browsed)$",CMIStatus2:"^(passed|completed|failed|incomplete|browsed|not attempted)$",CMIExit:"^(time-out|suspend|logout|)$",CMIType:"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$",CMIResult:"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\.[0-9]*)?)$",NAVEvent:"^(previous|continue)$",score_range:"0#100",audio_range:"-1#100",speed_range:"-100#100",weighting_range:"-100#100",text_range:"-1#1"},aicc_regex={...scorm12_regex,CMIIdentifier:"^\\w{1,255}$"},scorm2004_regex_CMILangString250="^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,250}$)?$",scorm2004_regex_CMILangString4000="^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,4000}$)?$",scorm2004_regex_CMITime="^(19[7-9]{1}[0-9]{1}|20[0-2]{1}[0-9]{1}|203[0-8]{1})((-(0[1-9]{1}|1[0-2]{1}))((-(0[1-9]{1}|[1-2]{1}[0-9]{1}|3[0-1]{1}))(T([0-1]{1}[0-9]{1}|2[0-3]{1})((:[0-5]{1}[0-9]{1})((:[0-5]{1}[0-9]{1})((\\.[0-9]{1,6})((Z|([+|-]([0-1]{1}[0-9]{1}|2[0-3]{1})))(:[0-5]{1}[0-9]{1})?)?)?)?)?)?)?)?$",scorm2004_regex_CMITimespan="^P(?:([.,\\d]+)Y)?(?:([.,\\d]+)M)?(?:([.,\\d]+)W)?(?:([.,\\d]+)D)?(?:T?(?:([.,\\d]+)H)?(?:([.,\\d]+)M)?(?:([.,\\d]+)S)?)?$",scorm2004_regex_CMIDecimal="^-?([0-9]{1,5})(\\.[0-9]{1,18})?$",scorm2004_regex_CMILongIdentifier="^(?:(?!urn:)\\S{1,4000}|urn:[A-Za-z0-9-]{1,31}:\\S{1,4000}|.{1,4000})$",scorm2004_regex_NAVEvent="^(previous|continue|exit|exitAll|abandon|abandonAll|suspendAll|_none_|(\\{target=(?<choice_target>\\S{0,}[a-zA-Z0-9-_]+)})?choice|(\\{target=(?<jump_target>\\S{0,}[a-zA-Z0-9-_]+)})?jump)$";class BaseScormValidationError extends Error{constructor(CMIElement,errorCode){super(`${CMIElement} : ${""+errorCode}`),this._errorCode=errorCode,Object.setPrototypeOf(this,BaseScormValidationError.prototype)}get errorCode(){return this._errorCode}}class ValidationError extends BaseScormValidationError{constructor(CMIElement,errorCode,errorMessage,detailedMessage){super(CMIElement,errorCode),this._detailedMessage="",this.message=`${CMIElement} : ${errorMessage}`,this._errorMessage=errorMessage,detailedMessage&&(this._detailedMessage=detailedMessage),Object.setPrototypeOf(this,ValidationError.prototype)}get errorMessage(){return this._errorMessage}get detailedMessage(){return this._detailedMessage}}const scorm12_errors=scorm12_constants.error_descriptions;class Scorm12ValidationError extends ValidationError{constructor(CMIElement,errorCode){!{}.hasOwnProperty.call(scorm12_errors,errorCode+"")?super(CMIElement,101,scorm12_errors[101].basicMessage,scorm12_errors[101].detailMessage):super(CMIElement,errorCode,scorm12_errors[errorCode+""].basicMessage,scorm12_errors[errorCode+""].detailMessage),Object.setPrototypeOf(this,Scorm12ValidationError.prototype)}}class BaseCMI{constructor(cmi_element){this.jsonString=!1,this._initialized=!1,this._cmi_element=cmi_element}get initialized(){return this._initialized}get start_time(){return this._start_time}initialize(){this._initialized=!0}setStartTime(){this._start_time=(new Date).getTime()}}class BaseRootCMI extends BaseCMI{}const designations={D:86400,H:3600,M:60,S:1},getSecondsAsHHMMSS=memoize((totalSeconds=>{if(!totalSeconds||0>=totalSeconds)return"00:00:00";const hours=Math.floor(totalSeconds/3600),dateObj=new Date(1e3*totalSeconds),minutes=dateObj.getUTCMinutes(),seconds=dateObj.getSeconds(),ms=totalSeconds%1;let msStr="";return countDecimals(ms)>0&&(msStr=countDecimals(ms)>2?ms.toFixed(2):ms+"",msStr="."+msStr.split(".")[1]),(hours+":"+minutes+":"+seconds).replace(/\b\d\b/g,"0$&")+msStr})),getSecondsAsISODuration=memoize((seconds=>{if(!seconds||0>=seconds)return"PT0S";let duration="P",remainder=seconds;return Object.entries(designations).forEach((([designationsKey,current_seconds])=>{let value=Math.floor(remainder/current_seconds);remainder%=current_seconds,countDecimals(remainder)>2&&(remainder=+(+remainder).toFixed(2)),"S"===designationsKey&&remainder>0&&(value+=remainder),value&&((duration.indexOf("D")>0||["H","M","S"].includes(designationsKey))&&-1===duration.indexOf("T")&&(duration+="T"),duration+=`${value}${designationsKey}`)})),duration})),getTimeAsSeconds=memoize(((timeString,timeRegex)=>{if("number"!=typeof timeString&&"boolean"!=typeof timeString||(timeString+=""),"string"==typeof timeRegex&&(timeRegex=RegExp(timeRegex)),!timeString||!timeString?.match?.(timeRegex))return 0;const parts=timeString.split(":");return 3600*+parts[0]+60*+parts[1]+ +parts[2]}),((timeString,timeRegex)=>`${"string"==typeof timeString?timeString:(timeString??"")+""}:${"string"==typeof timeRegex?timeRegex:timeRegex?.toString()??""}`)),getDurationAsSeconds=memoize(((duration,durationRegex)=>{if("string"==typeof durationRegex&&(durationRegex=RegExp(durationRegex)),!duration||!duration?.match?.(durationRegex))return 0;const[,years,_,,days,hours,minutes,seconds]=RegExp(durationRegex).exec?.(duration)??[];let result=0;return result+=+seconds||0,result+=60*+minutes||0,result+=3600*+hours||0,result+=86400*+days||0,result+=31536e3*+years||0,result}),((duration,durationRegex)=>`${duration??""}:${"string"==typeof durationRegex?durationRegex:durationRegex?.toString()??""}`));function flatten(data){const result={};return function recurse(cur,prop){if(Object(cur)!==cur)result[prop]=cur;else if(Array.isArray(cur))cur.forEach(((item,i)=>{recurse(item,`${prop}[${i}]`)})),0===cur.length&&(result[prop]=[]);else{const keys=Object.keys(cur).filter((p=>({}.hasOwnProperty.call(cur,p)))),isEmpty=0===keys.length;keys.forEach((p=>{recurse(cur[p],prop?`${prop}.${p}`:p)})),isEmpty&&prop&&(result[prop]={})}}(data,""),result}function countDecimals(num){if(Math.floor(num)===num||0>(num+"")?.indexOf?.("."))return 0;const parts=(""+num).split(".")?.[1];return parts?.length??0}function stringMatches(str,tester){return null!==str?.match(tester)}function memoize(fn,keyFn){const cache=new Map;return(...args)=>{const key=keyFn?keyFn(...args):JSON.stringify(args);return cache.has(key)?cache.get(key):(()=>{const result=fn(...args);return cache.set(key,result),result})()}}const checkValidFormat=memoize(((CMIElement,value,regexPattern,errorCode,errorClass,allowEmptyString)=>{if("string"!=typeof value)return!1;const formatRegex=RegExp(regexPattern),matches=value.match(formatRegex);if(allowEmptyString&&""===value)return!0;if(void 0===value||!matches||""===matches[0])throw new errorClass(CMIElement,errorCode);return!0}),((CMIElement,value,regexPattern,errorCode,_errorClass,allowEmptyString)=>`${CMIElement}:${"string"==typeof value?value:`[${typeof value}]`}:${regexPattern}:${errorCode}:${allowEmptyString||!1}`)),checkValidRange=memoize(((CMIElement,value,rangePattern,errorCode,errorClass)=>{const ranges=rangePattern.split("#");if(ranges[0]>(value*=1))throw new errorClass(CMIElement,errorCode);if("*"!==ranges[1]&&value>ranges[1])throw new errorClass(CMIElement,errorCode);return!0}),((CMIElement,value,rangePattern,errorCode,_errorClass)=>`${CMIElement}:${value}:${rangePattern}:${errorCode}`));function check12ValidFormat(CMIElement,value,regexPattern,allowEmptyString){return checkValidFormat(CMIElement,value,regexPattern,scorm12_errors$1.TYPE_MISMATCH,Scorm12ValidationError,allowEmptyString)}function check12ValidRange(CMIElement,value,rangePattern,allowEmptyString){if(""===value)throw new Scorm12ValidationError(CMIElement,scorm12_errors$1.VALUE_OUT_OF_RANGE);return checkValidRange(CMIElement,value,rangePattern,scorm12_errors$1.VALUE_OUT_OF_RANGE,Scorm12ValidationError)}const validationService=new class{validateScore(CMIElement,value,decimalRegex,scoreRange,invalidTypeCode,invalidRangeCode,errorClass){return checkValidFormat(CMIElement,value,decimalRegex,invalidTypeCode,errorClass)&&(!scoreRange||checkValidRange(CMIElement,value,scoreRange,invalidRangeCode,errorClass))}validateScorm12Audio(CMIElement,value){return check12ValidFormat(CMIElement,value,"^-?([0-9]+)$")&&check12ValidRange(CMIElement,value,"-1#100")}validateScorm12Language(CMIElement,value){return check12ValidFormat(CMIElement,value,"^.{0,255}$")}validateScorm12Speed(CMIElement,value){return check12ValidFormat(CMIElement,value,"^-?([0-9]+)$")&&check12ValidRange(CMIElement,value,"-100#100")}validateScorm12Text(CMIElement,value){return check12ValidFormat(CMIElement,value,"^-?([0-9]+)$")&&check12ValidRange(CMIElement,value,"-1#1")}validateReadOnly(CMIElement,initialized){if(initialized)throw new Scorm12ValidationError(CMIElement,scorm12_errors$1.READ_ONLY_ELEMENT)}};class CMIScore extends BaseCMI{constructor(params){super(params.CMIElement),this._raw="",this._min="",this.__children=params.score_children||scorm12_constants.score_children,this.__score_range=!!params.score_range&&"0#100",this._max=params.max||""===params.max?params.max:"100",this.__invalid_error_code=params.invalidErrorCode||scorm12_errors$1.INVALID_SET_VALUE,this.__invalid_type_code=params.invalidTypeCode||scorm12_errors$1.TYPE_MISMATCH,this.__invalid_range_code=params.invalidRangeCode||scorm12_errors$1.VALUE_OUT_OF_RANGE,this.__decimal_regex=params.decimalRegex||scorm12_regex.CMIDecimal,this.__error_class=params.errorClass}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new this.__error_class(this._cmi_element+"._children",this.__invalid_error_code)}get raw(){return this._raw}set raw(raw){validationService.validateScore(this._cmi_element+".raw",raw,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._raw=raw)}get min(){return this._min}set min(min){validationService.validateScore(this._cmi_element+".min",min,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._min=min)}get max(){return this._max}set max(max){validationService.validateScore(this._cmi_element+".max",max,this.__decimal_regex,this.__score_range,this.__invalid_type_code,this.__invalid_range_code,this.__error_class)&&(this._max=max)}toJSON(){this.jsonString=!0;const result={raw:this.raw,min:this.min,max:this.max};return delete this.jsonString,result}}class CMICore extends BaseCMI{constructor(){super("cmi.core"),this.__children=scorm12_constants.core_children,this._student_id="",this._student_name="",this._lesson_location="",this._credit="",this._lesson_status="not attempted",this._entry="",this._total_time="",this._lesson_mode="normal",this._exit="",this._session_time="00:00:00",this._suspend_data="",this.score=new CMIScore({CMIElement:"cmi.core.score",score_children:scorm12_constants.score_children,score_range:"0#100",invalidErrorCode:scorm12_errors$1.INVALID_SET_VALUE,invalidTypeCode:scorm12_errors$1.TYPE_MISMATCH,invalidRangeCode:scorm12_errors$1.VALUE_OUT_OF_RANGE,errorClass:Scorm12ValidationError})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._exit="",this._entry="",this._session_time="00:00:00",this.score?.reset()}get _children(){return this.__children}set _children(_children){throw new Scorm12ValidationError(this._cmi_element+"._children",scorm12_errors$1.INVALID_SET_VALUE)}get student_id(){return this._student_id}set student_id(student_id){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".student_id",scorm12_errors$1.READ_ONLY_ELEMENT);this._student_id=student_id}get student_name(){return this._student_name}set student_name(student_name){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".student_name",scorm12_errors$1.READ_ONLY_ELEMENT);this._student_name=student_name}get lesson_location(){return this._lesson_location}set lesson_location(lesson_location){check12ValidFormat(this._cmi_element+".lesson_location",lesson_location,"^.{0,255}$",!0)&&(this._lesson_location=lesson_location)}get credit(){return this._credit}set credit(credit){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".credit",scorm12_errors$1.READ_ONLY_ELEMENT);this._credit=credit}get lesson_status(){return this._lesson_status}set lesson_status(lesson_status){this.initialized?check12ValidFormat(this._cmi_element+".lesson_status",lesson_status,scorm12_regex.CMIStatus)&&(this._lesson_status=lesson_status):check12ValidFormat(this._cmi_element+".lesson_status",lesson_status,scorm12_regex.CMIStatus2)&&(this._lesson_status=lesson_status)}get entry(){return this._entry}set entry(entry){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".entry",scorm12_errors$1.READ_ONLY_ELEMENT);this._entry=entry}get total_time(){return this._total_time}set total_time(total_time){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".total_time",scorm12_errors$1.READ_ONLY_ELEMENT);this._total_time=total_time}get lesson_mode(){return this._lesson_mode}set lesson_mode(lesson_mode){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".lesson_mode",scorm12_errors$1.READ_ONLY_ELEMENT);this._lesson_mode=lesson_mode}get exit(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".exit",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._exit}set exit(exit){check12ValidFormat(this._cmi_element+".exit",exit,scorm12_regex.CMIExit,!0)&&(this._exit=exit)}get session_time(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".session_time",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._session_time}set session_time(session_time){check12ValidFormat(this._cmi_element+".session_time",session_time,scorm12_regex.CMITimespan)&&(this._session_time=session_time)}get suspend_data(){return this._suspend_data}set suspend_data(suspend_data){check12ValidFormat(this._cmi_element+".suspend_data",suspend_data,"^.{0,4096}$",!0)&&(this._suspend_data=suspend_data)}getCurrentTotalTime(start_time){let sessionTime=this._session_time;const startTime=start_time;if(null!=startTime){const seconds=(new Date).getTime()-startTime;sessionTime=getSecondsAsHHMMSS(seconds/1e3)}return first=this._total_time,second=sessionTime,"string"==typeof(timeRegex=RegExp(scorm12_regex.CMITimespan))&&(timeRegex=RegExp(timeRegex)),getSecondsAsHHMMSS(getTimeAsSeconds(first,timeRegex)+getTimeAsSeconds(second,timeRegex));var first,second,timeRegex}toJSON(){this.jsonString=!0;const result={student_id:this.student_id,student_name:this.student_name,lesson_location:this.lesson_location,credit:this.credit,lesson_status:this.lesson_status,entry:this.entry,lesson_mode:this.lesson_mode,exit:this.exit,session_time:this.session_time,score:this.score};return delete this.jsonString,result}}class CMIArray extends BaseCMI{constructor(params){super(params.CMIElement),this.__children=params.children,this._errorCode=params.errorCode||scorm12_errors$1.GENERAL,this._errorClass=params.errorClass||BaseScormValidationError,this.childArray=[]}reset(wipe=!1){if(this._initialized=!1,wipe)this.childArray=[];else for(let i=0;this.childArray.length>i;i++)this.childArray[i].reset()}get _children(){return this.__children}set _children(_children){throw new this._errorClass(this._cmi_element+"._children",this._errorCode)}get _count(){return this.childArray.length}set _count(_count){throw new this._errorClass(this._cmi_element+"._count",this._errorCode)}toJSON(){this.jsonString=!0;const result={};for(let i=0;this.childArray.length>i;i++)result[i+""]=this.childArray[i];return delete this.jsonString,result}}let CMIObjectives$1=class extends CMIArray{constructor(){super({CMIElement:"cmi.objectives",children:scorm12_constants.objectives_children,errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:Scorm12ValidationError})}},CMIObjectivesObject$1=class extends BaseCMI{constructor(){super("cmi.objectives.n"),this._id="",this._status="",this.score=new CMIScore({CMIElement:"cmi.objectives.n.score",score_children:scorm12_constants.score_children,score_range:"0#100",invalidErrorCode:scorm12_errors$1.INVALID_SET_VALUE,invalidTypeCode:scorm12_errors$1.TYPE_MISMATCH,invalidRangeCode:scorm12_errors$1.VALUE_OUT_OF_RANGE,errorClass:Scorm12ValidationError})}reset(){this._initialized=!1,this._id="",this._status="",this.score?.reset()}get id(){return this._id}set id(id){check12ValidFormat(this._cmi_element+".id",id,scorm12_regex.CMIIdentifier)&&(this._id=id)}get status(){return this._status}set status(status){check12ValidFormat(this._cmi_element+".status",status,scorm12_regex.CMIStatus2)&&(this._status=status)}toJSON(){this.jsonString=!0;const result={id:this.id,status:this.status,score:this.score};return delete this.jsonString,result}};class CMIStudentData extends BaseCMI{constructor(student_data_children){super("cmi.student_data"),this._mastery_score="",this._max_time_allowed="",this._time_limit_action="",this.__children=student_data_children||scorm12_constants.student_data_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new Scorm12ValidationError(this._cmi_element+"._children",scorm12_errors$1.INVALID_SET_VALUE)}get mastery_score(){return this._mastery_score}set mastery_score(mastery_score){validationService.validateReadOnly(this._cmi_element+".mastery_score",this.initialized),this._mastery_score=mastery_score}get max_time_allowed(){return this._max_time_allowed}set max_time_allowed(max_time_allowed){validationService.validateReadOnly(this._cmi_element+".max_time_allowed",this.initialized),this._max_time_allowed=max_time_allowed}get time_limit_action(){return this._time_limit_action}set time_limit_action(time_limit_action){validationService.validateReadOnly(this._cmi_element+".time_limit_action",this.initialized),this._time_limit_action=time_limit_action}toJSON(){this.jsonString=!0;const result={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action};return delete this.jsonString,result}}class CMIStudentPreference extends BaseCMI{constructor(student_preference_children){super("cmi.student_preference"),this._audio="",this._language="",this._speed="",this._text="",this.__children=student_preference_children||scorm12_constants.student_preference_children}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new Scorm12ValidationError(this._cmi_element+"._children",scorm12_errors$1.INVALID_SET_VALUE)}get audio(){return this._audio}set audio(audio){validationService.validateScorm12Audio(this._cmi_element+".audio",audio)&&(this._audio=audio)}get language(){return this._language}set language(language){validationService.validateScorm12Language(this._cmi_element+".language",language)&&(this._language=language)}get speed(){return this._speed}set speed(speed){validationService.validateScorm12Speed(this._cmi_element+".speed",speed)&&(this._speed=speed)}get text(){return this._text}set text(text){validationService.validateScorm12Text(this._cmi_element+".text",text)&&(this._text=text)}toJSON(){this.jsonString=!0;const result={audio:this.audio,language:this.language,speed:this.speed,text:this.text};return delete this.jsonString,result}}let CMIInteractions$1=class extends CMIArray{constructor(){super({CMIElement:"cmi.interactions",children:scorm12_constants.interactions_children,errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:Scorm12ValidationError})}},CMIInteractionsObject$1=class extends BaseCMI{constructor(){super("cmi.interactions.n"),this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives=new CMIArray({CMIElement:"cmi.interactions.n.objectives",errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:Scorm12ValidationError,children:scorm12_constants.objectives_children}),this.correct_responses=new CMIArray({CMIElement:"cmi.interactions.correct_responses",errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:Scorm12ValidationError,children:scorm12_constants.correct_responses_children})}initialize(){super.initialize(),this.objectives?.initialize(),this.correct_responses?.initialize()}reset(){this._initialized=!1,this._id="",this._time="",this._type="",this._weighting="",this._student_response="",this._result="",this._latency="",this.objectives?.reset(),this.correct_responses?.reset()}get id(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".id",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._id}set id(id){check12ValidFormat(this._cmi_element+".id",id,scorm12_regex.CMIIdentifier)&&(this._id=id)}get time(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".time",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._time}set time(time){check12ValidFormat(this._cmi_element+".time",time,scorm12_regex.CMITime)&&(this._time=time)}get type(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".type",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._type}set type(type){check12ValidFormat(this._cmi_element+".type",type,scorm12_regex.CMIType)&&(this._type=type)}get weighting(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".weighting",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._weighting}set weighting(weighting){check12ValidFormat(this._cmi_element+".weighting",weighting,scorm12_regex.CMIDecimal)&&check12ValidRange(this._cmi_element+".weighting",weighting,"-100#100")&&(this._weighting=weighting)}get student_response(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".student_response",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._student_response}set student_response(student_response){check12ValidFormat(this._cmi_element+".student_response",student_response,"^.{0,255}$",!0)&&(this._student_response=student_response)}get result(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".result",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._result}set result(result){check12ValidFormat(this._cmi_element+".result",result,scorm12_regex.CMIResult)&&(this._result=result)}get latency(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".latency",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._latency}set latency(latency){check12ValidFormat(this._cmi_element+".latency",latency,scorm12_regex.CMITimespan)&&(this._latency=latency)}toJSON(){this.jsonString=!0;const result={id:this.id,time:this.time,type:this.type,weighting:this.weighting,student_response:this.student_response,result:this.result,latency:this.latency,objectives:this.objectives,correct_responses:this.correct_responses};return delete this.jsonString,result}},CMIInteractionsObjectivesObject$1=class extends BaseCMI{constructor(){super("cmi.interactions.n.objectives.n"),this._id=""}reset(){this._initialized=!1,this._id=""}get id(){return this._id}set id(id){check12ValidFormat(this._cmi_element+".id",id,scorm12_regex.CMIIdentifier)&&(this._id=id)}toJSON(){this.jsonString=!0;const result={id:this.id};return delete this.jsonString,result}},CMIInteractionsCorrectResponsesObject$1=class extends BaseCMI{constructor(){super("cmi.interactions.correct_responses.n"),this._pattern=""}reset(){this._initialized=!1,this._pattern=""}get pattern(){if(!this.jsonString)throw new Scorm12ValidationError(this._cmi_element+".pattern",scorm12_errors$1.WRITE_ONLY_ELEMENT);return this._pattern}set pattern(pattern){check12ValidFormat(this._cmi_element+".pattern",pattern,"^.{0,255}$",!0)&&(this._pattern=pattern)}toJSON(){this.jsonString=!0;const result={pattern:this._pattern};return delete this.jsonString,result}},CMI$2=class extends BaseRootCMI{constructor(cmi_children,student_data,initialized){super("cmi"),this.__children="",this.__version="3.4",this._launch_data="",this._comments="",this._comments_from_lms="",initialized&&this.initialize(),this.__children=cmi_children||scorm12_constants.cmi_children,this.core=new CMICore,this.objectives=new CMIObjectives$1,this.student_data=student_data||new CMIStudentData,this.student_preference=new CMIStudentPreference,this.interactions=new CMIInteractions$1}reset(){this._initialized=!1,this._launch_data="",this._comments="",this.core?.reset(),this.objectives=new CMIObjectives$1,this.interactions=new CMIInteractions$1,this.student_data?.reset(),this.student_preference?.reset()}initialize(){super.initialize(),this.core?.initialize(),this.objectives?.initialize(),this.student_data?.initialize(),this.student_preference?.initialize(),this.interactions?.initialize()}toJSON(){this.jsonString=!0;const result={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,interactions:this.interactions};return delete this.jsonString,result}get _version(){return this.__version}set _version(_version){throw new Scorm12ValidationError(this._cmi_element+"._version",scorm12_errors$1.INVALID_SET_VALUE)}get _children(){return this.__children}set _children(_children){throw new Scorm12ValidationError(this._cmi_element+"._children",scorm12_errors$1.INVALID_SET_VALUE)}get suspend_data(){return this.core?.suspend_data}set suspend_data(suspend_data){this.core&&(this.core.suspend_data=suspend_data)}get launch_data(){return this._launch_data}set launch_data(launch_data){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".launch_data",scorm12_errors$1.READ_ONLY_ELEMENT);this._launch_data=launch_data}get comments(){return this._comments}set comments(comments){check12ValidFormat(this._cmi_element+".comments",comments,"^.{0,4096}$",!0)&&(this._comments=comments)}get comments_from_lms(){return this._comments_from_lms}set comments_from_lms(comments_from_lms){if(this.initialized)throw new Scorm12ValidationError(this._cmi_element+".comments_from_lms",scorm12_errors$1.READ_ONLY_ELEMENT);this._comments_from_lms=comments_from_lms}getCurrentTotalTime(){return this.core.getCurrentTotalTime(this.start_time)}};class NAV extends BaseCMI{constructor(){super("cmi.nav"),this._event=""}reset(){this._event="",this._initialized=!1}get event(){return this._event}set event(event){(""===event||check12ValidFormat(this._cmi_element+".event",event,scorm12_regex.NAVEvent))&&(this._event=event)}toJSON(){this.jsonString=!0;const result={event:this.event};return delete this.jsonString,result}}const LogLevelEnum={_:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},DefaultSettings={autocommit:!1,autocommitSeconds:10,asyncCommit:!1,sendFullCommit:!0,lmsCommitUrl:!1,dataCommitFormat:"json",commitRequestDataType:"application/json;charset=UTF-8",autoProgress:!1,logLevel:LogLevelEnum.ERROR,selfReportSessionTime:!1,alwaysSendTotalTime:!1,renderCommonCommitFields:!1,strict_errors:!0,xhrHeaders:{},xhrWithCredentials:!1,fetchMode:"cors",responseHandler:async function(response){if(void 0!==response){let httpResult=null;try{if("function"==typeof response.json)httpResult=await response.json();else if("function"==typeof response.text){const responseText=await response.text();responseText&&(httpResult=JSON.parse(responseText))}}catch(e){}return null!==httpResult&&{}.hasOwnProperty.call(httpResult,"result")?{result:httpResult.result,errorCode:httpResult.errorCode?httpResult.errorCode:"true"===httpResult.result?0:101}:200===response.status?{result:"true",errorCode:0}:{result:"false",errorCode:101}}return{result:"false",errorCode:101}},requestHandler:function(commitObject){return commitObject},onLogMessage:defaultLogHandler,scoItemIds:[],scoItemIdValidator:!1,globalObjectiveIds:[],enableOfflineSupport:!1,courseId:"",syncOnInitialize:!0,syncOnTerminate:!0,maxSyncAttempts:5};function defaultLogHandler(messageLevel,logMessage){switch(messageLevel){case"4":case 4:case"ERROR":case LogLevelEnum.ERROR:console.error(logMessage);break;case"3":case 3:case"WARN":case LogLevelEnum.WARN:console.warn(logMessage);break;case"2":case 2:case"INFO":case LogLevelEnum.INFO:console.info(logMessage);break;case"1":case 1:case"DEBUG":case LogLevelEnum.DEBUG:console.debug?console.debug(logMessage):console.log(logMessage)}}class ScheduledCommit{constructor(API,when,callback){this._cancelled=!1,this._API=API,this._timeout=setTimeout(this.wrapper.bind(this),when),this._callback=callback}cancel(){this._cancelled=!0,this._timeout&&clearTimeout(this._timeout)}wrapper(){this._cancelled||(async()=>{await this._API.commit(this._callback)})()}}class HttpService{constructor(settings,error_codes){this.settings=settings,this.error_codes=error_codes}async processHttpRequest(url,params,immediate=!1,apiLog,processListeners){const genericError={result:"false",errorCode:this.error_codes.GENERAL};return immediate?(this.performFetch(url,params).then((async response=>{await this.transformResponse(response,processListeners)})),{result:"true",errorCode:0}):await(async(url2,params2,settings)=>{try{params2=settings.requestHandler(params2);const response=await this.performFetch(url2,params2);return this.transformResponse(response,processListeners)}catch(e){return apiLog("processHttpRequest",e,LogLevelEnum.ERROR),processListeners("CommitError"),genericError}})(url,params,this.settings)}async performFetch(url,params){return fetch(url,{method:"POST",mode:this.settings.fetchMode,body:params instanceof Array?params.join("&"):JSON.stringify(params),headers:{...this.settings.xhrHeaders,"Content-Type":this.settings.commitRequestDataType},credentials:this.settings.xhrWithCredentials?"include":void 0,keepalive:!0})}async transformResponse(response,processListeners){const result="function"==typeof this.settings.responseHandler?await this.settings.responseHandler(response):await response.json();return 200>response.status||response.status>299||!0!==result.result&&"true"!==result.result?(Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=this.error_codes.GENERAL),processListeners("CommitError",null,result.errorCode)):(processListeners("CommitSuccess"),Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=0)),result}updateSettings(settings){this.settings=settings}}class EventService{constructor(apiLog){this.listenerMap=new Map,this.listenerCount=0,this.apiLog=apiLog}parseListenerName(listenerName){const listenerSplit=listenerName.split(".");if(0===listenerSplit.length)return null;const functionName=listenerSplit[0];let CMIElement=null;return listenerSplit.length>1&&(CMIElement=listenerName.replace(functionName+".","")),{functionName:functionName,CMIElement:CMIElement}}on(listenerName,callback){if(!callback)return;const listenerFunctions=listenerName.split(" ");for(const listenerFunction of listenerFunctions){const parsedListener=this.parseListenerName(listenerFunction);if(!parsedListener)continue;const{functionName:functionName,CMIElement:CMIElement}=parsedListener,listeners=this.listenerMap.get(functionName)??[];listeners.push({functionName:functionName,CMIElement:CMIElement,callback:callback}),this.listenerMap.set(functionName,listeners),this.listenerCount++,this.apiLog("on","Added event listener: "+this.listenerCount,LogLevelEnum.INFO,functionName)}}off(listenerName,callback){if(!callback)return;const listenerFunctions=listenerName.split(" ");for(const listenerFunction of listenerFunctions){const parsedListener=this.parseListenerName(listenerFunction);if(!parsedListener)continue;const{functionName:functionName,CMIElement:CMIElement}=parsedListener,listeners=this.listenerMap.get(functionName);if(!listeners)continue;const removeIndex=listeners.findIndex((obj=>obj.CMIElement===CMIElement&&obj.callback===callback));-1!==removeIndex&&(listeners.splice(removeIndex,1),this.listenerCount--,0===listeners.length?this.listenerMap.delete(functionName):this.listenerMap.set(functionName,listeners),this.apiLog("off","Removed event listener: "+this.listenerCount,LogLevelEnum.INFO,functionName))}}clear(listenerName){const listenerFunctions=listenerName.split(" ");for(const listenerFunction of listenerFunctions){const parsedListener=this.parseListenerName(listenerFunction);if(!parsedListener)continue;const{functionName:functionName,CMIElement:CMIElement}=parsedListener;if(this.listenerMap.has(functionName)){const listeners=this.listenerMap.get(functionName),newListeners=listeners.filter((obj=>obj.CMIElement!==CMIElement));this.listenerCount-=listeners.length-newListeners.length,0===newListeners.length?this.listenerMap.delete(functionName):this.listenerMap.set(functionName,newListeners)}}}processListeners(functionName,CMIElement,value){this.apiLog(functionName,value,LogLevelEnum.INFO,CMIElement);const listeners=this.listenerMap.get(functionName);if(listeners)for(const listener of listeners){const listenerHasCMIElement=!!listener.CMIElement;let CMIElementsMatch=!1;if(CMIElement&&listener.CMIElement)if(listener.CMIElement.endsWith("*")){const prefix=listener.CMIElement.slice(0,-1);CMIElementsMatch=CMIElement.startsWith(prefix)}else CMIElementsMatch=listener.CMIElement===CMIElement;listenerHasCMIElement&&!CMIElementsMatch||(this.apiLog("processListeners","Processing listener: "+listener.functionName,LogLevelEnum.DEBUG,CMIElement),functionName.startsWith("Sequence")||"CommitError"===functionName?listener.callback(value):"CommitSuccess"===functionName?listener.callback():listener.callback(CMIElement,value))}}reset(){this.listenerMap.clear(),this.listenerCount=0}}class SerializationService{loadFromFlattenedJSON(json,CMIElement="",setCMIValue,isNotInitialized,setStartingData){if(!isNotInitialized())return void console.error("loadFromFlattenedJSON can only be called before the call to lmsInitialize.");const int_pattern=/^(cmi\.interactions\.)(\d+)\.(.*)$/,obj_pattern=/^(cmi\.objectives\.)(\d+)\.(.*)$/,interactions=[],objectives=[],others=[];for(const key in json)if({}.hasOwnProperty.call(json,key)){const intMatch=key.match(int_pattern);if(intMatch){interactions.push({key:key,value:json[key],index:+intMatch[2],field:intMatch[3]});continue}const objMatch=key.match(obj_pattern);if(objMatch){objectives.push({key:key,value:json[key],index:+objMatch[2],field:objMatch[3]});continue}others.push({key:key,value:json[key]})}interactions.sort(((a,b)=>a.index!==b.index?a.index-b.index:"id"===a.field?-1:"id"===b.field?1:"type"===a.field?-1:"type"===b.field?1:a.field.localeCompare(b.field))),objectives.sort(((a,b)=>a.index!==b.index?a.index-b.index:"id"===a.field?-1:"id"===b.field?1:a.field.localeCompare(b.field))),others.sort(((a,b)=>a.key.localeCompare(b.key)));const processItems=items=>{items.forEach((item=>{const obj={};obj[item.key]=item.value,this.loadFromJSON(function(data){if(Object(data)!==data||Array.isArray(data))return data;const result={},pattern=/\.?([^.[\]]+)|\[(\d+)]/g;return Object.keys(data).filter((p=>({}.hasOwnProperty.call(data,p)))).forEach((p=>{let cur=result,prop="";const regex=RegExp(pattern);Array.from({length:p.match(RegExp(pattern,"g"))?.length??0},(()=>regex.exec(p))).forEach((m=>{m&&(cur=cur[prop]??(cur[prop]=m[2]?[]:{}),prop=m[2]||m[1])})),cur[prop]=data[p]})),result[""]??result}(obj),CMIElement,setCMIValue,isNotInitialized,setStartingData)}))};processItems(interactions),processItems(objectives),processItems(others)}loadFromJSON(json,CMIElement="",setCMIValue,isNotInitialized,setStartingData){if(isNotInitialized()){CMIElement=void 0!==CMIElement?CMIElement:"cmi",setStartingData(json);for(const key in json)if({}.hasOwnProperty.call(json,key)&&json[key]){const currentCMIElement=(CMIElement?CMIElement+".":"")+key,value=json[key];if(value.constructor===Array){for(let i=0;value.length>i;i++)if(value[i]){const item=value[i],tempCMIElement=`${currentCMIElement}.${i}`;item.constructor===Object?this.loadFromJSON(item,tempCMIElement,setCMIValue,isNotInitialized,setStartingData):setCMIValue(tempCMIElement,item)}}else value.constructor===Object?this.loadFromJSON(value,currentCMIElement,setCMIValue,isNotInitialized,setStartingData):setCMIValue(currentCMIElement,value)}}else console.error("loadFromJSON can only be called before the call to lmsInitialize.")}renderCMIToJSONString(cmi,sendFullCommit){return sendFullCommit?JSON.stringify({cmi:cmi}):JSON.stringify({cmi:cmi},((k,v)=>void 0===v?null:v),2)}renderCMIToJSONObject(cmi,sendFullCommit){return JSON.parse(this.renderCMIToJSONString(cmi,sendFullCommit))}getCommitObject(terminateCommit,alwaysSendTotalTime,renderCommonCommitFields,renderCommitObject,renderCommitCMI,apiLogLevel){const shouldTerminateCommit=terminateCommit||alwaysSendTotalTime,commitObject=renderCommonCommitFields?renderCommitObject(shouldTerminateCommit):renderCommitCMI(shouldTerminateCommit);return[LogLevelEnum.DEBUG,"1",1,"DEBUG"].includes(apiLogLevel)&&(console.debug("Commit (terminated: "+(terminateCommit?"yes":"no")+"): "),console.debug(commitObject)),commitObject}}class LoggingService{constructor(){this._logLevel=LogLevelEnum.ERROR,this._logHandler=defaultLogHandler}static getInstance(){return LoggingService._instance||(LoggingService._instance=new LoggingService),LoggingService._instance}setLogLevel(level){this._logLevel=level}getLogLevel(){return this._logLevel}setLogHandler(handler){this._logHandler=handler}log(messageLevel,logMessage){this.shouldLog(messageLevel)&&this._logHandler(messageLevel,logMessage)}error(logMessage){this.log(LogLevelEnum.ERROR,logMessage)}warn(logMessage){this.log(LogLevelEnum.WARN,logMessage)}info(logMessage){this.log(LogLevelEnum.INFO,logMessage)}debug(logMessage){this.log(LogLevelEnum.DEBUG,logMessage)}shouldLog(messageLevel){return this.getNumericLevel(messageLevel)>=this.getNumericLevel(this._logLevel)}getNumericLevel(level){if(void 0===level)return LogLevelEnum.NONE;if("number"==typeof level)return level;switch(level){case"1":case"DEBUG":return LogLevelEnum.DEBUG;case"2":case"INFO":return LogLevelEnum.INFO;case"3":case"WARN":return LogLevelEnum.WARN;case"4":case"ERROR":default:return LogLevelEnum.ERROR;case"5":case"NONE":return LogLevelEnum.NONE}}}function getLoggingService(){return LoggingService.getInstance()}class ErrorHandlingService{constructor(errorCodes,apiLog,getLmsErrorMessageDetails,loggingService){this._lastErrorCode="0",this._errorCodes=errorCodes,this._apiLog=apiLog,this._getLmsErrorMessageDetails=getLmsErrorMessageDetails,this._loggingService=loggingService||getLoggingService()}get lastErrorCode(){return this._lastErrorCode}set lastErrorCode(errorCode){this._lastErrorCode=errorCode}throwSCORMError(CMIElement,errorNumber,message){message||(message=this._getLmsErrorMessageDetails(errorNumber,!0));const formattedMessage=`SCORM Error ${errorNumber}: ${message}${CMIElement?` [Element: ${CMIElement}]`:""}`;this._apiLog("throwSCORMError",errorNumber+": "+message,LogLevelEnum.ERROR,CMIElement),this._loggingService.error(formattedMessage),this._lastErrorCode=errorNumber+""}clearSCORMError(success){void 0!==success&&"false"!==success&&(this._lastErrorCode="0")}handleValueAccessException(CMIElement,e,returnValue){if(e instanceof ValidationError){const validationError=e;this._lastErrorCode=validationError.errorCode+"",this._loggingService.warn(`Validation Error ${validationError.errorCode}: ${validationError.message} [Element: ${CMIElement}]`),returnValue="false"}else if(e instanceof Error){const errorType=e.constructor.name;this._loggingService.error(`${errorType}: ${e.message} [Element: ${CMIElement}]\n${e.stack||""}`),this.throwSCORMError(CMIElement,this._errorCodes.GENERAL,`${errorType}: ${e.message}`)}else{this._loggingService.error(`Unknown error occurred while accessing [Element: ${CMIElement}]`);try{const errorDetails=JSON.stringify(e);this._loggingService.error("Error details: "+errorDetails)}catch(jsonError){this._loggingService.error("Could not stringify error object for details")}this.throwSCORMError(CMIElement,this._errorCodes.GENERAL,"Unknown error")}return returnValue}get errorCodes(){return this._errorCodes}}class OfflineStorageService{constructor(settings,error_codes,apiLog){this.apiLog=apiLog,this.storeName="scorm_again_offline_data",this.syncQueue="scorm_again_sync_queue",this.isOnline=navigator.onLine,this.syncInProgress=!1,this.settings=settings,this.error_codes=error_codes,window.addEventListener("online",this.handleOnlineStatusChange.bind(this)),window.addEventListener("offline",this.handleOnlineStatusChange.bind(this))}handleOnlineStatusChange(){const wasOnline=this.isOnline;this.isOnline=navigator.onLine,!wasOnline&&this.isOnline?(this.apiLog("OfflineStorageService","Device is back online, attempting to sync...",LogLevelEnum.INFO),this.syncOfflineData()):wasOnline&&!this.isOnline&&this.apiLog("OfflineStorageService","Device is offline, data will be stored locally",LogLevelEnum.INFO)}async storeOffline(courseId,commitData){try{const queueItem={id:`${courseId}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,courseId:courseId,timestamp:Date.now(),data:commitData,syncAttempts:0},currentQueue=await this.getFromStorage(this.syncQueue)||[];return currentQueue.push(queueItem),await this.saveToStorage(this.syncQueue,currentQueue),await this.saveToStorage(`${this.storeName}_${courseId}`,commitData),this.apiLog("OfflineStorageService","Stored data offline for course "+courseId,LogLevelEnum.INFO),{result:"true",errorCode:0}}catch(error){return this.apiLog("OfflineStorageService","Error storing offline data: "+error,LogLevelEnum.ERROR),{result:"false",errorCode:this.error_codes.GENERAL}}}async getOfflineData(courseId){try{return await this.getFromStorage(`${this.storeName}_${courseId}`)||null}catch(error){return this.apiLog("OfflineStorageService","Error retrieving offline data: "+error,LogLevelEnum.ERROR),null}}async syncOfflineData(){if(this.syncInProgress||!this.isOnline)return!1;this.syncInProgress=!0;try{const syncQueue=await this.getFromStorage(this.syncQueue)||[];if(0===syncQueue.length)return this.syncInProgress=!1,!0;this.apiLog("OfflineStorageService",`Found ${syncQueue.length} items to sync`,LogLevelEnum.INFO);const remainingQueue=[];for(const item of syncQueue)if(5>item.syncAttempts)try{"true"===(await this.sendDataToLMS(item.data)).result?this.apiLog("OfflineStorageService","Successfully synced item "+item.id,LogLevelEnum.INFO):(item.syncAttempts++,remainingQueue.push(item),this.apiLog("OfflineStorageService",`Failed to sync item ${item.id}, attempt #${item.syncAttempts}`,LogLevelEnum.WARN))}catch(error){item.syncAttempts++,remainingQueue.push(item),this.apiLog("OfflineStorageService",`Error syncing item ${item.id}: ${error}`,LogLevelEnum.ERROR)}else this.apiLog("OfflineStorageService",`Skipping item ${item.id} after 5 failed attempts`,LogLevelEnum.WARN);return await this.saveToStorage(this.syncQueue,remainingQueue),this.apiLog("OfflineStorageService",`Sync completed. ${syncQueue.length-remainingQueue.length} items synced, ${remainingQueue.length} items remaining`,LogLevelEnum.INFO),this.syncInProgress=!1,!0}catch(error){return this.apiLog("OfflineStorageService","Error during sync process: "+error,LogLevelEnum.ERROR),this.syncInProgress=!1,!1}}async sendDataToLMS(data){if(!this.settings.lmsCommitUrl)return{result:"false",errorCode:this.error_codes.GENERAL};try{const processedData=this.settings.requestHandler(data),response=await fetch(this.settings.lmsCommitUrl,{method:"POST",mode:this.settings.fetchMode,body:JSON.stringify(processedData),headers:{...this.settings.xhrHeaders,"Content-Type":this.settings.commitRequestDataType},credentials:this.settings.xhrWithCredentials?"include":void 0}),result="function"==typeof this.settings.responseHandler?await this.settings.responseHandler(response):await response.json();return 200>response.status||response.status>299||!0!==result.result&&"true"!==result.result?(Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=this.error_codes.GENERAL),result):(Object.hasOwnProperty.call(result,"errorCode")||(result.errorCode=0),result)}catch(error){return this.apiLog("OfflineStorageService","Error sending data to LMS: "+error,LogLevelEnum.ERROR),{result:"false",errorCode:this.error_codes.GENERAL}}}isDeviceOnline(){return this.isOnline}async getFromStorage(key){const storedData=localStorage.getItem(key);if(storedData)try{return JSON.parse(storedData)}catch(e){return null}return null}async saveToStorage(key,data){localStorage.setItem(key,JSON.stringify(data))}async hasPendingOfflineData(courseId){return(await this.getFromStorage(this.syncQueue)||[]).some((item=>item.courseId===courseId))}updateSettings(settings){this.settings=settings}}class BaseAPI{constructor(error_codes,settings,httpService,eventService,serializationService,cmiDataService,errorHandlingService,loggingService,offlineStorageService){if(this._settings=DefaultSettings,this._courseId="",new.target===BaseAPI)throw new TypeError("Cannot construct BaseAPI instances directly");this.currentState=0,this._error_codes=error_codes,settings&&(this.settings=settings),this.apiLogLevel=this.settings.logLevel,this.selfReportSessionTime=this.settings.selfReportSessionTime,void 0===this.apiLogLevel&&(this.apiLogLevel=LogLevelEnum.NONE),this._loggingService=loggingService||getLoggingService(),this._loggingService.setLogLevel(this.apiLogLevel),this.settings.onLogMessage&&this._loggingService.setLogHandler(this.settings.onLogMessage),this._httpService=httpService||new HttpService(this.settings,this._error_codes),this._eventService=eventService||new EventService(((functionName,message,level,element)=>this.apiLog(functionName,message,level,element))),this._serializationService=serializationService||new SerializationService,this._errorHandlingService=errorHandlingService||new ErrorHandlingService(this._error_codes,((functionName,message,level,element)=>this.apiLog(functionName,message,level,element)),((errorNumber,detail)=>this.getLmsErrorMessageDetails(errorNumber,detail)),void 0),this.settings.enableOfflineSupport&&(this._offlineStorageService=offlineStorageService||new OfflineStorageService(this.settings,this._error_codes,((functionName,message,level,element)=>this.apiLog(functionName,message,level,element))),this.settings.courseId&&(this._courseId=this.settings.courseId),this._offlineStorageService&&this._courseId&&this._offlineStorageService.getOfflineData(this._courseId).then((offlineData=>{offlineData&&(this.apiLog("constructor","Found offline data to restore",LogLevelEnum.INFO),this.loadFromJSON(offlineData.runtimeData))})).catch((error=>{this.apiLog("constructor","Error retrieving offline data: "+error,LogLevelEnum.ERROR)})))}get lastErrorCode(){return this._errorHandlingService?.lastErrorCode??"0"}set lastErrorCode(errorCode){this._errorHandlingService&&(this._errorHandlingService.lastErrorCode=errorCode)}commonReset(settings){this.apiLog("reset","Called",LogLevelEnum.INFO),this.settings={...this.settings,...settings},this.clearScheduledCommit(),this.currentState=0,this.lastErrorCode="0",this._eventService.reset(),this.startingData=void 0,this._offlineStorageService&&(this._offlineStorageService.updateSettings(this.settings),settings?.courseId&&(this._courseId=settings.courseId))}initialize(callbackName,initializeMessage,terminationMessage){let returnValue="false";return this.isInitialized()?this.throwSCORMError("api",this._error_codes.INITIALIZED,initializeMessage):this.isTerminated()?this.throwSCORMError("api",this._error_codes.TERMINATED,terminationMessage):(this.selfReportSessionTime&&this.cmi.setStartTime(),this.currentState=1,this.lastErrorCode="0",returnValue="true",this.processListeners(callbackName),this.settings.enableOfflineSupport&&this._offlineStorageService&&this._courseId&&this.settings.syncOnInitialize&&this._offlineStorageService.isDeviceOnline()&&this._offlineStorageService.hasPendingOfflineData(this._courseId).then((hasPendingData=>{hasPendingData&&(this.apiLog(callbackName,"Syncing pending offline data on initialization",LogLevelEnum.INFO),this._offlineStorageService?.syncOfflineData().then((syncSuccess=>{syncSuccess&&(this.apiLog(callbackName,"Successfully synced offline data",LogLevelEnum.INFO),this.processListeners("OfflineDataSynced"))})))}))),this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),this.clearSCORMError(returnValue),returnValue}apiLog(functionName,logMessage,messageLevel,CMIElement){logMessage=function(functionName,message,CMIElement){let messageString=functionName.padEnd(20)+": ";return CMIElement&&(messageString+=CMIElement,messageString=messageString.padEnd(70)),messageString+=message??"",messageString}(functionName,logMessage,CMIElement),this.apiLogLevel>messageLevel||this._loggingService.log(messageLevel,logMessage)}get error_codes(){return this._error_codes}get settings(){return this._settings}set settings(settings){const previousSettings=this._settings;this._settings={...this._settings,...settings},this._httpService?.updateSettings(this._settings),void 0!==settings.logLevel&&settings.logLevel!==previousSettings.logLevel&&(this.apiLogLevel=settings.logLevel,this._loggingService?.setLogLevel(settings.logLevel)),void 0!==settings.onLogMessage&&settings.onLogMessage!==previousSettings.onLogMessage&&this._loggingService?.setLogHandler(settings.onLogMessage)}async terminate(callbackName,checkTerminated){let returnValue="false";if(this.checkState(checkTerminated,this._error_codes.TERMINATION_BEFORE_INIT,this._error_codes.MULTIPLE_TERMINATION)){this.currentState=2,this.settings.enableOfflineSupport&&this._offlineStorageService&&this._courseId&&this.settings.syncOnTerminate&&this._offlineStorageService.isDeviceOnline()&&await this._offlineStorageService.hasPendingOfflineData(this._courseId)&&(this.apiLog(callbackName,"Syncing pending offline data before termination",LogLevelEnum.INFO),await this._offlineStorageService.syncOfflineData());const result=await this.storeData(!0);(result.errorCode??0)>0&&this.throwSCORMError("api",result.errorCode),returnValue=result?.result??"false",checkTerminated&&(this.lastErrorCode="0"),returnValue="true",this.processListeners(callbackName)}return this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),this.clearSCORMError(returnValue),returnValue}getValue(callbackName,checkTerminated,CMIElement){let returnValue="";if(this.checkState(checkTerminated,this._error_codes.RETRIEVE_BEFORE_INIT,this._error_codes.RETRIEVE_AFTER_TERM)){try{returnValue=this.getCMIValue(CMIElement)}catch(e){returnValue=this.handleValueAccessException(CMIElement,e,returnValue)}this.processListeners(callbackName,CMIElement)}return this.apiLog(callbackName,": returned: "+returnValue,LogLevelEnum.INFO,CMIElement),void 0===returnValue?"":("0"===this.lastErrorCode&&this.clearSCORMError(returnValue),returnValue)}setValue(callbackName,commitCallback,checkTerminated,CMIElement,value){void 0!==value&&(value+="");let returnValue="false";if(this.checkState(checkTerminated,this._error_codes.STORE_BEFORE_INIT,this._error_codes.STORE_AFTER_TERM)){try{returnValue=this.setCMIValue(CMIElement,value)}catch(e){returnValue=this.handleValueAccessException(CMIElement,e,returnValue)}this.processListeners(callbackName,CMIElement,value)}return void 0===returnValue&&(returnValue="false"),this.lastErrorCode+""=="0"&&this.settings.autocommit&&this.scheduleCommit(1e3*this.settings.autocommitSeconds,commitCallback),this.apiLog(callbackName,": "+value+": result: "+returnValue,LogLevelEnum.INFO,CMIElement),"0"===this.lastErrorCode&&this.clearSCORMError(returnValue),returnValue}async commit(callbackName,checkTerminated=!1){this.clearScheduledCommit();let returnValue="false";if(this.checkState(checkTerminated,this._error_codes.COMMIT_BEFORE_INIT,this._error_codes.COMMIT_AFTER_TERM)){const result=await this.storeData(!1);(result.errorCode??0)>0&&this.throwSCORMError("api",result.errorCode),returnValue=result?.result??"false",this.apiLog(callbackName," Result: "+returnValue,LogLevelEnum.DEBUG,"HttpRequest"),checkTerminated&&(this.lastErrorCode="0"),this.processListeners(callbackName),this.settings.enableOfflineSupport&&this._offlineStorageService&&this._offlineStorageService.isDeviceOnline()&&this._courseId&&this._offlineStorageService.hasPendingOfflineData(this._courseId).then((hasPendingData=>{hasPendingData&&(this.apiLog(callbackName,"Syncing pending offline data",LogLevelEnum.INFO),this._offlineStorageService?.syncOfflineData().then((syncSuccess=>{syncSuccess?(this.apiLog(callbackName,"Successfully synced offline data",LogLevelEnum.INFO),this.processListeners("OfflineDataSynced")):this.apiLog(callbackName,"Failed to sync some offline data",LogLevelEnum.WARN)})))}))}return this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),"0"===this.lastErrorCode&&this.clearSCORMError(returnValue),returnValue}getLastError(callbackName){const returnValue=this.lastErrorCode+"";return this.processListeners(callbackName),this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),returnValue}getErrorString(callbackName,CMIErrorCode){let returnValue="";return null!==CMIErrorCode&&""!==CMIErrorCode&&(returnValue=this.getLmsErrorMessageDetails(CMIErrorCode),this.processListeners(callbackName)),this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),returnValue}getDiagnostic(callbackName,CMIErrorCode){let returnValue="";return null!==CMIErrorCode&&""!==CMIErrorCode&&(returnValue=this.getLmsErrorMessageDetails(CMIErrorCode,!0),this.processListeners(callbackName)),this.apiLog(callbackName,"returned: "+returnValue,LogLevelEnum.INFO),returnValue}checkState(checkTerminated,beforeInitError,afterTermError){return this.isNotInitialized()?(this.throwSCORMError("api",beforeInitError),!1):!checkTerminated||!this.isTerminated()||(this.throwSCORMError("api",afterTermError),!1)}getLmsErrorMessageDetails(_errorNumber,_detail=!1){throw Error("The getLmsErrorMessageDetails method has not been implemented")}getCMIValue(_CMIElement){throw Error("The getCMIValue method has not been implemented")}setCMIValue(_CMIElement,_value){throw Error("The setCMIValue method has not been implemented")}_commonSetCMIValue(methodName,scorm2004,CMIElement,value){if(!CMIElement||""===CMIElement)return"false";this.lastErrorCode="0";const structure=CMIElement.split(".");let refObject=this,returnValue="false",foundFirstIndex=!1;const invalidErrorMessage=`The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`,invalidErrorCode=scorm2004?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let idx=0;structure.length>idx;idx++){const attribute=structure[idx];if(idx===structure.length-1)if(scorm2004&&"{target="===attribute.substring(0,8)){if(this.isInitialized()){this.throwSCORMError(CMIElement,this._error_codes.READ_ONLY_ELEMENT);break}refObject={...refObject,attribute:value}}else{if(!this._checkObjectHasProperty(refObject,attribute)){this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage);break}if(stringMatches(CMIElement,"\\.correct_responses\\.\\d+$")&&this.isInitialized()&&"pattern"!==attribute&&(this.validateCorrectResponse(CMIElement,value),"0"!==this.lastErrorCode)){this.throwSCORMError(CMIElement,this._error_codes.TYPE_MISMATCH);break}scorm2004&&"0"!==this._errorHandlingService.lastErrorCode||(refObject[attribute]=value,returnValue="true")}else{if(refObject=refObject[attribute],!refObject){this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage);break}if(refObject instanceof CMIArray){const index=parseInt(structure[idx+1],10);if(!isNaN(index)){const item=refObject.childArray[index];if(item)refObject=item,foundFirstIndex=!0;else{const newChild=this.getChildElement(CMIElement,value,foundFirstIndex);if(foundFirstIndex=!0,!newChild){"0"===this.lastErrorCode&&this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage);break}refObject.initialized&&newChild.initialize(),refObject.childArray[index]=newChild,refObject=newChild}idx++}}}}return"false"===returnValue&&this.apiLog(methodName,`There was an error setting the value for: ${CMIElement}, value of: ${value}`,LogLevelEnum.WARN),returnValue}_commonGetCMIValue(methodName,scorm2004,CMIElement){if(!CMIElement||""===CMIElement)return"";const structure=CMIElement.split(".");let refObject=this,attribute=null;const uninitializedErrorMessage=`The data model element passed to ${methodName} (${CMIElement}) has not been initialized.`,invalidErrorMessage=`The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`,invalidErrorCode=scorm2004?this._error_codes.UNDEFINED_DATA_MODEL:this._error_codes.GENERAL;for(let idx=0;structure.length>idx;idx++){if(attribute=structure[idx],scorm2004){if("{target="===(attribute+"").substring(0,8)&&"function"==typeof refObject._isTargetValid)return refObject._isTargetValid((attribute+"").substring(8,(attribute+"").length-9));if(!this._checkObjectHasProperty(refObject,attribute))return void this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage)}else if(idx===structure.length-1&&!this._checkObjectHasProperty(refObject,attribute))return void this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage);if(refObject=refObject[attribute],void 0===refObject){this.throwSCORMError(CMIElement,invalidErrorCode,invalidErrorMessage);break}if(refObject instanceof CMIArray){const index=parseInt(structure[idx+1],10);if(!isNaN(index)){const item=refObject.childArray[index];if(!item){this.throwSCORMError(CMIElement,this._error_codes.VALUE_NOT_INITIALIZED,uninitializedErrorMessage);break}refObject=item,idx++}}}if(null!=refObject)return refObject;scorm2004||("_children"===attribute?this.throwSCORMError(CMIElement,this._error_codes.CHILDREN_ERROR,void 0):"_count"===attribute&&this.throwSCORMError(CMIElement,this._error_codes.COUNT_ERROR,void 0))}isInitialized(){return 1===this.currentState}isNotInitialized(){return 0===this.currentState}isTerminated(){return 2===this.currentState}on(listenerName,callback){this._eventService.on(listenerName,callback)}off(listenerName,callback){this._eventService.off(listenerName,callback)}clear(listenerName){this._eventService.clear(listenerName)}processListeners(functionName,CMIElement,value){this._eventService.processListeners(functionName,CMIElement,value)}throwSCORMError(CMIElement,errorNumber,message){this._errorHandlingService.throwSCORMError(CMIElement,errorNumber,message)}clearSCORMError(success){this._errorHandlingService.clearSCORMError(success)}loadFromFlattenedJSON(json,CMIElement){CMIElement||(CMIElement=""),this._serializationService.loadFromFlattenedJSON(json,CMIElement,((CMIElement2,value)=>this.setCMIValue(CMIElement2,value)),(()=>this.isNotInitialized()),(data=>{this.startingData=data}))}loadFromJSON(json,CMIElement=""){CMIElement&&""!==CMIElement||Object.hasOwnProperty.call(json,"cmi")||(CMIElement="cmi"),this._serializationService.loadFromJSON(json,CMIElement,((CMIElement2,value)=>this.setCMIValue(CMIElement2,value)),(()=>this.isNotInitialized()),(data=>{this.startingData=data}))}renderCMIToJSONString(){return this._serializationService.renderCMIToJSONString(this.cmi,this.settings.sendFullCommit)}renderCMIToJSONObject(){return this._serializationService.renderCMIToJSONObject(this.cmi,this.settings.sendFullCommit)}async processHttpRequest(url,params,immediate=!1){return this.settings.enableOfflineSupport&&this._offlineStorageService&&!this._offlineStorageService.isDeviceOnline()&&this._courseId?(this.apiLog("processHttpRequest","Device is offline, storing data locally",LogLevelEnum.INFO),params&&"object"==typeof params&&"cmi"in params?await this._offlineStorageService.storeOffline(this._courseId,params):(this.apiLog("processHttpRequest","Invalid commit data format for offline storage",LogLevelEnum.ERROR),{result:"false",errorCode:this._error_codes.GENERAL})):await this._httpService.processHttpRequest(url,params,immediate,((functionName,message,level,element)=>this.apiLog(functionName,message,level,element)),((functionName,CMIElement,value)=>this.processListeners(functionName,CMIElement,value)))}scheduleCommit(when,callback){this._timeout||(this._timeout=new ScheduledCommit(this,when,callback),this.apiLog("scheduleCommit","scheduled",LogLevelEnum.DEBUG,""))}clearScheduledCommit(){this._timeout&&(this._timeout.cancel(),this._timeout=void 0,this.apiLog("clearScheduledCommit","cleared",LogLevelEnum.DEBUG,""))}_checkObjectHasProperty(StringKeyMap2,attribute){return Object.hasOwnProperty.call(StringKeyMap2,attribute)||null!=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(StringKeyMap2),attribute)||attribute in StringKeyMap2}handleValueAccessException(CMIElement,e,returnValue){return e instanceof ValidationError?(this.lastErrorCode=e.errorCode+"",returnValue="false",this.throwSCORMError(CMIElement,e.errorCode,e.errorMessage)):this.throwSCORMError(CMIElement,this._error_codes.GENERAL,e instanceof Error&&e.message?e.message:"Unknown error"),returnValue}getCommitObject(terminateCommit){return this._serializationService.getCommitObject(terminateCommit,this.settings.alwaysSendTotalTime,this.settings.renderCommonCommitFields,(terminateCommit2=>this.renderCommitObject(terminateCommit2)),(terminateCommit2=>this.renderCommitCMI(terminateCommit2)),this.apiLogLevel)}}class Scorm12API extends BaseAPI{constructor(settings){settings&&void 0===settings.mastery_override&&(settings.mastery_override=!1),super(scorm12_errors$1,settings),this.statusSetByModule=!1,this.cmi=new CMI$2,this.nav=new NAV,this.LMSInitialize=this.lmsInitialize,this.LMSFinish=this.lmsFinish,this.LMSGetValue=this.lmsGetValue,this.LMSSetValue=this.lmsSetValue,this.LMSCommit=this.lmsCommit,this.LMSGetLastError=this.lmsGetLastError,this.LMSGetErrorString=this.lmsGetErrorString,this.LMSGetDiagnostic=this.lmsGetDiagnostic}reset(settings){this.commonReset(settings),this.cmi?.reset(),this.nav?.reset()}lmsInitialize(){return this.cmi.initialize(),this.cmi.core.lesson_status?this.statusSetByModule=!0:this.cmi.core.lesson_status="not attempted",this.initialize("LMSInitialize","LMS was already initialized!","LMS is already finished!")}lmsFinish(){return(async()=>{await this.internalFinish()})(),"true"}async internalFinish(){const result=await this.terminate("LMSFinish",!0);return"true"===result&&(""!==this.nav.event?this.processListeners("continue"===this.nav.event?"SequenceNext":"SequencePrevious"):this.settings.autoProgress&&this.processListeners("SequenceNext")),result}lmsGetValue(CMIElement){return this.getValue("LMSGetValue",!1,CMIElement)}lmsSetValue(CMIElement,value){return"cmi.core.lesson_status"===CMIElement&&(this.statusSetByModule=!0),this.setValue("LMSSetValue","LMSCommit",!1,CMIElement,value)}lmsCommit(){return this.settings.asyncCommit?this.scheduleCommit(500,"LMSCommit"):(async()=>{await this.commit("LMSCommit",!1)})(),"true"}lmsGetLastError(){return this.getLastError("LMSGetLastError")}lmsGetErrorString(CMIErrorCode){return this.getErrorString("LMSGetErrorString",CMIErrorCode)}lmsGetDiagnostic(CMIErrorCode){return this.getDiagnostic("LMSGetDiagnostic",CMIErrorCode)}setCMIValue(CMIElement,value){return this._commonSetCMIValue("LMSSetValue",!1,CMIElement,value)}getCMIValue(CMIElement){return this._commonGetCMIValue("getCMIValue",!1,CMIElement)}getChildElement(CMIElement,_value,foundFirstIndex){return stringMatches(CMIElement,"cmi\\.objectives\\.\\d+")?new CMIObjectivesObject$1:foundFirstIndex&&stringMatches(CMIElement,"cmi\\.interactions\\.\\d+\\.correct_responses\\.\\d+")?new CMIInteractionsCorrectResponsesObject$1:foundFirstIndex&&stringMatches(CMIElement,"cmi\\.interactions\\.\\d+\\.objectives\\.\\d+")?new CMIInteractionsObjectivesObject$1:!foundFirstIndex&&stringMatches(CMIElement,"cmi\\.interactions\\.\\d+")?new CMIInteractionsObject$1:null}validateCorrectResponse(_CMIElement,_value){}getLmsErrorMessageDetails(errorNumber,detail){let basicMessage="No Error",detailMessage="No Error";return scorm12_constants.error_descriptions[errorNumber+=""]&&(basicMessage=scorm12_constants.error_descriptions[errorNumber].basicMessage,detailMessage=scorm12_constants.error_descriptions[errorNumber].detailMessage),detail?detailMessage:basicMessage}replaceWithAnotherScormAPI(newAPI){this.cmi=newAPI.cmi}renderCommitCMI(terminateCommit){const cmiExport=this.renderCMIToJSONObject();terminateCommit&&(cmiExport.cmi.core.total_time=this.cmi.getCurrentTotalTime());const result=[],flattened=flatten(cmiExport);switch(this.settings.dataCommitFormat){case"flattened":return flatten(cmiExport);case"params":for(const item in flattened)({}).hasOwnProperty.call(flattened,item)&&result.push(`${item}=${flattened[item]}`);return result;default:return cmiExport}}renderCommitObject(terminateCommit){const cmiExport=this.renderCommitCMI(terminateCommit),totalTimeHHMMSS=this.cmi.getCurrentTotalTime(),totalTimeSeconds=getTimeAsSeconds(totalTimeHHMMSS,scorm12_regex.CMITimespan),lessonStatus=this.cmi.core.lesson_status;let completionStatus="unknown",successStatus="unknown";lessonStatus&&(completionStatus="completed"===lessonStatus||"passed"===lessonStatus?"completed":"incomplete","passed"===lessonStatus?successStatus="passed":"failed"===lessonStatus&&(successStatus="failed"));const score=this.cmi.core.score;let scoreObject=null;score&&(scoreObject={},Number.isNaN(Number.parseFloat(score.raw))||(scoreObject.raw=Number.parseFloat(score.raw)),Number.isNaN(Number.parseFloat(score.min))||(scoreObject.min=Number.parseFloat(score.min)),Number.isNaN(Number.parseFloat(score.max))||(scoreObject.max=Number.parseFloat(score.max)));const commitObject={successStatus:successStatus,completionStatus:completionStatus,runtimeData:cmiExport,totalTimeSeconds:totalTimeSeconds};return scoreObject&&(commitObject.score=scoreObject),commitObject}async storeData(terminateCommit){if(terminateCommit){const originalStatus=this.cmi.core.lesson_status;this.cmi.core.lesson_status&&(this.statusSetByModule||"not attempted"!==this.cmi.core.lesson_status)||(this.cmi.core.lesson_status="completed"),"normal"===this.cmi.core.lesson_mode?"credit"===this.cmi.core.credit&&this.settings.mastery_override&&""!==this.cmi.student_data.mastery_score&&""!==this.cmi.core.score.raw&&(this.cmi.core.lesson_status=parseFloat(this.cmi.student_data.mastery_score)>parseFloat(this.cmi.core.score.raw)?"failed":"passed"):"browse"===this.cmi.core.lesson_mode&&""===(this.startingData?.cmi?.core?.lesson_status||"")&&"not attempted"===originalStatus&&(this.cmi.core.lesson_status="browsed")}const commitObject=this.getCommitObject(terminateCommit);return"string"==typeof this.settings.lmsCommitUrl?await this.processHttpRequest(this.settings.lmsCommitUrl,commitObject,terminateCommit):{result:"true",errorCode:0}}}const aicc_errors=aicc_constants.error_descriptions;class AICCValidationError extends ValidationError{constructor(CMIElement,errorCode){!{}.hasOwnProperty.call(aicc_errors,errorCode+"")?super(CMIElement,101,aicc_errors[101].basicMessage,aicc_errors[101].detailMessage):super(CMIElement,errorCode,aicc_errors[errorCode+""].basicMessage,aicc_errors[errorCode+""].detailMessage),Object.setPrototypeOf(this,AICCValidationError.prototype)}}function checkAICCValidFormat(CMIElement,value,regexPattern,allowEmptyString){return checkValidFormat(CMIElement,value,regexPattern,scorm12_errors$1.TYPE_MISMATCH,AICCValidationError,allowEmptyString)}class CMIEvaluation extends BaseCMI{constructor(){super("cmi.evaluation"),this.comments=new CMIEvaluationComments}initialize(){super.initialize(),this.comments?.initialize()}reset(){this._initialized=!1,this.comments?.reset()}toJSON(){this.jsonString=!0;const result={comments:this.comments};return delete this.jsonString,result}}class CMIEvaluationComments extends CMIArray{constructor(){super({CMIElement:"cmi.evaluation.comments",children:aicc_constants.comments_children,errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:AICCValidationError})}}class CMIEvaluationCommentsObject extends BaseCMI{constructor(){super("cmi.evaluation.comments.n"),this._content="",this._location="",this._time=""}reset(){this._initialized=!1,this._content="",this._location="",this._time=""}get content(){return this._content}set content(content){checkAICCValidFormat(this._cmi_element+".content",content,aicc_regex.CMIString256)&&(this._content=content)}get location(){return this._location}set location(location){checkAICCValidFormat(this._cmi_element+".location",location,aicc_regex.CMIString256)&&(this._location=location)}get time(){return this._time}set time(time){checkAICCValidFormat(this._cmi_element+".time",time,aicc_regex.CMITime)&&(this._time=time)}toJSON(){this.jsonString=!0;const result={content:this.content,location:this.location,time:this.time};return delete this.jsonString,result}}class AICCStudentPreferences extends CMIStudentPreference{constructor(){super(aicc_constants.student_preference_children),this._lesson_type="",this._text_color="",this._text_location="",this._text_size="",this._video="",this.windows=new CMIArray({CMIElement:"cmi.student_preference.windows",errorCode:scorm12_errors$1.INVALID_SET_VALUE,errorClass:AICCValidationError,children:""})}initialize(){super.initialize(),this.windows?.initialize()}get lesson_type(){return this._lesson_type}set lesson_type(lesson_type){checkAICCValidFormat(this._cmi_element+".lesson_type",lesson_type,aicc_regex.CMIString256)&&(this._lesson_type=lesson_type)}get text_color(){return this._text_color}set text_color(text_color){checkAICCValidFormat(this._cmi_element+".text_color",text_color,aicc_regex.CMIString256)&&(this._text_color=text_color)}get text_location(){return this._text_location}set text_location(text_location){checkAICCValidFormat(this._cmi_element+".text_location",text_location,aicc_regex.CMIString256)&&(this._text_location=text_location)}get text_size(){return this._text_size}set text_size(text_size){checkAICCValidFormat(this._cmi_element+".text_size",text_size,aicc_regex.CMIString256)&&(this._text_size=text_size)}get video(){return this._video}set video(video){checkAICCValidFormat(this._cmi_element+".video",video,aicc_regex.CMIString256)&&(this._video=video)}toJSON(){this.jsonString=!0;const result={audio:this.audio,language:this.language,lesson_type:this.lesson_type,speed:this.speed,text:this.text,text_color:this.text_color,text_location:this.text_location,text_size:this.text_size,video:this.video,windows:this.windows};return delete this.jsonString,result}}class CMIStudentDemographics extends BaseCMI{constructor(){super("cmi.student_demographics"),this.__children=aicc_constants.student_demographics_children,this._city="",this._class="",this._company="",this._country="",this._experience="",this._familiar_name="",this._instructor_name="",this._title="",this._native_language="",this._state="",this._street_address="",this._telephone="",this._years_experience=""}reset(){this._initialized=!1}get _children(){return this.__children}get city(){return this._city}set city(city){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.city",scorm12_errors$1.READ_ONLY_ELEMENT);this._city=city}get class(){return this._class}set class(clazz){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.class",scorm12_errors$1.READ_ONLY_ELEMENT);this._class=clazz}get company(){return this._company}set company(company){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.company",scorm12_errors$1.READ_ONLY_ELEMENT);this._company=company}get country(){return this._country}set country(country){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.country",scorm12_errors$1.READ_ONLY_ELEMENT);this._country=country}get experience(){return this._experience}set experience(experience){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.experience",scorm12_errors$1.READ_ONLY_ELEMENT);this._experience=experience}get familiar_name(){return this._familiar_name}set familiar_name(familiar_name){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.familiar_name",scorm12_errors$1.READ_ONLY_ELEMENT);this._familiar_name=familiar_name}get instructor_name(){return this._instructor_name}set instructor_name(instructor_name){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.instructor_name",scorm12_errors$1.READ_ONLY_ELEMENT);this._instructor_name=instructor_name}get title(){return this._title}set title(title){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.title",scorm12_errors$1.READ_ONLY_ELEMENT);this._title=title}get native_language(){return this._native_language}set native_language(native_language){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.native_language",scorm12_errors$1.READ_ONLY_ELEMENT);this._native_language=native_language}get state(){return this._state}set state(state){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.state",scorm12_errors$1.READ_ONLY_ELEMENT);this._state=state}get street_address(){return this._street_address}set street_address(street_address){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.street_address",scorm12_errors$1.READ_ONLY_ELEMENT);this._street_address=street_address}get telephone(){return this._telephone}set telephone(telephone){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.telephone",scorm12_errors$1.READ_ONLY_ELEMENT);this._telephone=telephone}get years_experience(){return this._years_experience}set years_experience(years_experience){if(this.initialized)throw new AICCValidationError("cmi.student_demographics.years_experience",scorm12_errors$1.READ_ONLY_ELEMENT);this._years_experience=years_experience}toJSON(){this.jsonString=!0;const result={city:this.city,class:this.class,company:this.company,country:this.country,experience:this.experience,familiar_name:this.familiar_name,instructor_name:this.instructor_name,title:this.title,native_language:this.native_language,state:this.state,street_address:this.street_address,telephone:this.telephone,years_experience:this.years_experience};return delete this.jsonString,result}}class CMITries extends CMIArray{constructor(){super({CMIElement:"cmi.student_data.tries",children:aicc_constants.tries_children})}}class CMITriesObject extends BaseCMI{constructor(){super("cmi.student_data.tries.n"),this._status="",this._time="",this.score=new CMIScore({CMIElement:"cmi.student_data.tries.n.score",score_children:aicc_constants.score_children,score_range:aicc_regex.score_range,invalidErrorCode:scorm12_errors$1.INVALID_SET_VALUE,invalidTypeCode:scorm12_errors$1.TYPE_MISMATCH,invalidRangeCode:scorm12_errors$1.VALUE_OUT_OF_RANGE,errorClass:AICCValidationError})}initialize(){super.initialize(),this.score?.initialize()}reset(){this._initialized=!1,this._status="",this._time="",this.score?.reset()}get status(){return this._status}set status(status){checkAICCValidFormat(this._cmi_element+".status",status,aicc_regex.CMIStatus2)&&(this._status=status)}get time(){return this._time}set time(time){checkAICCValidFormat(this._cmi_element+".time",time,aicc_regex.CMITime)&&(this._time=time)}toJSON(){this.jsonString=!0;const result={status:this.status,time:this.time,score:this.score};return delete this.jsonString,result}}class CMIAttemptRecords extends CMIArray{constructor(){super({CMIElement:"cmi.student_data.attempt_records",children:aicc_constants.attempt_records_children})}}class CMIAttemptRecordsObject extends BaseCMI{constructor(){super("cmi.student_data.attempt_records.n"),this._lesson_status="",this.score=new CMIScore({CMIElement:"cmi.student_data.attempt_records.n.score",score_children:aicc_constants.score_children,score_range:aicc_regex.score_range,invalidErrorCode:scorm12_errors$1.INVALID_SET_VALUE,invalidTypeCode:scorm12_errors$1.TYPE_MISMATCH,invalidRangeCode:scorm12_errors$1.VALUE_OUT_OF_RANGE,errorClass:AICCValidationError})}initialize(){super.initialize(),this._lesson_status="",this.score?.initialize()}reset(){this._initialized=!1,this.score?.reset()}get lesson_status(){return this._lesson_status}set lesson_status(lesson_status){checkAICCValidFormat(this._cmi_element+".lesson_status",lesson_status,aicc_regex.CMIStatus2)&&(this._lesson_status=lesson_status)}toJSON(){this.jsonString=!0;const result={lesson_status:this.lesson_status,score:this.score};return delete this.jsonString,result}}class AICCCMIStudentData extends CMIStudentData{constructor(){super(aicc_constants.student_data_children),this._tries_during_lesson="",this.tries=new CMITries,this.attempt_records=new CMIAttemptRecords}initialize(){super.initialize(),this.tries?.initialize(),this.attempt_records?.initialize()}reset(){this._initialized=!1,this.tries?.reset(!0),this.attempt_records?.reset(!0)}get tries_during_lesson(){return this._tries_during_lesson}set tries_during_lesson(tries_during_lesson){if(this.initialized)throw new AICCValidationError("cmi.student_data.tries_during_lesson",scorm12_errors$1.READ_ONLY_ELEMENT);this._tries_during_lesson=tries_during_lesson}toJSON(){this.jsonString=!0;const result={mastery_score:this.mastery_score,max_time_allowed:this.max_time_allowed,time_limit_action:this.time_limit_action,tries:this.tries,attempt_records:this.attempt_records};return delete this.jsonString,result}}class CMIPaths extends CMIArray{constructor(){super({CMIElement:"cmi.paths",children:aicc_constants.paths_children})}}class CMIPathsObject extends BaseCMI{constructor(){super("cmi.paths.n"),this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}reset(){this._initialized=!1,this._location_id="",this._date="",this._time="",this._status="",this._why_left="",this._time_in_element=""}get location_id(){return this._location_id}set location_id(location_id){checkAICCValidFormat(this._cmi_element+".location_id",location_id,aicc_regex.CMIString256)&&(this._location_id=location_id)}get date(){return this._date}set date(date){checkAICCValidFormat(this._cmi_element+".date",date,aicc_regex.CMIString256)&&(this._date=date)}get time(){return this._time}set time(time){checkAICCValidFormat(this._cmi_element+".time",time,aicc_regex.CMITime)&&(this._time=time)}get status(){return this._status}set status(status){checkAICCValidFormat(this._cmi_element+".status",status,aicc_regex.CMIStatus2)&&(this._status=status)}get why_left(){return this._why_left}set why_left(why_left){checkAICCValidFormat(this._cmi_element+".why_left",why_left,aicc_regex.CMIString256)&&(this._why_left=why_left)}get time_in_element(){return this._time_in_element}set time_in_element(time_in_element){checkAICCValidFormat(this._cmi_element+".time_in_element",time_in_element,aicc_regex.CMITime)&&(this._time_in_element=time_in_element)}toJSON(){this.jsonString=!0;const result={location_id:this.location_id,date:this.date,time:this.time,status:this.status,why_left:this.why_left,time_in_element:this.time_in_element};return delete this.jsonString,result}}let CMI$1=class extends CMI$2{constructor(initialized=!1){super(aicc_constants.cmi_children),initialized&&this.initialize(),this.student_preference=new AICCStudentPreferences,this.student_data=new AICCCMIStudentData,this.student_demographics=new CMIStudentDemographics,this.evaluation=new CMIEvaluation,this.paths=new CMIPaths}initialize(){super.initialize(),this.student_preference?.initialize(),this.student_data?.initialize(),this.student_demographics?.initialize(),this.evaluation?.initialize(),this.paths?.initialize()}toJSON(){this.jsonString=!0;const result={suspend_data:this.suspend_data,launch_data:this.launch_data,comments:this.comments,comments_from_lms:this.comments_from_lms,core:this.core,objectives:this.objectives,student_data:this.student_data,student_preference:this.student_preference,student_demographics:this.student_demographics,interactions:this.interactions,evaluation:this.evaluation,paths:this.paths};return delete this.jsonString,result}};class AICC extends Scorm12API{constructor(settings){super(settings),this.cmi=new CMI$1,this.nav=new NAV}getChildElement(CMIElement,value,foundFirstIndex){let newChild=super.getChildElement(CMIElement,value,foundFirstIndex);return newChild||(stringMatches(CMIElement,"cmi\\.evaluation\\.comments\\.\\d+")?newChild=new CMIEvaluationCommentsObject:stringMatches(CMIElement,"cmi\\.student_data\\.tries\\.\\d+")?newChild=new CMITriesObject:stringMatches(CMIElement,"cmi\\.student_data\\.attempt_records\\.\\d+")?newChild=new CMIAttemptRecordsObject:stringMatches(CMIElement,"cmi\\.paths\\.\\d+")&&(newChild=new CMIPathsObject)),newChild}replaceWithAnotherScormAPI(newAPI){this.cmi=newAPI.cmi,this.nav=newAPI.nav}}const scorm2004_errors=scorm2004_constants.error_descriptions;class Scorm2004ValidationError extends ValidationError{constructor(CMIElement,errorCode){!{}.hasOwnProperty.call(scorm2004_errors,errorCode+"")?super(CMIElement,101,scorm2004_errors[101].basicMessage,scorm2004_errors[101].detailMessage):super(CMIElement,errorCode,scorm2004_errors[errorCode+""].basicMessage,scorm2004_errors[errorCode+""].detailMessage),Object.setPrototypeOf(this,Scorm2004ValidationError.prototype)}}function check2004ValidFormat(CMIElement,value,regexPattern,allowEmptyString){return checkValidFormat(CMIElement,value,regexPattern,scorm2004_errors$1.TYPE_MISMATCH,Scorm2004ValidationError,allowEmptyString)}function check2004ValidRange(CMIElement,value,rangePattern){return checkValidRange(CMIElement,value,rangePattern,scorm2004_errors$1.VALUE_OUT_OF_RANGE,Scorm2004ValidationError)}class CMILearnerPreference extends BaseCMI{constructor(){super("cmi.learner_preference"),this.__children=scorm2004_constants.student_preference_children,this._audio_level="1",this._language="",this._delivery_speed="1",this._audio_captioning="0"}reset(){this._initialized=!1}get _children(){return this.__children}set _children(_children){throw new Scorm2004ValidationError(this._cmi_element+"._children",scorm2004_errors$1.READ_ONLY_ELEMENT)}get audio_level(){return this._audio_level}set audio_level(audio_level){check2004ValidFormat(this._cmi_element+".audio_level",audio_level,scorm2004_regex_CMIDecimal)&&check2004ValidRange(this._cmi_element+".audio_level",audio_level,"0#999.9999999")&&(this._audio_level=audio_level)}get language(){return this._language}set language(language){check2004ValidFormat(this._cmi_element+".language",language,"^([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?$|^$")&&(this._language=language)}get delivery_speed(){return this._delivery_speed}set delivery_speed(delivery_speed){check2004ValidFormat(this._cmi_element+".delivery_speed",delivery_speed,scorm2004_regex_CMIDecimal)&&check2004ValidRange(this._cmi_element+".delivery_speed",delivery_speed,"0#999.9999999")&&(this._delivery_speed=delivery_speed)}get audio_captioning(){return this._audio_captioning}set audio_captioning(audio_captioning){check2004ValidFormat(this._cmi_element+".audio_captioning",audio_captioning,"^-?([0-9]+)$")&&check2004ValidRange(this._cmi_element+".audio_captioning",audio_captioning,"-1#1")&&(this._audio_captioning=audio_captioning)}toJSON(){this.jsonString=!0;const result={audio_level:this.audio_level,language:this.language,delivery_speed:this.delivery_speed,audio_captioning:this.audio_captioning};return delete this.jsonString,result}}const LearnerResponses={"true-false":{format:"^true$|^false$",max:1,delimiter:"",unique:!1},choice:{format:scorm2004_regex_CMILongIdentifier,max:36,delimiter:"[,]",unique:!0},"fill-in":{format:scorm2004_regex_CMILangString250,max:10,delimiter:"[,]",unique:!1},"long-fill-in":{format:scorm2004_regex_CMILangString4000,max:1,delimiter:"",unique:!1},matching:{format:"^[\\w\\.\\-\\_]{1,250}$",format2:"^[\\w\\.\\-\\_]{1,250}$",max:36,delimiter:"[,]",delimiter2:"[.]",unique:!1},performance:{format:"^$|^[\\w\\.\\-\\_]{1,250}$",format2:scorm2004_regex_CMIDecimal+"|^$|^[\\w\\.\\-\\_]{1,250}$",max:250,delimiter:"[,]",delimiter2:"[.]",unique:!1},sequencing:{format:"^[\\w\\.\\-\\_]{1,250}$",max:36,delimiter:"[,]",unique:!1},likert:{format:"^[\\w\\.\\-\\_]{1,250}$",max:1,delimiter:"",unique:!1},numeric:{format:scorm2004_regex_CMIDecimal,max:1,delimiter:"",unique:!1},other:{format:"^[\\u0000-\\uFFFF]{0,4000}$",max:1,delimiter:"",unique:!1}},CorrectResponses={"true-false":{max:1,delimiter:"",unique:!1,duplicate:!1,format:"^true$|^false$",limit:1},choice:{max:36,delimiter:"[,]",unique:!0,duplicate:!1,format:scorm2004_regex_CMILongIdentifier},"fill-in":{max:10,delimiter:"[,]",unique:!1,duplicate:!1,format:"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?})?(.{0,250})?)?$"},"long-fill-in":{max:1,delimiter:"",unique:!1,duplicate:!0,format:scorm2004_regex_CMILangString4000},matching:{max:36,delimiter:"[,]",delimiter2:"[.]",unique:!1,duplicate:!1,format:"^[\\w\\.\\-\\_]{1,250}$",format2:"^[\\w\\.\\-\\_]{1,250}$"},performance:{max:250,delimiter:"[,]",delimiter2:"[.]",delimiter3:"[:]",unique:!1,duplicate:!1,format:"^$|^[\\w\\.\\-\\_]{1,250}$",format2:scorm2004_regex_CMIDecimal+"|^$|^[\\w\\.\\-\\_]{1,250}$"},sequencing:{max:36,delimiter:"[,]",unique:!1,duplicate:!1,format:"^[\\w\\.\\-\\_]{1,250}$"},likert:{max:1,delimiter:"",unique:!1,duplicate:!1,format:"^[\\w\\.\\-\\_]{1,250}$",limit:1},numeric:{max:2,delimiter:"[:]",unique:!1,duplicate:!1,format:scorm2004_regex_CMIDecimal,limit:1},other:{max:1,delimiter:"",unique:!1,duplicate:!1,format:"^[\\u0000-\\uFFFF]{0,4000}$",limit:1}};class CMIInteractions extends CMIArray{constructor(){super({CMIElement:"cmi.interactions",children:scorm2004_constants.interactions_children,errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError})}}class CMIInteractionsObject extends BaseCMI{constructor(){super("cmi.interactions.n"),this._id="",this._type="",this._timestamp="",this._weighting="",this._learner_response="",this._result="",this._latency="",this._description="",this.objectives=new CMIArray({CMIElement:"cmi.interactions.n.objectives",errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError,children:scorm2004_constants.objectives_children}),this.correct_responses=new CMIArray({CMIElement:"cmi.interactions.n.correct_responses",errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError,children:scorm2004_constants.correct_responses_children})}initialize(){super.initialize(),this.objectives?.initialize(),this.correct_responses?.initialize()}reset(){this._initialized=!1,this._id="",this._type="",this._timestamp="",this._weighting="",this._learner_response="",this._result="",this._latency="",this._description="",this.objectives=new CMIArray({CMIElement:"cmi.interactions.n.objectives",errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError,children:scorm2004_constants.objectives_children}),this.correct_responses=new CMIArray({CMIElement:"cmi.interactions.n.correct_responses",errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError,children:scorm2004_constants.correct_responses_children})}get id(){return this._id}set id(id){check2004ValidFormat(this._cmi_element+".id",id,scorm2004_regex_CMILongIdentifier)&&(this._id=id)}get type(){return this._type}set type(type){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".type",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".type",type,"^(true-false|choice|fill-in|long-fill-in|matching|performance|sequencing|likert|numeric|other)$")&&(this._type=type)}get timestamp(){return this._timestamp}set timestamp(timestamp){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".timestamp",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".timestamp",timestamp,scorm2004_regex_CMITime)&&(this._timestamp=timestamp)}get weighting(){return this._weighting}set weighting(weighting){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".weighting",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".weighting",weighting,scorm2004_regex_CMIDecimal)&&(this._weighting=weighting)}get learner_response(){return this._learner_response}set learner_response(learner_response){if(this.initialized&&(""===this._type||""===this._id))throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);{let nodes=[];const response_type=LearnerResponses[this.type];if(!response_type)throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH);if(response_type?.delimiter?nodes=learner_response.split("[,]"===response_type.delimiter?",":response_type.delimiter):nodes[0]=learner_response,0>=nodes.length||nodes.length>response_type.max)throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.GENERAL_SET_FAILURE);{const formatRegex=RegExp(response_type.format);for(let i=0;nodes.length>i;i++)if(response_type?.delimiter2){const values=nodes[i].split("[.]"===response_type.delimiter2?".":response_type.delimiter2);if(2!==values.length)throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH);if(!values[0].match(formatRegex))throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH);if(!response_type.format2||!values[1].match(RegExp(response_type.format2)))throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH)}else{if(!nodes[i].match(formatRegex))throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH);if(""!==nodes[i]&&response_type.unique)for(let j=0;i>j;j++)if(nodes[i]===nodes[j])throw new Scorm2004ValidationError(this._cmi_element+".learner_response",scorm2004_errors$1.TYPE_MISMATCH)}}this._learner_response=learner_response}}get result(){return this._result}set result(result){check2004ValidFormat(this._cmi_element+".result",result,"^(correct|incorrect|unanticipated|neutral|-?([0-9]{1,4})(\\.[0-9]{1,18})?)$")&&(this._result=result)}get latency(){return this._latency}set latency(latency){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".latency",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".latency",latency,scorm2004_regex_CMITimespan)&&(this._latency=latency)}get description(){return this._description}set description(description){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".description",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".description",description,scorm2004_regex_CMILangString250,!0)&&(this._description=description)}toJSON(){this.jsonString=!0;const result={id:this.id,type:this.type,objectives:this.objectives,timestamp:this.timestamp,weighting:this.weighting,learner_response:this.learner_response,result:this.result,latency:this.latency,description:this.description,correct_responses:this.correct_responses};return delete this.jsonString,result}}class CMIInteractionsObjectivesObject extends BaseCMI{constructor(){super("cmi.interactions.n.objectives.n"),this._id=""}reset(){this._initialized=!1,this._id=""}get id(){return this._id}set id(id){check2004ValidFormat(this._cmi_element+".id",id,scorm2004_regex_CMILongIdentifier)&&(this._id=id)}toJSON(){this.jsonString=!0;const result={id:this.id};return delete this.jsonString,result}}class CMIInteractionsCorrectResponsesObject extends BaseCMI{constructor(parent){super("cmi.interactions.n.correct_responses.n"),this._pattern="",this._parent=parent}reset(){this._initialized=!1,this._pattern=""}get pattern(){return this._pattern}set pattern(pattern){if(check2004ValidFormat(this._cmi_element+".pattern",pattern,"^.*$")){if(this._parent&&this._parent.type){const interactionType=this._parent.type,response=CorrectResponses[interactionType];if(response){let isValid=!0,nodes=[];if(response?.delimiter?nodes=(pattern+"").split(response.delimiter):nodes[0]=pattern,nodes.length>0&&response.max>=nodes.length){const formatRegex=RegExp(response.format);for(let i=0;nodes.length>i&&isValid;i++)if(response?.delimiter2){const values=nodes[i].split(response.delimiter2);2===values.length&&values[0].match(formatRegex)&&response.format2&&values[1].match(RegExp(response.format2))||(isValid=!1)}else{const matches=nodes[i].match(formatRegex);(!matches&&""!==pattern||!matches&&"true-false"===interactionType)&&(isValid=!1)}}else nodes.length>response.max&&(isValid=!1);if(!isValid)throw new Scorm2004ValidationError(this._cmi_element+".pattern",scorm2004_errors$1.TYPE_MISMATCH)}}this._pattern=pattern}}toJSON(){this.jsonString=!0;const result={pattern:this.pattern};return delete this.jsonString,result}}class Scorm2004CMIScore extends CMIScore{constructor(){super({CMIElement:"cmi.score",score_children:scorm2004_constants.score_children,max:"",invalidErrorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,invalidTypeCode:scorm2004_errors$1.TYPE_MISMATCH,invalidRangeCode:scorm2004_errors$1.VALUE_OUT_OF_RANGE,decimalRegex:scorm2004_regex_CMIDecimal,errorClass:Scorm2004ValidationError}),this._scaled=""}reset(){this._initialized=!1,this._scaled="",this._raw="",this._min="",this._max=""}get scaled(){return this._scaled}set scaled(scaled){check2004ValidFormat(this._cmi_element+".scaled",scaled,scorm2004_regex_CMIDecimal)&&check2004ValidRange(this._cmi_element+".scaled",scaled,"-1#1")&&(this._scaled=scaled)}toJSON(){this.jsonString=!0;const result={scaled:this.scaled,raw:this.raw,min:this.min,max:this.max};return delete this.jsonString,result}}class CMICommentsFromLMS extends CMIArray{constructor(){super({CMIElement:"cmi.comments_from_lms",children:scorm2004_constants.comments_children,errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError})}}class CMICommentsFromLearner extends CMIArray{constructor(){super({CMIElement:"cmi.comments_from_learner",children:scorm2004_constants.comments_children,errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError})}}class CMICommentsObject extends BaseCMI{constructor(readOnlyAfterInit=!1){super("cmi.comments_from_learner.n"),this._comment="",this._location="",this._timestamp="",this._comment="",this._location="",this._timestamp="",this._readOnlyAfterInit=readOnlyAfterInit}reset(){this._initialized=!1}get comment(){return this._comment}set comment(comment){if(this.initialized&&this._readOnlyAfterInit)throw new Scorm2004ValidationError(this._cmi_element+".comment",scorm2004_errors$1.READ_ONLY_ELEMENT);check2004ValidFormat(this._cmi_element+".comment",comment,scorm2004_regex_CMILangString4000,!0)&&(this._comment=comment)}get location(){return this._location}set location(location){if(this.initialized&&this._readOnlyAfterInit)throw new Scorm2004ValidationError(this._cmi_element+".location",scorm2004_errors$1.READ_ONLY_ELEMENT);check2004ValidFormat(this._cmi_element+".location",location,"^[\\u0000-\\uFFFF]{0,250}$")&&(this._location=location)}get timestamp(){return this._timestamp}set timestamp(timestamp){if(this.initialized&&this._readOnlyAfterInit)throw new Scorm2004ValidationError(this._cmi_element+".timestamp",scorm2004_errors$1.READ_ONLY_ELEMENT);check2004ValidFormat(this._cmi_element+".timestamp",timestamp,scorm2004_regex_CMITime)&&(this._timestamp=timestamp)}toJSON(){this.jsonString=!0;const result={comment:this.comment,location:this.location,timestamp:this.timestamp};return delete this.jsonString,result}}class CMIObjectives extends CMIArray{constructor(){super({CMIElement:"cmi.objectives",children:scorm2004_constants.objectives_children,errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError})}findObjectiveById(id){return this.childArray.find((objective=>objective.id===id))}findObjectiveByIndex(index){return this.childArray[index]}setObjectiveByIndex(index,objective){this.childArray[index]=objective}}class CMIObjectivesObject extends BaseCMI{constructor(){super("cmi.objectives.n"),this._id="",this._success_status="unknown",this._completion_status="unknown",this._progress_measure="",this._description="",this.score=new Scorm2004CMIScore}reset(){this._initialized=!1}initialize(){super.initialize(),this.score?.initialize()}get id(){return this._id}set id(id){check2004ValidFormat(this._cmi_element+".id",id,scorm2004_regex_CMILongIdentifier)&&(this._id=id)}get success_status(){return this._success_status}set success_status(success_status){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".success_status",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".success_status",success_status,"^(passed|failed|unknown)$")&&(this._success_status=success_status)}get completion_status(){return this._completion_status}set completion_status(completion_status){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".completion_status",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".completion_status",completion_status,"^(completed|incomplete|not attempted|unknown)$")&&(this._completion_status=completion_status)}get progress_measure(){return this._progress_measure}set progress_measure(progress_measure){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".progress_measure",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".progress_measure",progress_measure,scorm2004_regex_CMIDecimal)&&check2004ValidRange(this._cmi_element+".progress_measure",progress_measure,"0#1")&&(this._progress_measure=progress_measure)}get description(){return this._description}set description(description){if(this.initialized&&""===this._id)throw new Scorm2004ValidationError(this._cmi_element+".description",scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED);check2004ValidFormat(this._cmi_element+".description",description,scorm2004_regex_CMILangString250,!0)&&(this._description=description)}toJSON(){this.jsonString=!0;const result={id:this.id,success_status:this.success_status,completion_status:this.completion_status,progress_measure:this.progress_measure,description:this.description,score:this.score};return delete this.jsonString,result}}class CMIMetadata extends BaseCMI{constructor(){super("cmi"),this.__version="1.0",this.__children=scorm2004_constants.cmi_children}get _version(){return this.__version}set _version(_version){throw new Scorm2004ValidationError(this._cmi_element+"._version",scorm2004_errors$1.READ_ONLY_ELEMENT)}get _children(){return this.__children}set _children(_children){throw new Scorm2004ValidationError(this._cmi_element+"._children",scorm2004_errors$1.READ_ONLY_ELEMENT)}reset(){this._initialized=!1}}class CMILearner extends BaseCMI{constructor(){super("cmi"),this._learner_id="",this._learner_name=""}get learner_id(){return this._learner_id}set learner_id(learner_id){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".learner_id",scorm2004_errors$1.READ_ONLY_ELEMENT);this._learner_id=learner_id}get learner_name(){return this._learner_name}set learner_name(learner_name){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".learner_name",scorm2004_errors$1.READ_ONLY_ELEMENT);this._learner_name=learner_name}reset(){this._initialized=!1}}class CMIStatus extends BaseCMI{constructor(){super("cmi"),this._completion_status="unknown",this._success_status="unknown",this._progress_measure=""}get completion_status(){return this._completion_status}set completion_status(completion_status){check2004ValidFormat(this._cmi_element+".completion_status",completion_status,"^(completed|incomplete|not attempted|unknown)$")&&(this._completion_status=completion_status)}get success_status(){return this._success_status}set success_status(success_status){check2004ValidFormat(this._cmi_element+".success_status",success_status,"^(passed|failed|unknown)$")&&(this._success_status=success_status)}get progress_measure(){return this._progress_measure}set progress_measure(progress_measure){check2004ValidFormat(this._cmi_element+".progress_measure",progress_measure,scorm2004_regex_CMIDecimal)&&check2004ValidRange(this._cmi_element+".progress_measure",progress_measure,"0#1")&&(this._progress_measure=progress_measure)}reset(){this._initialized=!1,this._completion_status="unknown",this._success_status="unknown",this._progress_measure=""}}class CMISession extends BaseCMI{constructor(){super("cmi"),this._entry="",this._exit="",this._session_time="PT0H0M0S",this._total_time=""}get entry(){return this._entry}set entry(entry){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".entry",scorm2004_errors$1.READ_ONLY_ELEMENT);this._entry=entry}get exit(){if(!this.jsonString)throw new Scorm2004ValidationError(this._cmi_element+".exit",scorm2004_errors$1.WRITE_ONLY_ELEMENT);return this._exit}set exit(exit){check2004ValidFormat(this._cmi_element+".exit",exit,"^(time-out|suspend|logout|normal)$",!0)&&(this._exit=exit)}get session_time(){if(!this.jsonString)throw new Scorm2004ValidationError(this._cmi_element+".session_time",scorm2004_errors$1.WRITE_ONLY_ELEMENT);return this._session_time}set session_time(session_time){check2004ValidFormat(this._cmi_element+".session_time",session_time,scorm2004_regex_CMITimespan)&&(this._session_time=session_time)}get total_time(){return this._total_time}set total_time(total_time){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".total_time",scorm2004_errors$1.READ_ONLY_ELEMENT);this._total_time=total_time}getCurrentTotalTime(){let sessionTime=this._session_time;const startTime=this.start_time;if(null!=startTime){const seconds=(new Date).getTime()-startTime;sessionTime=getSecondsAsISODuration(seconds/1e3)}return function(first,second){const regex=RegExp(scorm2004_regex_CMITimespan);return getSecondsAsISODuration(getDurationAsSeconds(first,regex)+getDurationAsSeconds(second,regex))}(this._total_time,sessionTime)}reset(){this._initialized=!1,this._entry="",this._exit="",this._session_time="PT0H0M0S"}}class CMIContent extends BaseCMI{constructor(){super("cmi"),this._location="",this._launch_data="",this._suspend_data=""}get location(){return this._location}set location(location){check2004ValidFormat(this._cmi_element+".location",location,"^[\\u0000-\\uFFFF]{0,1000}$")&&(this._location=location)}get launch_data(){return this._launch_data}set launch_data(launch_data){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".launch_data",scorm2004_errors$1.READ_ONLY_ELEMENT);this._launch_data=launch_data}get suspend_data(){return this._suspend_data}set suspend_data(suspend_data){check2004ValidFormat(this._cmi_element+".suspend_data",suspend_data,"^[\\u0000-\\uFFFF]{0,64000}$",!0)&&(this._suspend_data=suspend_data)}reset(){this._initialized=!1,this._location="",this._suspend_data=""}}class CMISettings extends BaseCMI{constructor(){super("cmi"),this._credit="credit",this._mode="normal",this._time_limit_action="continue,no message",this._max_time_allowed=""}get credit(){return this._credit}set credit(credit){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".credit",scorm2004_errors$1.READ_ONLY_ELEMENT);this._credit=credit}get mode(){return this._mode}set mode(mode){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".mode",scorm2004_errors$1.READ_ONLY_ELEMENT);this._mode=mode}get time_limit_action(){return this._time_limit_action}set time_limit_action(time_limit_action){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".time_limit_action",scorm2004_errors$1.READ_ONLY_ELEMENT);this._time_limit_action=time_limit_action}get max_time_allowed(){return this._max_time_allowed}set max_time_allowed(max_time_allowed){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".max_time_allowed",scorm2004_errors$1.READ_ONLY_ELEMENT);this._max_time_allowed=max_time_allowed}reset(){this._initialized=!1}}class CMIThresholds extends BaseCMI{constructor(){super("cmi"),this._scaled_passing_score="",this._completion_threshold=""}get scaled_passing_score(){return this._scaled_passing_score}set scaled_passing_score(scaled_passing_score){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".scaled_passing_score",scorm2004_errors$1.READ_ONLY_ELEMENT);this._scaled_passing_score=scaled_passing_score}get completion_threshold(){return this._completion_threshold}set completion_threshold(completion_threshold){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".completion_threshold",scorm2004_errors$1.READ_ONLY_ELEMENT);this._completion_threshold=completion_threshold}reset(){this._initialized=!1}}class CMI extends BaseRootCMI{constructor(initialized=!1){super("cmi"),this.metadata=new CMIMetadata,this.learner=new CMILearner,this.status=new CMIStatus,this.session=new CMISession,this.content=new CMIContent,this.settings=new CMISettings,this.thresholds=new CMIThresholds,this.learner_preference=new CMILearnerPreference,this.score=new Scorm2004CMIScore,this.comments_from_learner=new CMICommentsFromLearner,this.comments_from_lms=new CMICommentsFromLMS,this.interactions=new CMIInteractions,this.objectives=new CMIObjectives,initialized&&this.initialize()}initialize(){super.initialize(),this.metadata?.initialize(),this.learner?.initialize(),this.status?.initialize(),this.session?.initialize(),this.content?.initialize(),this.settings?.initialize(),this.thresholds?.initialize(),this.learner_preference?.initialize(),this.score?.initialize(),this.comments_from_learner?.initialize(),this.comments_from_lms?.initialize(),this.interactions?.initialize(),this.objectives?.initialize()}reset(){this._initialized=!1,this.metadata?.reset(),this.learner?.reset(),this.status?.reset(),this.session?.reset(),this.content?.reset(),this.settings?.reset(),this.thresholds?.reset(),this.objectives?.reset(!1),this.interactions?.reset(!0),this.score?.reset(),this.comments_from_learner?.reset(),this.comments_from_lms?.reset(),this.learner_preference?.reset()}get _version(){return this.metadata._version}set _version(_version){this.metadata._version=_version}get _children(){return this.metadata._children}set _children(_children){this.metadata._children=_children}get completion_status(){return this.status.completion_status}set completion_status(completion_status){this.status.completion_status=completion_status}get completion_threshold(){return this.thresholds.completion_threshold}set completion_threshold(completion_threshold){this.thresholds.completion_threshold=completion_threshold}get credit(){return this.settings.credit}set credit(credit){this.settings.credit=credit}get entry(){return this.session.entry}set entry(entry){this.session.entry=entry}get exit(){return this.session.jsonString=this.jsonString,this.session.exit}set exit(exit){this.session.exit=exit}get launch_data(){return this.content.launch_data}set launch_data(launch_data){this.content.launch_data=launch_data}get learner_id(){return this.learner.learner_id}set learner_id(learner_id){this.learner.learner_id=learner_id}get learner_name(){return this.learner.learner_name}set learner_name(learner_name){this.learner.learner_name=learner_name}get location(){return this.content.location}set location(location){this.content.location=location}get max_time_allowed(){return this.settings.max_time_allowed}set max_time_allowed(max_time_allowed){this.settings.max_time_allowed=max_time_allowed}get mode(){return this.settings.mode}set mode(mode){this.settings.mode=mode}get progress_measure(){return this.status.progress_measure}set progress_measure(progress_measure){this.status.progress_measure=progress_measure}get scaled_passing_score(){return this.thresholds.scaled_passing_score}set scaled_passing_score(scaled_passing_score){this.thresholds.scaled_passing_score=scaled_passing_score}get session_time(){return this.session.jsonString=this.jsonString,this.session.session_time}set session_time(session_time){this.session.session_time=session_time}get success_status(){return this.status.success_status}set success_status(success_status){this.status.success_status=success_status}get suspend_data(){return this.content.suspend_data}set suspend_data(suspend_data){this.content.suspend_data=suspend_data}get time_limit_action(){return this.settings.time_limit_action}set time_limit_action(time_limit_action){this.settings.time_limit_action=time_limit_action}get total_time(){return this.session.total_time}set total_time(total_time){this.session.total_time=total_time}getCurrentTotalTime(){return this.session.getCurrentTotalTime()}toJSON(){this.jsonString=!0,this.session.jsonString=!0;const result={comments_from_learner:this.comments_from_learner,comments_from_lms:this.comments_from_lms,completion_status:this.completion_status,completion_threshold:this.completion_threshold,credit:this.credit,entry:this.entry,exit:this.exit,interactions:this.interactions,launch_data:this.launch_data,learner_id:this.learner_id,learner_name:this.learner_name,learner_preference:this.learner_preference,location:this.location,max_time_allowed:this.max_time_allowed,mode:this.mode,objectives:this.objectives,progress_measure:this.progress_measure,scaled_passing_score:this.scaled_passing_score,score:this.score,session_time:this.session_time,success_status:this.success_status,suspend_data:this.suspend_data,time_limit_action:this.time_limit_action};return delete this.jsonString,delete this.session.jsonString,result}}class ADL extends BaseCMI{constructor(){super("adl"),this.data=new ADLData,this._sequencing=null,this.nav=new ADLNav,this.data=new ADLData}initialize(){super.initialize(),this.nav?.initialize()}reset(){this._initialized=!1,this.nav?.reset()}get sequencing(){return this._sequencing}set sequencing(sequencing){this._sequencing=sequencing,sequencing&&(sequencing.adlNav=this.nav,this.nav.sequencing=sequencing)}toJSON(){this.jsonString=!0;const result={nav:this.nav,data:this.data};return delete this.jsonString,result}}class ADLNav extends BaseCMI{constructor(){super("adl.nav"),this._request="_none_",this._sequencing=null,this.request_valid=new ADLNavRequestValid}get sequencing(){return this._sequencing}set sequencing(sequencing){this._sequencing=sequencing}initialize(){super.initialize(),this.request_valid?.initialize()}reset(){this._initialized=!1,this._request="_none_",this._sequencing=null,this.request_valid?.reset()}get request(){return this._request}set request(request){check2004ValidFormat(this._cmi_element+".request",request,scorm2004_regex_NAVEvent)&&this._request!==request&&(this._request=request,this._sequencing&&this._sequencing.processNavigationRequest(request))}toJSON(){this.jsonString=!0;const result={request:this.request};return delete this.jsonString,result}}class ADLData extends CMIArray{constructor(){super({CMIElement:"adl.data",children:scorm2004_constants.adl_data_children,errorCode:scorm2004_errors$1.READ_ONLY_ELEMENT,errorClass:Scorm2004ValidationError})}}class ADLDataObject extends BaseCMI{constructor(){super("adl.data.n"),this._id="",this._store=""}reset(){this._initialized=!1}get id(){return this._id}set id(id){check2004ValidFormat(this._cmi_element+".id",id,scorm2004_regex_CMILongIdentifier)&&(this._id=id)}get store(){return this._store}set store(store){check2004ValidFormat(this._cmi_element+".store",store,scorm2004_regex_CMILangString4000)&&(this._store=store)}toJSON(){this.jsonString=!0;const result={id:this._id,store:this._store};return delete this.jsonString,result}}class ADLNavRequestValid extends BaseCMI{constructor(){super("adl.nav.request_valid"),this._continue="unknown",this._previous="unknown",this._choice={},this._jump={}}reset(){this._initialized=!1,this._continue="unknown",this._previous="unknown"}get continue(){return this._continue}set continue(_continue){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".continue",scorm2004_errors$1.READ_ONLY_ELEMENT);check2004ValidFormat(this._cmi_element+".continue",_continue,"^(unknown|true|false$)")&&(this._continue=_continue)}get previous(){return this._previous}set previous(_previous){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".previous",scorm2004_errors$1.READ_ONLY_ELEMENT);check2004ValidFormat(this._cmi_element+".previous",_previous,"^(unknown|true|false$)")&&(this._previous=_previous)}get choice(){return this._choice}set choice(choice){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".choice",scorm2004_errors$1.READ_ONLY_ELEMENT);if("object"!=typeof choice)throw new Scorm2004ValidationError(this._cmi_element+".choice",scorm2004_errors$1.TYPE_MISMATCH);for(const key in choice)if({}.hasOwnProperty.call(choice,key)&&check2004ValidFormat(this._cmi_element+".choice."+key,choice[key],"^(unknown|true|false$)")&&check2004ValidFormat(this._cmi_element+".choice."+key,key,"^{target=\\S{0,}[a-zA-Z0-9-_]+}$")){const value=choice[key];"true"===value?this._choice[key]="true":"false"===value?this._choice[key]="false":"unknown"===value&&(this._choice[key]="unknown")}}get jump(){return this._jump}set jump(jump){if(this.initialized)throw new Scorm2004ValidationError(this._cmi_element+".jump",scorm2004_errors$1.READ_ONLY_ELEMENT);if("object"!=typeof jump)throw new Scorm2004ValidationError(this._cmi_element+".jump",scorm2004_errors$1.TYPE_MISMATCH);for(const key in jump)if({}.hasOwnProperty.call(jump,key)&&check2004ValidFormat(this._cmi_element+".jump."+key,jump[key],"^(unknown|true|false$)")&&check2004ValidFormat(this._cmi_element+".jump."+key,key,"^{target=\\S{0,}[a-zA-Z0-9-_]+}$")){const value=jump[key];"true"===value?this._jump[key]="true":"false"===value?this._jump[key]="false":"unknown"===value&&(this._jump[key]="unknown")}}toJSON(){this.jsonString=!0;const result={previous:this._previous,continue:this._continue,choice:this._choice,jump:this._jump};return delete this.jsonString,result}}var RuleActionType=(RuleActionType2=>(RuleActionType2.SKIP="skip",RuleActionType2.DISABLED="disabled",RuleActionType2.HIDE_FROM_CHOICE="hideFromChoice",RuleActionType2.STOP_FORWARD_TRAVERSAL="stopForwardTraversal",RuleActionType2.EXIT_PARENT="exitParent",RuleActionType2.EXIT_ALL="exitAll",RuleActionType2.RETRY="retry",RuleActionType2.RETRY_ALL="retryAll",RuleActionType2.CONTINUE="continue",RuleActionType2.PREVIOUS="previous",RuleActionType2.EXIT="exit",RuleActionType2))(RuleActionType||{});class RuleCondition extends BaseCMI{constructor(condition="always",operator=null,parameters=new Map){super("ruleCondition"),this._condition="always",this._operator=null,this._parameters=new Map,this._condition=condition,this._operator=operator,this._parameters=parameters}reset(){this._initialized=!1}get condition(){return this._condition}set condition(condition){this._condition=condition}get operator(){return this._operator}set operator(operator){this._operator=operator}get parameters(){return this._parameters}set parameters(parameters){this._parameters=parameters}evaluate(activity){switch(this._condition){case"satisfied":return"passed"===activity.successStatus;case"objectiveStatusKnown":case"objectiveMeasureKnown":return activity.objectiveMeasureStatus;case"objectiveMeasureGreaterThan":{const greaterThanValue=this._parameters.get("threshold")||0;return activity.objectiveMeasureStatus&&activity.objectiveNormalizedMeasure>greaterThanValue}case"objectiveMeasureLessThan":{const lessThanValue=this._parameters.get("threshold")||0;return activity.objectiveMeasureStatus&&lessThanValue>activity.objectiveNormalizedMeasure}case"completed":return activity.isCompleted;case"progressKnown":return"unknown"!==activity.completionStatus;case"attempted":return activity.attemptCount>0;case"attemptLimitExceeded":{const attemptLimit=this._parameters.get("attemptLimit")||0;return attemptLimit>0&&activity.attemptCount>=attemptLimit}case"timeLimitExceeded":case"outsideAvailableTimeRange":default:return!1;case"always":return!0}}toJSON(){this.jsonString=!0;const result={condition:this._condition,operator:this._operator,parameters:Object.fromEntries(this._parameters)};return delete this.jsonString,result}}class SequencingRule extends BaseCMI{constructor(action="skip",conditionCombination="and"){super("sequencingRule"),this._conditions=[],this._action="skip",this._conditionCombination="and",this._action=action,this._conditionCombination=conditionCombination}reset(){this._initialized=!1,this._conditions=[]}get conditions(){return this._conditions}addCondition(condition){if(!(condition instanceof RuleCondition))throw new Scorm2004ValidationError(this._cmi_element+".conditions",scorm2004_errors$1.TYPE_MISMATCH);this._conditions.push(condition)}removeCondition(condition){const index=this._conditions.indexOf(condition);return-1!==index&&(this._conditions.splice(index,1),!0)}get action(){return this._action}set action(action){this._action=action}get conditionCombination(){return this._conditionCombination}set conditionCombination(conditionCombination){this._conditionCombination=conditionCombination}evaluate(activity){return 0===this._conditions.length||("and"===this._conditionCombination?this._conditions.every((condition=>condition.evaluate(activity))):"or"===this._conditionCombination&&this._conditions.some((condition=>condition.evaluate(activity))))}toJSON(){this.jsonString=!0;const result={conditions:this._conditions,action:this._action,conditionCombination:this._conditionCombination};return delete this.jsonString,result}}class SequencingRules extends BaseCMI{constructor(){super("sequencingRules"),this._preConditionRules=[],this._exitConditionRules=[],this._postConditionRules=[]}reset(){this._initialized=!1,this._preConditionRules=[],this._exitConditionRules=[],this._postConditionRules=[]}get preConditionRules(){return this._preConditionRules}addPreConditionRule(rule){if(!(rule instanceof SequencingRule))throw new Scorm2004ValidationError(this._cmi_element+".preConditionRules",scorm2004_errors$1.TYPE_MISMATCH);this._preConditionRules.push(rule)}get exitConditionRules(){return this._exitConditionRules}addExitConditionRule(rule){if(!(rule instanceof SequencingRule))throw new Scorm2004ValidationError(this._cmi_element+".exitConditionRules",scorm2004_errors$1.TYPE_MISMATCH);this._exitConditionRules.push(rule)}get postConditionRules(){return this._postConditionRules}addPostConditionRule(rule){if(!(rule instanceof SequencingRule))throw new Scorm2004ValidationError(this._cmi_element+".postConditionRules",scorm2004_errors$1.TYPE_MISMATCH);this._postConditionRules.push(rule)}evaluatePreConditionRules(activity){for(const rule of this._preConditionRules)if(rule.evaluate(activity))return rule.action;return null}evaluateExitConditionRules(activity){for(const rule of this._exitConditionRules)if(rule.evaluate(activity))return rule.action;return null}evaluatePostConditionRules(activity){for(const rule of this._postConditionRules)if(rule.evaluate(activity))return rule.action;return null}toJSON(){this.jsonString=!0;const result={preConditionRules:this._preConditionRules,exitConditionRules:this._exitConditionRules,postConditionRules:this._postConditionRules};return delete this.jsonString,result}}class RollupCondition extends BaseCMI{constructor(condition="always",parameters=new Map){super("rollupCondition"),this._condition="always",this._parameters=new Map,this._condition=condition,this._parameters=parameters}reset(){this._initialized=!1}get condition(){return this._condition}set condition(condition){this._condition=condition}get parameters(){return this._parameters}set parameters(parameters){this._parameters=parameters}evaluate(activity){switch(this._condition){case"satisfied":return"passed"===activity.successStatus;case"objectiveStatusKnown":case"objectiveMeasureKnown":return activity.objectiveMeasureStatus;case"objectiveMeasureGreaterThan":{const greaterThanValue=this._parameters.get("threshold")||0;return activity.objectiveMeasureStatus&&activity.objectiveNormalizedMeasure>greaterThanValue}case"objectiveMeasureLessThan":{const lessThanValue=this._parameters.get("threshold")||0;return activity.objectiveMeasureStatus&&lessThanValue>activity.objectiveNormalizedMeasure}case"completed":return activity.isCompleted;case"progressKnown":return"unknown"!==activity.completionStatus;case"attempted":return activity.attemptCount>0;case"notAttempted":return 0===activity.attemptCount;case"always":return!0;default:return!1}}toJSON(){this.jsonString=!0;const result={condition:this._condition,parameters:Object.fromEntries(this._parameters)};return delete this.jsonString,result}}class RollupRule extends BaseCMI{constructor(action="satisfied",consideration="all",minimumCount=0,minimumPercent=0){super("rollupRule"),this._conditions=[],this._action="satisfied",this._consideration="all",this._minimumCount=0,this._minimumPercent=0,this._action=action,this._consideration=consideration,this._minimumCount=minimumCount,this._minimumPercent=minimumPercent}reset(){this._initialized=!1,this._conditions=[]}get conditions(){return this._conditions}addCondition(condition){if(!(condition instanceof RollupCondition))throw new Scorm2004ValidationError(this._cmi_element+".conditions",scorm2004_errors$1.TYPE_MISMATCH);this._conditions.push(condition)}removeCondition(condition){const index=this._conditions.indexOf(condition);return-1!==index&&(this._conditions.splice(index,1),!0)}get action(){return this._action}set action(action){this._action=action}get consideration(){return this._consideration}set consideration(consideration){this._consideration=consideration}get minimumCount(){return this._minimumCount}set minimumCount(minimumCount){0>minimumCount||(this._minimumCount=minimumCount)}get minimumPercent(){return this._minimumPercent}set minimumPercent(minimumPercent){0>minimumPercent||minimumPercent>100||(this._minimumPercent=minimumPercent)}evaluate(children){if(0===children.length)return!1;const matchingChildren=children.filter((child=>this._conditions.every((condition=>condition.evaluate(child)))));switch(this._consideration){case"all":return matchingChildren.length===children.length;case"any":return matchingChildren.length>0;case"none":return 0===matchingChildren.length;case"atLeastCount":return matchingChildren.length>=this._minimumCount;case"atLeastPercent":return matchingChildren.length/children.length*100>=this._minimumPercent;default:return!1}}toJSON(){this.jsonString=!0;const result={conditions:this._conditions,action:this._action,consideration:this._consideration,minimumCount:this._minimumCount,minimumPercent:this._minimumPercent};return delete this.jsonString,result}}class RollupRules extends BaseCMI{constructor(){super("rollupRules"),this._rules=[]}reset(){this._initialized=!1,this._rules=[]}get rules(){return this._rules}addRule(rule){if(!(rule instanceof RollupRule))throw new Scorm2004ValidationError(this._cmi_element+".rules",scorm2004_errors$1.TYPE_MISMATCH);this._rules.push(rule)}removeRule(rule){const index=this._rules.indexOf(rule);return-1!==index&&(this._rules.splice(index,1),!0)}processRollup(activity){if(!activity||0===activity.children.length)return;const children=activity.children;let completionRollup=!1,successRollup=!1;for(const rule of this._rules)if(rule.evaluate(children))switch(rule.action){case"satisfied":activity.successStatus="passed",successRollup=!0;break;case"notSatisfied":activity.successStatus="failed",successRollup=!0;break;case"completed":activity.completionStatus="completed",activity.isCompleted=!0,completionRollup=!0;break;case"incomplete":activity.completionStatus="incomplete",activity.isCompleted=!1,completionRollup=!0}completionRollup||this._defaultCompletionRollup(activity,children),successRollup||this._defaultSuccessRollup(activity,children)}_defaultCompletionRollup(activity,children){children.every((child=>child.isCompleted))?(activity.completionStatus="completed",activity.isCompleted=!0):children.some((child=>"incomplete"===child.completionStatus))&&(activity.completionStatus="incomplete",activity.isCompleted=!1)}_defaultSuccessRollup(activity,children){children.every((child=>"passed"===child.successStatus))?activity.successStatus="passed":children.some((child=>"failed"===child.successStatus))&&(activity.successStatus="failed")}toJSON(){this.jsonString=!0;const result={rules:this._rules};return delete this.jsonString,result}}const ValidLanguages=["aa","ab","ae","af","ak","am","an","ar","as","av","ay","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","dv","dz","ee","el","en","eo","es","et","eu","fa","ff","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","iu","ja","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lu","lv","mg","mh","mi","mk","ml","mn","mo","mr","ms","mt","my","na","nb","nd","ne","ng","nl","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sc","sd","se","sg","sh","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zu","aar","abk","ave","afr","aka","amh","arg","ara","asm","ava","aym","aze","bak","bel","bul","bih","bis","bam","ben","tib","bod","bre","bos","cat","che","cha","cos","cre","cze","ces","chu","chv","wel","cym","dan","ger","deu","div","dzo","ewe","gre","ell","eng","epo","spa","est","baq","eus","per","fas","ful","fin","fij","fao","fre","fra","fry","gle","gla","glg","grn","guj","glv","hau","heb","hin","hmo","hrv","hat","hun","arm","hye","her","ina","ind","ile","ibo","iii","ipk","ido","ice","isl","ita","iku","jpn","jav","geo","kat","kon","kik","kua","kaz","kal","khm","kan","kor","kau","kas","kur","kom","cor","kir","lat","ltz","lug","lim","lin","lao","lit","lub","lav","mlg","mah","mao","mri","mac","mkd","mal","mon","mol","mar","may","msa","mlt","bur","mya","nau","nob","nde","nep","ndo","dut","nld","nno","nor","nbl","nav","nya","oci","oji","orm","ori","oss","pan","pli","pol","pus","por","que","roh","run","rum","ron","rus","kin","san","srd","snd","sme","sag","slo","sin","slk","slv","smo","sna","som","alb","sqi","srp","ssw","sot","sun","swe","swa","tam","tel","tgk","tha","tir","tuk","tgl","tsn","ton","tur","tso","tat","twi","tah","uig","ukr","urd","uzb","ven","vie","vol","wln","wol","xho","yid","yor","zha","chi","zho","zul"];class Activity extends BaseCMI{constructor(id="",title=""){super("activity"),this._id="",this._title="",this._children=[],this._parent=null,this._isVisible=!0,this._isActive=!1,this._isSuspended=!1,this._isCompleted=!1,this._completionStatus="unknown",this._successStatus="unknown",this._attemptCount=0,this._attemptCompletionAmount=0,this._attemptAbsoluteDuration="PT0H0M0S",this._attemptExperiencedDuration="PT0H0M0S",this._activityAbsoluteDuration="PT0H0M0S",this._activityExperiencedDuration="PT0H0M0S",this._objectiveSatisfiedStatus=!1,this._objectiveMeasureStatus=!1,this._objectiveNormalizedMeasure=0,this._id=id,this._title=title}initialize(){super.initialize();for(const child of this._children)child.initialize()}reset(){this._initialized=!1,this._isActive=!1,this._isSuspended=!1,this._isCompleted=!1,this._completionStatus="unknown",this._successStatus="unknown",this._attemptCount=0,this._attemptCompletionAmount=0,this._attemptAbsoluteDuration="PT0H0M0S",this._attemptExperiencedDuration="PT0H0M0S",this._activityAbsoluteDuration="PT0H0M0S",this._activityExperiencedDuration="PT0H0M0S",this._objectiveSatisfiedStatus=!1,this._objectiveMeasureStatus=!1,this._objectiveNormalizedMeasure=0;for(const child of this._children)child.reset()}get id(){return this._id}set id(id){check2004ValidFormat(this._cmi_element+".id",id,scorm2004_regex_CMILongIdentifier)&&(this._id=id)}get title(){return this._title}set title(title){check2004ValidFormat(this._cmi_element+".title",title,scorm2004_regex_CMILangString250)&&(this._title=title)}get children(){return this._children}addChild(child){if(!(child instanceof Activity))throw new Scorm2004ValidationError(this._cmi_element+".children",scorm2004_errors$1.TYPE_MISMATCH);child._parent=this,this._children.push(child)}removeChild(child){const index=this._children.indexOf(child);return-1!==index&&(this._children.splice(index,1),child._parent=null,!0)}get parent(){return this._parent}get isVisible(){return this._isVisible}set isVisible(isVisible){this._isVisible=isVisible}get isActive(){return this._isActive}set isActive(isActive){this._isActive=isActive}get isSuspended(){return this._isSuspended}set isSuspended(isSuspended){this._isSuspended=isSuspended}get isCompleted(){return this._isCompleted}set isCompleted(isCompleted){this._isCompleted=isCompleted}get completionStatus(){return this._completionStatus}set completionStatus(completionStatus){this._completionStatus=completionStatus,this._isCompleted="completed"===completionStatus}get successStatus(){return this._successStatus}set successStatus(successStatus){this._successStatus=successStatus}get attemptCount(){return this._attemptCount}incrementAttemptCount(){this._attemptCount++}get objectiveMeasureStatus(){return this._objectiveMeasureStatus}set objectiveMeasureStatus(objectiveMeasureStatus){this._objectiveMeasureStatus=objectiveMeasureStatus}get objectiveNormalizedMeasure(){return this._objectiveNormalizedMeasure}set objectiveNormalizedMeasure(objectiveNormalizedMeasure){this._objectiveNormalizedMeasure=objectiveNormalizedMeasure}toJSON(){this.jsonString=!0;const result={id:this._id,title:this._title,isVisible:this._isVisible,isActive:this._isActive,isSuspended:this._isSuspended,isCompleted:this._isCompleted,completionStatus:this._completionStatus,successStatus:this._successStatus,attemptCount:this._attemptCount,attemptCompletionAmount:this._attemptCompletionAmount,attemptAbsoluteDuration:this._attemptAbsoluteDuration,attemptExperiencedDuration:this._attemptExperiencedDuration,activityAbsoluteDuration:this._activityAbsoluteDuration,activityExperiencedDuration:this._activityExperiencedDuration,objectiveSatisfiedStatus:this._objectiveSatisfiedStatus,objectiveMeasureStatus:this._objectiveMeasureStatus,objectiveNormalizedMeasure:this._objectiveNormalizedMeasure,children:this._children.map((child=>child.toJSON()))};return delete this.jsonString,result}}class ActivityTree extends BaseCMI{constructor(){super("activityTree"),this._root=null,this._currentActivity=null,this._suspendedActivity=null,this._activities=new Map}initialize(){super.initialize(),this._root&&this._root.initialize()}reset(){this._initialized=!1,this._currentActivity=null,this._suspendedActivity=null,this._root&&this._root.reset()}get root(){return this._root}set root(root){if(null!==root&&!(root instanceof Activity))throw new Scorm2004ValidationError(this._cmi_element+".root",scorm2004_errors$1.TYPE_MISMATCH);this._root=root,root&&(this._activities.set(root.id,root),this._addActivitiesToMap(root))}_addActivitiesToMap(activity){for(const child of activity.children)this._activities.set(child.id,child),this._addActivitiesToMap(child)}get currentActivity(){return this._currentActivity}set currentActivity(activity){if(null!==activity&&!(activity instanceof Activity))throw new Scorm2004ValidationError(this._cmi_element+".currentActivity",scorm2004_errors$1.TYPE_MISMATCH);this._currentActivity&&(this._currentActivity.isActive=!1),this._currentActivity=activity,activity&&(activity.isActive=!0)}get suspendedActivity(){return this._suspendedActivity}set suspendedActivity(activity){if(null!==activity&&!(activity instanceof Activity))throw new Scorm2004ValidationError(this._cmi_element+".suspendedActivity",scorm2004_errors$1.TYPE_MISMATCH);this._suspendedActivity&&(this._suspendedActivity.isSuspended=!1),this._suspendedActivity=activity,activity&&(activity.isSuspended=!0)}getActivity(id){return this._activities.get(id)}getAllActivities(){return Array.from(this._activities.values())}getParent(activity){return activity.parent}getChildren(activity){return activity.children}getSiblings(activity){return activity.parent?activity.parent.children.filter((child=>child!==activity)):[]}getNextSibling(activity){if(!activity.parent)return null;const siblings=activity.parent.children,index=siblings.indexOf(activity);return-1===index||index===siblings.length-1?null:siblings[index+1]}getPreviousSibling(activity){if(!activity.parent)return null;const siblings=activity.parent.children,index=siblings.indexOf(activity);return index>0?siblings[index-1]:null}getFirstChild(activity){return 0===activity.children.length?null:activity.children[0]}getLastChild(activity){return 0===activity.children.length?null:activity.children[activity.children.length-1]}getCommonAncestor(activity1,activity2){const path1=[];let current=activity1;for(;current;)path1.unshift(current),current=current.parent;for(current=activity2;current;){if(path1.includes(current))return current;current=current.parent}return null}toJSON(){this.jsonString=!0;const result={root:this._root,currentActivity:this._currentActivity?this._currentActivity.id:null,suspendedActivity:this._suspendedActivity?this._suspendedActivity.id:null};return delete this.jsonString,result}}class SequencingControls extends BaseCMI{constructor(){super("sequencingControls"),this._enabled=!0,this._choiceExit=!0,this._flow=!1,this._forwardOnly=!1,this._useCurrentAttemptObjectiveInfo=!0,this._useCurrentAttemptProgressInfo=!0,this._preventActivation=!1,this._constrainChoice=!1,this._rollupObjectiveSatisfied=!0,this._rollupProgressCompletion=!0,this._objectiveMeasureWeight=1}reset(){this._initialized=!1,this._enabled=!0,this._choiceExit=!0,this._flow=!1,this._forwardOnly=!1,this._useCurrentAttemptObjectiveInfo=!0,this._useCurrentAttemptProgressInfo=!0,this._preventActivation=!1,this._constrainChoice=!1,this._rollupObjectiveSatisfied=!0,this._rollupProgressCompletion=!0,this._objectiveMeasureWeight=1}get enabled(){return this._enabled}set enabled(enabled){this._enabled=enabled}get choiceExit(){return this._choiceExit}set choiceExit(choiceExit){this._choiceExit=choiceExit}get flow(){return this._flow}set flow(flow){this._flow=flow}get forwardOnly(){return this._forwardOnly}set forwardOnly(forwardOnly){this._forwardOnly=forwardOnly}get useCurrentAttemptObjectiveInfo(){return this._useCurrentAttemptObjectiveInfo}set useCurrentAttemptObjectiveInfo(useCurrentAttemptObjectiveInfo){this._useCurrentAttemptObjectiveInfo=useCurrentAttemptObjectiveInfo}get useCurrentAttemptProgressInfo(){return this._useCurrentAttemptProgressInfo}set useCurrentAttemptProgressInfo(useCurrentAttemptProgressInfo){this._useCurrentAttemptProgressInfo=useCurrentAttemptProgressInfo}get preventActivation(){return this._preventActivation}set preventActivation(preventActivation){this._preventActivation=preventActivation}get constrainChoice(){return this._constrainChoice}set constrainChoice(constrainChoice){this._constrainChoice=constrainChoice}get rollupObjectiveSatisfied(){return this._rollupObjectiveSatisfied}set rollupObjectiveSatisfied(rollupObjectiveSatisfied){this._rollupObjectiveSatisfied=rollupObjectiveSatisfied}get rollupProgressCompletion(){return this._rollupProgressCompletion}set rollupProgressCompletion(rollupProgressCompletion){this._rollupProgressCompletion=rollupProgressCompletion}get objectiveMeasureWeight(){return this._objectiveMeasureWeight}set objectiveMeasureWeight(objectiveMeasureWeight){0>objectiveMeasureWeight||objectiveMeasureWeight>1||(this._objectiveMeasureWeight=objectiveMeasureWeight)}isChoiceNavigationAllowed(){return this._enabled&&!this._constrainChoice}isFlowNavigationAllowed(){return this._enabled&&this._flow}isForwardNavigationAllowed(){return this._enabled&&(!this._forwardOnly||this._flow)}isBackwardNavigationAllowed(){return this._enabled&&!this._forwardOnly}toJSON(){this.jsonString=!0;const result={enabled:this._enabled,choiceExit:this._choiceExit,flow:this._flow,forwardOnly:this._forwardOnly,useCurrentAttemptObjectiveInfo:this._useCurrentAttemptObjectiveInfo,useCurrentAttemptProgressInfo:this._useCurrentAttemptProgressInfo,preventActivation:this._preventActivation,constrainChoice:this._constrainChoice,rollupObjectiveSatisfied:this._rollupObjectiveSatisfied,rollupProgressCompletion:this._rollupProgressCompletion,objectiveMeasureWeight:this._objectiveMeasureWeight};return delete this.jsonString,result}}class Sequencing extends BaseCMI{constructor(){super("sequencing"),this._adlNav=null,this._activityTree=new ActivityTree,this._sequencingRules=new SequencingRules,this._sequencingControls=new SequencingControls,this._rollupRules=new RollupRules}initialize(){super.initialize(),this._activityTree.initialize(),this._sequencingRules.initialize(),this._sequencingControls.initialize(),this._rollupRules.initialize()}reset(){this._initialized=!1,this._activityTree.reset(),this._sequencingRules.reset(),this._sequencingControls.reset(),this._rollupRules.reset()}get activityTree(){return this._activityTree}set activityTree(activityTree){if(!(activityTree instanceof ActivityTree))throw new Scorm2004ValidationError(this._cmi_element+".activityTree",scorm2004_errors$1.TYPE_MISMATCH);this._activityTree=activityTree}get sequencingRules(){return this._sequencingRules}set sequencingRules(sequencingRules){if(!(sequencingRules instanceof SequencingRules))throw new Scorm2004ValidationError(this._cmi_element+".sequencingRules",scorm2004_errors$1.TYPE_MISMATCH);this._sequencingRules=sequencingRules}get sequencingControls(){return this._sequencingControls}set sequencingControls(sequencingControls){if(!(sequencingControls instanceof SequencingControls))throw new Scorm2004ValidationError(this._cmi_element+".sequencingControls",scorm2004_errors$1.TYPE_MISMATCH);this._sequencingControls=sequencingControls}get rollupRules(){return this._rollupRules}set rollupRules(rollupRules){if(!(rollupRules instanceof RollupRules))throw new Scorm2004ValidationError(this._cmi_element+".rollupRules",scorm2004_errors$1.TYPE_MISMATCH);this._rollupRules=rollupRules}get adlNav(){return this._adlNav}set adlNav(adlNav){this._adlNav=adlNav}processNavigationRequest(request){if(!this._adlNav)return!1;this._adlNav.request=request;const currentActivity=this._activityTree.currentActivity;if(!currentActivity)return!1;const preConditionAction=this._sequencingRules.evaluatePreConditionRules(currentActivity);if(preConditionAction)switch(preConditionAction){case RuleActionType.SKIP:case RuleActionType.DISABLED:case RuleActionType.HIDE_FROM_CHOICE:case RuleActionType.STOP_FORWARD_TRAVERSAL:return!1}switch(request){case"continue":return this.processContinueRequest(currentActivity);case"previous":return this.processPreviousRequest(currentActivity);case"choice":default:return!1;case"exit":return this.processExitRequest(currentActivity);case"exitAll":return this.processExitAllRequest();case"abandon":return this.processAbandonRequest(currentActivity);case"abandonAll":return this.processAbandonAllRequest();case"suspendAll":return this.processSuspendAllRequest(currentActivity)}}processContinueRequest(currentActivity){if(!this._sequencingControls.isForwardNavigationAllowed())return!1;const nextActivity=this._activityTree.getNextSibling(currentActivity);if(!nextActivity)return!1;const exitConditionAction=this._sequencingRules.evaluateExitConditionRules(currentActivity);if(exitConditionAction)switch(exitConditionAction){case RuleActionType.EXIT_PARENT:{const parent=currentActivity.parent;return!!parent&&(this._activityTree.currentActivity=parent,!0)}case RuleActionType.EXIT_ALL:return this._activityTree.currentActivity=null,!0}this._activityTree.currentActivity=nextActivity;const postConditionAction=this._sequencingRules.evaluatePostConditionRules(nextActivity);if(postConditionAction)switch(postConditionAction){case RuleActionType.RETRY:return nextActivity.incrementAttemptCount(),!0;case RuleActionType.RETRY_ALL:return this._activityTree.getAllActivities().forEach((activity=>{activity.incrementAttemptCount()})),!0;case RuleActionType.CONTINUE:return this.processContinueRequest(nextActivity);case RuleActionType.PREVIOUS:return this.processPreviousRequest(nextActivity);case RuleActionType.EXIT:return this._activityTree.currentActivity=currentActivity,!0}return!0}processPreviousRequest(currentActivity){if(!this._sequencingControls.isBackwardNavigationAllowed())return!1;const previousActivity=this._activityTree.getPreviousSibling(currentActivity);if(!previousActivity)return!1;const exitConditionAction=this._sequencingRules.evaluateExitConditionRules(currentActivity);if(exitConditionAction)switch(exitConditionAction){case RuleActionType.EXIT_PARENT:{const parent=currentActivity.parent;return!!parent&&(this._activityTree.currentActivity=parent,!0)}case RuleActionType.EXIT_ALL:return this._activityTree.currentActivity=null,!0}this._activityTree.currentActivity=previousActivity;const postConditionAction=this._sequencingRules.evaluatePostConditionRules(previousActivity);if(postConditionAction)switch(postConditionAction){case RuleActionType.RETRY:return previousActivity.incrementAttemptCount(),!0;case RuleActionType.RETRY_ALL:return this._activityTree.getAllActivities().forEach((activity=>{activity.incrementAttemptCount()})),!0;case RuleActionType.CONTINUE:return this.processContinueRequest(previousActivity);case RuleActionType.PREVIOUS:return this.processPreviousRequest(previousActivity);case RuleActionType.EXIT:return this._activityTree.currentActivity=currentActivity,!0}return!0}processExitRequest(currentActivity){if(!this._sequencingControls.choiceExit)return!1;const parent=currentActivity.parent;return!!parent&&(this._activityTree.currentActivity=parent,!0)}processExitAllRequest(){return!!this._sequencingControls.choiceExit&&(this._activityTree.currentActivity=null,!0)}processAbandonRequest(currentActivity){const parent=currentActivity.parent;return!!parent&&(this._activityTree.currentActivity=parent,!0)}processAbandonAllRequest(){return this._activityTree.currentActivity=null,!0}processSuspendAllRequest(currentActivity){return this._activityTree.suspendedActivity=currentActivity,this._activityTree.currentActivity=null,!0}processRollup(){const root=this._activityTree.root;root&&this._processRollupRecursive(root)}_processRollupRecursive(activity){for(const child of activity.children)this._processRollupRecursive(child);this._rollupRules.processRollup(activity)}toJSON(){this.jsonString=!0;const result={activityTree:this._activityTree,sequencingRules:this._sequencingRules,sequencingControls:this._sequencingControls,rollupRules:this._rollupRules};return delete this.jsonString,result}}class Scorm2004API extends BaseAPI{constructor(settings){settings&&void 0===settings.mastery_override&&(settings.mastery_override=!1),super(scorm2004_errors$1,settings),this._version="1.0",this._globalObjectives=[],this._extractedScoItemIds=[],this.cmi=new CMI,this.adl=new ADL,this._sequencing=new Sequencing,this.adl.sequencing=this._sequencing,settings?.sequencing&&this.configureSequencing(settings.sequencing),this.Initialize=this.lmsInitialize,this.Terminate=this.lmsFinish,this.GetValue=this.lmsGetValue,this.SetValue=this.lmsSetValue,this.Commit=this.lmsCommit,this.GetLastError=this.lmsGetLastError,this.GetErrorString=this.lmsGetErrorString,this.GetDiagnostic=this.lmsGetDiagnostic}reset(settings){this.commonReset(settings),this.cmi?.reset(),this.adl?.reset(),this._sequencing?.reset()}get version(){return this._version}get globalObjectives(){return this._globalObjectives}lmsInitialize(){return this.cmi.initialize(),this.initialize("Initialize","LMS was already initialized!","LMS is already finished!")}lmsFinish(){return(async()=>{await this.internalFinish()})(),"true"}async internalFinish(){const result=await this.terminate("Terminate",!0);if("true"===result)if("_none_"!==this.adl.nav.request){const navActions={continue:"SequenceNext",previous:"SequencePrevious",choice:"SequenceChoice",jump:"SequenceJump",exit:"SequenceExit",exitAll:"SequenceExitAll",abandon:"SequenceAbandon",abandonAll:"SequenceAbandonAll"};let request=this.adl.nav.request;const choiceJumpRegex=RegExp(scorm2004_regex_NAVEvent),matches=request.match(choiceJumpRegex);let target="";matches&&(matches.groups?.choice_target?(target=matches.groups?.choice_target,request="choice"):matches.groups?.jump_target&&(target=matches.groups?.jump_target,request="jump"));const action=navActions[request];action&&this.processListeners(action,"adl.nav.request",target)}else this.settings.autoProgress&&this.processListeners("SequenceNext",null,"next");return result}lmsGetValue(CMIElement){const adlNavRequestRegex="^adl\\.nav\\.request_valid\\.(choice|jump)\\.{target=\\S{0,}([a-zA-Z0-9-_]+)}$";if(stringMatches(CMIElement,adlNavRequestRegex)){const matches=CMIElement.match(adlNavRequestRegex),request=matches[1],target=matches[2].replace("{target=","").replace("}","");if("choice"===request||"jump"===request)return this.settings.scoItemIdValidator?this.settings.scoItemIdValidator(target)+"":this._extractedScoItemIds.length>0?this._extractedScoItemIds.includes(target)+"":this.settings.scoItemIds.includes(target)+""}return this.getValue("GetValue",!0,CMIElement)}lmsSetValue(CMIElement,value){return this.setValue("SetValue","Commit",!0,CMIElement,value)}lmsCommit(){return this.settings.asyncCommit?this.scheduleCommit(500,"Commit"):(async()=>{await this.commit("Commit",!1)})(),"true"}lmsGetLastError(){return this.getLastError("GetLastError")}lmsGetErrorString(CMIErrorCode){return this.getErrorString("GetErrorString",CMIErrorCode)}lmsGetDiagnostic(CMIErrorCode){return this.getDiagnostic("GetDiagnostic",CMIErrorCode)}setCMIValue(CMIElement,value){if(stringMatches(CMIElement,"cmi\\.objectives\\.\\d+")){const index=+CMIElement.split(".")[2],element_base="cmi.objectives."+index;let objective_id;if(stringMatches(CMIElement,"cmi\\.objectives\\.\\d+\\.id"))objective_id=value;else{const objective=this.cmi.objectives.findObjectiveByIndex(index);objective_id=objective?objective.id:void 0}if(objective_id&&this.settings.globalObjectiveIds.includes(objective_id)){let global_index=this._globalObjectives.findIndex((obj=>obj.id===objective_id));if(-1===global_index){global_index=this._globalObjectives.length;const newGlobalObjective=new CMIObjectivesObject;newGlobalObjective.id=objective_id,this._globalObjectives.push(newGlobalObjective)}const global_element=CMIElement.replace(element_base,"_globalObjectives."+global_index);this._commonSetCMIValue("SetGlobalObjectiveValue",!0,global_element,value)}}return this._commonSetCMIValue("SetValue",!0,CMIElement,value)}getChildElement(CMIElement,value,foundFirstIndex){if(stringMatches(CMIElement,"cmi\\.objectives\\.\\d+"))return new CMIObjectivesObject;if(foundFirstIndex){if(stringMatches(CMIElement,"cmi\\.interactions\\.\\d+\\.correct_responses\\.\\d+"))return this.createCorrectResponsesObject(CMIElement,value);if(stringMatches(CMIElement,"cmi\\.interactions\\.\\d+\\.objectives\\.\\d+"))return new CMIInteractionsObjectivesObject}else if(stringMatches(CMIElement,"cmi\\.interactions\\.\\d+"))return new CMIInteractionsObject;return stringMatches(CMIElement,"cmi\\.comments_from_learner\\.\\d+")?new CMICommentsObject:stringMatches(CMIElement,"cmi\\.comments_from_lms\\.\\d+")?new CMICommentsObject(!0):stringMatches(CMIElement,"adl\\.data\\.\\d+")?new ADLDataObject:null}createCorrectResponsesObject(CMIElement,value){const parts=CMIElement.split("."),interaction=this.cmi.interactions.childArray[+parts[2]];if(this.isInitialized()){if(void 0===interaction||!interaction.type)return this.throwSCORMError(CMIElement,scorm2004_errors$1.DEPENDENCY_NOT_ESTABLISHED,CMIElement),null;{this.checkDuplicateChoiceResponse(CMIElement,interaction,value);const response_type=CorrectResponses[interaction.type];if(!response_type)return this.throwSCORMError(CMIElement,scorm2004_errors$1.GENERAL_SET_FAILURE,"Incorrect Response Type: "+interaction.type),null;this.checkValidResponseType(CMIElement,response_type,value,interaction.type)}}return"0"===this.lastErrorCode?new CMIInteractionsCorrectResponsesObject(interaction):null}checkValidResponseType(CMIElement,response_type,value,interaction_type){let nodes=[];response_type?.delimiter?nodes=(value+"").split(response_type.delimiter):nodes[0]=value,nodes.length>0&&response_type.max>=nodes.length?this.checkCorrectResponseValue(CMIElement,interaction_type,nodes,value):nodes.length>response_type.max&&this.throwSCORMError(CMIElement,scorm2004_errors$1.GENERAL_SET_FAILURE,"Data Model Element Pattern Too Long: "+value)}checkDuplicateChoiceResponse(CMIElement,interaction,value){const interaction_count=interaction.correct_responses._count;if("choice"===interaction.type)for(let i=0;interaction_count>i&&"0"===this.lastErrorCode;i++)interaction.correct_responses.childArray[i].pattern===value&&this.throwSCORMError(CMIElement,scorm2004_errors$1.GENERAL_SET_FAILURE,""+value)}validateCorrectResponse(CMIElement,value){const parts=CMIElement.split("."),pattern_index=+parts[4],interaction=this.cmi.interactions.childArray[+parts[2]],interaction_count=interaction.correct_responses._count;this.checkDuplicateChoiceResponse(CMIElement,interaction,value);const response_type=CorrectResponses[interaction.type];void 0!==response_type.limit&&interaction_count>response_type.limit?this.throwSCORMError(CMIElement,scorm2004_errors$1.GENERAL_SET_FAILURE,`Data Model Element Collection Limit Reached: ${CMIElement} - ${value}`):(this.checkValidResponseType(CMIElement,response_type,value,interaction.type),"0"===this.lastErrorCode&&(!response_type.duplicate||!this.checkDuplicatedPattern(interaction.correct_responses,pattern_index,value))||"0"===this.lastErrorCode&&""===value||"0"===this.lastErrorCode&&this.throwSCORMError(CMIElement,scorm2004_errors$1.GENERAL_SET_FAILURE,`Data Model Element Pattern Already Exists: ${CMIElement} - ${value}`))}getCMIValue(CMIElement){return this._commonGetCMIValue("GetValue",!0,CMIElement)}getLmsErrorMessageDetails(errorNumber,detail){let basicMessage="",detailMessage="";return scorm2004_constants.error_descriptions[errorNumber+=""]&&(basicMessage=scorm2004_constants.error_descriptions[errorNumber].basicMessage,detailMessage=scorm2004_constants.error_descriptions[errorNumber].detailMessage),detail?detailMessage:basicMessage}checkDuplicatedPattern(correct_response,current_index,value){let found=!1;const count=correct_response._count;for(let i=0;count>i&&!found;i++)i!==current_index&&correct_response.childArray[i]===value&&(found=!0);return found}checkCorrectResponseValue(CMIElement,interaction_type,nodes,value){const response=CorrectResponses[interaction_type];if(!response)return void this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,"Incorrect Response Type: "+interaction_type);const formatRegex=RegExp(response.format);for(let i=0;nodes.length>i&&"0"===this.lastErrorCode;i++)if(interaction_type.match("^(fill-in|long-fill-in|matching|performance|sequencing)$")&&(nodes[i]=this.removeCorrectResponsePrefixes(CMIElement,nodes[i])),response?.delimiter2){const values=nodes[i].split(response.delimiter2);2===values.length&&values[0].match(formatRegex)&&response.format2&&values[1].match(RegExp(response.format2))||this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,`${interaction_type}: ${value}`)}else{const matches=nodes[i].match(formatRegex);if(!matches&&""!==value||!matches&&"true-false"===interaction_type)this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,`${interaction_type}: ${value}`);else if("numeric"===interaction_type&&nodes.length>1)+nodes[0]>+nodes[1]&&this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,`${interaction_type}: ${value}`);else if(""!==nodes[i]&&response.unique)for(let j=0;i>j&&"0"===this.lastErrorCode;j++)nodes[i]===nodes[j]&&this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,`${interaction_type}: ${value}`)}}removeCorrectResponsePrefixes(CMIElement,node){let seenOrder=!1,seenCase=!1,seenLang=!1;const prefixRegex=RegExp("^({(lang|case_matters|order_matters)=([^}]+)})");let matches=node.match(prefixRegex),langMatches=null;for(;matches;){switch(matches[2]){case"lang":if(langMatches=node.match("^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?}))(.*?)$"),langMatches){const lang=langMatches[3];void 0!==lang&&lang.length>0&&(ValidLanguages.includes(lang.toLowerCase())||this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,""+node))}seenLang=!0;break;case"case_matters":seenLang||seenOrder||seenCase||"true"!==matches[3]&&"false"!==matches[3]&&this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,""+node),seenCase=!0;break;case"order_matters":seenCase||seenLang||seenOrder||"true"!==matches[3]&&"false"!==matches[3]&&this.throwSCORMError(CMIElement,scorm2004_errors$1.TYPE_MISMATCH,""+node),seenOrder=!0}matches=(node=node.substring(matches[1].length)).match(prefixRegex)}return node}replaceWithAnotherScormAPI(newAPI){this.cmi=newAPI.cmi,this.adl=newAPI.adl}renderCommitCMI(terminateCommit){const cmiExport=this.renderCMIToJSONObject();terminateCommit&&(cmiExport.cmi.total_time=this.cmi.getCurrentTotalTime());const result=[],flattened=flatten(cmiExport);switch(this.settings.dataCommitFormat){case"flattened":return flatten(cmiExport);case"params":for(const item in flattened)({}).hasOwnProperty.call(flattened,item)&&result.push(`${item}=${flattened[item]}`);return result;default:return cmiExport}}renderCommitObject(terminateCommit){const cmiExport=this.renderCommitCMI(terminateCommit),totalTimeDuration=this.cmi.getCurrentTotalTime(),totalTimeSeconds=getDurationAsSeconds(totalTimeDuration,scorm2004_regex_CMITimespan);let completionStatus="unknown",successStatus="unknown";this.cmi.completion_status&&("completed"===this.cmi.completion_status?completionStatus="completed":"incomplete"===this.cmi.completion_status&&(completionStatus="incomplete")),this.cmi.success_status&&("passed"===this.cmi.success_status?successStatus="passed":"failed"===this.cmi.success_status&&(successStatus="failed"));const score=this.cmi.score;let scoreObject=null;score&&(scoreObject={},Number.isNaN(Number.parseFloat(score.raw))||(scoreObject.raw=Number.parseFloat(score.raw)),Number.isNaN(Number.parseFloat(score.min))||(scoreObject.min=Number.parseFloat(score.min)),Number.isNaN(Number.parseFloat(score.max))||(scoreObject.max=Number.parseFloat(score.max)),Number.isNaN(Number.parseFloat(score.scaled))||(scoreObject.scaled=Number.parseFloat(score.scaled)));const commitObject={completionStatus:completionStatus,successStatus:successStatus,totalTimeSeconds:totalTimeSeconds,runtimeData:cmiExport};return scoreObject&&(commitObject.score=scoreObject),commitObject}async storeData(terminateCommit){terminateCommit&&"normal"===this.cmi.mode&&"credit"===this.cmi.credit&&(this.cmi.completion_threshold&&this.cmi.progress_measure&&(this.cmi.completion_status=this.cmi.completion_threshold>this.cmi.progress_measure?"incomplete":"completed"),this.cmi.scaled_passing_score&&this.cmi.score.scaled&&(this.cmi.success_status=this.cmi.scaled_passing_score>this.cmi.score.scaled?"failed":"passed"));let navRequest=!1;this.adl.nav.request!==this.startingData?.adl?.nav?.request&&"_none_"!==this.adl.nav.request&&(navRequest=!0);const commitObject=this.getCommitObject(terminateCommit);if("string"==typeof this.settings.lmsCommitUrl){const result=await this.processHttpRequest(this.settings.lmsCommitUrl,{commitObject:commitObject},terminateCommit);return navRequest&&void 0!==result.navRequest&&""!==result.navRequest&&"string"==typeof result.navRequest?Function(`"use strict";(() => { ${result.navRequest} })()`)():result?.navRequest&&!navRequest&&"object"==typeof result.navRequest&&Object.hasOwnProperty.call(result.navRequest,"name")&&this.processListeners(result.navRequest.name,result.navRequest.data),result}return{result:"true",errorCode:0}}configureSequencing(sequencingSettings){sequencingSettings.activityTree&&this.configureActivityTree(sequencingSettings.activityTree),sequencingSettings.sequencingRules&&this.configureSequencingRules(sequencingSettings.sequencingRules),sequencingSettings.sequencingControls&&this.configureSequencingControls(sequencingSettings.sequencingControls),sequencingSettings.rollupRules&&this.configureRollupRules(sequencingSettings.rollupRules)}configureActivityTree(activityTreeSettings){const rootActivity=this.createActivity(activityTreeSettings);this._sequencing.activityTree.root=rootActivity,this._extractedScoItemIds=this.extractActivityIds(rootActivity)}extractActivityIds(activity){const ids=[activity.id];for(const child of activity.children)ids.push(...this.extractActivityIds(child));return ids}createActivity(activitySettings){const activity=new Activity(activitySettings.id,activitySettings.title);if(void 0!==activitySettings.isVisible&&(activity.isVisible=activitySettings.isVisible),void 0!==activitySettings.isActive&&(activity.isActive=activitySettings.isActive),void 0!==activitySettings.isSuspended&&(activity.isSuspended=activitySettings.isSuspended),void 0!==activitySettings.isCompleted&&(activity.isCompleted=activitySettings.isCompleted),activitySettings.children)for(const childSettings of activitySettings.children){const childActivity=this.createActivity(childSettings);activity.addChild(childActivity)}return activity}configureSequencingRules(sequencingRulesSettings){const sequencingRules=this._sequencing.sequencingRules;if(sequencingRulesSettings.preConditionRules)for(const ruleSettings of sequencingRulesSettings.preConditionRules){const rule=this.createSequencingRule(ruleSettings);sequencingRules.addPreConditionRule(rule)}if(sequencingRulesSettings.exitConditionRules)for(const ruleSettings of sequencingRulesSettings.exitConditionRules){const rule=this.createSequencingRule(ruleSettings);sequencingRules.addExitConditionRule(rule)}if(sequencingRulesSettings.postConditionRules)for(const ruleSettings of sequencingRulesSettings.postConditionRules){const rule=this.createSequencingRule(ruleSettings);sequencingRules.addPostConditionRule(rule)}}createSequencingRule(ruleSettings){const rule=new SequencingRule(ruleSettings.action,ruleSettings.conditionCombination);for(const conditionSettings of ruleSettings.conditions){const condition=new RuleCondition(conditionSettings.condition,conditionSettings.operator,new Map(Object.entries(conditionSettings.parameters||{})));rule.addCondition(condition)}return rule}configureSequencingControls(sequencingControlsSettings){const sequencingControls=this._sequencing.sequencingControls;void 0!==sequencingControlsSettings.enabled&&(sequencingControls.enabled=sequencingControlsSettings.enabled),void 0!==sequencingControlsSettings.choiceExit&&(sequencingControls.choiceExit=sequencingControlsSettings.choiceExit),void 0!==sequencingControlsSettings.flow&&(sequencingControls.flow=sequencingControlsSettings.flow),void 0!==sequencingControlsSettings.forwardOnly&&(sequencingControls.forwardOnly=sequencingControlsSettings.forwardOnly),void 0!==sequencingControlsSettings.useCurrentAttemptObjectiveInfo&&(sequencingControls.useCurrentAttemptObjectiveInfo=sequencingControlsSettings.useCurrentAttemptObjectiveInfo),void 0!==sequencingControlsSettings.useCurrentAttemptProgressInfo&&(sequencingControls.useCurrentAttemptProgressInfo=sequencingControlsSettings.useCurrentAttemptProgressInfo),void 0!==sequencingControlsSettings.preventActivation&&(sequencingControls.preventActivation=sequencingControlsSettings.preventActivation),void 0!==sequencingControlsSettings.constrainChoice&&(sequencingControls.constrainChoice=sequencingControlsSettings.constrainChoice),void 0!==sequencingControlsSettings.rollupObjectiveSatisfied&&(sequencingControls.rollupObjectiveSatisfied=sequencingControlsSettings.rollupObjectiveSatisfied),void 0!==sequencingControlsSettings.rollupProgressCompletion&&(sequencingControls.rollupProgressCompletion=sequencingControlsSettings.rollupProgressCompletion),void 0!==sequencingControlsSettings.objectiveMeasureWeight&&(sequencingControls.objectiveMeasureWeight=sequencingControlsSettings.objectiveMeasureWeight)}configureRollupRules(rollupRulesSettings){const rollupRules=this._sequencing.rollupRules;if(rollupRulesSettings.rules)for(const ruleSettings of rollupRulesSettings.rules){const rule=this.createRollupRule(ruleSettings);rollupRules.addRule(rule)}}createRollupRule(ruleSettings){const rule=new RollupRule(ruleSettings.action,ruleSettings.consideration,ruleSettings.minimumCount,ruleSettings.minimumPercent);for(const conditionSettings of ruleSettings.conditions){const condition=new RollupCondition(conditionSettings.condition,new Map(Object.entries(conditionSettings.parameters||{})));rule.addCondition(condition)}return rule}}export{AICC,Scorm12API,Scorm2004API};
//# sourceMappingURL=scorm-again.min.js.map
