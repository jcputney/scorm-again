{"version":3,"file":"scorm12.min.js","mappings":"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","sources":["webpack://scorm-again/./src/constants/enums.ts","webpack://scorm-again/./src/cmi/scorm12/objectives.ts","webpack://scorm-again/./src/exceptions/scorm12_exceptions.ts","webpack://scorm-again/./src/cmi/scorm12/student_preference.ts","webpack://scorm-again/./src/cmi/common/base_cmi.ts","webpack://scorm-again/./src/cmi/scorm12/nav.ts","webpack://scorm-again/./src/constants/api_constants.ts","webpack://scorm-again/./src/constants/default_settings.ts","webpack://scorm-again/./src/helpers/scheduled_commit.ts","webpack://scorm-again/./src/services/HttpService.ts","webpack://scorm-again/./src/services/EventService.ts","webpack://scorm-again/./src/services/SerializationService.ts","webpack://scorm-again/./src/utils/type_guards.ts","webpack://scorm-again/./src/services/ErrorHandlingService.ts","webpack://scorm-again/./src/services/LoggingService.ts","webpack://scorm-again/./src/BaseAPI.ts","webpack://scorm-again/./src/constants/regex.ts","webpack://scorm-again/./src/cmi/common/score.ts","webpack://scorm-again/./src/cmi/common/validation.ts","webpack://scorm-again/./src/cmi/scorm12/student_data.ts","webpack://scorm-again/./src/cmi/common/array.ts","webpack://scorm-again/./node_modules/tslib/tslib.es6.mjs","webpack://scorm-again/./src/exceptions.ts","webpack://scorm-again/./src/constants/error_codes.ts","webpack://scorm-again/./src/services/ValidationService.ts","webpack://scorm-again/./src/cmi/scorm12/interactions.ts","webpack://scorm-again/./src/utilities.ts","webpack://scorm-again/./src/cmi/scorm12/validation.ts","webpack://scorm-again/./src/cmi/aicc/core.ts","webpack://scorm-again/./src/cmi/scorm12/cmi.ts","webpack://scorm-again/webpack/bootstrap","webpack://scorm-again/webpack/runtime/define property getters","webpack://scorm-again/webpack/runtime/hasOwnProperty shorthand","webpack://scorm-again/./src/Scorm12API.ts"],"sourcesContent":["// Using plain objects instead of enums for better compatibility with strip-only mode\n// This approach avoids TypeScript enum runtime code while maintaining the same API\n\n// NAVBoolean values\nexport const NAVBoolean = {\n  UNKNOWN: \"unknown\",\n  TRUE: \"true\",\n  FALSE: \"false\",\n};\n\n// Type for NAVBoolean values\nexport type NAVBoolean = (typeof NAVBoolean)[keyof typeof NAVBoolean];\n\n// SuccessStatus values\nexport const SuccessStatus = {\n  PASSED: \"passed\",\n  FAILED: \"failed\",\n  UNKNOWN: \"unknown\",\n};\n\n// Type for SuccessStatus values\nexport type SuccessStatus = (typeof SuccessStatus)[keyof typeof SuccessStatus];\n\n// CompletionStatus values\nexport const CompletionStatus = {\n  COMPLETED: \"completed\",\n  INCOMPLETE: \"incomplete\",\n  UNKNOWN: \"unknown\",\n};\n\n// Type for CompletionStatus values\nexport type CompletionStatus =\n  (typeof CompletionStatus)[keyof typeof CompletionStatus];\n\n// LogLevelEnum values\nexport const LogLevelEnum = {\n  _: 0,\n  DEBUG: 1,\n  INFO: 2,\n  WARN: 3,\n  ERROR: 4,\n  NONE: 5,\n};\n\n// Type for LogLevelEnum values\nexport type LogLevelEnum = (typeof LogLevelEnum)[keyof typeof LogLevelEnum];\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { check12ValidFormat } from \"./validation\";\nimport { CMIArray } from \"../common/array\";\n\n/**\n * Class representing SCORM 1.2's `cmi.objectives` object\n * @extends CMIArray\n */\nexport class CMIObjectives extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives`\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.objectives\",\n      children: scorm12_constants.objectives_children,\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.objectives.n object\n * @extends BaseCMI\n */\nexport class CMIObjectivesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.objectives.n\n   */\n  constructor() {\n    super(\"cmi.objectives.n\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.objectives.n.score\",\n      score_children: scorm12_constants.score_children,\n      score_range: scorm12_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n\n  public readonly score: CMIScore;\n\n  private _id = \"\";\n  private _status = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._id = \"\";\n    this._status = \"\";\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _status\n   * @return {string}\n   */\n  get status(): string {\n    return this._status;\n  }\n\n  /**\n   * Setter for _status\n   * @param {string} status\n   */\n  set status(status: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".status\",\n        status,\n        scorm12_regex.CMIStatus2,\n      )\n    ) {\n      this._status = status;\n    }\n  }\n\n  /**\n   * toJSON for cmi.objectives.n\n   * @return {\n   *    {\n   *      id: string,\n   *      status: string,\n   *      score: CMIScore\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    status: string;\n    score: CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      status: this.status,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { ValidationError } from \"../exceptions\";\nimport { scorm12_constants } from \"../constants/api_constants\";\n\nconst scorm12_errors = scorm12_constants.error_descriptions;\n\n/**\n * SCORM 1.2 Validation Error\n */\nexport class Scorm12ValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   */\n  constructor(CMIElement: string, errorCode: number) {\n    if ({}.hasOwnProperty.call(scorm12_errors, String(errorCode))) {\n      super(\n        CMIElement,\n        errorCode,\n        scorm12_errors[String(errorCode)].basicMessage,\n        scorm12_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        CMIElement,\n        101,\n        scorm12_errors[\"101\"].basicMessage,\n        scorm12_errors[\"101\"].detailMessage,\n      );\n    }\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Class representing the SCORM 1.2 cmi.student_preference object\n * @extends BaseCMI\n */\nexport class CMIStudentPreference extends BaseCMI {\n  private readonly __children;\n\n  /**\n   * Constructor for cmi.student_preference\n   * @param {string} student_preference_children\n   */\n  constructor(student_preference_children?: string) {\n    super(\"cmi.student_preference\");\n    this.__children = student_preference_children\n      ? student_preference_children\n      : scorm12_constants.student_preference_children;\n  }\n\n  private _audio = \"\";\n  private _language = \"\";\n  private _speed = \"\";\n  private _text = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _audio\n   * @return {string}\n   */\n  get audio(): string {\n    return this._audio;\n  }\n\n  /**\n   * Setter for _audio\n   * @param {string} audio\n   */\n  set audio(audio: string) {\n    if (\n      validationService.validateScorm12Audio(\n        this._cmi_element + \".audio\",\n        audio,\n      )\n    ) {\n      this._audio = audio;\n    }\n  }\n\n  /**\n   * Getter for _language\n   * @return {string}\n   */\n  get language(): string {\n    return this._language;\n  }\n\n  /**\n   * Setter for _language\n   * @param {string} language\n   */\n  set language(language: string) {\n    if (\n      validationService.validateScorm12Language(\n        this._cmi_element + \".language\",\n        language,\n      )\n    ) {\n      this._language = language;\n    }\n  }\n\n  /**\n   * Getter for _speed\n   * @return {string}\n   */\n  get speed(): string {\n    return this._speed;\n  }\n\n  /**\n   * Setter for _speed\n   * @param {string} speed\n   */\n  set speed(speed: string) {\n    if (\n      validationService.validateScorm12Speed(\n        this._cmi_element + \".speed\",\n        speed,\n      )\n    ) {\n      this._speed = speed;\n    }\n  }\n\n  /**\n   * Getter for _text\n   * @return {string}\n   */\n  get text(): string {\n    return this._text;\n  }\n\n  /**\n   * Setter for _text\n   * @param {string} text\n   */\n  set text(text: string) {\n    if (\n      validationService.validateScorm12Text(this._cmi_element + \".text\", text)\n    ) {\n      this._text = text;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_preference\n   *\n   * @return {\n   *    {\n   *      audio: string,\n   *      language: string,\n   *      speed: string,\n   *      text: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    audio: string;\n    language: string;\n    speed: string;\n    text: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      audio: this.audio,\n      language: this.language,\n      speed: this.speed,\n      text: this.text,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Base class for API cmi objects\n */\nexport abstract class BaseCMI {\n  jsonString? = false;\n  protected readonly _cmi_element: string;\n  protected _initialized = false;\n  private _start_time: number | undefined;\n\n  /**\n   * Constructor for BaseCMI\n   * @param {string} cmi_element\n   */\n  constructor(cmi_element: string) {\n    this._cmi_element = cmi_element;\n  }\n\n  /**\n   * Getter for _initialized\n   * @return {boolean}\n   */\n  get initialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Getter for _start_time\n   * @return {number | undefined}\n   */\n  get start_time(): number | undefined {\n    return this._start_time;\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize(): void {\n    this._initialized = true;\n  }\n\n  /**\n   * Called when the player should override the 'session_time' provided by\n   * the module\n   */\n  setStartTime(): void {\n    this._start_time = new Date().getTime();\n  }\n\n  abstract reset(): void;\n}\n\n/**\n * Base class for cmi root objects\n */\nexport abstract class BaseRootCMI extends BaseCMI {\n  abstract getCurrentTotalTime(): string;\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat } from \"./validation\";\nimport { scorm12_regex } from \"../../constants/regex\";\n\n/**\n * Class for AICC Navigation object\n */\nexport class NAV extends BaseCMI {\n  /**\n   * Constructor for NAV object\n   */\n  constructor() {\n    super(\"cmi.nav\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._event = \"\";\n    this._initialized = false;\n  }\n\n  private _event = \"\";\n\n  /**\n   * Getter for _event\n   * @return {string}\n   */\n  get event(): string {\n    return this._event;\n  }\n\n  /**\n   * Setter for _event\n   * @param {string} event\n   */\n  set event(event: string) {\n    if (\n      event === \"\" ||\n      check12ValidFormat(\n        this._cmi_element + \".event\",\n        event,\n        scorm12_regex.NAVEvent,\n      )\n    ) {\n      this._event = event;\n    }\n  }\n\n  /**\n   * toJSON for nav object\n   * @return {\n   *    {\n   *      event: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    event: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      event: this.event,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","interface ErrorDescription {\n  basicMessage: string;\n  detailMessage: string;\n}\n\ninterface ErrorDescriptions {\n  [key: string]: ErrorDescription;\n}\n\ninterface ScormConstants {\n  cmi_children: string;\n  core_children: string;\n  score_children: string;\n  comments_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface AiccConstants extends ScormConstants {\n  student_demographics_children: string;\n  tries_children: string;\n  attempt_records_children: string;\n  paths_children: string;\n}\n\ninterface Scorm2004Constants {\n  cmi_children: string;\n  comments_children: string;\n  score_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  adl_data_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface GlobalConstants {\n  SCORM_TRUE: string;\n  SCORM_FALSE: string;\n  STATE_NOT_INITIALIZED: number;\n  STATE_INITIALIZED: number;\n  STATE_TERMINATED: number;\n}\n\nexport const global_constants: GlobalConstants = {\n  SCORM_TRUE: \"true\",\n  SCORM_FALSE: \"false\",\n  STATE_NOT_INITIALIZED: 0,\n  STATE_INITIALIZED: 1,\n  STATE_TERMINATED: 2,\n};\n\nexport const scorm12_constants: ScormConstants = {\n  // Children lists\n  cmi_children:\n    \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions\",\n  core_children:\n    \"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time\",\n  score_children: \"raw,min,max\",\n  comments_children: \"content,location,time\",\n  objectives_children: \"id,score,status\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children: \"audio,language,speed,text\",\n  interactions_children:\n    \"id,objectives,time,type,correct_responses,weighting,student_response,result,latency\",\n  error_descriptions: {\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use LMSGetDiagnostic for more information\",\n    },\n    \"201\": {\n      basicMessage: \"Invalid argument error\",\n      detailMessage:\n        \"Indicates that an argument represents an invalid data model element or is otherwise incorrect.\",\n    },\n    \"202\": {\n      basicMessage: \"Element cannot have children\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_children\" for a data model element that does not support the \"_children\" suffix.',\n    },\n    \"203\": {\n      basicMessage: \"Element not an array - cannot have count\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_count\" for a data model element that does not support the \"_count\" suffix.',\n    },\n    \"301\": {\n      basicMessage: \"Not initialized\",\n      detailMessage:\n        \"Indicates that an API call was made before the call to lmsInitialize.\",\n    },\n    \"401\": {\n      basicMessage: \"Not implemented error\",\n      detailMessage:\n        \"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement.\",\n    },\n    \"402\": {\n      basicMessage: \"Invalid set value, element is a keyword\",\n      detailMessage:\n        'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in \"_children\" and \"_count\").',\n    },\n    \"403\": {\n      basicMessage: \"Element is read only\",\n      detailMessage:\n        \"LMSSetValue was called with a data model element that can only be read.\",\n    },\n    \"404\": {\n      basicMessage: \"Element is write only\",\n      detailMessage:\n        \"LMSGetValue was called on a data model element that can only be written to.\",\n    },\n    \"405\": {\n      basicMessage: \"Incorrect Data Type\",\n      detailMessage:\n        \"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\nexport const aicc_constants: AiccConstants = {\n  ...scorm12_constants,\n  ...{\n    cmi_children:\n      \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation\",\n    student_preference_children:\n      \"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows\",\n    student_data_children:\n      \"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action\",\n    student_demographics_children:\n      \"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience\",\n    tries_children: \"time,status,score\",\n    attempt_records_children: \"score,lesson_status\",\n    paths_children: \"location_id,date,time,status,why_left,time_in_element\",\n  },\n};\n\nexport const scorm2004_constants: Scorm2004Constants = {\n  // Children lists\n  cmi_children:\n    \"_version,comments_from_learner,comments_from_lms,completion_status,credit,entry,exit,interactions,launch_data,learner_id,learner_name,learner_preference,location,max_time_allowed,mode,objectives,progress_measure,scaled_passing_score,score,session_time,success_status,suspend_data,time_limit_action,total_time\",\n  comments_children: \"comment,timestamp,location\",\n  score_children: \"max,raw,scaled,min\",\n  objectives_children:\n    \"progress_measure,completion_status,success_status,description,score,id\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children:\n    \"audio_level,audio_captioning,delivery_speed,language\",\n  interactions_children:\n    \"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description\",\n  adl_data_children: \"id,store\",\n  error_descriptions: {\n    \"0\": {\n      basicMessage: \"No Error\",\n      detailMessage: \"No error occurred, the previous API call was successful.\",\n    },\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use GetDiagnostic for more information.\",\n    },\n    \"102\": {\n      basicMessage: \"General Initialization Failure\",\n      detailMessage: \"Call to Initialize failed for an unknown reason.\",\n    },\n    \"103\": {\n      basicMessage: \"Already Initialized\",\n      detailMessage:\n        \"Call to Initialize failed because Initialize was already called.\",\n    },\n    \"104\": {\n      basicMessage: \"Content Instance Terminated\",\n      detailMessage:\n        \"Call to Initialize failed because Terminate was already called.\",\n    },\n    \"111\": {\n      basicMessage: \"General Termination Failure\",\n      detailMessage: \"Call to Terminate failed for an unknown reason.\",\n    },\n    \"112\": {\n      basicMessage: \"Termination Before Initialization\",\n      detailMessage:\n        \"Call to Terminate failed because it was made before the call to Initialize.\",\n    },\n    \"113\": {\n      basicMessage: \"Termination After Termination\",\n      detailMessage:\n        \"Call to Terminate failed because Terminate was already called.\",\n    },\n    \"122\": {\n      basicMessage: \"Retrieve Data Before Initialization\",\n      detailMessage:\n        \"Call to GetValue failed because it was made before the call to Initialize.\",\n    },\n    \"123\": {\n      basicMessage: \"Retrieve Data After Termination\",\n      detailMessage:\n        \"Call to GetValue failed because it was made after the call to Terminate.\",\n    },\n    \"132\": {\n      basicMessage: \"Store Data Before Initialization\",\n      detailMessage:\n        \"Call to SetValue failed because it was made before the call to Initialize.\",\n    },\n    \"133\": {\n      basicMessage: \"Store Data After Termination\",\n      detailMessage:\n        \"Call to SetValue failed because it was made after the call to Terminate.\",\n    },\n    \"142\": {\n      basicMessage: \"Commit Before Initialization\",\n      detailMessage:\n        \"Call to Commit failed because it was made before the call to Initialize.\",\n    },\n    \"143\": {\n      basicMessage: \"Commit After Termination\",\n      detailMessage:\n        \"Call to Commit failed because it was made after the call to Terminate.\",\n    },\n    \"201\": {\n      basicMessage: \"General Argument Error\",\n      detailMessage:\n        \"An invalid argument was passed to an API method (usually indicates that Initialize, Commit or Terminate did not receive the expected empty string argument.\",\n    },\n    \"301\": {\n      basicMessage: \"General Get Failure\",\n      detailMessage:\n        \"Indicates a failed GetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"351\": {\n      basicMessage: \"General Set Failure\",\n      detailMessage:\n        \"Indicates a failed SetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"391\": {\n      basicMessage: \"General Commit Failure\",\n      detailMessage:\n        \"Indicates a failed Commit call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"401\": {\n      basicMessage: \"Undefined Data Model Element\",\n      detailMessage:\n        \"The data model element name passed to GetValue or SetValue is not a valid SCORM data model element.\",\n    },\n    \"402\": {\n      basicMessage: \"Unimplemented Data Model Element\",\n      detailMessage:\n        \"The data model element indicated in a call to GetValue or SetValue is valid, but was not implemented by this LMS. In SCORM 2004, this error would indicate an LMS that is not fully SCORM conformant.\",\n    },\n    \"403\": {\n      basicMessage: \"Data Model Element Value Not Initialized\",\n      detailMessage:\n        \"Attempt to read a data model element that has not been initialized by the LMS or through a SetValue call. This error condition is often reached during normal execution of a SCO.\",\n    },\n    \"404\": {\n      basicMessage: \"Data Model Element Is Read Only\",\n      detailMessage:\n        \"SetValue was called with a data model element that can only be read.\",\n    },\n    \"405\": {\n      basicMessage: \"Data Model Element Is Write Only\",\n      detailMessage:\n        \"GetValue was called on a data model element that can only be written to.\",\n    },\n    \"406\": {\n      basicMessage: \"Data Model Element Type Mismatch\",\n      detailMessage:\n        \"SetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Data Model Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a SetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\n","import { LogLevel, ResultObject, Settings } from \"../types/api_types\";\nimport { global_constants } from \"./api_constants\";\nimport { LogLevelEnum } from \"./enums\";\n\n/**\n * Default settings for the SCORM API\n */\nexport const DefaultSettings: Settings = {\n  autocommit: false,\n  autocommitSeconds: 10,\n  asyncCommit: false,\n  sendFullCommit: true,\n  lmsCommitUrl: false,\n  dataCommitFormat: \"json\",\n  commitRequestDataType: \"application/json;charset=UTF-8\",\n  autoProgress: false,\n  logLevel: LogLevelEnum.ERROR,\n  selfReportSessionTime: false,\n  alwaysSendTotalTime: false,\n  renderCommonCommitFields: false,\n  strict_errors: true,\n  xhrHeaders: {},\n  xhrWithCredentials: false,\n  fetchMode: \"cors\",\n  responseHandler: async function (response: Response): Promise<ResultObject> {\n    if (typeof response !== \"undefined\") {\n      const responseText = await response.text();\n      let httpResult = null;\n      if (responseText) {\n        httpResult = JSON.parse(responseText);\n      }\n      if (\n        httpResult === null ||\n        !{}.hasOwnProperty.call(httpResult, \"result\")\n      ) {\n        if (response.status === 200) {\n          return {\n            result: global_constants.SCORM_TRUE,\n            errorCode: 0,\n          };\n        } else {\n          return {\n            result: global_constants.SCORM_FALSE,\n            errorCode: 101,\n          };\n        }\n      } else {\n        return {\n          result: httpResult.result,\n          errorCode: httpResult.errorCode\n            ? httpResult.errorCode\n            : httpResult.result === global_constants.SCORM_TRUE\n              ? 0\n              : 101,\n        };\n      }\n    }\n    return {\n      result: global_constants.SCORM_FALSE,\n      errorCode: 101,\n    };\n  },\n  requestHandler: function (commitObject) {\n    return commitObject;\n  },\n  onLogMessage: defaultLogHandler,\n  scoItemIds: [],\n  scoItemIdValidator: false,\n  globalObjectiveIds: [],\n};\n\nexport function defaultLogHandler(\n  messageLevel: LogLevel,\n  logMessage: string,\n): void {\n  switch (messageLevel) {\n    case \"4\":\n    case 4:\n    case \"ERROR\":\n    case LogLevelEnum.ERROR:\n      console.error(logMessage);\n      break;\n    case \"3\":\n    case 3:\n    case \"WARN\":\n    case LogLevelEnum.WARN:\n      console.warn(logMessage);\n      break;\n    case \"2\":\n    case 2:\n    case \"INFO\":\n    case LogLevelEnum.INFO:\n      console.info(logMessage);\n      break;\n    case \"1\":\n    case 1:\n    case \"DEBUG\":\n    case LogLevelEnum.DEBUG:\n      if (console.debug) {\n        console.debug(logMessage);\n      } else {\n        console.log(logMessage);\n      }\n      break;\n  }\n}\n","import BaseAPI from \"../BaseAPI\";\n\n/**\n * Private class that wraps a timeout call to the commit() function\n */\nexport class ScheduledCommit {\n  private _API;\n  private _cancelled = false;\n  private readonly _timeout;\n  private readonly _callback;\n\n  /**\n   * Constructor for ScheduledCommit\n   * @param {BaseAPI} API\n   * @param {number} when\n   * @param {string} callback\n   */\n  constructor(API: BaseAPI, when: number, callback: string) {\n    this._API = API;\n    this._timeout = setTimeout(this.wrapper.bind(this), when);\n    this._callback = callback;\n  }\n\n  /**\n   * Cancel any currently scheduled commit\n   */\n  cancel() {\n    this._cancelled = true;\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n  }\n\n  /**\n   * Wrap the API commit call to check if the call has already been cancelled\n   */\n  wrapper() {\n    if (!this._cancelled) {\n      (async () => await this._API.commit(this._callback))();\n    }\n  }\n}\n","import { CommitObject, ResultObject, Settings } from \"../types/api_types\";\nimport { global_constants } from \"../constants/api_constants\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { IHttpService } from \"../interfaces/services\";\nimport { ErrorCode } from \"../constants/error_codes\";\nimport { StringKeyMap } from \"../utilities\";\n\n/**\n * Service for handling HTTP communication with the LMS\n */\nexport class HttpService implements IHttpService {\n  private settings: Settings;\n  private error_codes: ErrorCode;\n\n  /**\n   * Constructor for HttpService\n   * @param {Settings} settings - The settings object\n   * @param {ErrorCode} error_codes - The error codes object\n   */\n  constructor(settings: Settings, error_codes: ErrorCode) {\n    this.settings = settings;\n    this.error_codes = error_codes;\n  }\n\n  /**\n   * Sends HTTP requests to the LMS with special handling for immediate and standard requests.\n   *\n   * This method handles communication with the LMS server, implementing two distinct\n   * request handling strategies based on the context:\n   *\n   * 1. Immediate Mode (used during termination):\n   *    When immediate=true, the method:\n   *    - Initiates the fetch request but doesn't wait for it to complete\n   *    - Returns a success result immediately\n   *    - Processes the response asynchronously when it arrives\n   *\n   *    This is critical for browser compatibility during page unload/termination,\n   *    as some browsers (especially Chrome) may cancel synchronous or awaited\n   *    requests when a page is closing.\n   *\n   * 2. Standard Mode (normal operation):\n   *    When immediate=false, the method:\n   *    - Processes the request parameters through the configured requestHandler\n   *    - Awaits the fetch response completely\n   *    - Transforms the response using the configured responseHandler\n   *    - Triggers appropriate event listeners based on success/failure\n   *    - Returns the complete result with appropriate error codes\n   *\n   * The method also includes error handling to catch network failures or other\n   * exceptions that might occur during the request process.\n   *\n   * @param {string} url - The URL endpoint to send the request to\n   * @param {CommitObject|StringKeyMap|Array} params - The data to send to the LMS\n   * @param {boolean} immediate - Whether to send the request immediately without waiting (true) or process normally (false)\n   * @param {Function} apiLog - Function to log API messages with appropriate levels\n   * @param {Function} processListeners - Function to trigger event listeners for commit events\n   * @return {Promise<ResultObject>} - A promise that resolves with the result of the request\n   *\n   * @example\n   * // Standard request (waits for response)\n   * const result = await httpService.processHttpRequest(\n   *   \"https://lms.example.com/commit\",\n   *   { cmi: { core: { lesson_status: \"completed\" } } },\n   *   false,\n   *   console.log,\n   *   (event) => dispatchEvent(new CustomEvent(event))\n   * );\n   *\n   * @example\n   * // Immediate request (for termination)\n   * const result = await httpService.processHttpRequest(\n   *   \"https://lms.example.com/commit\",\n   *   { cmi: { core: { lesson_status: \"completed\" } } },\n   *   true,\n   *   console.log,\n   *   (event) => dispatchEvent(new CustomEvent(event))\n   * );\n   * // result will be success immediately, regardless of actual HTTP result\n   */\n  async processHttpRequest(\n    url: string,\n    params: CommitObject | StringKeyMap | Array<any>,\n    immediate: boolean = false,\n    apiLog: (\n      functionName: string,\n      message: any,\n      messageLevel: LogLevelEnum,\n      CMIElement?: string,\n    ) => void,\n    processListeners: (\n      functionName: string,\n      CMIElement?: string,\n      value?: any,\n    ) => void,\n  ): Promise<ResultObject> {\n    const genericError: ResultObject = {\n      result: global_constants.SCORM_FALSE,\n      errorCode: this.error_codes.GENERAL,\n    };\n\n    // if we are terminating the module or closing the browser window/tab, we need to make this fetch ASAP.\n    // Some browsers, especially Chrome, do not like synchronous requests to be made when the window is closing.\n    if (immediate) {\n      this.performFetch(url, params).then(async (response) => {\n        await this.transformResponse(response, processListeners);\n      });\n      return {\n        result: global_constants.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n\n    const process = async (\n      url: string,\n      params: CommitObject | StringKeyMap | Array<any>,\n      settings: Settings,\n    ): Promise<ResultObject> => {\n      try {\n        params = settings.requestHandler(params) as\n          | CommitObject\n          | StringKeyMap\n          | Array<any>;\n        const response = await this.performFetch(url, params);\n\n        return this.transformResponse(response, processListeners);\n      } catch (e) {\n        apiLog(\"processHttpRequest\", e, LogLevelEnum.ERROR);\n        processListeners(\"CommitError\");\n        return genericError;\n      }\n    };\n\n    return await process(url, params, this.settings);\n  }\n\n  /**\n   * Perform the fetch request to the LMS\n   * @param {string} url - The URL to send the request to\n   * @param {StringKeyMap|Array} params - The parameters to include in the request\n   * @return {Promise<Response>} - The response from the LMS\n   * @private\n   */\n  private async performFetch(\n    url: string,\n    params: StringKeyMap | Array<any>,\n  ): Promise<Response> {\n    return fetch(url, {\n      method: \"POST\",\n      mode: this.settings.fetchMode,\n      body: params instanceof Array ? params.join(\"&\") : JSON.stringify(params),\n      headers: {\n        ...this.settings.xhrHeaders,\n        \"Content-Type\": this.settings.commitRequestDataType,\n      },\n      credentials: this.settings.xhrWithCredentials ? \"include\" : undefined,\n      keepalive: true,\n    });\n  }\n\n  /**\n   * Transforms the response from the LMS to a ResultObject\n   * @param {Response} response - The response from the LMS\n   * @param {Function} processListeners - Function to process event listeners\n   * @return {Promise<ResultObject>} - The transformed response\n   * @private\n   */\n  private async transformResponse(\n    response: Response,\n    processListeners: (\n      functionName: string,\n      CMIElement?: string,\n      value?: any,\n    ) => void,\n  ): Promise<ResultObject> {\n    const result =\n      typeof this.settings.responseHandler === \"function\"\n        ? await this.settings.responseHandler(response)\n        : await response.json();\n\n    if (\n      response.status >= 200 &&\n      response.status <= 299 &&\n      (result.result === true || result.result === global_constants.SCORM_TRUE)\n    ) {\n      processListeners(\"CommitSuccess\");\n      if (!Object.hasOwnProperty.call(result, \"errorCode\")) {\n        result.errorCode = 0;\n      }\n    } else {\n      processListeners(\"CommitError\");\n      if (!Object.hasOwnProperty.call(result, \"errorCode\")) {\n        result.errorCode = this.error_codes.GENERAL;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Updates the service settings\n   * @param {Settings} settings - The new settings\n   */\n  updateSettings(settings: Settings): void {\n    this.settings = settings;\n  }\n}\n","import { LogLevel } from \"../types/api_types\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { stringMatches } from \"../utilities\";\nimport { IEventService } from \"../interfaces/services\";\n\n/**\n * Interface for a listener object\n */\ninterface Listener {\n  functionName: string;\n  CMIElement: string | null;\n  callback: Function;\n}\n\n/**\n * Type for parsed listener information\n */\ninterface ParsedListener {\n  functionName: string;\n  CMIElement: string | null;\n}\n\n/**\n * Service for handling event listeners and event processing\n */\nexport class EventService implements IEventService {\n  // Map of function names to listeners for faster lookups\n  private listenerMap: Map<string, Listener[]> = new Map();\n  // Total count of listeners for logging\n  private listenerCount = 0;\n  // Function to log API messages\n  private readonly apiLog: (\n    functionName: string,\n    message: string,\n    messageLevel: LogLevel,\n    CMIElement?: string,\n  ) => void;\n\n  /**\n   * Constructor for EventService\n   * @param {Function} apiLog - Function to log API messages\n   */\n  constructor(\n    apiLog: (\n      functionName: string,\n      message: string,\n      messageLevel: LogLevel,\n      CMIElement?: string,\n    ) => void,\n  ) {\n    this.apiLog = apiLog;\n  }\n\n  /**\n   * Parses a listener name into its components\n   *\n   * @param {string} listenerName - The name of the listener\n   * @returns {ParsedListener|null} - The parsed listener information or null if invalid\n   */\n  private parseListenerName(listenerName: string): ParsedListener | null {\n    const listenerSplit = listenerName.split(\".\");\n    if (listenerSplit.length === 0) return null;\n\n    const functionName = listenerSplit[0];\n    let CMIElement = null;\n\n    if (listenerSplit.length > 1) {\n      CMIElement = listenerName.replace(`${functionName}.`, \"\");\n    }\n\n    return { functionName, CMIElement };\n  }\n\n  /**\n   * Provides a mechanism for attaching to a specific SCORM event\n   *\n   * @param {string} listenerName - The name of the listener\n   * @param {Function} callback - The callback function to execute when the event occurs\n   */\n  on(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // Get or create the array for this function name\n      const listeners = this.listenerMap.get(functionName) ?? [];\n\n      // Add the new listener\n      listeners.push({\n        functionName,\n        CMIElement,\n        callback,\n      });\n\n      // Update the map and count\n      this.listenerMap.set(functionName, listeners);\n      this.listenerCount++;\n\n      this.apiLog(\n        \"on\",\n        `Added event listener: ${this.listenerCount}`,\n        LogLevelEnum.INFO,\n        functionName,\n      );\n    }\n  }\n\n  /**\n   * Provides a mechanism for detaching a specific SCORM event listener\n   *\n   * @param {string} listenerName - The name of the listener to remove\n   * @param {Function} callback - The callback function to remove\n   */\n  off(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // Get the listeners for this function name\n      const listeners = this.listenerMap.get(functionName);\n      if (!listeners) continue;\n\n      // Find the index of the listener to remove\n      const removeIndex = listeners.findIndex(\n        (obj) => obj.CMIElement === CMIElement && obj.callback === callback,\n      );\n\n      if (removeIndex !== -1) {\n        // Remove the listener\n        listeners.splice(removeIndex, 1);\n        this.listenerCount--;\n\n        // Update the map or remove the entry if empty\n        if (listeners.length === 0) {\n          this.listenerMap.delete(functionName);\n        } else {\n          this.listenerMap.set(functionName, listeners);\n        }\n\n        this.apiLog(\n          \"off\",\n          `Removed event listener: ${this.listenerCount}`,\n          LogLevelEnum.INFO,\n          functionName,\n        );\n      }\n    }\n  }\n\n  /**\n   * Provides a mechanism for clearing all listeners from a specific SCORM event\n   *\n   * @param {string} listenerName - The name of the listener to clear\n   */\n  clear(listenerName: string) {\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // If we have listeners for this function name\n      if (this.listenerMap.has(functionName)) {\n        const listeners = this.listenerMap.get(functionName)!;\n\n        // Filter out listeners that match the criteria\n        const newListeners = listeners.filter(\n          (obj) => obj.CMIElement !== CMIElement,\n        );\n\n        // Update the count and map\n        this.listenerCount -= listeners.length - newListeners.length;\n\n        if (newListeners.length === 0) {\n          this.listenerMap.delete(functionName);\n        } else {\n          this.listenerMap.set(functionName, newListeners);\n        }\n      }\n    }\n  }\n\n  /**\n   * Processes any 'on' listeners that have been created\n   *\n   * @param {string} functionName - The name of the function that triggered the event\n   * @param {string} CMIElement - The CMI element that was affected\n   * @param {any} value - The value that was set\n   */\n  processListeners(functionName: string, CMIElement?: string, value?: any) {\n    this.apiLog(functionName, value, LogLevelEnum.INFO, CMIElement);\n\n    // Get listeners for this function name\n    const listeners = this.listenerMap.get(functionName);\n    if (!listeners) return;\n\n    for (const listener of listeners) {\n      const listenerHasCMIElement = !!listener.CMIElement;\n      let CMIElementsMatch = false;\n\n      // Check if CMI elements match\n      if (\n        CMIElement &&\n        listener.CMIElement &&\n        listener.CMIElement.endsWith(\"*\")\n      ) {\n        const prefix = listener.CMIElement.slice(0, -1);\n        CMIElementsMatch = stringMatches(CMIElement, prefix);\n      } else {\n        CMIElementsMatch = listener.CMIElement === CMIElement;\n      }\n\n      // If the listener matches, call the callback\n      if (!listenerHasCMIElement || CMIElementsMatch) {\n        this.apiLog(\n          \"processListeners\",\n          `Processing listener: ${listener.functionName}`,\n          LogLevelEnum.DEBUG,\n          CMIElement,\n        );\n        listener.callback(CMIElement, value);\n      }\n    }\n  }\n\n  /**\n   * Resets the event service by clearing all listeners\n   */\n  reset() {\n    this.listenerMap.clear();\n    this.listenerCount = 0;\n  }\n}\n","import { CommitObject, LogLevel } from \"../types/api_types\";\nimport { StringKeyMap, unflatten } from \"../utilities\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { BaseCMI } from \"../cmi/common/base_cmi\";\nimport { ISerializationService } from \"../interfaces/services\";\n\n/**\n * Service for handling data serialization and deserialization in SCORM Again\n */\nexport class SerializationService implements ISerializationService {\n  /**\n   * Loads CMI data from a flattened JSON object with special handling for arrays and ordering.\n   *\n   * This method implements a complex algorithm for loading flattened JSON data into the CMI\n   * object structure. It handles several key challenges:\n   *\n   * 1. Ordering dependencies: Some CMI elements (like interactions and objectives) must be\n   *    loaded in a specific order to ensure proper initialization.\n   *\n   * 2. Array handling: Interactions and objectives are stored as arrays, and their properties\n   *    must be loaded in the correct order (e.g., 'id' and 'type' must be set before other properties).\n   *\n   * 3. Unflattening: The method converts flattened dot notation (e.g., \"cmi.objectives.0.id\")\n   *    back into nested objects before loading.\n   *\n   * The algorithm works by:\n   * - Categorizing keys into interactions, objectives, and other properties\n   * - Sorting interactions to prioritize 'id' and 'type' fields within each index\n   * - Sorting objectives to prioritize 'id' fields within each index\n   * - Processing each category in order: interactions, objectives, then other properties\n   *\n   * @param {StringKeyMap} json - The flattened JSON object with dot notation keys\n   * @param {string} CMIElement - The CMI element to start from (usually empty or \"cmi\")\n   * @param {Function} setCMIValue - Function to set CMI value\n   * @param {Function} isNotInitialized - Function to check if API is not initialized\n   *\n   * @param setStartingData\n   * @example\n   * // Example of flattened JSON input:\n   * // {\n   * //   \"cmi.objectives.0.id\": \"obj1\",\n   * //   \"cmi.objectives.0.score.raw\": \"80\",\n   * //   \"cmi.interactions.0.id\": \"int1\",\n   * //   \"cmi.interactions.0.type\": \"choice\",\n   * //   \"cmi.interactions.0.result\": \"correct\"\n   * // }\n   */\n  loadFromFlattenedJSON(\n    json: StringKeyMap,\n    CMIElement: string = \"\",\n    setCMIValue: (CMIElement: string, value: any) => void,\n    isNotInitialized: () => boolean,\n    setStartingData: (data: StringKeyMap) => void,\n  ): void {\n    if (!isNotInitialized()) {\n      console.error(\n        \"loadFromFlattenedJSON can only be called before the call to lmsInitialize.\",\n      );\n      return;\n    }\n\n    const int_pattern = /^(cmi\\.interactions\\.)(\\d+)\\.(.*)$/;\n    const obj_pattern = /^(cmi\\.objectives\\.)(\\d+)\\.(.*)$/;\n\n    // Extract and categorize keys for better sorting\n    const interactions: {\n      key: string;\n      value: any;\n      index: number;\n      field: string;\n    }[] = [];\n    const objectives: {\n      key: string;\n      value: any;\n      index: number;\n      field: string;\n    }[] = [];\n    const others: { key: string; value: any }[] = [];\n\n    // Categorize keys\n    for (const key in json) {\n      if (Object.prototype.hasOwnProperty.call(json, key)) {\n        const intMatch = key.match(int_pattern);\n        if (intMatch) {\n          interactions.push({\n            key,\n            value: json[key],\n            index: Number(intMatch[2]),\n            field: intMatch[3],\n          });\n          continue;\n        }\n\n        const objMatch = key.match(obj_pattern);\n        if (objMatch) {\n          objectives.push({\n            key,\n            value: json[key],\n            index: Number(objMatch[2]),\n            field: objMatch[3],\n          });\n          continue;\n        }\n\n        others.push({ key, value: json[key] });\n      }\n    }\n\n    // Sort interactions: first by index, then prioritize 'id' and 'type' fields\n    interactions.sort((a, b) => {\n      if (a.index !== b.index) {\n        return a.index - b.index;\n      }\n\n      // Same index, prioritize id and type\n      if (a.field === \"id\") return -1;\n      if (b.field === \"id\") return 1;\n      if (a.field === \"type\") return -1;\n      if (b.field === \"type\") return 1;\n\n      return a.field.localeCompare(b.field);\n    });\n\n    // Sort objectives: first by index, then prioritize 'id' field\n    objectives.sort((a, b) => {\n      if (a.index !== b.index) {\n        return a.index - b.index;\n      }\n\n      // Same index, prioritize id\n      if (a.field === \"id\") return -1;\n      if (b.field === \"id\") return 1;\n\n      return a.field.localeCompare(b.field);\n    });\n\n    // Sort other keys alphabetically\n    others.sort((a, b) => a.key.localeCompare(b.key));\n\n    // Process all items in the correct order\n    const processItems = (items: { key: string; value: any }[]) => {\n      items.forEach((item) => {\n        const obj: StringKeyMap = {};\n        obj[item.key] = item.value;\n        this.loadFromJSON(\n          unflatten(obj) as StringKeyMap,\n          CMIElement,\n          setCMIValue,\n          isNotInitialized,\n          setStartingData,\n        );\n      });\n    };\n\n    // Process in order: interactions, objectives, others\n    processItems(interactions);\n    processItems(objectives);\n    processItems(others);\n  }\n\n  /**\n   * Loads CMI data from a nested JSON object with recursive traversal.\n   *\n   * This method implements a recursive algorithm for loading nested JSON data into the CMI\n   * object structure. It handles several key aspects:\n   *\n   * 1. Recursive traversal: The method recursively traverses the nested JSON structure,\n   *    building CMI element paths as it goes (e.g., \"cmi.core.student_id\").\n   *\n   * 2. Type-specific handling: Different data types are handled differently:\n   *    - Arrays: Each array element is processed individually with its index in the path\n   *    - Objects: Recursively processed with updated path\n   *    - Primitives: Set directly using setCMIValue\n   *\n   * 3. Initialization check: Ensures the method is only called before API initialization\n   *\n   * 4. Starting data storage: Stores the original JSON data for potential future use\n   *\n   * The algorithm works by:\n   * - First storing the complete JSON object via setStartingData\n   * - Iterating through each property in the JSON object\n   * - For each property, determining its type and handling it accordingly\n   * - Building the CMI element path as it traverses the structure\n   * - Setting values at the appropriate paths using setCMIValue\n   *\n   * @param {{[key: string]: any}} json - The nested JSON object to load\n   * @param {string} CMIElement - The CMI element to start from (usually empty or \"cmi\")\n   * @param {Function} setCMIValue - Function to set CMI value at a specific path\n   * @param {Function} isNotInitialized - Function to check if API is not initialized\n   * @param {Function} setStartingData - Function to store the original JSON data\n   *\n   * @example\n   * // Example of nested JSON input:\n   * // {\n   * //   \"core\": {\n   * //     \"student_id\": \"12345\",\n   * //     \"student_name\": \"John Doe\"\n   * //   },\n   * //   \"objectives\": [\n   * //     { \"id\": \"obj1\", \"score\": { \"raw\": 80 } },\n   * //     { \"id\": \"obj2\", \"score\": { \"raw\": 90 } }\n   * //   ]\n   * // }\n   */\n  loadFromJSON(\n    json: { [key: string]: any },\n    CMIElement: string = \"\",\n    setCMIValue: (CMIElement: string, value: any) => void,\n    isNotInitialized: () => boolean,\n    setStartingData: (data: StringKeyMap) => void,\n  ): void {\n    if (!isNotInitialized()) {\n      console.error(\n        \"loadFromJSON can only be called before the call to lmsInitialize.\",\n      );\n      return;\n    }\n\n    CMIElement = CMIElement !== undefined ? CMIElement : \"cmi\";\n\n    setStartingData(json);\n\n    // could this be refactored down to flatten(json) then setCMIValue on each?\n    for (const key in json) {\n      if (Object.prototype.hasOwnProperty.call(json, key) && json[key]) {\n        const currentCMIElement = (CMIElement ? CMIElement + \".\" : \"\") + key;\n        const value = json[key];\n\n        if (value.constructor === Array) {\n          for (let i = 0; i < value.length; i++) {\n            if (value[i]) {\n              const item = value[i];\n              const tempCMIElement = `${currentCMIElement}.${i}`;\n\n              if (item.constructor === Object) {\n                this.loadFromJSON(\n                  item,\n                  tempCMIElement,\n                  setCMIValue,\n                  isNotInitialized,\n                  setStartingData,\n                );\n              } else {\n                setCMIValue(tempCMIElement, item);\n              }\n            }\n          }\n        } else if (value.constructor === Object) {\n          this.loadFromJSON(\n            value,\n            currentCMIElement,\n            setCMIValue,\n            isNotInitialized,\n            setStartingData,\n          );\n        } else {\n          setCMIValue(currentCMIElement, value);\n        }\n      }\n    }\n  }\n\n  /**\n   * Render the CMI object to JSON for sending to an LMS.\n   *\n   * @param {BaseCMI|StringKeyMap} cmi - The CMI object\n   * @param {boolean} sendFullCommit - Whether to send the full commit\n   * @return {string}\n   */\n  renderCMIToJSONString(\n    cmi: BaseCMI | StringKeyMap,\n    sendFullCommit: boolean,\n  ): string {\n    // Do we want/need to return fields that have no set value?\n    if (sendFullCommit) {\n      return JSON.stringify({ cmi });\n    }\n    return JSON.stringify({ cmi }, (k, v) => (v === undefined ? null : v), 2);\n  }\n\n  /**\n   * Returns a JS object representing the current cmi\n   * @param {BaseCMI|StringKeyMap} cmi - The CMI object\n   * @param {boolean} sendFullCommit - Whether to send the full commit\n   * @return {object}\n   */\n  renderCMIToJSONObject(\n    cmi: BaseCMI | StringKeyMap,\n    sendFullCommit: boolean,\n  ): StringKeyMap {\n    // Revert to the original implementation to maintain compatibility with tests\n    return JSON.parse(this.renderCMIToJSONString(cmi, sendFullCommit));\n  }\n\n  /**\n   * Builds the commit object to be sent to the LMS\n   * @param {boolean} terminateCommit - Whether this is a termination commit\n   * @param {boolean} alwaysSendTotalTime - Whether to always send total time\n   * @param {boolean|Function} renderCommonCommitFields - Whether to render common commit fields\n   * @param {Function} renderCommitObject - Function to render commit object\n   * @param {Function} renderCommitCMI - Function to render commit CMI\n   * @param {LogLevel} apiLogLevel - The API log level\n   * @return {CommitObject|StringKeyMap|Array<any>}\n   */\n  getCommitObject(\n    terminateCommit: boolean,\n    alwaysSendTotalTime: boolean,\n    renderCommonCommitFields:\n      | boolean\n      | ((commitObject: CommitObject) => boolean),\n    renderCommitObject: (terminateCommit: boolean) => CommitObject,\n    renderCommitCMI: (terminateCommit: boolean) => StringKeyMap | Array<any>,\n    apiLogLevel: LogLevel,\n  ): CommitObject | StringKeyMap | Array<any> {\n    const shouldTerminateCommit = terminateCommit || alwaysSendTotalTime;\n    const commitObject = renderCommonCommitFields\n      ? renderCommitObject(shouldTerminateCommit)\n      : renderCommitCMI(shouldTerminateCommit);\n\n    if ([LogLevelEnum.DEBUG, \"1\", 1, \"DEBUG\"].includes(apiLogLevel)) {\n      console.debug(\n        \"Commit (terminated: \" + (terminateCommit ? \"yes\" : \"no\") + \"): \",\n      );\n      console.debug(commitObject);\n    }\n    return commitObject;\n  }\n}\n","import { ValidationError } from \"../exceptions\";\nimport { CMIArray } from \"../cmi/common/array\";\n\n/**\n * Type guard for ValidationError\n *\n * @param {unknown} value - The value to check\n * @return {boolean} - Whether the value is a ValidationError\n */\nexport function isValidationError(value: unknown): value is ValidationError {\n  return value instanceof ValidationError;\n}\n\n/**\n * Type guard for Error\n *\n * @param {unknown} value - The value to check\n * @return {boolean} - Whether the value is an Error\n */\nexport function isError(value: unknown): value is Error {\n  return value instanceof Error;\n}\n\n/**\n * Type guard for CMIArray\n *\n * @param {unknown} value - The value to check\n * @return {boolean} - Whether the value is a CMIArray\n */\nexport function isCMIArray(value: unknown): value is CMIArray {\n  return value instanceof CMIArray;\n}\n","import { LogLevelEnum } from \"../constants/enums\";\nimport { global_constants } from \"../constants/api_constants\";\nimport { ErrorCode } from \"../constants/error_codes\";\nimport { ValidationError } from \"../exceptions\";\nimport { IErrorHandlingService } from \"../interfaces/services\";\nimport { isError, isValidationError } from \"../utils/type_guards\";\n\n/**\n * Service for handling SCORM errors\n */\nexport class ErrorHandlingService implements IErrorHandlingService {\n  private _lastErrorCode: string = \"0\";\n  private readonly _errorCodes: ErrorCode;\n  private readonly _apiLog: (\n    functionName: string,\n    message: string,\n    logLevel?: LogLevelEnum,\n    CMIElement?: string,\n  ) => void;\n  private readonly _getLmsErrorMessageDetails: (\n    errorCode: number,\n    detail: boolean,\n  ) => string;\n\n  /**\n   * Constructor for ErrorHandlingService\n   *\n   * @param {ErrorCode} errorCodes - The error codes object\n   * @param {Function} apiLog - Function for logging API calls\n   * @param {Function} getLmsErrorMessageDetails - Function for getting error message details\n   */\n  constructor(\n    errorCodes: ErrorCode,\n    apiLog: (\n      functionName: string,\n      message: string,\n      logLevel?: LogLevelEnum,\n      CMIElement?: string,\n    ) => void,\n    getLmsErrorMessageDetails: (errorCode: number, detail: boolean) => string,\n  ) {\n    this._errorCodes = errorCodes;\n    this._apiLog = apiLog;\n    this._getLmsErrorMessageDetails = getLmsErrorMessageDetails;\n  }\n\n  /**\n   * Get the last error code\n   *\n   * @return {string} - The last error code\n   */\n  get lastErrorCode(): string {\n    return this._lastErrorCode;\n  }\n\n  /**\n   * Set the last error code\n   *\n   * @param {string} errorCode - The error code to set\n   */\n  set lastErrorCode(errorCode: string) {\n    this._lastErrorCode = errorCode;\n  }\n\n  /**\n   * Throws a SCORM error\n   *\n   * @param {string} CMIElement\n   * @param {number} errorNumber - The error number\n   * @param {string} message - The error message\n   * @throws {ValidationError} - If throwException is true, throws a ValidationError\n   */\n  throwSCORMError(\n    CMIElement: string,\n    errorNumber: number,\n    message?: string,\n  ): void {\n    if (!message) {\n      message = this._getLmsErrorMessageDetails(errorNumber, true);\n    }\n\n    this._apiLog(\n      \"throwSCORMError\",\n      errorNumber + \": \" + message,\n      LogLevelEnum.ERROR,\n      CMIElement,\n    );\n\n    this._lastErrorCode = String(errorNumber);\n  }\n\n  /**\n   * Clears the last SCORM error code on success.\n   *\n   * @param {string} success - Whether the operation was successful\n   */\n  clearSCORMError(success: string): void {\n    if (success !== undefined && success !== global_constants.SCORM_FALSE) {\n      this._lastErrorCode = \"0\";\n    }\n  }\n\n  /**\n   * Handles exceptions that occur when accessing or setting CMI values.\n   *\n   * This method provides centralized error handling for exceptions that occur during\n   * CMI data operations. It differentiates between different types of errors and\n   * handles them appropriately:\n   *\n   * 1. ValidationError: These are expected errors from the validation system that\n   *    indicate a specific SCORM error condition (like invalid data format or range).\n   *    For these errors, the method:\n   *    - Sets the lastErrorCode to the error code from the ValidationError\n   *    - Returns SCORM_FALSE to indicate failure to the caller\n   *\n   * 2. Standard JavaScript Error: For general JavaScript errors (like TypeError,\n   *    ReferenceError, etc.), the method:\n   *    - Logs the error message to the console\n   *    - Sets a general SCORM error\n   *    - Returns SCORM_FALSE to indicate failure\n   *\n   * 3. Unknown exceptions: For any other type of exception that doesn't match the\n   *    above categories, the method:\n   *    - Logs the entire exception object to the console\n   *    - Sets a general SCORM error\n   *    - Returns SCORM_FALSE to indicate failure\n   *\n   * This method is critical for maintaining SCORM compliance by ensuring that\n   * all errors are properly translated into the appropriate SCORM error codes.\n   *\n   * @param {string} CMIElement\n   * @param {ValidationError|Error|unknown} e - The exception that was thrown\n   * @param {string} returnValue - The default return value (typically an empty string)\n   * @return {string} - Either the original returnValue or SCORM_FALSE if an error occurred\n   *\n   * @example\n   * try {\n   *   const value = getCMIValue(\"cmi.core.score.raw\");\n   *   return value;\n   * } catch (e) {\n   *   return handleValueAccessException(e, \"\");\n   * }\n   */\n  handleValueAccessException(\n    CMIElement: string,\n    e: ValidationError | Error | unknown,\n    returnValue: string,\n  ): string {\n    if (isValidationError(e)) {\n      this._lastErrorCode = String(e.errorCode);\n      returnValue = global_constants.SCORM_FALSE;\n    } else {\n      if (isError(e) && e.message) {\n        console.error(e.message);\n        this.throwSCORMError(CMIElement, this._errorCodes.GENERAL, e.message);\n      } else {\n        console.error(e);\n        this.throwSCORMError(\n          CMIElement,\n          this._errorCodes.GENERAL,\n          \"Unknown error\",\n        );\n      }\n    }\n    return returnValue;\n  }\n\n  /**\n   * Get the error codes object\n   *\n   * @return {ErrorCode} - The error codes object\n   */\n  get errorCodes(): ErrorCode {\n    return this._errorCodes;\n  }\n}\n\n// Export a factory function to create the service\nexport function createErrorHandlingService(\n  errorCodes: ErrorCode,\n  apiLog: (\n    functionName: string,\n    message: string,\n    logLevel?: LogLevelEnum,\n    CMIElement?: string,\n  ) => void,\n  getLmsErrorMessageDetails: (errorCode: number, detail: boolean) => string,\n): ErrorHandlingService {\n  return new ErrorHandlingService(\n    errorCodes,\n    apiLog,\n    getLmsErrorMessageDetails,\n  );\n}\n","import { LogLevel } from \"../types/api_types\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { ILoggingService } from \"../interfaces/services\";\nimport { defaultLogHandler } from \"../constants/default_settings\";\n\n/**\n * Centralized logging service implemented as a singleton\n * Provides methods for logging at different levels and configuring the log level\n */\nexport class LoggingService implements ILoggingService {\n  private static _instance: LoggingService;\n  private _logLevel: LogLevel = LogLevelEnum.ERROR;\n  private _logHandler: (messageLevel: LogLevel, logMessage: string) => void;\n\n  /**\n   * Private constructor to prevent direct instantiation\n   */\n  private constructor() {\n    // Default log handler uses console methods based on log level\n    this._logHandler = defaultLogHandler;\n  }\n\n  /**\n   * Get the singleton instance of LoggingService\n   *\n   * @returns {LoggingService} The singleton instance\n   */\n  public static getInstance(): LoggingService {\n    if (!LoggingService._instance) {\n      LoggingService._instance = new LoggingService();\n    }\n    return LoggingService._instance;\n  }\n\n  /**\n   * Set the log level\n   *\n   * @param {LogLevel} level - The log level to set\n   */\n  public setLogLevel(level: LogLevel): void {\n    this._logLevel = level;\n  }\n\n  /**\n   * Get the current log level\n   *\n   * @returns {LogLevel} The current log level\n   */\n  public getLogLevel(): LogLevel {\n    return this._logLevel;\n  }\n\n  /**\n   * Set a custom log handler\n   *\n   * @param {Function} handler - The function to handle log messages\n   */\n  public setLogHandler(\n    handler: (messageLevel: LogLevel, logMessage: string) => void,\n  ): void {\n    this._logHandler = handler;\n  }\n\n  /**\n   * Log a message if the message level is greater than or equal to the current log level\n   *\n   * @param {LogLevel} messageLevel - The level of the message\n   * @param {string} logMessage - The message to log\n   */\n  public log(messageLevel: LogLevel, logMessage: string): void {\n    if (this.shouldLog(messageLevel)) {\n      this._logHandler(messageLevel, logMessage);\n    }\n  }\n\n  /**\n   * Log a message at ERROR level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public error(logMessage: string): void {\n    this.log(LogLevelEnum.ERROR, logMessage);\n  }\n\n  /**\n   * Log a message at WARN level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public warn(logMessage: string): void {\n    this.log(LogLevelEnum.WARN, logMessage);\n  }\n\n  /**\n   * Log a message at INFO level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public info(logMessage: string): void {\n    this.log(LogLevelEnum.INFO, logMessage);\n  }\n\n  /**\n   * Log a message at DEBUG level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public debug(logMessage: string): void {\n    this.log(LogLevelEnum.DEBUG, logMessage);\n  }\n\n  /**\n   * Determine if a message should be logged based on its level and the current log level\n   *\n   * @param {LogLevel} messageLevel - The level of the message\n   * @returns {boolean} Whether the message should be logged\n   */\n  private shouldLog(messageLevel: LogLevel): boolean {\n    // Convert string levels to numbers for comparison\n    const numericMessageLevel = this.getNumericLevel(messageLevel);\n    const numericLogLevel = this.getNumericLevel(this._logLevel);\n\n    return numericMessageLevel >= numericLogLevel;\n  }\n\n  /**\n   * Convert a log level to its numeric value\n   *\n   * @param {LogLevel} level - The log level to convert\n   * @returns {number} The numeric value of the log level\n   */\n  private getNumericLevel(level: LogLevel): number {\n    if (level === undefined) return LogLevelEnum.NONE;\n\n    if (typeof level === \"number\") return level;\n\n    switch (level) {\n      case \"1\":\n      case \"DEBUG\":\n        return LogLevelEnum.DEBUG;\n      case \"2\":\n      case \"INFO\":\n        return LogLevelEnum.INFO;\n      case \"3\":\n      case \"WARN\":\n        return LogLevelEnum.WARN;\n      case \"4\":\n      case \"ERROR\":\n        return LogLevelEnum.ERROR;\n      case \"5\":\n      case \"NONE\":\n        return LogLevelEnum.NONE;\n      default:\n        return LogLevelEnum.ERROR; // Default to ERROR if unknown\n    }\n  }\n}\n\n// Export a function to get the singleton instance\nexport function getLoggingService(): LoggingService {\n  return LoggingService.getInstance();\n}\n","import { ErrorCode } from \"./constants/error_codes\";\nimport { global_constants } from \"./constants/api_constants\";\nimport { formatMessage, StringKeyMap, stringMatches } from \"./utilities\";\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport {\n  CommitObject,\n  LogLevel,\n  ResultObject,\n  Settings,\n} from \"./types/api_types\";\nimport { DefaultSettings } from \"./constants/default_settings\";\nimport { IBaseAPI } from \"./interfaces/IBaseAPI\";\nimport { ScheduledCommit } from \"./helpers/scheduled_commit\";\nimport { LogLevelEnum } from \"./constants/enums\";\nimport { HttpService } from \"./services/HttpService\";\nimport { EventService } from \"./services/EventService\";\nimport { SerializationService } from \"./services/SerializationService\";\nimport { createErrorHandlingService } from \"./services/ErrorHandlingService\";\nimport { getLoggingService } from \"./services/LoggingService\";\nimport {\n  ICMIDataService,\n  IErrorHandlingService,\n  IEventService,\n  IHttpService,\n  ILoggingService,\n  ISerializationService,\n} from \"./interfaces/services\";\nimport { isCMIArray, isError } from \"./utils/type_guards\";\nimport { ValidationError } from \"./exceptions\";\n\n/**\n * Base API class for AICC, SCORM 1.2, and SCORM 2004. Should be considered\n * abstract, and never initialized on its own.\n */\nexport default abstract class BaseAPI implements IBaseAPI {\n  private _timeout?: ScheduledCommit;\n  private readonly _error_codes: ErrorCode;\n  private _settings: Settings = DefaultSettings;\n  private readonly _httpService: IHttpService;\n  private _eventService: IEventService;\n  private _serializationService: ISerializationService;\n  private readonly _errorHandlingService: IErrorHandlingService;\n  private readonly _loggingService: ILoggingService;\n\n  /**\n   * Constructor for Base API class. Sets some shared API fields, as well as\n   * sets up options for the API.\n   * @param {ErrorCode} error_codes - The error codes object\n   * @param {Settings} settings - Optional settings for the API\n   * @param {IHttpService} httpService - Optional HTTP service instance\n   * @param {IEventService} eventService - Optional Event service instance\n   * @param {ISerializationService} serializationService - Optional Serialization service instance\n   * @param {ICMIDataService} cmiDataService - Optional CMI Data service instance\n   * @param {IErrorHandlingService} errorHandlingService - Optional Error Handling service instance\n   * @param {ILoggingService} loggingService - Optional Logging service instance\n   */\n  protected constructor(\n    error_codes: ErrorCode,\n    settings?: Settings,\n    httpService?: IHttpService,\n    eventService?: IEventService,\n    serializationService?: ISerializationService,\n    cmiDataService?: ICMIDataService,\n    errorHandlingService?: IErrorHandlingService,\n    loggingService?: ILoggingService,\n  ) {\n    if (new.target === BaseAPI) {\n      throw new TypeError(\"Cannot construct BaseAPI instances directly\");\n    }\n    this.currentState = global_constants.STATE_NOT_INITIALIZED;\n\n    this._error_codes = error_codes;\n\n    if (settings) {\n      this.settings = settings;\n    }\n    this.apiLogLevel = this.settings.logLevel;\n    this.selfReportSessionTime = this.settings.selfReportSessionTime;\n\n    if (this.apiLogLevel === undefined) {\n      this.apiLogLevel = LogLevelEnum.NONE;\n    }\n\n    // Initialize and configure LoggingService\n    this._loggingService = loggingService || getLoggingService();\n    this._loggingService.setLogLevel(this.apiLogLevel);\n\n    // If settings include a custom onLogMessage function, use it as the log handler\n    if (this.settings.onLogMessage) {\n      this._loggingService.setLogHandler(this.settings.onLogMessage);\n    }\n\n    // Initialize HTTP service\n    this._httpService =\n      httpService || new HttpService(this.settings, this._error_codes);\n\n    // Initialize Event service\n    this._eventService =\n      eventService ||\n      new EventService((functionName, message, level, element) =>\n        this.apiLog(functionName, message, level, element),\n      );\n\n    // Initialize Serialization service\n    this._serializationService =\n      serializationService || new SerializationService();\n\n    // Initialize Error Handling service\n    this._errorHandlingService =\n      errorHandlingService ||\n      createErrorHandlingService(\n        this._error_codes,\n        (functionName, message, level, element) =>\n          this.apiLog(functionName, message, level, element),\n        (errorNumber, detail) =>\n          this.getLmsErrorMessageDetails(errorNumber, detail),\n      );\n  }\n\n  public abstract cmi: BaseCMI;\n  public startingData?: StringKeyMap;\n\n  public currentState: number;\n  public apiLogLevel: LogLevel;\n  public selfReportSessionTime: boolean;\n\n  /**\n   * Get the last error code\n   * @return {string}\n   */\n  get lastErrorCode(): string {\n    return this._errorHandlingService?.lastErrorCode ?? \"0\";\n  }\n\n  /**\n   * Set the last error code\n   * @param {string} errorCode\n   */\n  set lastErrorCode(errorCode: string) {\n    if (this._errorHandlingService) {\n      this._errorHandlingService.lastErrorCode = errorCode;\n    }\n  }\n\n  /**\n   * Reset the API to its initial state.\n   * This method clears all current data and resets the API to an uninitialized state.\n   * It can optionally accept new settings to configure the API after reset.\n   *\n   * @param {Settings} settings - Optional new settings to apply after reset\n   */\n  abstract reset(settings?: Settings): void;\n\n  /**\n   * Common reset method for all APIs. New settings are merged with the existing settings.\n   * @param {Settings} settings\n   * @protected\n   */\n  commonReset(settings?: Settings): void {\n    this.apiLog(\"reset\", \"Called\", LogLevelEnum.INFO);\n\n    this.settings = { ...this.settings, ...settings };\n\n    this.clearScheduledCommit();\n    this.currentState = global_constants.STATE_NOT_INITIALIZED;\n    this.lastErrorCode = \"0\";\n    this._eventService.reset();\n    this.startingData = undefined;\n  }\n\n  /**\n   * Initialize the API\n   * @param {string} callbackName\n   * @param {string} initializeMessage\n   * @param {string} terminationMessage\n   * @return {string}\n   */\n  initialize(\n    callbackName: string,\n    initializeMessage?: string,\n    terminationMessage?: string,\n  ): string {\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (this.isInitialized()) {\n      this.throwSCORMError(\n        \"api\",\n        this._error_codes.INITIALIZED,\n        initializeMessage,\n      );\n    } else if (this.isTerminated()) {\n      this.throwSCORMError(\n        \"api\",\n        this._error_codes.TERMINATED,\n        terminationMessage,\n      );\n    } else {\n      if (this.selfReportSessionTime) {\n        this.cmi.setStartTime();\n      }\n\n      this.currentState = global_constants.STATE_INITIALIZED;\n      this.lastErrorCode = \"0\";\n      returnValue = global_constants.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Initialize the LMS API\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsInitialize(): string;\n\n  /**\n   * Finish the current LMS API session\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsFinish(): string;\n\n  /**\n   * Get the value of a CMI element from the LMS\n   * @param {string} CMIElement - The CMI element to get the value of\n   * @return {string} The value of the CMI element\n   */\n  abstract lmsGetValue(CMIElement: string): string;\n\n  /**\n   * Set the value of a CMI element in the LMS\n   * @param {string} CMIElement - The CMI element to set the value of\n   * @param {any} value - The value to set\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsSetValue(CMIElement: string, value: any): string;\n\n  /**\n   * Commit the current data to the LMS\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsCommit(): string;\n\n  /**\n   * Get the last error code from the LMS\n   * @return {string} The last error code\n   */\n  abstract lmsGetLastError(): string;\n\n  /**\n   * Get the error string for a specific error code\n   * @param {string|number} CMIErrorCode - The error code to get the string for\n   * @return {string} The error string\n   */\n  abstract lmsGetErrorString(CMIErrorCode: string | number): string;\n\n  /**\n   * Get diagnostic information for a specific error code\n   * @param {string|number} CMIErrorCode - The error code to get diagnostic information for\n   * @return {string} The diagnostic information\n   */\n  abstract lmsGetDiagnostic(CMIErrorCode: string | number): string;\n\n  /**\n   * Abstract method for validating that a response is correct.\n   * This method is used to validate the format and content of a response\n   * before it is set in the CMI data model.\n   *\n   * @param {string} _CMIElement - The CMI element path to validate\n   * @param {any} _value - The value to validate\n   * @throws {Error} If the response format is invalid\n   */\n  abstract validateCorrectResponse(_CMIElement: string, _value: any): void;\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   * APIs that inherit BaseAPI should override this method.\n   *\n   * @param {string} _CMIElement - unused\n   * @param {*} _value - unused\n   * @param {boolean} _foundFirstIndex - unused\n   * @return {BaseCMI|null}\n   * @abstract\n   */\n  abstract getChildElement(\n    _CMIElement: string,\n    _value: any,\n    _foundFirstIndex: boolean,\n  ): BaseCMI | null;\n\n  /**\n   * Attempts to store the data to the LMS, logs data if no LMS configured\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _calculateTotalTime\n   * @return {ResultObject}\n   * @abstract\n   */\n  abstract storeData(_calculateTotalTime: boolean): Promise<ResultObject>;\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _terminateCommit\n   * @return {StringKeyMap|Array}\n   * @abstract\n   */\n  abstract renderCommitCMI(\n    _terminateCommit: boolean,\n  ): StringKeyMap | Array<string>;\n\n  /**\n   * Render the commit object to the shortened format for LMS commit.\n   * This method transforms the CMI data into a format suitable for sending to the LMS.\n   * It is called during the commit process to prepare the data for transmission.\n   *\n   * @param {boolean} _terminateCommit - Whether this commit is part of the termination process\n   * @return {CommitObject} A formatted object containing the data to be sent to the LMS\n   * @example\n   * // Example of a commit object structure\n   * {\n   *   method: \"POST\",\n   *   params: {\n   *     cmi: { ... },\n   *     finishState: \"COMPLETED\"\n   *   }\n   * }\n   */\n  abstract renderCommitObject(_terminateCommit: boolean): CommitObject;\n\n  /**\n   * Logging for all SCORM actions\n   *\n   * @param {string} functionName\n   * @param {string} logMessage\n   * @param {number} messageLevel\n   * @param {string} CMIElement\n   */\n  apiLog(\n    functionName: string,\n    logMessage: string,\n    messageLevel: LogLevel,\n    CMIElement?: string,\n  ) {\n    logMessage = formatMessage(functionName, logMessage, CMIElement);\n\n    if (messageLevel >= this.apiLogLevel) {\n      // Use the injected LoggingService\n      this._loggingService.log(messageLevel, logMessage);\n\n      // For backward compatibility, also call the settings.onLogMessage if it exists\n      // and is different from the LoggingService's handler\n      if (\n        this.settings.onLogMessage &&\n        this.settings.onLogMessage !==\n          (this._loggingService as any)[\"_logHandler\"]\n      ) {\n        this.settings.onLogMessage(messageLevel, logMessage);\n      }\n    }\n  }\n\n  /**\n   * Getter for _error_codes\n   * @return {ErrorCode}\n   */\n  get error_codes(): ErrorCode {\n    return this._error_codes;\n  }\n\n  /**\n   * Getter for _settings\n   * @return {Settings}\n   */\n  get settings(): Settings {\n    return this._settings;\n  }\n\n  /**\n   * Setter for _settings\n   * @param {Settings} settings\n   */\n  set settings(settings: Settings) {\n    const previousSettings = this._settings;\n    this._settings = { ...this._settings, ...settings };\n\n    // Update HTTP service settings\n    this._httpService?.updateSettings(this._settings);\n\n    // Update log level if it changed\n    if (\n      settings.logLevel !== undefined &&\n      settings.logLevel !== previousSettings.logLevel\n    ) {\n      this.apiLogLevel = settings.logLevel;\n      this._loggingService?.setLogLevel(settings.logLevel);\n    }\n\n    // Update log handler if onLogMessage changed\n    if (\n      settings.onLogMessage !== undefined &&\n      settings.onLogMessage !== previousSettings.onLogMessage\n    ) {\n      this._loggingService?.setLogHandler(settings.onLogMessage);\n    }\n  }\n\n  /**\n   * Terminates the current run of the API\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async terminate(\n    callbackName: string,\n    checkTerminated: boolean,\n  ): Promise<string> {\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.TERMINATION_BEFORE_INIT,\n        this._error_codes.MULTIPLE_TERMINATION,\n      )\n    ) {\n      this.currentState = global_constants.STATE_TERMINATED;\n\n      const result: ResultObject = await this.storeData(true);\n      if ((result.errorCode ?? 0) > 0) {\n        this.throwSCORMError(\"api\", result.errorCode);\n      }\n      returnValue = result?.result ?? global_constants.SCORM_FALSE;\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      returnValue = global_constants.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Get the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  getValue(\n    callbackName: string,\n    checkTerminated: boolean,\n    CMIElement: string,\n  ): string {\n    let returnValue: string = \"\";\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.RETRIEVE_BEFORE_INIT,\n        this._error_codes.RETRIEVE_AFTER_TERM,\n      )\n    ) {\n      // Only reset the error code if there's no error and checkTerminated is true\n      // This is a no-op if lastErrorCode is already \"0\"\n      try {\n        returnValue = this.getCMIValue(CMIElement);\n      } catch (e) {\n        returnValue = this.handleValueAccessException(\n          CMIElement,\n          e,\n          returnValue,\n        );\n      }\n      this.processListeners(callbackName, CMIElement);\n    }\n\n    this.apiLog(\n      callbackName,\n      \": returned: \" + returnValue,\n      LogLevelEnum.INFO,\n      CMIElement,\n    );\n\n    if (returnValue === undefined) {\n      return \"\";\n    }\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Sets the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {string} commitCallback\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  setValue(\n    callbackName: string,\n    commitCallback: string,\n    checkTerminated: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (value !== undefined) {\n      value = String(value);\n    }\n    let returnValue: string = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.STORE_BEFORE_INIT,\n        this._error_codes.STORE_AFTER_TERM,\n      )\n    ) {\n      // Only reset the error code if there's no error and checkTerminated is true\n      // This is a no-op if lastErrorCode is already \"0\"\n      try {\n        returnValue = this.setCMIValue(CMIElement, value);\n      } catch (e) {\n        returnValue = this.handleValueAccessException(\n          CMIElement,\n          e,\n          returnValue,\n        );\n      }\n      this.processListeners(callbackName, CMIElement, value);\n    }\n\n    if (returnValue === undefined) {\n      returnValue = global_constants.SCORM_FALSE;\n    }\n\n    // If we didn't have any errors while setting the data, go ahead and\n    // schedule a commit, if autocommit is turned on\n    if (String(this.lastErrorCode) === \"0\") {\n      if (this.settings.autocommit) {\n        this.scheduleCommit(\n          this.settings.autocommitSeconds * 1000,\n          commitCallback,\n        );\n      }\n    }\n\n    this.apiLog(\n      callbackName,\n      \": \" + value + \": result: \" + returnValue,\n      LogLevelEnum.INFO,\n      CMIElement,\n    );\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Orders LMS to store all content parameters\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async commit(\n    callbackName: string,\n    checkTerminated: boolean = false,\n  ): Promise<string> {\n    this.clearScheduledCommit();\n\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.COMMIT_BEFORE_INIT,\n        this._error_codes.COMMIT_AFTER_TERM,\n      )\n    ) {\n      const result = await this.storeData(false);\n      if ((result.errorCode ?? 0) > 0) {\n        this.throwSCORMError(\"api\", result.errorCode);\n      }\n      returnValue = result?.result ?? global_constants.SCORM_FALSE;\n\n      this.apiLog(\n        callbackName,\n        \" Result: \" + returnValue,\n        LogLevelEnum.DEBUG,\n        \"HttpRequest\",\n      );\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Returns last error code\n   * @param {string} callbackName\n   * @return {string}\n   */\n  getLastError(callbackName: string): string {\n    const returnValue = String(this.lastErrorCode);\n\n    this.processListeners(callbackName);\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Returns the errorNumber error description\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getErrorString(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Returns a comprehensive description of the errorNumber error.\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getDiagnostic(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode, true);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Checks the LMS state and ensures it has been initialized.\n   *\n   * @param {boolean} checkTerminated\n   * @param {number} beforeInitError\n   * @param {number} afterTermError\n   * @return {boolean}\n   */\n  checkState(\n    checkTerminated: boolean,\n    beforeInitError: number,\n    afterTermError: number,\n  ): boolean {\n    if (this.isNotInitialized()) {\n      this.throwSCORMError(\"api\", beforeInitError);\n      return false;\n    } else if (checkTerminated && this.isTerminated()) {\n      this.throwSCORMError(\"api\", afterTermError);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {(string|number)} _errorNumber\n   * @param {boolean} _detail\n   * @return {string}\n   * @abstract\n   */\n  getLmsErrorMessageDetails(\n    _errorNumber: string | number,\n    _detail: boolean = false,\n  ): string {\n    throw new Error(\n      \"The getLmsErrorMessageDetails method has not been implemented\",\n    );\n  }\n\n  /**\n   * Gets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @return {string}\n   * @abstract\n   */\n  getCMIValue(_CMIElement: string): string {\n    throw new Error(\"The getCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Sets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @param {any} _value\n   * @return {string}\n   * @abstract\n   */\n  setCMIValue(_CMIElement: string, _value: any): string {\n    throw new Error(\"The setCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Shared API method to set a valid for a given element.\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  _commonSetCMIValue(\n    methodName: string,\n    scorm2004: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (!CMIElement || CMIElement === \"\") {\n      return global_constants.SCORM_FALSE;\n    }\n\n    this.lastErrorCode = \"0\";\n\n    const structure = CMIElement.split(\".\");\n    let refObject: StringKeyMap | BaseCMI = this as StringKeyMap;\n    let returnValue = global_constants.SCORM_FALSE;\n    let foundFirstIndex = false;\n\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      const attribute = structure[idx];\n\n      if (idx === structure.length - 1) {\n        if (scorm2004 && attribute.substring(0, 8) === \"{target=\") {\n          if (this.isInitialized()) {\n            this.throwSCORMError(\n              CMIElement,\n              this._error_codes.READ_ONLY_ELEMENT,\n            );\n          } else {\n            refObject = {\n              ...refObject,\n              attribute: value,\n            };\n          }\n        } else if (\n          attribute === \"pattern\" &&\n          CMIElement.includes(\".correct_responses.\") &&\n          this.isInitialized()\n        ) {\n          // For correct_responses.pattern, validate the response first\n          this.validateCorrectResponse(CMIElement, value);\n\n          // If validation passed, set the value\n          if (this._errorHandlingService.lastErrorCode === \"0\") {\n            (refObject as StringKeyMap)[attribute] = value;\n            returnValue = global_constants.SCORM_TRUE;\n          }\n\n          // Skip the rest of the processing for this attribute\n          continue;\n        } else if (\n          !this._checkObjectHasProperty(refObject as StringKeyMap, attribute)\n        ) {\n          this.throwSCORMError(\n            CMIElement,\n            invalidErrorCode,\n            invalidErrorMessage,\n          );\n        } else {\n          if (\n            stringMatches(CMIElement, \"\\\\.correct_responses\\\\.\\\\d+$\") &&\n            this.isInitialized() &&\n            attribute !== \"pattern\"\n          ) {\n            this.validateCorrectResponse(CMIElement, value);\n          }\n\n          if (!scorm2004 || this._errorHandlingService.lastErrorCode === \"0\") {\n            (refObject as StringKeyMap)[attribute] = value;\n            returnValue = global_constants.SCORM_TRUE;\n          }\n        }\n      } else {\n        refObject = (refObject as StringKeyMap)[attribute] as StringKeyMap;\n        if (!refObject) {\n          this.throwSCORMError(\n            CMIElement,\n            invalidErrorCode,\n            invalidErrorMessage,\n          );\n          break;\n        }\n\n        if (isCMIArray(refObject)) {\n          const index = parseInt(structure[idx + 1], 10);\n\n          // SCO is trying to set an item on an array\n          if (!isNaN(index)) {\n            const item = refObject.childArray[index];\n\n            if (item) {\n              refObject = item;\n              foundFirstIndex = true;\n            } else {\n              const newChild = this.getChildElement(\n                CMIElement,\n                value,\n                foundFirstIndex,\n              );\n              foundFirstIndex = true;\n\n              if (!newChild) {\n                this.throwSCORMError(\n                  CMIElement,\n                  invalidErrorCode,\n                  invalidErrorMessage,\n                );\n              } else {\n                if (refObject.initialized) newChild.initialize();\n\n                refObject.childArray.push(newChild);\n                refObject = newChild;\n              }\n            }\n\n            // Have to update idx value to skip the array position\n            idx++;\n          }\n        }\n      }\n    }\n\n    if (returnValue === global_constants.SCORM_FALSE) {\n      this.apiLog(\n        methodName,\n        `There was an error setting the value for: ${CMIElement}, value of: ${value}`,\n        LogLevelEnum.WARN,\n      );\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @return {any}\n   */\n  _commonGetCMIValue(\n    methodName: string,\n    scorm2004: boolean,\n    CMIElement: string,\n  ): any {\n    if (!CMIElement || CMIElement === \"\") {\n      return \"\";\n    }\n\n    const structure = CMIElement.split(\".\");\n    let refObject: StringKeyMap = this as StringKeyMap;\n    let attribute = null;\n\n    const uninitializedErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) has not been initialized.`;\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      attribute = structure[idx];\n\n      if (!scorm2004) {\n        if (idx === structure.length - 1) {\n          if (!this._checkObjectHasProperty(refObject, attribute)) {\n            this.throwSCORMError(\n              CMIElement,\n              invalidErrorCode,\n              invalidErrorMessage,\n            );\n            return;\n          }\n        }\n      } else {\n        if (\n          String(attribute).substring(0, 8) === \"{target=\" &&\n          typeof refObject._isTargetValid == \"function\"\n        ) {\n          const target = String(attribute).substring(\n            8,\n            String(attribute).length - 9,\n          );\n          return refObject._isTargetValid(target);\n        } else if (!this._checkObjectHasProperty(refObject, attribute)) {\n          this.throwSCORMError(\n            CMIElement,\n            invalidErrorCode,\n            invalidErrorMessage,\n          );\n          return;\n        }\n      }\n\n      refObject = refObject[attribute] as StringKeyMap;\n      if (refObject === undefined) {\n        this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n        break;\n      }\n\n      if (isCMIArray(refObject)) {\n        const index = parseInt(structure[idx + 1], 10);\n\n        // SCO is trying to set an item on an array\n        if (!isNaN(index)) {\n          const item = refObject.childArray[index];\n\n          if (item) {\n            refObject = item;\n          } else {\n            this.throwSCORMError(\n              CMIElement,\n              this._error_codes.VALUE_NOT_INITIALIZED,\n              uninitializedErrorMessage,\n            );\n            break;\n          }\n\n          // Have to update idx value to skip the array position\n          idx++;\n        }\n      }\n    }\n\n    if (refObject === null || refObject === undefined) {\n      if (!scorm2004) {\n        if (attribute === \"_children\") {\n          this.throwSCORMError(\n            CMIElement,\n            this._error_codes.CHILDREN_ERROR,\n            undefined,\n          );\n        } else if (attribute === \"_count\") {\n          this.throwSCORMError(\n            CMIElement,\n            this._error_codes.COUNT_ERROR,\n            undefined,\n          );\n        }\n      }\n    } else {\n      return refObject;\n    }\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isInitialized(): boolean {\n    return this.currentState === global_constants.STATE_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_NOT_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isNotInitialized(): boolean {\n    return this.currentState === global_constants.STATE_NOT_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_TERMINATED\n   *\n   * @return {boolean}\n   */\n  isTerminated(): boolean {\n    return this.currentState === global_constants.STATE_TERMINATED;\n  }\n\n  /**\n   * Provides a mechanism for attaching to a specific SCORM event.\n   * This method allows you to register a callback function that will be executed\n   * when the specified event occurs.\n   *\n   * @param {string} listenerName - The name of the event to listen for (e.g., \"Initialize\", \"Terminate\", \"GetValue\", \"SetValue\", \"Commit\")\n   * @param {function} callback - The function to execute when the event occurs. The callback will receive relevant event data.\n   * @example\n   * // Listen for Initialize events\n   * api.on(\"Initialize\", function() {\n   *   console.log(\"API has been initialized\");\n   * });\n   *\n   * // Listen for SetValue events\n   * api.on(\"SetValue\", function(element, value) {\n   *   console.log(\"Setting \" + element + \" to \" + value);\n   * });\n   */\n  on(listenerName: string, callback: Function) {\n    this._eventService.on(listenerName, callback);\n  }\n\n  /**\n   * Provides a mechanism for detaching a specific SCORM event listener.\n   * This method removes a previously registered callback for an event.\n   * Both the event name and the callback reference must match what was used in the 'on' method.\n   *\n   * @param {string} listenerName - The name of the event to stop listening for\n   * @param {function} callback - The callback function to remove\n   * @example\n   * // Remove a specific listener\n   * const myCallback = function() { console.log(\"API initialized\"); };\n   * api.on(\"Initialize\", myCallback);\n   * // Later, when you want to remove it:\n   * api.off(\"Initialize\", myCallback);\n   */\n  off(listenerName: string, callback: Function) {\n    this._eventService.off(listenerName, callback);\n  }\n\n  /**\n   * Provides a mechanism for clearing all listeners from a specific SCORM event.\n   * This method removes all callbacks registered for the specified event.\n   *\n   * @param {string} listenerName - The name of the event to clear all listeners for\n   * @example\n   * // Remove all listeners for the Initialize event\n   * api.clear(\"Initialize\");\n   */\n  clear(listenerName: string) {\n    this._eventService.clear(listenerName);\n  }\n\n  /**\n   * Processes any 'on' listeners that have been created for a specific event.\n   * This method is called internally when SCORM events occur to notify all registered listeners.\n   * It triggers all callback functions registered for the specified event.\n   *\n   * @param {string} functionName - The name of the function/event that occurred\n   * @param {string} CMIElement - Optional CMI element involved in the event\n   * @param {any} value - Optional value associated with the event\n   */\n  processListeners(functionName: string, CMIElement?: string, value?: any) {\n    this._eventService.processListeners(functionName, CMIElement, value);\n  }\n\n  /**\n   * Throws a SCORM error with the specified error number and optional message.\n   * This method sets the last error code and can be used to indicate that an operation failed.\n   * The error number should correspond to one of the standard SCORM error codes.\n   *\n   * @param {string} CMIElement\n   * @param {number} errorNumber - The SCORM error code to set\n   * @param {string} message - Optional custom error message to provide additional context\n   * @example\n   * // Throw a \"not initialized\" error\n   * this.throwSCORMError(301, \"The API must be initialized before calling GetValue\");\n   */\n  throwSCORMError(CMIElement: string, errorNumber: number, message?: string) {\n    this._errorHandlingService.throwSCORMError(\n      CMIElement,\n      errorNumber,\n      message,\n    );\n  }\n\n  /**\n   * Clears the last SCORM error code when an operation succeeds.\n   * This method is typically called after successful API operations to reset the error state.\n   * It only clears the error if the success parameter is \"true\".\n   *\n   * @param {string} success - A string indicating whether the operation succeeded (\"true\" or \"false\")\n   * @example\n   * // Clear error after successful operation\n   * this.clearSCORMError(\"true\");\n   */\n  clearSCORMError(success: string) {\n    this._errorHandlingService.clearSCORMError(success);\n  }\n\n  /**\n   * Load the CMI from a flattened JSON object.\n   * This method populates the CMI data model from a flattened JSON structure\n   * where keys represent CMI element paths (e.g., \"cmi.core.student_id\").\n   *\n   * @param {StringKeyMap} json - The flattened JSON object containing CMI data\n   * @param {string} CMIElement - Optional base CMI element path to prepend to all keys\n   * @example\n   * // Load data from a flattened JSON structure\n   * api.loadFromFlattenedJSON({\n   *   \"cmi.core.student_id\": \"12345\",\n   *   \"cmi.core.student_name\": \"John Doe\",\n   *   \"cmi.core.lesson_status\": \"incomplete\"\n   * });\n   */\n  loadFromFlattenedJSON(json: StringKeyMap, CMIElement?: string) {\n    if (!CMIElement) {\n      // by default, we start from a blank string because we're expecting each element to start with `cmi`\n      CMIElement = \"\";\n    }\n\n    this._serializationService.loadFromFlattenedJSON(\n      json,\n      CMIElement,\n      (CMIElement, value) => this.setCMIValue(CMIElement, value),\n      () => this.isNotInitialized(),\n      (data: StringKeyMap) => {\n        this.startingData = data;\n      },\n    );\n  }\n\n  /**\n   * Loads CMI data from a hierarchical JSON object.\n   * This method populates the CMI data model from a nested JSON structure\n   * that mirrors the CMI object hierarchy.\n   *\n   * @param {StringKeyMap} json - The hierarchical JSON object containing CMI data\n   * @param {string} CMIElement - Optional base CMI element path to prepend to all keys\n   * @example\n   * // Load data from a hierarchical JSON structure\n   * api.loadFromJSON({\n   *   core: {\n   *     student_id: \"12345\",\n   *     student_name: \"John Doe\",\n   *     lesson_status: \"incomplete\"\n   *   },\n   *   objectives: [\n   *     { id: \"obj1\", score: { raw: 85 } }\n   *   ]\n   * });\n   */\n  loadFromJSON(json: StringKeyMap, CMIElement: string = \"\") {\n    this._serializationService.loadFromJSON(\n      json,\n      CMIElement,\n      (CMIElement, value) => this.setCMIValue(CMIElement, value),\n      () => this.isNotInitialized(),\n      (data: StringKeyMap) => {\n        this.startingData = data;\n      },\n    );\n  }\n\n  /**\n   * Render the CMI object to a JSON string for sending to an LMS.\n   * This method serializes the current CMI data model to a JSON string.\n   * The output format is controlled by the sendFullCommit setting.\n   *\n   * @return {string} A JSON string representation of the CMI data\n   * @example\n   * // Get the current CMI data as a JSON string\n   * const jsonString = api.renderCMIToJSONString();\n   * console.log(jsonString); // '{\"core\":{\"student_id\":\"12345\",...}}'\n   */\n  renderCMIToJSONString(): string {\n    return this._serializationService.renderCMIToJSONString(\n      this.cmi,\n      this.settings.sendFullCommit,\n    );\n  }\n\n  /**\n   * Returns a JavaScript object representing the current CMI data.\n   * This method creates a plain JavaScript object that mirrors the\n   * structure of the CMI data model, suitable for further processing.\n   *\n   * @return {StringKeyMap} A JavaScript object representing the CMI data\n   * @example\n   * // Get the current CMI data as a JavaScript object\n   * const cmiObject = api.renderCMIToJSONObject();\n   * console.log(cmiObject.core.student_id); // \"12345\"\n   */\n  renderCMIToJSONObject(): StringKeyMap {\n    return this._serializationService.renderCMIToJSONObject(\n      this.cmi,\n      this.settings.sendFullCommit,\n    );\n  }\n\n  /**\n   * Sends a request to the LMS with the specified parameters.\n   * This method handles communication with the LMS server, including\n   * formatting the request, handling the response, and triggering appropriate events.\n   *\n   * @param {string} url - The URL endpoint to send the request to\n   * @param {CommitObject|StringKeyMap|Array} params - The data to send to the LMS\n   * @param {boolean} immediate - Whether to send the request immediately (true) or queue it (false)\n   * @return {Promise<ResultObject>} A promise that resolves with the result of the request\n   * @example\n   * // Send data to the LMS immediately\n   * const result = await api.processHttpRequest(\n   *   \"https://lms.example.com/scorm/commit\",\n   *   { method: \"POST\", params: { cmi: { core: { lesson_status: \"completed\" } } } },\n   *   true\n   * );\n   * console.log(result.errorCode === 0 ? \"Success\" : \"Failed\");\n   */\n  async processHttpRequest(\n    url: string,\n    params: CommitObject | StringKeyMap | Array<any>,\n    immediate: boolean = false,\n  ): Promise<ResultObject> {\n    return this._httpService.processHttpRequest(\n      url,\n      params,\n      immediate,\n      (functionName, message, level, element) =>\n        this.apiLog(functionName, message, level, element),\n      (functionName, CMIElement, value) =>\n        this.processListeners(functionName, CMIElement, value),\n    );\n  }\n\n  /**\n   * Schedules a commit operation to occur after a specified delay.\n   * This method is used to implement auto-commit functionality, where data\n   * is periodically sent to the LMS without requiring explicit commit calls.\n   *\n   * @param {number} when - The number of milliseconds to wait before committing\n   * @param {string} callback - The name of the commit event callback\n   * @example\n   * // Schedule a commit to happen in 60 seconds\n   * api.scheduleCommit(60000, \"commit\");\n   */\n  scheduleCommit(when: number, callback: string) {\n    if (!this._timeout) {\n      this._timeout = new ScheduledCommit(this, when, callback);\n      this.apiLog(\"scheduleCommit\", \"scheduled\", LogLevelEnum.DEBUG, \"\");\n    }\n  }\n\n  /**\n   * Clears and cancels any currently scheduled commits.\n   * This method is typically called when an explicit commit is performed\n   * or when the API is terminated, to prevent redundant commits.\n   *\n   * @example\n   * // Cancel any pending scheduled commits\n   * api.clearScheduledCommit();\n   */\n  clearScheduledCommit() {\n    if (this._timeout) {\n      this._timeout.cancel();\n      this._timeout = undefined;\n      this.apiLog(\"clearScheduledCommit\", \"cleared\", LogLevelEnum.DEBUG, \"\");\n    }\n  }\n\n  /**\n   * Checks if an object has a specific property, using multiple detection methods.\n   * This method performs a thorough check for property existence by:\n   * 1. Checking if it's an own property using Object.hasOwnProperty\n   * 2. Checking if it's defined in the prototype with a property descriptor\n   * 3. Checking if it's accessible via the 'in' operator (includes inherited properties)\n   *\n   * @param {StringKeyMap} StringKeyMap - The object to check for the property\n   * @param {string} attribute - The property name to look for\n   * @return {boolean} True if the property exists on the object or its prototype chain\n   * @private\n   *\n   * @example\n   * // Check for an own property\n   * const obj = { name: \"John\" };\n   * this._checkObjectHasProperty(obj, \"name\"); // Returns true\n   *\n   * @example\n   * // Check for an inherited property\n   * class Parent { get type() { return \"parent\"; } }\n   * const child = Object.create(new Parent());\n   * this._checkObjectHasProperty(child, \"type\"); // Returns true\n   *\n   * @example\n   * // Check for a non-existent property\n   * const obj = { name: \"John\" };\n   * this._checkObjectHasProperty(obj, \"age\"); // Returns false\n   */\n  private _checkObjectHasProperty(\n    StringKeyMap: StringKeyMap,\n    attribute: string,\n  ): boolean {\n    return (\n      Object.hasOwnProperty.call(StringKeyMap, attribute) ||\n      Object.getOwnPropertyDescriptor(\n        Object.getPrototypeOf(StringKeyMap),\n        attribute,\n      ) != null ||\n      attribute in StringKeyMap\n    );\n  }\n\n  /**\n   * Handles exceptions that occur when accessing CMI values.\n   * This method delegates to the ErrorHandlingService to process exceptions\n   * that occur during CMI data operations, ensuring consistent error handling\n   * throughout the API.\n   *\n   * @param {string} CMIElement\n   * @param {any} e - The exception that was thrown\n   * @param {string} returnValue - The default return value to use if an error occurs\n   * @return {string} Either the original returnValue or SCORM_FALSE if an error occurred\n   * @private\n   *\n   * @example\n   * // Handle a validation error when getting a CMI value\n   * try {\n   *   return this.getCMIValue(\"cmi.core.score.raw\");\n   * } catch (e) {\n   *   return this.handleValueAccessException(e, \"\");\n   * }\n   *\n   * @example\n   * // Handle a general error when setting a CMI value\n   * try {\n   *   this.setCMIValue(\"cmi.core.lesson_status\", \"completed\");\n   *   return \"true\";\n   * } catch (e) {\n   *   return this.handleValueAccessException(e, \"false\");\n   * }\n   */\n  private handleValueAccessException(\n    CMIElement: string,\n    e: any,\n    returnValue: string,\n  ): string {\n    if (e instanceof ValidationError) {\n      this.lastErrorCode = String(e.errorCode);\n      returnValue = global_constants.SCORM_FALSE;\n    } else {\n      if (isError(e) && e.message) {\n        console.error(e.message);\n        this.throwSCORMError(CMIElement, this._error_codes.GENERAL, e.message);\n      } else {\n        console.error(e);\n        this.throwSCORMError(\n          CMIElement,\n          this._error_codes.GENERAL,\n          \"Unknown error\",\n        );\n      }\n    }\n    return returnValue;\n  }\n\n  /**\n   * Builds the commit object to be sent to the LMS.\n   * This method delegates to the SerializationService to create a properly\n   * formatted object containing the CMI data that needs to be sent to the LMS.\n   * The format and content of the commit object depend on whether this is a\n   * regular commit or a termination commit.\n   *\n   * @param {boolean} terminateCommit - Whether this is a termination commit\n   * @return {CommitObject|StringKeyMap|Array} The formatted commit object\n   * @protected\n   *\n   * @example\n   * // Create a regular commit object\n   * const regularCommit = this.getCommitObject(false);\n   * // Result might be: { cmi: { core: { lesson_status: \"incomplete\" } } }\n   *\n   * @example\n   * // Create a termination commit object (includes total_time)\n   * const terminationCommit = this.getCommitObject(true);\n   * // Result might be: { cmi: { core: { lesson_status: \"completed\", total_time: \"PT1H30M\" } } }\n   */\n  protected getCommitObject(\n    terminateCommit: boolean,\n  ): CommitObject | StringKeyMap | Array<any> {\n    return this._serializationService.getCommitObject(\n      terminateCommit,\n      this.settings.alwaysSendTotalTime,\n      this.settings.renderCommonCommitFields,\n      (terminateCommit) => this.renderCommitObject(terminateCommit),\n      (terminateCommit) => this.renderCommitCMI(terminateCommit),\n      this.apiLogLevel,\n    );\n  }\n}\n","export const scorm12_regex = {\n  CMIString256: \"^.{0,255}$\",\n  CMIString4096: \"^.{0,4096}$\",\n  CMITime: \"^(?:[01]\\\\d|2[0123]):(?:[012345]\\\\d):(?:[012345]\\\\d)$\",\n  CMITimespan: \"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$\",\n\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{0,3})(.[0-9]*)?$\",\n\n  CMIIdentifier: \"^[\\\\u0021-\\\\u007E\\\\s]{0,255}$\",\n  CMIFeedback: \"^.{0,255}$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMIStatus: \"^(passed|completed|failed|incomplete|browsed)$\",\n  CMIStatus2: \"^(passed|completed|failed|incomplete|browsed|not attempted)$\",\n  CMIExit: \"^(time-out|suspend|logout|)$\",\n  CMIType:\n    \"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$\",\n  CMIResult:\n    \"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\\\.[0-9]*)?)$\",\n  NAVEvent: \"^(previous|continue)$\",\n  // Data ranges\n  score_range: \"0#100\",\n  audio_range: \"-1#100\",\n  speed_range: \"-100#100\",\n  weighting_range: \"-100#100\",\n  text_range: \"-1#1\",\n};\nexport const aicc_regex = {\n  ...scorm12_regex,\n  ...{\n    CMIIdentifier: \"^\\\\w{1,255}$\",\n  },\n};\nexport const scorm2004_regex = {\n  CMIString200: \"^[\\\\u0000-\\\\uFFFF]{0,200}$\",\n  CMIString250: \"^[\\\\u0000-\\\\uFFFF]{0,250}$\",\n  CMIString1000: \"^[\\\\u0000-\\\\uFFFF]{0,1000}$\",\n  CMIString4000: \"^[\\\\u0000-\\\\uFFFF]{0,4000}$\",\n  CMIString64000: \"^[\\\\u0000-\\\\uFFFF]{0,64000}$\",\n  CMILang: \"^([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?$|^$\",\n\n  CMILangString250:\n    \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,250}$)?$\",\n\n  CMILangcr: \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?}))(.*?)$\",\n\n  CMILangString250cr:\n    \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?})?(.{0,250})?)?$\",\n\n  CMILangString4000:\n    \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,4000}$)?$\",\n\n  CMITime:\n    \"^(19[7-9]{1}[0-9]{1}|20[0-2]{1}[0-9]{1}|203[0-8]{1})((-(0[1-9]{1}|1[0-2]{1}))((-(0[1-9]{1}|[1-2]{1}[0-9]{1}|3[0-1]{1}))(T([0-1]{1}[0-9]{1}|2[0-3]{1})((:[0-5]{1}[0-9]{1})((:[0-5]{1}[0-9]{1})((\\\\.[0-9]{1,6})((Z|([+|-]([0-1]{1}[0-9]{1}|2[0-3]{1})))(:[0-5]{1}[0-9]{1})?)?)?)?)?)?)?)?$\",\n  CMITimespan:\n    \"^P(?:([.,\\\\d]+)Y)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)W)?(?:([.,\\\\d]+)D)?(?:T?(?:([.,\\\\d]+)H)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)S)?)?$\",\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{1,5})(\\\\.[0-9]{1,18})?$\",\n  CMIIdentifier: \"^\\\\S{1,250}[a-zA-Z0-9]$\",\n  CMIShortIdentifier: \"^[\\\\w\\\\.\\\\-\\\\_]{1,250}$\",\n  CMILongIdentifier:\n    \"^(?:(?!urn:)\\\\S{1,4000}|urn:[A-Za-z0-9-]{1,31}:\\\\S{1,4000}|.{1,4000})$\",\n  // need to re-examine this\n  CMIFeedback: \"^.*$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  CMIIndexStore: \".N(\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMICStatus: \"^(completed|incomplete|not attempted|unknown)$\",\n  CMISStatus: \"^(passed|failed|unknown)$\",\n  CMIExit: \"^(time-out|suspend|logout|normal)$\",\n  CMIType:\n    \"^(true-false|choice|fill-in|long-fill-in|matching|performance|sequencing|likert|numeric|other)$\",\n  CMIResult:\n    \"^(correct|incorrect|unanticipated|neutral|-?([0-9]{1,4})(\\\\.[0-9]{1,18})?)$\",\n  NAVEvent:\n    \"^(previous|continue|exit|exitAll|abandon|abandonAll|suspendAll|_none_|(\\\\{target=(?<choice_target>\\\\S{0,}[a-zA-Z0-9-_]+)})?choice|(\\\\{target=(?<jump_target>\\\\S{0,}[a-zA-Z0-9-_]+)})?jump)$\",\n\n  NAVBoolean: \"^(unknown|true|false$)\",\n  NAVTarget: \"^{target=\\\\S{0,}[a-zA-Z0-9-_]+}$\",\n  // Data ranges\n  scaled_range: \"-1#1\",\n  audio_range: \"0#*\",\n  speed_range: \"0#*\",\n  text_range: \"-1#1\",\n  progress_range: \"0#1\",\n};\n","import { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { BaseCMI } from \"./base_cmi\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { BaseScormValidationError } from \"../../exceptions\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Base class for cmi *.score objects\n */\nexport class CMIScore extends BaseCMI {\n  private readonly __children: string;\n  private readonly __score_range: string | false;\n  private readonly __invalid_error_code: number;\n  private readonly __invalid_type_code: number;\n  private readonly __invalid_range_code: number;\n  private readonly __decimal_regex: string;\n  private readonly __error_class: typeof BaseScormValidationError;\n  protected _raw = \"\";\n  protected _min = \"\";\n  protected _max: string;\n\n  /**\n   * Constructor for *.score\n   * @param {\n   *     score_children: string,\n   *     score_range: string,\n   *     max: string,\n   *     invalidErrorCode: number,\n   *     invalidTypeCode: number,\n   *     invalidRangeCode: number,\n   *     decimalRegex: string,\n   *     errorClass: typeof BaseScormValidationError\n   * } params\n   */\n  constructor(params: {\n    CMIElement: string;\n    score_children?: string;\n    score_range?: string;\n    max?: string;\n    invalidErrorCode?: number;\n    invalidTypeCode?: number;\n    invalidRangeCode?: number;\n    decimalRegex?: string;\n    errorClass: typeof BaseScormValidationError;\n  }) {\n    super(params.CMIElement);\n\n    this.__children = params.score_children || scorm12_constants.score_children;\n    this.__score_range = !params.score_range\n      ? false\n      : scorm12_regex.score_range;\n    this._max = params.max || params.max === \"\" ? params.max : \"100\";\n    this.__invalid_error_code =\n      params.invalidErrorCode || scorm12_errors.INVALID_SET_VALUE;\n    this.__invalid_type_code =\n      params.invalidTypeCode || scorm12_errors.TYPE_MISMATCH;\n    this.__invalid_range_code =\n      params.invalidRangeCode || scorm12_errors.VALUE_OUT_OF_RANGE;\n    this.__decimal_regex = params.decimalRegex || scorm12_regex.CMIDecimal;\n    this.__error_class = params.errorClass;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this.__error_class(\n      this._cmi_element + \"._children\",\n      this.__invalid_error_code,\n    );\n  }\n\n  /**\n   * Getter for _raw\n   * @return {string}\n   */\n  get raw(): string {\n    return this._raw;\n  }\n\n  /**\n   * Setter for _raw\n   * @param {string} raw\n   */\n  set raw(raw: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".raw\",\n        raw,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._raw = raw;\n    }\n  }\n\n  /**\n   * Getter for _min\n   * @return {string}\n   */\n  get min(): string {\n    return this._min;\n  }\n\n  /**\n   * Setter for _min\n   * @param {string} min\n   */\n  set min(min: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".min\",\n        min,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._min = min;\n    }\n  }\n\n  /**\n   * Getter for _max\n   * @return {string}\n   */\n  get max(): string {\n    return this._max;\n  }\n\n  /**\n   * Setter for _max\n   * @param {string} max\n   */\n  set max(max: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".max\",\n        max,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._max = max;\n    }\n  }\n\n  /**\n   * toJSON for *.score\n   * @return {\n   *    {\n   *      min: string,\n   *      max: string,\n   *      raw: string\n   *    }\n   *    }\n   */\n  toJSON(): {\n    min: string;\n    max: string;\n    raw: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      raw: this.raw,\n      min: this.min,\n      max: this.max,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseScormValidationError } from \"../../exceptions\";\nimport { memoize } from \"../../utilities\";\n\n/**\n * Check if the value matches the proper format. If not, throw proper error code.\n *\n * @param {string} value\n * @param {string} regexPattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @param {boolean} [allowEmptyString]\n * @return {boolean}\n */\nexport const checkValidFormat = memoize(\n  (\n    CMIElement: string,\n    value: string,\n    regexPattern: string,\n    errorCode: number,\n    errorClass: typeof BaseScormValidationError,\n    allowEmptyString?: boolean,\n  ): boolean => {\n    if (typeof value !== \"string\") {\n      return false;\n    }\n    const formatRegex = new RegExp(regexPattern);\n    const matches = value.match(formatRegex);\n    if (allowEmptyString && value === \"\") {\n      return true;\n    }\n    if (value === undefined || !matches || matches[0] === \"\") {\n      throw new errorClass(CMIElement, errorCode);\n    }\n    return true;\n  },\n  // Custom key function that excludes the error class from the cache key\n  // since it can't be stringified and doesn't affect the validation result\n  (value, regexPattern, errorCode, _errorClass, allowEmptyString) =>\n    `${value}:${regexPattern}:${errorCode}:${allowEmptyString || false}`,\n);\n\n/**\n * Check if the value matches the proper range. If not, throw proper error code.\n *\n * @param {any} value\n * @param {string} rangePattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @return {boolean}\n */\nexport const checkValidRange = memoize(\n  (\n    CMIElement: string,\n    value: any,\n    rangePattern: string,\n    errorCode: number,\n    errorClass: typeof BaseScormValidationError,\n  ): boolean => {\n    const ranges = rangePattern.split(\"#\");\n    value = value * 1.0;\n    if (value >= ranges[0]) {\n      if (ranges[1] === \"*\" || value <= ranges[1]) {\n        return true;\n      } else {\n        throw new errorClass(CMIElement, errorCode);\n      }\n    } else {\n      throw new errorClass(CMIElement, errorCode);\n    }\n  },\n  // Custom key function that excludes the error class from the cache key\n  // since it can't be stringified and doesn't affect the validation result\n  (value, rangePattern, errorCode, _errorClass) =>\n    `${value}:${rangePattern}:${errorCode}`,\n);\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Class representing the SCORM 1.2 cmi.student_data object\n * @extends BaseCMI\n */\nexport class CMIStudentData extends BaseCMI {\n  private readonly __children;\n  private _mastery_score = \"\";\n  private _max_time_allowed = \"\";\n  private _time_limit_action = \"\";\n\n  /**\n   * Constructor for cmi.student_data\n   * @param {string} student_data_children\n   */\n  constructor(student_data_children?: string) {\n    super(\"cmi.student_data\");\n    this.__children = student_data_children\n      ? student_data_children\n      : scorm12_constants.student_data_children;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _master_score\n   * @return {string}\n   */\n  get mastery_score(): string {\n    return this._mastery_score;\n  }\n\n  /**\n   * Setter for _master_score. Can only be called before  initialization.\n   * @param {string} mastery_score\n   */\n  set mastery_score(mastery_score: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".mastery_score\",\n      this.initialized,\n    );\n    this._mastery_score = mastery_score;\n  }\n\n  /**\n   * Getter for _max_time_allowed\n   * @return {string}\n   */\n  get max_time_allowed(): string {\n    return this._max_time_allowed;\n  }\n\n  /**\n   * Setter for _max_time_allowed. Can only be called before  initialization.\n   * @param {string} max_time_allowed\n   */\n  set max_time_allowed(max_time_allowed: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".max_time_allowed\",\n      this.initialized,\n    );\n    this._max_time_allowed = max_time_allowed;\n  }\n\n  /**\n   * Getter for _time_limit_action\n   * @return {string}\n   */\n  get time_limit_action(): string {\n    return this._time_limit_action;\n  }\n\n  /**\n   * Setter for _time_limit_action. Can only be called before  initialization.\n   * @param {string} time_limit_action\n   */\n  set time_limit_action(time_limit_action: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".time_limit_action\",\n      this.initialized,\n    );\n    this._time_limit_action = time_limit_action;\n  }\n\n  /**\n   * toJSON for cmi.student_data\n   *\n   * @return {\n   *    {\n   *      max_time_allowed: string,\n   *      time_limit_action: string,\n   *      mastery_score: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    mastery_score: string;\n    max_time_allowed: string;\n    time_limit_action: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      mastery_score: this.mastery_score,\n      max_time_allowed: this.max_time_allowed,\n      time_limit_action: this.time_limit_action,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"./base_cmi\";\nimport { BaseScormValidationError } from \"../../exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\n\n/**\n * Base class for cmi *.n objects\n */\nexport class CMIArray extends BaseCMI {\n  private readonly _errorCode: number;\n  private readonly _errorClass: typeof BaseScormValidationError;\n  private readonly __children: string;\n  public childArray: any[];\n\n  /**\n   * Constructor cmi *.n arrays\n   * @param {object} params\n   */\n  constructor(params: {\n    CMIElement: string;\n    children: string;\n    errorCode?: number;\n    errorClass?: typeof BaseScormValidationError;\n  }) {\n    super(params.CMIElement);\n    this.__children = params.children;\n    this._errorCode = params.errorCode || scorm12_errors.GENERAL;\n    this._errorClass = params.errorClass || BaseScormValidationError;\n    this.childArray = [];\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(wipe: boolean = false): void {\n    this._initialized = false;\n    if (wipe) {\n      this.childArray = [];\n    } else {\n      // Reset all children\n      for (let i = 0; i < this.childArray.length; i++) {\n        this.childArray[i].reset();\n      }\n    }\n  }\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this._errorClass(\n      this._cmi_element + \"._children\",\n      this._errorCode,\n    );\n  }\n\n  /**\n   * Getter for _count\n   * @return {number}\n   */\n  get _count(): number {\n    return this.childArray.length;\n  }\n\n  /**\n   * Setter for _count. Just throws an error.\n   * @param {number} _count\n   */\n  set _count(_count: number) {\n    throw new this._errorClass(this._cmi_element + \"._count\", this._errorCode);\n  }\n\n  /**\n   * toJSON for *.n arrays\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result: { [key: string]: any } = {};\n    for (let i = 0; i < this.childArray.length; i++) {\n      result[i + \"\"] = this.childArray[i];\n    }\n    delete this.jsonString;\n    return result;\n  }\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","type APIError = {\n  errorCode: number;\n  errorMessage: string;\n  detailedMessage: string;\n};\n\nexport class BaseScormValidationError extends Error {\n  constructor(CMIElement: string, errorCode: number) {\n    super(`${CMIElement} : ${errorCode.toString()}`);\n    this._errorCode = errorCode;\n    this.name = \"ScormValidationError\";\n  }\n\n  private readonly _errorCode: number;\n\n  /**\n   * Getter for _errorCode\n   * @return {number}\n   */\n  get errorCode(): number {\n    return this._errorCode;\n  }\n}\n\n/**\n * Base Validation Exception\n */\nexport class ValidationError\n  extends BaseScormValidationError\n  implements APIError\n{\n  /**\n   * Constructor to take in an error message and code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   * @param {string} errorMessage\n   * @param {string} detailedMessage\n   */\n  constructor(\n    CMIElement: string,\n    errorCode: number,\n    errorMessage: string,\n    detailedMessage?: string,\n  ) {\n    super(CMIElement, errorCode);\n    this.message = `${CMIElement} : ${errorMessage}`;\n    this._errorMessage = errorMessage;\n    if (detailedMessage) {\n      this._detailedMessage = detailedMessage;\n    }\n  }\n\n  private readonly _errorMessage: string;\n  private readonly _detailedMessage: string = \"\";\n\n  /**\n   * Getter for _errorMessage\n   * @return {string}\n   */\n  get errorMessage(): string {\n    return this._errorMessage;\n  }\n\n  /**\n   * Getter for _detailedMessage\n   * @return {string}\n   */\n  get detailedMessage(): string {\n    return this._detailedMessage;\n  }\n}\n","export type ErrorCode = {\n  [key: string]: number;\n};\n\nexport const global_errors: ErrorCode = {\n  GENERAL: 101,\n  INITIALIZATION_FAILED: 101,\n  INITIALIZED: 101,\n  TERMINATED: 101,\n  TERMINATION_FAILURE: 101,\n  TERMINATION_BEFORE_INIT: 101,\n  MULTIPLE_TERMINATION: 101,\n  RETRIEVE_BEFORE_INIT: 101,\n  RETRIEVE_AFTER_TERM: 101,\n  STORE_BEFORE_INIT: 101,\n  STORE_AFTER_TERM: 101,\n  COMMIT_BEFORE_INIT: 101,\n  COMMIT_AFTER_TERM: 101,\n  ARGUMENT_ERROR: 101,\n  CHILDREN_ERROR: 101,\n  COUNT_ERROR: 101,\n  GENERAL_GET_FAILURE: 101,\n  GENERAL_SET_FAILURE: 101,\n  GENERAL_COMMIT_FAILURE: 101,\n  UNDEFINED_DATA_MODEL: 101,\n  UNIMPLEMENTED_ELEMENT: 101,\n  VALUE_NOT_INITIALIZED: 101,\n  INVALID_SET_VALUE: 101,\n  READ_ONLY_ELEMENT: 101,\n  WRITE_ONLY_ELEMENT: 101,\n  TYPE_MISMATCH: 101,\n  VALUE_OUT_OF_RANGE: 101,\n  DEPENDENCY_NOT_ESTABLISHED: 101,\n};\n\nexport const scorm12_errors: ErrorCode = {\n  ...global_errors,\n  RETRIEVE_BEFORE_INIT: 301,\n  STORE_BEFORE_INIT: 301,\n  COMMIT_BEFORE_INIT: 301,\n  ARGUMENT_ERROR: 201,\n  CHILDREN_ERROR: 202,\n  COUNT_ERROR: 203,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 401,\n  VALUE_NOT_INITIALIZED: 301,\n  INVALID_SET_VALUE: 402,\n  READ_ONLY_ELEMENT: 403,\n  WRITE_ONLY_ELEMENT: 404,\n  TYPE_MISMATCH: 405,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n\nexport const scorm2004_errors: ErrorCode = {\n  ...global_errors,\n  INITIALIZATION_FAILED: 102,\n  INITIALIZED: 103,\n  TERMINATED: 104,\n  TERMINATION_FAILURE: 111,\n  TERMINATION_BEFORE_INIT: 112,\n  MULTIPLE_TERMINATIONS: 113,\n  RETRIEVE_BEFORE_INIT: 122,\n  RETRIEVE_AFTER_TERM: 123,\n  STORE_BEFORE_INIT: 132,\n  STORE_AFTER_TERM: 133,\n  COMMIT_BEFORE_INIT: 142,\n  COMMIT_AFTER_TERM: 143,\n  ARGUMENT_ERROR: 201,\n  GENERAL_GET_FAILURE: 301,\n  GENERAL_SET_FAILURE: 351,\n  GENERAL_COMMIT_FAILURE: 391,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 402,\n  VALUE_NOT_INITIALIZED: 403,\n  READ_ONLY_ELEMENT: 404,\n  WRITE_ONLY_ELEMENT: 405,\n  TYPE_MISMATCH: 406,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n","import { BaseScormValidationError } from \"../exceptions\";\nimport { checkValidFormat, checkValidRange } from \"../cmi/common/validation\";\nimport {\n  check12ValidFormat,\n  check12ValidRange,\n} from \"../cmi/scorm12/validation\";\nimport { scorm12_regex } from \"../constants/regex\";\nimport { scorm12_errors } from \"../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../exceptions/scorm12_exceptions\";\n\n/**\n * Service for validating CMI data model properties\n */\nexport class ValidationService {\n  /**\n   * Validates a score property (raw, min, max)\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @param {string} decimalRegex - The regex pattern for decimal validation\n   * @param {string | false} scoreRange - The range pattern for score validation, or false if no range validation is needed\n   * @param {number} invalidTypeCode - The error code for invalid type\n   * @param {number} invalidRangeCode - The error code for invalid range\n   * @param {typeof BaseScormValidationError} errorClass - The error class to use for validation errors\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScore(\n    CMIElement: string,\n    value: string,\n    decimalRegex: string,\n    scoreRange: string | false,\n    invalidTypeCode: number,\n    invalidRangeCode: number,\n    errorClass: typeof BaseScormValidationError,\n  ): boolean {\n    return (\n      checkValidFormat(\n        CMIElement,\n        value,\n        decimalRegex,\n        invalidTypeCode,\n        errorClass,\n      ) &&\n      (!scoreRange ||\n        checkValidRange(\n          CMIElement,\n          value,\n          scoreRange,\n          invalidRangeCode,\n          errorClass,\n        ))\n    );\n    // This line should never be reached due to exceptions being thrown\n  }\n\n  /**\n   * Validates a SCORM 1.2 audio property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Audio(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.audio_range)\n    );\n  }\n\n  /**\n   * Validates a SCORM 1.2 language property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Language(CMIElement: string, value: string): boolean {\n    return check12ValidFormat(CMIElement, value, scorm12_regex.CMIString256);\n  }\n\n  /**\n   * Validates a SCORM 1.2 speed property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Speed(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.speed_range)\n    );\n  }\n\n  /**\n   * Validates a SCORM 1.2 text property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Text(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.text_range)\n    );\n  }\n\n  /**\n   * Validates if a property is read-only\n   *\n   * @param {string} CMIElement\n   * @param {boolean} initialized - Whether the object is initialized\n   * @throws {BaseScormValidationError} - Throws an error if the object is initialized\n   */\n  validateReadOnly(CMIElement: string, initialized: boolean): void {\n    if (initialized) {\n      throw new Scorm12ValidationError(\n        CMIElement,\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    }\n  }\n}\n\n// Export a singleton instance of the ValidationService\nexport const validationService = new ValidationService();\n","import { CMIArray } from \"../common/array\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat, check12ValidRange } from \"./validation\";\nimport { scorm12_regex } from \"../../constants/regex\";\n\n/**\n * Class representing the SCORM 1.2 `cmi.interactions`\n * @extends CMIArray\n */\nexport class CMIInteractions extends CMIArray {\n  /**\n   * Constructor for `cmi.interactions`\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.interactions\",\n      children: scorm12_constants.interactions_children,\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.n object\n   */\n  constructor() {\n    super(\"cmi.interactions.n\");\n    this.objectives = new CMIArray({\n      CMIElement: \"cmi.interactions.n.objectives\",\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n      children: scorm12_constants.objectives_children,\n    });\n    this.correct_responses = new CMIArray({\n      CMIElement: \"cmi.interactions.correct_responses\",\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n      children: scorm12_constants.correct_responses_children,\n    });\n  }\n\n  public readonly objectives: CMIArray;\n  public readonly correct_responses: CMIArray;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.objectives?.initialize();\n    this.correct_responses?.initialize();\n  }\n\n  private _id = \"\";\n  private _time = \"\";\n  private _type = \"\";\n  private _weighting = \"\";\n  private _student_response = \"\";\n  private _result = \"\";\n  private _latency = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset(): void {\n    this._initialized = false;\n\n    this._id = \"\";\n    this._time = \"\";\n    this._type = \"\";\n    this._weighting = \"\";\n    this._student_response = \"\";\n    this._result = \"\";\n    this._latency = \"\";\n\n    this.objectives?.reset();\n    this.correct_responses?.reset();\n  }\n\n  /**\n   * Getter for _id. Should only be called during JSON export.\n   * @return {string}\n   */\n  get id(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".id\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get time(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".time\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._time;\n  }\n\n  /**\n   * Setter for _time\n   * @param {string} time\n   */\n  set time(time: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".time\",\n        time,\n        scorm12_regex.CMITime,\n      )\n    ) {\n      this._time = time;\n    }\n  }\n\n  /**\n   * Getter for _type. Should only be called during JSON export.\n   * @return {string}\n   */\n  get type(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".type\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._type;\n  }\n\n  /**\n   * Setter for _type\n   * @param {string} type\n   */\n  set type(type: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".type\",\n        type,\n        scorm12_regex.CMIType,\n      )\n    ) {\n      this._type = type;\n    }\n  }\n\n  /**\n   * Getter for _weighting. Should only be called during JSON export.\n   * @return {string}\n   */\n  get weighting(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".weighting\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._weighting;\n  }\n\n  /**\n   * Setter for _weighting\n   * @param {string} weighting\n   */\n  set weighting(weighting: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".weighting\",\n        weighting,\n        scorm12_regex.CMIDecimal,\n      ) &&\n      check12ValidRange(\n        this._cmi_element + \".weighting\",\n        weighting,\n        scorm12_regex.weighting_range,\n      )\n    ) {\n      this._weighting = weighting;\n    }\n  }\n\n  /**\n   * Getter for _student_response. Should only be called during JSON export.\n   * @return {string}\n   */\n  get student_response(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_response\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._student_response;\n  }\n\n  /**\n   * Setter for _student_response\n   * @param {string} student_response\n   */\n  set student_response(student_response: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".student_response\",\n        student_response,\n        scorm12_regex.CMIFeedback,\n        true,\n      )\n    ) {\n      this._student_response = student_response;\n    }\n  }\n\n  /**\n   * Getter for _result. Should only be called during JSON export.\n   * @return {string}\n   */\n  get result(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".result\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._result;\n  }\n\n  /**\n   * Setter for _result\n   * @param {string} result\n   */\n  set result(result: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".result\",\n        result,\n        scorm12_regex.CMIResult,\n      )\n    ) {\n      this._result = result;\n    }\n  }\n\n  /**\n   * Getter for _latency. Should only be called during JSON export.\n   * @return {string}\n   */\n  get latency(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".latency\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._latency;\n  }\n\n  /**\n   * Setter for _latency\n   * @param {string} latency\n   */\n  set latency(latency: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".latency\",\n        latency,\n        scorm12_regex.CMITimespan,\n      )\n    ) {\n      this._latency = latency;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      time: string,\n   *      type: string,\n   *      weighting: string,\n   *      student_response: string,\n   *      result: string,\n   *      latency: string,\n   *      objectives: CMIArray,\n   *      correct_responses: CMIArray\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    time: string;\n    type: string;\n    weighting: string;\n    student_response: string;\n    result: string;\n    latency: string;\n    objectives: CMIArray;\n    correct_responses: CMIArray;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      time: this.time,\n      type: this.type,\n      weighting: this.weighting,\n      student_response: this.student_response,\n      result: this.result,\n      latency: this.latency,\n      objectives: this.objectives,\n      correct_responses: this.correct_responses,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.n.objectives.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsObjectivesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.n.objectives.n\n   */\n  constructor() {\n    super(\"cmi.interactions.n.objectives.n\");\n  }\n\n  private _id = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._id = \"\";\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n.objectives.n\n   * @return {\n   *    {\n   *      id: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.correct_responses.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsCorrectResponsesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.correct_responses.n\n   */\n  constructor() {\n    super(\"cmi.interactions.correct_responses.n\");\n  }\n\n  private _pattern = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._pattern = \"\";\n  }\n\n  /**\n   * Getter for _pattern\n   * @return {string}\n   */\n  get pattern(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".pattern\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._pattern;\n  }\n\n  /**\n   * Setter for _pattern\n   * @param {string} pattern\n   */\n  set pattern(pattern: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".pattern\",\n        pattern,\n        scorm12_regex.CMIFeedback,\n        true,\n      )\n    ) {\n      this._pattern = pattern;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.correct_responses.n\n   * @return {\n   *    {\n   *      pattern: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    pattern: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      pattern: this._pattern,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Constants for time conversion calculations.\n * These are used throughout the codebase for converting between different time formats.\n */\nexport const SECONDS_PER_SECOND = 1.0;\nexport const SECONDS_PER_MINUTE = 60;\nexport const SECONDS_PER_HOUR = 60 * SECONDS_PER_MINUTE;\nexport const SECONDS_PER_DAY = 24 * SECONDS_PER_HOUR;\n\ntype Designation = {\n  [key: string]: number;\n};\n\n/**\n * A record with string keys and unknown values.\n * This is a more type-safe alternative to using `any`.\n */\nexport type StringKeyMap = Record<string, unknown>;\n\nconst designations: Designation = {\n  D: SECONDS_PER_DAY,\n  H: SECONDS_PER_HOUR,\n  M: SECONDS_PER_MINUTE,\n  S: SECONDS_PER_SECOND,\n};\n\n/**\n * Converts a number of seconds to a formatted time string in HH:MM:SS format.\n * This function handles decimal seconds and ensures proper formatting with leading zeros.\n *\n * @param {number|null} totalSeconds - The total number of seconds to convert. If null or negative, returns \"00:00:00\".\n * @return {string} A formatted time string in HH:MM:SS format, with up to 2 decimal places for seconds if applicable.\n *\n * @example\n * // Returns \"01:30:45\"\n * getSecondsAsHHMMSS(5445);\n *\n * @example\n * // Returns \"00:00:30.5\"\n * getSecondsAsHHMMSS(30.5);\n *\n * @example\n * // Returns \"00:00:00\"\n * getSecondsAsHHMMSS(null);\n */\nexport const getSecondsAsHHMMSS = memoize(\n  (totalSeconds: number | null): string => {\n    // SCORM spec does not deal with negative durations, give zero back\n    if (!totalSeconds || totalSeconds <= 0) {\n      return \"00:00:00\";\n    }\n\n    const hours = Math.floor(totalSeconds / SECONDS_PER_HOUR);\n    const dateObj = new Date(totalSeconds * 1000);\n    const minutes = dateObj.getUTCMinutes();\n    // make sure we add any possible decimal value\n    const seconds = dateObj.getSeconds();\n    const ms = totalSeconds % 1.0;\n    let msStr = \"\";\n\n    if (countDecimals(ms) > 0) {\n      if (countDecimals(ms) > 2) {\n        msStr = ms.toFixed(2);\n      } else {\n        msStr = String(ms);\n      }\n\n      msStr = \".\" + msStr.split(\".\")[1];\n    }\n\n    return (\n      (hours + \":\" + minutes + \":\" + seconds).replace(/\\b\\d\\b/g, \"0$&\") + msStr\n    );\n  },\n);\n\n/**\n * Converts a number of seconds to an ISO 8601 duration string (e.g., \"PT1H30M45S\").\n * This function handles the complexity of formatting according to the ISO 8601 standard,\n * including the proper placement of the \"T\" separator for time components.\n *\n * @param {number|null} seconds - The number of seconds to convert. If null or negative, returns \"PT0S\".\n * @return {string} An ISO 8601 formatted duration string.\n *\n * @example\n * // Returns \"PT1H30M45S\" (1 hour, 30 minutes, 45 seconds)\n * getSecondsAsISODuration(5445);\n *\n * @example\n * // Returns \"PT30.5S\" (30.5 seconds)\n * getSecondsAsISODuration(30.5);\n *\n * @example\n * // Returns \"P1DT1H\" (1 day, 1 hour)\n * getSecondsAsISODuration(90000);\n *\n * @example\n * // Returns \"PT0S\" (0 seconds)\n * getSecondsAsISODuration(null);\n */\nexport const getSecondsAsISODuration = memoize(\n  (seconds: number | null): string => {\n    // SCORM spec does not deal with negative durations, give zero back\n    if (!seconds || seconds <= 0) {\n      return \"PT0S\";\n    }\n\n    let duration = \"P\";\n    let remainder = seconds;\n\n    // Convert to array of entries and use functional methods\n    const designationEntries = Object.entries(designations);\n\n    // Process each time designation\n    designationEntries.forEach(([designationsKey, current_seconds]) => {\n      let value = Math.floor(remainder / current_seconds);\n      remainder = remainder % current_seconds;\n\n      // Limit decimal places\n      if (countDecimals(remainder) > 2) {\n        remainder = Number(Number(remainder).toFixed(2));\n      }\n\n      // If we have anything left in the remainder, and we're currently adding\n      // seconds to the duration, go ahead and add the decimal to the seconds\n      if (designationsKey === \"S\" && remainder > 0) {\n        value += remainder;\n      }\n\n      if (value) {\n        // Add the 'T' separator for time components if needed\n        const needsTimeSeparator =\n          (duration.indexOf(\"D\") > 0 ||\n            [\"H\", \"M\", \"S\"].includes(designationsKey)) &&\n          duration.indexOf(\"T\") === -1;\n\n        if (needsTimeSeparator) {\n          duration += \"T\";\n        }\n\n        duration += `${value}${designationsKey}`;\n      }\n    });\n\n    return duration;\n  },\n);\n\n/**\n * Converts a time string in HH:MM:SS format to the equivalent number of seconds.\n * This function is flexible and can handle various input types, converting them to strings as needed.\n *\n * @param {string|number|boolean|null} timeString - The time string to convert, typically in HH:MM:SS format.\n *                                                 If not a string, it will be converted to one.\n *                                                 If null, invalid, or doesn't match the regex, returns 0.\n * @param {RegExp|string} timeRegex - The regular expression used to validate the time string format.\n *                                    If a string is provided, it will be converted to a RegExp.\n * @return {number} The total number of seconds represented by the time string.\n *\n * @example\n * // Returns 5445 (1 hour, 30 minutes, 45 seconds)\n * getTimeAsSeconds(\"01:30:45\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns 0 (invalid format)\n * getTimeAsSeconds(\"invalid\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns 30 (converts number to string \"30\" then parses as 0:0:30)\n * getTimeAsSeconds(30, /^(\\d+):(\\d+):(\\d+)$/);\n */\nexport const getTimeAsSeconds = memoize(\n  (\n    timeString: string | number | boolean | null,\n    timeRegex: RegExp | string,\n  ): number => {\n    if (typeof timeString === \"number\" || typeof timeString === \"boolean\") {\n      timeString = String(timeString);\n    }\n    if (typeof timeRegex === \"string\") {\n      timeRegex = new RegExp(timeRegex);\n    }\n    if (!timeString || !timeString?.match?.(timeRegex)) {\n      return 0;\n    }\n\n    const parts = timeString.split(\":\");\n    const hours = Number(parts[0]);\n    const minutes = Number(parts[1]);\n    const seconds = Number(parts[2]);\n    return hours * 3600 + minutes * 60 + seconds;\n  },\n  // Custom key function to handle RegExp objects which can't be stringified\n  (timeString, timeRegex) => {\n    const timeStr =\n      typeof timeString === \"string\" ? timeString : String(timeString ?? \"\");\n    const regexStr =\n      typeof timeRegex === \"string\" ? timeRegex : (timeRegex?.toString() ?? \"\");\n    return `${timeStr}:${regexStr}`;\n  },\n);\n\n/**\n * Converts an ISO 8601 duration string (e.g., \"PT1H30M45S\") to the equivalent number of seconds.\n * This function parses the duration string using a regular expression to extract years, days,\n * hours, minutes, and seconds components.\n *\n * @param {string|null} duration - The ISO 8601 duration string to convert.\n *                                If null, invalid, or doesn't match the regex, returns 0.\n * @param {RegExp|string} durationRegex - The regular expression used to parse the duration components.\n *                                       If a string is provided, it will be converted to a RegExp.\n *                                       The regex should have capture groups for years, days, hours, minutes, and seconds.\n * @return {number} The total number of seconds represented by the duration string.\n *\n * @example\n * // Returns 5445 (1 hour, 30 minutes, 45 seconds)\n * getDurationAsSeconds(\"PT1H30M45S\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns 90000 (1 day, 1 hour)\n * getDurationAsSeconds(\"P1DT1H\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns 0 (invalid format)\n * getDurationAsSeconds(\"invalid\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n */\nexport const getDurationAsSeconds = memoize(\n  (duration: string | null, durationRegex: RegExp | string): number => {\n    if (typeof durationRegex === \"string\") {\n      durationRegex = new RegExp(durationRegex);\n    }\n\n    if (!duration || !duration?.match?.(durationRegex)) {\n      return 0;\n    }\n\n    const [, years, _, , days, hours, minutes, seconds] =\n      new RegExp(durationRegex).exec?.(duration) ?? [];\n    let result = 0.0;\n    result += Number(seconds) || 0.0;\n    result += Number(minutes) * 60.0 || 0.0;\n    result += Number(hours) * 3600.0 || 0.0;\n    result += Number(days) * (60 * 60 * 24.0) || 0.0;\n    result += Number(years) * (60 * 60 * 24 * 365.0) || 0.0;\n    return result;\n  },\n  // Custom key function to handle RegExp objects which can't be stringified\n  (duration, durationRegex) => {\n    const durationStr = duration ?? \"\";\n    const regexStr =\n      typeof durationRegex === \"string\"\n        ? durationRegex\n        : (durationRegex?.toString() ?? \"\");\n    return `${durationStr}:${regexStr}`;\n  },\n);\n\n/**\n * Adds together two ISO 8601 duration strings and returns the result as a new ISO 8601 duration string.\n * This function works by converting both durations to seconds, adding them together, and then\n * converting the result back to an ISO 8601 duration string.\n *\n * @param {string} first - The first ISO 8601 duration string.\n * @param {string} second - The second ISO 8601 duration string.\n * @param {RegExp|string} durationRegex - The regular expression used to parse the duration components.\n *                                       If a string is provided, it will be converted to a RegExp.\n * @return {string} A new ISO 8601 duration string representing the sum of the two input durations.\n *\n * @example\n * // Returns \"PT2H\" (1 hour + 1 hour = 2 hours)\n * addTwoDurations(\"PT1H\", \"PT1H\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns \"PT1H30M\" (1 hour + 30 minutes = 1 hour and 30 minutes)\n * addTwoDurations(\"PT1H\", \"PT30M\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns \"P1DT1H30M\" (1 day + 1 hour and 30 minutes = 1 day, 1 hour, and 30 minutes)\n * addTwoDurations(\"P1D\", \"PT1H30M\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n */\nexport function addTwoDurations(\n  first: string,\n  second: string,\n  durationRegex: RegExp | string,\n): string {\n  const regex: RegExp =\n    typeof durationRegex === \"string\"\n      ? new RegExp(durationRegex)\n      : durationRegex;\n  return getSecondsAsISODuration(\n    getDurationAsSeconds(first, regex) + getDurationAsSeconds(second, regex),\n  );\n}\n\n/**\n * Adds together two time strings in HH:MM:SS format and returns the result as a new time string.\n * This function works by converting both time strings to seconds, adding them together, and then\n * converting the result back to an HH:MM:SS format.\n *\n * @param {string} first - The first time string in HH:MM:SS format.\n * @param {string} second - The second time string in HH:MM:SS format.\n * @param {RegExp|string} timeRegex - The regular expression used to validate and parse the time strings.\n *                                   If a string is provided, it will be converted to a RegExp.\n * @return {string} A new time string in HH:MM:SS format representing the sum of the two input times.\n *\n * @example\n * // Returns \"02:00:00\" (1 hour + 1 hour = 2 hours)\n * addHHMMSSTimeStrings(\"01:00:00\", \"01:00:00\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns \"01:30:00\" (1 hour + 30 minutes = 1 hour and 30 minutes)\n * addHHMMSSTimeStrings(\"01:00:00\", \"00:30:00\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns \"01:30:45\" (1 hour + 30 minutes and 45 seconds = 1 hour, 30 minutes, and 45 seconds)\n * addHHMMSSTimeStrings(\"01:00:00\", \"00:30:45\", /^(\\d+):(\\d+):(\\d+)$/);\n */\nexport function addHHMMSSTimeStrings(\n  first: string,\n  second: string,\n  timeRegex: RegExp | string,\n): string {\n  if (typeof timeRegex === \"string\") {\n    timeRegex = new RegExp(timeRegex);\n  }\n  return getSecondsAsHHMMSS(\n    getTimeAsSeconds(first, timeRegex) + getTimeAsSeconds(second, timeRegex),\n  );\n}\n\n/**\n * Flattens a nested JSON object into a flat object with dot notation for nested properties.\n * This function recursively traverses the object and creates new keys using dot notation\n * for nested objects and bracket notation for arrays.\n *\n * @param {StringKeyMap} data - The nested object to flatten.\n * @return {StringKeyMap} A flattened object where nested properties are represented with dot notation.\n *\n * @example\n * // Returns { \"a\": 1, \"b.c\": 2, \"b.d\": 3, \"e[0]\": 4, \"e[1]\": 5 }\n * flatten({\n *   a: 1,\n *   b: { c: 2, d: 3 },\n *   e: [4, 5]\n * });\n *\n * @example\n * // Returns { \"\": [] } for an empty array\n * flatten([]);\n *\n * @example\n * // Returns { \"\": {} } for an empty object\n * flatten({});\n */\nexport function flatten(data: StringKeyMap): StringKeyMap {\n  const result: StringKeyMap = {};\n\n  /**\n   * Recurse through the object\n   * @param {*} cur\n   * @param {*} prop\n   */\n  function recurse(cur: any, prop: any) {\n    if (Object(cur) !== cur) {\n      result[prop] = cur;\n    } else if (Array.isArray(cur)) {\n      // Use forEach instead of for loop\n      cur.forEach((item, i) => {\n        recurse(item, `${prop}[${i}]`);\n      });\n\n      if (cur.length === 0) result[prop] = [];\n    } else {\n      const keys = Object.keys(cur).filter((p) =>\n        Object.prototype.hasOwnProperty.call(cur, p),\n      );\n\n      const isEmpty = keys.length === 0;\n\n      // Use forEach instead of for...in loop\n      keys.forEach((p) => {\n        recurse(cur[p], prop ? `${prop}.${p}` : p);\n      });\n\n      if (isEmpty && prop) result[prop] = {};\n    }\n  }\n\n  recurse(data, \"\");\n  return result;\n}\n\n/**\n * Converts a flattened object back into a nested object structure.\n * This function is the inverse of `flatten()`. It parses dot notation and bracket notation\n * in property names to recreate the original nested structure.\n *\n * @param {StringKeyMap} data - The flattened object to unflatten.\n * @return {object} A nested object recreated from the flattened structure.\n *\n * @example\n * // Returns { a: 1, b: { c: 2, d: 3 }, e: [4, 5] }\n * unflatten({\n *   \"a\": 1,\n *   \"b.c\": 2,\n *   \"b.d\": 3,\n *   \"e[0]\": 4,\n *   \"e[1]\": 5\n * });\n *\n * @example\n * // Handles array indices correctly\n * unflatten({\n *   \"users[0].name\": \"John\",\n *   \"users[0].email\": \"john@example.com\",\n *   \"users[1].name\": \"Jane\",\n *   \"users[1].email\": \"jane@example.com\"\n * });\n * // Returns:\n * // {\n * //   users: [\n * //     { name: \"John\", email: \"john@example.com\" },\n * //     { name: \"Jane\", email: \"jane@example.com\" }\n * //   ]\n * // }\n */\nexport function unflatten(data: StringKeyMap): object {\n  \"use strict\";\n\n  if (Object(data) !== data || Array.isArray(data)) return data;\n  const result: StringKeyMap = {};\n\n  // Regex pattern for parsing property paths\n  const pattern = /\\.?([^.[\\]]+)|\\[(\\d+)]/g;\n\n  // Get all own properties and process them\n  Object.keys(data)\n    .filter((p) => Object.prototype.hasOwnProperty.call(data, p))\n    .forEach((p) => {\n      let cur = result;\n      let prop = \"\";\n\n      // Create a new regex instance for each property to reset lastIndex\n      const regex = new RegExp(pattern);\n\n      // Process all matches in the property path\n      Array.from(\n        { length: p.match(new RegExp(pattern, \"g\"))?.length ?? 0 },\n        () => regex.exec(p),\n      ).forEach((m) => {\n        if (m) {\n          // Create array or object as needed\n          cur = (cur[prop] ??\n            (cur[prop] = m[2] ? [] : ({} as StringKeyMap))) as StringKeyMap;\n          prop = m[2] || m[1];\n        }\n      });\n\n      cur[prop] = data[p];\n    });\n\n  return (result[\"\"] ?? result) as object;\n}\n\n/**\n * Counts the number of decimal places in a number.\n * This function handles both integer and floating-point numbers.\n *\n * @param {number} num - The number to analyze.\n * @return {number} The number of decimal places. Returns 0 for integers or if the number doesn't have a decimal point.\n *\n * @example\n * // Returns 0\n * countDecimals(42);\n *\n * @example\n * // Returns 2\n * countDecimals(3.14);\n *\n * @example\n * // Returns 5\n * countDecimals(1.23456);\n */\nexport function countDecimals(num: number): number {\n  if (Math.floor(num) === num || String(num)?.indexOf?.(\".\") < 0) return 0;\n  const parts = num.toString().split(\".\")?.[1];\n  return parts?.length ?? 0;\n}\n\n/**\n * Formats SCORM messages for consistent and readable logging.\n * This function pads the function name and CMI element to create aligned log messages\n * that are easier to read in log files or console output.\n *\n * @param {string} functionName - The name of the function that generated the message.\n * @param {string} message - The message content to be logged.\n * @param {string} [CMIElement] - Optional. The CMI element related to the message.\n * @return {string} A formatted message string with consistent padding.\n *\n * @example\n * // Returns \"initialize          : Successfully initialized\"\n * formatMessage(\"initialize\", \"Successfully initialized\");\n *\n * @example\n * // Returns \"getValue            : cmi.core.student_id                                             : 12345\"\n * formatMessage(\"getValue\", \"12345\", \"cmi.core.student_id\");\n *\n * @example\n * // Returns \"setValue            : cmi.core.lesson_status                                          : completed\"\n * formatMessage(\"setValue\", \"completed\", \"cmi.core.lesson_status\");\n */\nexport function formatMessage(\n  functionName: string,\n  message: string,\n  CMIElement?: string,\n): string {\n  const baseLength = 20;\n\n  // Use string padding instead of loops\n  const paddedFunction = functionName.padEnd(baseLength);\n  let messageString = `${paddedFunction}: `;\n\n  if (CMIElement) {\n    const CMIElementBaseLength = 70;\n    // Add CMIElement and pad to the required length\n    messageString += CMIElement;\n    messageString = messageString.padEnd(CMIElementBaseLength);\n  }\n\n  // Add the message (or empty string if null/undefined)\n  messageString += message ?? \"\";\n\n  return messageString;\n}\n\n/**\n * Checks if a string contains a specific pattern using regular expression matching.\n * This function is a wrapper around JavaScript's String.match() method that handles\n * null/undefined values gracefully.\n *\n * @param {string} str - The string to search within. If null or undefined, returns false.\n * @param {string} tester - The pattern to search for. Can be a regular expression pattern.\n * @return {boolean} True if the pattern is found in the string, false otherwise.\n *\n * @example\n * // Returns true\n * stringMatches(\"Hello, world!\", \"world\");\n *\n * @example\n * // Returns true\n * stringMatches(\"The quick brown fox\", \"\\\\w+\\\\s+\\\\w+\");\n *\n * @example\n * // Returns false\n * stringMatches(\"Hello, world!\", \"universe\");\n *\n * @example\n * // Returns false (handles null gracefully)\n * stringMatches(null, \"test\");\n */\nexport function stringMatches(str: string, tester: string): boolean {\n  return str?.match(tester) !== null;\n}\n\n/**\n * Creates a memoized (cached) version of a function for performance optimization.\n * This function caches the results of previous calls with the same arguments,\n * avoiding redundant calculations for repeated calls with the same input.\n *\n * @template T - The type of the function to memoize\n * @param {T} fn - The function to memoize\n * @param {Function} [keyFn] - Optional function to generate a custom cache key.\n *                           Useful for functions with complex arguments that can't be serialized.\n * @return {T} A memoized version of the input function with the same signature\n *\n * @example\n * // Basic usage with a simple function\n * const memoizedAdd = memoize((a, b) => {\n *   console.log('Calculating...');\n *   return a + b;\n * });\n *\n * memoizedAdd(1, 2); // Logs \"Calculating...\" and returns 3\n * memoizedAdd(1, 2); // Returns 3 without logging (uses cached result)\n *\n * @example\n * // Using a custom key function for objects that can't be serialized\n * const memoizedProcessUser = memoize(\n *   (user) => {\n *     console.log('Processing user...');\n *     return { ...user, processed: true };\n *   },\n *   (user) => user.id // Use user.id as the cache key\n * );\n *\n * memoizedProcessUser({ id: 123, name: 'John' }); // Logs and processes\n * memoizedProcessUser({ id: 123, name: 'John' }); // Uses cached result\n */\nexport function memoize<T extends (...args: any[]) => any>(\n  fn: T,\n  keyFn?: (...args: Parameters<T>) => string,\n): T {\n  const cache = new Map<string, ReturnType<T>>();\n\n  return ((...args: Parameters<T>): ReturnType<T> => {\n    const key = keyFn ? keyFn(...args) : JSON.stringify(args);\n\n    return cache.has(key)\n      ? (cache.get(key) as ReturnType<T>)\n      : (() => {\n          const result = fn(...args);\n          cache.set(key, result);\n          return result;\n        })();\n  }) as T;\n}\n","import { checkValidFormat, checkValidRange } from \"../common/validation\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} regexPattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check12ValidFormat(\n  CMIElement: string,\n  value: string,\n  regexPattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  return checkValidFormat(\n    CMIElement,\n    value,\n    regexPattern,\n    scorm12_errors.TYPE_MISMATCH,\n    Scorm12ValidationError,\n    allowEmptyString,\n  );\n}\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} rangePattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check12ValidRange(\n  CMIElement: string,\n  value: any,\n  rangePattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  if (!allowEmptyString && value === \"\") {\n    throw new Scorm12ValidationError(\n      CMIElement,\n      scorm12_errors.VALUE_OUT_OF_RANGE,\n    );\n  }\n\n  return checkValidRange(\n    CMIElement,\n    value,\n    rangePattern,\n    scorm12_errors.VALUE_OUT_OF_RANGE,\n    Scorm12ValidationError,\n  );\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { check12ValidFormat } from \"../scorm12/validation\";\nimport * as Util from \"../../utilities\";\n\n/**\n * Class representing the `cmi.core` object\n * @extends BaseCMI\n */\nexport class CMICore extends BaseCMI {\n  /**\n   * Constructor for `cmi.core`\n   */\n  constructor() {\n    super(\"cmi.core\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.core.score\",\n      score_children: scorm12_constants.score_children,\n      score_range: scorm12_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n\n  public readonly score: CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.score?.initialize();\n  }\n\n  private __children = scorm12_constants.core_children;\n  private _student_id = \"\";\n  private _student_name = \"\";\n  private _lesson_location = \"\";\n  private _credit = \"\";\n  private _lesson_status = \"not attempted\";\n  private _entry = \"\";\n  private _total_time = \"\";\n  private _lesson_mode = \"normal\";\n  private _exit = \"\";\n  private _session_time = \"00:00:00\";\n  private _suspend_data = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._exit = \"\";\n    this._entry = \"\";\n\n    /**\n     * Resetting ensures we accurately track the time spent on each individual SCO session independently. Each new\n     * session should start from zero, so we can reset cmi.core.session_time at the beginning of each session.\n     */\n    this._session_time = \"00:00:00\";\n\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _student_id\n   * @return {string}\n   */\n  get student_id(): string {\n    return this._student_id;\n  }\n\n  /**\n   * Setter for _student_id. Can only be called before  initialization.\n   * @param {string} student_id\n   */\n  set student_id(student_id: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_id\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._student_id = student_id;\n    }\n  }\n\n  /**\n   * Getter for _student_name\n   * @return {string}\n   */\n  get student_name(): string {\n    return this._student_name;\n  }\n\n  /**\n   * Setter for _student_name. Can only be called before  initialization.\n   * @param {string} student_name\n   */\n  set student_name(student_name: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_name\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._student_name = student_name;\n    }\n  }\n\n  /**\n   * Getter for _lesson_location\n   * @return {string}\n   */\n  get lesson_location(): string {\n    return this._lesson_location;\n  }\n\n  /**\n   * Setter for _lesson_location\n   * @param {string} lesson_location\n   */\n  set lesson_location(lesson_location: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".lesson_location\",\n        lesson_location,\n        scorm12_regex.CMIString256,\n        true,\n      )\n    ) {\n      this._lesson_location = lesson_location;\n    }\n  }\n\n  /**\n   * Getter for _credit\n   * @return {string}\n   */\n  get credit(): string {\n    return this._credit;\n  }\n\n  /**\n   * Setter for _credit. Can only be called before  initialization.\n   * @param {string} credit\n   */\n  set credit(credit: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".credit\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._credit = credit;\n    }\n  }\n\n  /**\n   * Getter for _lesson_status\n   * @return {string}\n   */\n  get lesson_status(): string {\n    return this._lesson_status;\n  }\n\n  /**\n   * Setter for _lesson_status\n   * @param {string} lesson_status\n   */\n  set lesson_status(lesson_status: string) {\n    if (this.initialized) {\n      if (\n        check12ValidFormat(\n          this._cmi_element + \".lesson_status\",\n          lesson_status,\n          scorm12_regex.CMIStatus,\n        )\n      ) {\n        this._lesson_status = lesson_status;\n      }\n    } else {\n      if (\n        check12ValidFormat(\n          this._cmi_element + \".lesson_status\",\n          lesson_status,\n          scorm12_regex.CMIStatus2,\n        )\n      ) {\n        this._lesson_status = lesson_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _entry\n   * @return {string}\n   */\n  get entry(): string {\n    return this._entry;\n  }\n\n  /**\n   * Setter for _entry. Can only be called before  initialization.\n   * @param {string} entry\n   */\n  set entry(entry: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".entry\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._entry = entry;\n    }\n  }\n\n  /**\n   * Getter for _total_time\n   * @return {string}\n   */\n  get total_time(): string {\n    return this._total_time;\n  }\n\n  /**\n   * Setter for _total_time. Can only be called before  initialization.\n   * @param {string} total_time\n   */\n  set total_time(total_time: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".total_time\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._total_time = total_time;\n    }\n  }\n\n  /**\n   * Getter for _lesson_mode\n   * @return {string}\n   */\n  get lesson_mode(): string {\n    return this._lesson_mode;\n  }\n\n  /**\n   * Setter for _lesson_mode. Can only be called before  initialization.\n   * @param {string} lesson_mode\n   */\n  set lesson_mode(lesson_mode: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".lesson_mode\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._lesson_mode = lesson_mode;\n    }\n  }\n\n  /**\n   * Getter for _exit. Should only be called during JSON export.\n   * @return {string}\n   */\n  get exit(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".exit\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._exit;\n  }\n\n  /**\n   * Setter for _exit\n   * @param {string} exit\n   */\n  set exit(exit: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".exit\",\n        exit,\n        scorm12_regex.CMIExit,\n        true,\n      )\n    ) {\n      this._exit = exit;\n    }\n  }\n\n  /**\n   * Getter for _session_time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get session_time(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".session_time\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._session_time;\n  }\n\n  /**\n   * Setter for _session_time\n   * @param {string} session_time\n   */\n  set session_time(session_time: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".session_time\",\n        session_time,\n        scorm12_regex.CMITimespan,\n      )\n    ) {\n      this._session_time = session_time;\n    }\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this._suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".suspend_data\",\n        suspend_data,\n        scorm12_regex.CMIString4096,\n        true,\n      )\n    ) {\n      this._suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   * @param {number} start_time\n   * @return {string}\n   */\n  getCurrentTotalTime(start_time: number | undefined): string {\n    let sessionTime = this._session_time;\n    const startTime = start_time;\n\n    if (typeof startTime !== \"undefined\" && startTime !== null) {\n      const seconds = new Date().getTime() - startTime;\n      sessionTime = Util.getSecondsAsHHMMSS(seconds / 1000);\n    }\n\n    return Util.addHHMMSSTimeStrings(\n      this._total_time,\n      sessionTime,\n      new RegExp(scorm12_regex.CMITimespan),\n    );\n  }\n\n  /**\n   * toJSON for cmi.core\n   *\n   * @return {\n   *    {\n   *      student_name: string,\n   *      entry: string,\n   *      exit: string,\n   *      score: CMIScore,\n   *      student_id: string,\n   *      lesson_mode: string,\n   *      lesson_location: string,\n   *      lesson_status: string,\n   *      credit: string,\n   *      session_time: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    student_name: string;\n    entry: string;\n    exit: string;\n    score: CMIScore;\n    student_id: string;\n    lesson_mode: string;\n    lesson_location: string;\n    lesson_status: string;\n    credit: string;\n    session_time: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      student_id: this.student_id,\n      student_name: this.student_name,\n      lesson_location: this.lesson_location,\n      credit: this.credit,\n      lesson_status: this.lesson_status,\n      entry: this.entry,\n      lesson_mode: this.lesson_mode,\n      exit: this.exit,\n      session_time: this.session_time,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { BaseRootCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat } from \"./validation\";\nimport { CMICore } from \"../aicc/core\";\nimport { CMIObjectives } from \"./objectives\";\nimport { CMIStudentData } from \"./student_data\";\nimport { CMIStudentPreference } from \"./student_preference\";\nimport { CMIInteractions } from \"./interactions\";\n\n/**\n * Class representing the cmi object for SCORM 1.2\n */\nexport class CMI extends BaseRootCMI {\n  private readonly __children: string = \"\";\n  private __version: string = \"3.4\";\n  private _launch_data: string = \"\";\n  private _comments: string = \"\";\n  private _comments_from_lms: string = \"\";\n\n  /**\n   * Constructor for the SCORM 1.2 cmi object\n   * @param {string} cmi_children\n   * @param {(CMIStudentData|AICCCMIStudentData)} student_data\n   * @param {boolean} initialized\n   */\n  constructor(\n    cmi_children?: string,\n    student_data?: CMIStudentData,\n    initialized?: boolean,\n  ) {\n    super(\"cmi\");\n    if (initialized) this.initialize();\n    this.__children = cmi_children\n      ? cmi_children\n      : scorm12_constants.cmi_children;\n    this.core = new CMICore();\n    this.objectives = new CMIObjectives();\n    this.student_data = student_data ? student_data : new CMIStudentData();\n    this.student_preference = new CMIStudentPreference();\n    this.interactions = new CMIInteractions();\n  }\n\n  public core: CMICore;\n  public objectives: CMIObjectives;\n  public student_data: CMIStudentData;\n  public student_preference: CMIStudentPreference;\n  public interactions: CMIInteractions;\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._launch_data = \"\";\n    this._comments = \"\";\n    this.core?.reset();\n    this.objectives = new CMIObjectives();\n    this.interactions = new CMIInteractions();\n    this.student_data?.reset();\n    this.student_preference?.reset();\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.core?.initialize();\n    this.objectives?.initialize();\n    this.student_data?.initialize();\n    this.student_preference?.initialize();\n    this.interactions?.initialize();\n  }\n\n  /**\n   * toJSON for cmi\n   *\n   * @return {\n   *    {\n   *      suspend_data: string,\n   *      launch_data: string,\n   *      comments: string,\n   *      comments_from_lms: string,\n   *      core: CMICore,\n   *      objectives: CMIObjectives,\n   *      student_data: CMIStudentData,\n   *      student_preference: CMIStudentPreference,\n   *      interactions: CMIInteractions\n   *    }\n   *  }\n   */\n  toJSON(): {\n    suspend_data: string;\n    launch_data: string;\n    comments: string;\n    comments_from_lms: string;\n    core: CMICore;\n    objectives: CMIObjectives;\n    student_data: CMIStudentData;\n    student_preference: CMIStudentPreference;\n    interactions: CMIInteractions;\n  } {\n    this.jsonString = true;\n    const result = {\n      suspend_data: this.suspend_data,\n      launch_data: this.launch_data,\n      comments: this.comments,\n      comments_from_lms: this.comments_from_lms,\n      core: this.core,\n      objectives: this.objectives,\n      student_data: this.student_data,\n      student_preference: this.student_preference,\n      interactions: this.interactions,\n    };\n    delete this.jsonString;\n    return result;\n  }\n\n  /**\n   * Getter for __version\n   * @return {string}\n   */\n  get _version(): string {\n    return this.__version;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _version\n   */\n  set _version(_version: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._version\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this.core?.suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (this.core) {\n      this.core.suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Getter for _launch_data\n   * @return {string}\n   */\n  get launch_data(): string {\n    return this._launch_data;\n  }\n\n  /**\n   * Setter for _launch_data. Can only be called before  initialization.\n   * @param {string} launch_data\n   */\n  set launch_data(launch_data: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".launch_data\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._launch_data = launch_data;\n    }\n  }\n\n  /**\n   * Getter for _comments\n   * @return {string}\n   */\n  get comments(): string {\n    return this._comments;\n  }\n\n  /**\n   * Setter for _comments\n   * @param {string} comments\n   */\n  set comments(comments: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".comments\",\n        comments,\n        scorm12_regex.CMIString4096,\n        true,\n      )\n    ) {\n      this._comments = comments;\n    }\n  }\n\n  /**\n   * Getter for _comments_from_lms\n   * @return {string}\n   */\n  get comments_from_lms(): string {\n    return this._comments_from_lms;\n  }\n\n  /**\n   * Setter for _comments_from_lms. Can only be called before  initialization.\n   * @param {string} comments_from_lms\n   */\n  set comments_from_lms(comments_from_lms: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".comments_from_lms\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._comments_from_lms = comments_from_lms;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   *\n   * @return {string}\n   */\n  getCurrentTotalTime(): string {\n    return this.core.getCurrentTotalTime(this.start_time);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","import { CMI } from \"./cmi/scorm12/cmi\";\nimport * as Utilities from \"./utilities\";\nimport { StringKeyMap, stringMatches } from \"./utilities\";\nimport { global_constants, scorm12_constants } from \"./constants/api_constants\";\nimport { scorm12_errors } from \"./constants/error_codes\";\n\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport { CMIObjectivesObject } from \"./cmi/scorm12/objectives\";\nimport {\n  CMIInteractionsCorrectResponsesObject,\n  CMIInteractionsObject,\n  CMIInteractionsObjectivesObject,\n} from \"./cmi/scorm12/interactions\";\nimport { NAV } from \"./cmi/scorm12/nav\";\nimport {\n  CommitObject,\n  ResultObject,\n  ScoreObject,\n  Settings,\n} from \"./types/api_types\";\nimport { CompletionStatus, SuccessStatus } from \"./constants/enums\";\nimport BaseAPI from \"./BaseAPI\";\nimport { scorm12_regex } from \"./constants/regex\";\n\n/**\n * API class for SCORM 1.2\n */\nclass Scorm12Impl extends BaseAPI {\n  /**\n   * Constructor for SCORM 1.2 API\n   * @param {object} settings\n   */\n  constructor(settings?: Settings) {\n    if (settings) {\n      if (settings.mastery_override === undefined) {\n        settings.mastery_override = false;\n      }\n    }\n\n    super(scorm12_errors, settings);\n\n    this.cmi = new CMI();\n    this.nav = new NAV();\n\n    // Rename functions to match 1.2 Spec and expose to modules\n    this.LMSInitialize = this.lmsInitialize;\n    this.LMSFinish = this.lmsFinish;\n    this.LMSGetValue = this.lmsGetValue;\n    this.LMSSetValue = this.lmsSetValue;\n    this.LMSCommit = this.lmsCommit;\n    this.LMSGetLastError = this.lmsGetLastError;\n    this.LMSGetErrorString = this.lmsGetErrorString;\n    this.LMSGetDiagnostic = this.lmsGetDiagnostic;\n  }\n\n  public statusSetByModule = false;\n\n  cmi: CMI;\n  nav: NAV;\n\n  LMSInitialize: () => string;\n  LMSFinish: () => string;\n  LMSGetValue: (CMIElement: string) => string;\n  LMSSetValue: (CMIElement: string, value: any) => string;\n  LMSCommit: () => string;\n  LMSGetLastError: () => string;\n  LMSGetErrorString: (CMIErrorCode: string) => string;\n  LMSGetDiagnostic: (CMIErrorCode: string) => string;\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset(settings?: Settings) {\n    this.commonReset(settings);\n\n    this.cmi?.reset();\n    this.nav?.reset();\n  }\n\n  /**\n   * lmsInitialize function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsInitialize(): string {\n    this.cmi.initialize();\n    if (this.cmi.core.lesson_status) {\n      this.statusSetByModule = true;\n    } else {\n      this.cmi.core.lesson_status = \"not attempted\";\n    }\n    return this.initialize(\n      \"LMSInitialize\",\n      \"LMS was already initialized!\",\n      \"LMS is already finished!\",\n    );\n  }\n\n  /**\n   * LMSFinish function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsFinish(): string {\n    (async () => {\n      await this.internalFinish();\n    })();\n    return global_constants.SCORM_TRUE;\n  }\n\n  async internalFinish(): Promise<string> {\n    const result = await this.terminate(\"LMSFinish\", true);\n\n    if (result === global_constants.SCORM_TRUE) {\n      if (this.nav.event !== \"\") {\n        if (this.nav.event === \"continue\") {\n          this.processListeners(\"SequenceNext\");\n        } else {\n          this.processListeners(\"SequencePrevious\");\n        }\n      } else if (this.settings.autoProgress) {\n        this.processListeners(\"SequenceNext\");\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * LMSGetValue function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  lmsGetValue(CMIElement: string): string {\n    return this.getValue(\"LMSGetValue\", false, CMIElement);\n  }\n\n  /**\n   * LMSSetValue function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  lmsSetValue(CMIElement: string, value: any): string {\n    if (CMIElement === \"cmi.core.lesson_status\") {\n      this.statusSetByModule = true;\n    }\n    return this.setValue(\"LMSSetValue\", \"LMSCommit\", false, CMIElement, value);\n  }\n\n  /**\n   * LMSCommit function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsCommit(): string {\n    if (this.settings.asyncCommit) {\n      this.scheduleCommit(500, \"LMSCommit\");\n    } else {\n      (async () => {\n        await this.commit(\"LMSCommit\", false);\n      })();\n    }\n    return global_constants.SCORM_TRUE;\n  }\n\n  /**\n   * LMSGetLastError function from SCORM 1.2 Spec\n   *\n   * @return {string}\n   */\n  lmsGetLastError(): string {\n    return this.getLastError(\"LMSGetLastError\");\n  }\n\n  /**\n   * LMSGetErrorString function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetErrorString(CMIErrorCode: string): string {\n    return this.getErrorString(\"LMSGetErrorString\", CMIErrorCode);\n  }\n\n  /**\n   * LMSGetDiagnostic function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetDiagnostic(CMIErrorCode: string): string {\n    return this.getDiagnostic(\"LMSGetDiagnostic\", CMIErrorCode);\n  }\n\n  /**\n   * Sets a value on the CMI Object\n   *\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  override setCMIValue(CMIElement: string, value: any): string {\n    return this._commonSetCMIValue(\"LMSSetValue\", false, CMIElement, value);\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} CMIElement\n   * @return {*}\n   */\n  override getCMIValue(CMIElement: string): any {\n    return this._commonGetCMIValue(\"getCMIValue\", false, CMIElement);\n  }\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   *\n   * @param {string} CMIElement\n   * @param {*} _value\n   * @param {boolean} foundFirstIndex\n   * @return {BaseCMI|null}\n   */\n  getChildElement(\n    CMIElement: string,\n    _value: any,\n    foundFirstIndex: boolean,\n  ): BaseCMI | null {\n    if (stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\")) {\n      return new CMIObjectivesObject();\n    } else if (\n      foundFirstIndex &&\n      stringMatches(\n        CMIElement,\n        \"cmi\\\\.interactions\\\\.\\\\d+\\\\.correct_responses\\\\.\\\\d+\",\n      )\n    ) {\n      return new CMIInteractionsCorrectResponsesObject();\n    } else if (\n      foundFirstIndex &&\n      stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\\\\.objectives\\\\.\\\\d+\")\n    ) {\n      return new CMIInteractionsObjectivesObject();\n    } else if (\n      !foundFirstIndex &&\n      stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\")\n    ) {\n      return new CMIInteractionsObject();\n    }\n\n    return null;\n  }\n\n  /**\n   * Validates Correct Response values\n   *\n   * @param {string} _CMIElement\n   * @param {*} _value\n   */\n  validateCorrectResponse(_CMIElement: string, _value: any) {\n    // do nothing\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber.\n   *\n   * @param {number|string} errorNumber\n   * @param {boolean} detail\n   * @return {string}\n   */\n  override getLmsErrorMessageDetails(\n    errorNumber: number | string,\n    detail: boolean,\n  ): string {\n    let basicMessage = \"No Error\";\n    let detailMessage = \"No Error\";\n\n    // Set error number to string since inconsistent from modules if string or number\n    errorNumber = String(errorNumber);\n    if (scorm12_constants.error_descriptions[errorNumber]) {\n      basicMessage =\n        scorm12_constants.error_descriptions[errorNumber].basicMessage;\n      detailMessage =\n        scorm12_constants.error_descriptions[errorNumber].detailMessage;\n    }\n\n    return detail ? detailMessage : basicMessage;\n  }\n\n  /**\n   * Replace the whole API with another\n   *\n   * @param {Scorm12Impl} newAPI\n   */\n  replaceWithAnotherScormAPI(newAPI: Scorm12Impl) {\n    // Data Model\n    this.cmi = newAPI.cmi;\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   *\n   * @param {boolean} terminateCommit\n   * @return {object|Array}\n   */\n  renderCommitCMI(terminateCommit: boolean): StringKeyMap | Array<string> {\n    const cmiExport: StringKeyMap = this.renderCMIToJSONObject();\n\n    if (terminateCommit) {\n      (cmiExport.cmi as any).core.total_time = this.cmi.getCurrentTotalTime();\n    }\n\n    const result = [];\n    const flattened: StringKeyMap = Utilities.flatten(cmiExport);\n    switch (this.settings.dataCommitFormat) {\n      case \"flattened\":\n        return Utilities.flatten(cmiExport);\n      case \"params\":\n        for (const item in flattened) {\n          if ({}.hasOwnProperty.call(flattened, item)) {\n            result.push(`${item}=${flattened[item]}`);\n          }\n        }\n        return result;\n      case \"json\":\n      default:\n        return cmiExport;\n    }\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * @param {boolean} terminateCommit\n   * @return {CommitObject}\n   */\n  renderCommitObject(terminateCommit: boolean): CommitObject {\n    const cmiExport = this.renderCommitCMI(terminateCommit);\n    const totalTimeHHMMSS = this.cmi.getCurrentTotalTime();\n    const totalTimeSeconds = Utilities.getTimeAsSeconds(\n      totalTimeHHMMSS,\n      scorm12_regex.CMITimespan,\n    );\n    const lessonStatus = this.cmi.core.lesson_status;\n    let completionStatus = CompletionStatus.UNKNOWN;\n    let successStatus = SuccessStatus.UNKNOWN;\n    if (lessonStatus) {\n      completionStatus =\n        lessonStatus === \"completed\" || lessonStatus === \"passed\"\n          ? CompletionStatus.COMPLETED\n          : CompletionStatus.INCOMPLETE;\n      if (lessonStatus === \"passed\") {\n        successStatus = SuccessStatus.PASSED;\n      } else if (lessonStatus === \"failed\") {\n        successStatus = SuccessStatus.FAILED;\n      }\n    }\n\n    const score = this.cmi.core.score;\n    let scoreObject: ScoreObject = null;\n    if (score) {\n      scoreObject = {};\n\n      if (!Number.isNaN(Number.parseFloat(score.raw))) {\n        scoreObject.raw = Number.parseFloat(score.raw);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.min))) {\n        scoreObject.min = Number.parseFloat(score.min);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.max))) {\n        scoreObject.max = Number.parseFloat(score.max);\n      }\n    }\n\n    const commitObject: CommitObject = {\n      successStatus: successStatus,\n      completionStatus: completionStatus,\n      runtimeData: cmiExport as StringKeyMap,\n      totalTimeSeconds: totalTimeSeconds,\n    };\n    if (scoreObject) {\n      commitObject.score = scoreObject;\n    }\n    return commitObject;\n  }\n\n  /**\n   * Attempts to store the data to the LMS\n   *\n   * @param {boolean} terminateCommit\n   * @return {ResultObject}\n   */\n  async storeData(terminateCommit: boolean): Promise<ResultObject> {\n    if (terminateCommit) {\n      const originalStatus = this.cmi.core.lesson_status;\n      if (\n        !this.cmi.core.lesson_status ||\n        (!this.statusSetByModule &&\n          this.cmi.core.lesson_status === \"not attempted\")\n      ) {\n        this.cmi.core.lesson_status = \"completed\";\n      }\n\n      if (this.cmi.core.lesson_mode === \"normal\") {\n        if (this.cmi.core.credit === \"credit\") {\n          if (\n            this.settings.mastery_override &&\n            this.cmi.student_data.mastery_score !== \"\" &&\n            this.cmi.core.score.raw !== \"\"\n          ) {\n            this.cmi.core.lesson_status =\n              parseFloat(this.cmi.core.score.raw) >=\n              parseFloat(this.cmi.student_data.mastery_score)\n                ? \"passed\"\n                : \"failed\";\n          }\n        }\n      } else if (this.cmi.core.lesson_mode === \"browse\") {\n        if (\n          ((this.startingData?.cmi as any)?.core?.lesson_status || \"\") === \"\" &&\n          originalStatus === \"not attempted\"\n        ) {\n          this.cmi.core.lesson_status = \"browsed\";\n        }\n      }\n    }\n\n    const commitObject = this.getCommitObject(terminateCommit);\n    if (typeof this.settings.lmsCommitUrl === \"string\") {\n      return await this.processHttpRequest(\n        this.settings.lmsCommitUrl,\n        commitObject,\n        terminateCommit,\n      );\n    } else {\n      return {\n        result: global_constants.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n  }\n}\n\nexport { Scorm12Impl as Scorm12API };\n"],"names":["SuccessStatus","PASSED","FAILED","UNKNOWN","CompletionStatus","COMPLETED","INCOMPLETE","LogLevelEnum","_","DEBUG","INFO","WARN","ERROR","NONE","CMIElement","children","objectives_children","errorCode","INVALID_SET_VALUE","errorClass","_id","_status","score","score_children","score_range","invalidErrorCode","invalidTypeCode","TYPE_MISMATCH","invalidRangeCode","VALUE_OUT_OF_RANGE","reset","this","_initialized","id","_cmi_element","CMIIdentifier","status","CMIStatus2","toJSON","jsonString","result","scorm12_errors","error_descriptions","hasOwnProperty","call","String","basicMessage","detailMessage","student_preference_children","_audio","_language","_speed","_text","__children","_children","audio","v","validateScorm12Audio","language","validateScorm12Language","speed","validateScorm12Speed","text","validateScorm12Text","cmi_element","_start_time","initialize","setStartTime","Date","getTime","BaseCMI","_event","event","NAVEvent","global_constants","SCORM_TRUE","SCORM_FALSE","STATE_NOT_INITIALIZED","STATE_INITIALIZED","STATE_TERMINATED","scorm12_constants","cmi_children","core_children","comments_children","correct_responses_children","student_data_children","interactions_children","student_demographics_children","tries_children","attempt_records_children","paths_children","DefaultSettings","autocommit","autocommitSeconds","asyncCommit","sendFullCommit","lmsCommitUrl","dataCommitFormat","commitRequestDataType","autoProgress","logLevel","selfReportSessionTime","alwaysSendTotalTime","renderCommonCommitFields","strict_errors","xhrHeaders","xhrWithCredentials","fetchMode","responseHandler","response","responseText","httpResult","JSON","parse","requestHandler","commitObject","onLogMessage","defaultLogHandler","scoItemIds","scoItemIdValidator","globalObjectiveIds","messageLevel","logMessage","console","error","warn","info","debug","log","API","when","callback","_cancelled","_API","_timeout","setTimeout","wrapper","bind","_callback","cancel","clearTimeout","commit","settings","error_codes","processHttpRequest","url","params","immediate","apiLog","processListeners","genericError","GENERAL","performFetch","then","transformResponse","process","fetch","method","mode","body","Array","join","stringify","headers","credentials","undefined","keepalive","json","Object","updateSettings","listenerMap","Map","listenerCount","parseListenerName","listenerName","listenerSplit","split","length","functionName","replace","on","parsedListener","listeners","get","push","set","off","listenerFunctions","listenerFunction","removeIndex","findIndex","obj","splice","delete","clear","has","newListeners","filter","value","listener","listenerHasCMIElement","CMIElementsMatch","endsWith","prefix","slice","loadFromFlattenedJSON","setCMIValue","isNotInitialized","setStartingData","int_pattern","obj_pattern","interactions","objectives","others","key","prototype","intMatch","match","index","field","objMatch","sort","a","b","localeCompare","processItems","items","forEach","item","loadFromJSON","currentCMIElement","constructor","i","tempCMIElement","renderCMIToJSONString","cmi","k","renderCMIToJSONObject","getCommitObject","terminateCommit","renderCommitObject","renderCommitCMI","apiLogLevel","shouldTerminateCommit","includes","isError","Error","isCMIArray","errorCodes","getLmsErrorMessageDetails","_lastErrorCode","_errorCodes","_apiLog","_getLmsErrorMessageDetails","throwSCORMError","errorNumber","message","clearSCORMError","success","handleValueAccessException","e","returnValue","_logLevel","_logHandler","getInstance","LoggingService","_instance","setLogLevel","level","getLogLevel","setLogHandler","handler","shouldLog","getNumericLevel","httpService","eventService","serializationService","cmiDataService","errorHandlingService","loggingService","_settings","BaseAPI","TypeError","currentState","_error_codes","_loggingService","_httpService","HttpService","_eventService","EventService","element","_serializationService","SerializationService","_errorHandlingService","ErrorHandlingService","detail","lastErrorCode","commonReset","clearScheduledCommit","startingData","callbackName","initializeMessage","terminationMessage","isInitialized","INITIALIZED","isTerminated","TERMINATED","previousSettings","terminate","checkTerminated","checkState","TERMINATION_BEFORE_INIT","MULTIPLE_TERMINATION","storeData","getValue","RETRIEVE_BEFORE_INIT","RETRIEVE_AFTER_TERM","getCMIValue","setValue","commitCallback","STORE_BEFORE_INIT","STORE_AFTER_TERM","scheduleCommit","COMMIT_BEFORE_INIT","COMMIT_AFTER_TERM","getLastError","getErrorString","CMIErrorCode","getDiagnostic","beforeInitError","afterTermError","_errorNumber","_detail","_CMIElement","_value","_commonSetCMIValue","methodName","scorm2004","structure","refObject","foundFirstIndex","invalidErrorMessage","UNDEFINED_DATA_MODEL","idx","attribute","substring","READ_ONLY_ELEMENT","validateCorrectResponse","_checkObjectHasProperty","parseInt","isNaN","childArray","newChild","getChildElement","initialized","_commonGetCMIValue","uninitializedErrorMessage","_isTargetValid","VALUE_NOT_INITIALIZED","CHILDREN_ERROR","COUNT_ERROR","data","ScheduledCommit","StringKeyMap","getOwnPropertyDescriptor","getPrototypeOf","scorm12_regex","CMIString256","CMIString4096","CMITime","CMITimespan","CMIInteger","CMISInteger","CMIDecimal","CMIFeedback","CMIIndex","CMIStatus","CMIExit","CMIType","CMIResult","audio_range","speed_range","weighting_range","text_range","_raw","_min","__score_range","_max","max","__invalid_error_code","__invalid_type_code","__invalid_range_code","__decimal_regex","decimalRegex","__error_class","raw","validateScore","min","checkValidFormat","regexPattern","allowEmptyString","formatRegex","RegExp","matches","_errorClass","checkValidRange","rangePattern","ranges","_mastery_score","_max_time_allowed","_time_limit_action","mastery_score","validateReadOnly","max_time_allowed","time_limit_action","_errorCode","wipe","_count","extendStatics","d","setPrototypeOf","__proto__","p","__extends","__","create","__assign","assign","t","s","n","arguments","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","done","__generator","f","y","label","sent","trys","ops","g","Iterator","verb","Symbol","iterator","op","pop","SuppressedError","name","errorMessage","detailedMessage","_detailedMessage","_errorMessage","BaseScormValidationError","global_errors","INITIALIZATION_FAILED","TERMINATION_FAILURE","ARGUMENT_ERROR","GENERAL_GET_FAILURE","GENERAL_SET_FAILURE","GENERAL_COMMIT_FAILURE","UNIMPLEMENTED_ELEMENT","WRITE_ONLY_ELEMENT","DEPENDENCY_NOT_ESTABLISHED","MULTIPLE_TERMINATIONS","validationService","scoreRange","_time","_type","_weighting","_student_response","_result","_latency","correct_responses","time","type","weighting","student_response","latency","_pattern","pattern","designations","D","H","M","S","getSecondsAsHHMMSS","memoize","totalSeconds","hours","Math","floor","dateObj","minutes","getUTCMinutes","seconds","getSeconds","ms","msStr","countDecimals","toFixed","getTimeAsSeconds","duration","remainder","entries","designationsKey","current_seconds","indexOf","timeString","timeRegex","parts","regexStr","addHHMMSSTimeStrings","first","second","flatten","recurse","cur","prop","isArray","keys","isEmpty","unflatten","regex","from","exec","m","num","formatMessage","paddedFunction","padEnd","messageString","stringMatches","str","tester","fn","keyFn","cache","args","durationRegex","check12ValidFormat","check12ValidRange","_student_id","_student_name","_lesson_location","_credit","_lesson_status","_entry","_total_time","_lesson_mode","_exit","_session_time","_suspend_data","student_id","student_name","lesson_location","credit","lesson_status","entry","total_time","lesson_mode","exit","session_time","suspend_data","getCurrentTotalTime","start_time","sessionTime","startTime","student_data","__version","_launch_data","_comments","_comments_from_lms","core","CMICore","C","student_preference","launch_data","comments","comments_from_lms","_version","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","o","defineProperty","enumerable","mastery_override","statusSetByModule","nav","LMSInitialize","lmsInitialize","LMSFinish","lmsFinish","LMSGetValue","lmsGetValue","LMSSetValue","lmsSetValue","LMSCommit","lmsCommit","LMSGetLastError","lmsGetLastError","LMSGetErrorString","lmsGetErrorString","LMSGetDiagnostic","lmsGetDiagnostic","internalFinish","replaceWithAnotherScormAPI","newAPI","cmiExport","flattened","totalTimeHHMMSS","totalTimeSeconds","lessonStatus","completionStatus","successStatus","scoreObject","Number","parseFloat","runtimeData","originalStatus"],"sourceRoot":""}