{"version":3,"file":"scorm-again.min.js","mappings":"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KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OC7XF,eA0BE,WAAYP,EAAiBqY,QAAjB,IAAArY,IAAAA,EAAA,SAAiB,IAAAqY,IAAAA,EAAA,IAC3B,QAAK,UAAC,aAAW,K,OA1BX,EAAAlZ,IAAc,GACd,EAAAmZ,OAAiB,GACjB,EAAA7W,UAAwB,GACxB,EAAA4K,QAA2B,KAC3B,EAAAkM,YAAsB,EACtB,EAAAC,WAAqB,EACrB,EAAAC,cAAwB,EACxB,EAAAC,cAAwB,EACxB,EAAAC,kBAAsC,KAAiB9a,QACvD,EAAA+a,eAAgC,KAAc/a,QAC9C,EAAAgb,cAAwB,EACxB,EAAAC,yBAAmC,EACnC,EAAAC,yBAAmC,WACnC,EAAAC,4BAAsC,WACtC,EAAAC,0BAAoC,WACpC,EAAAC,6BAAuC,WACvC,EAAAC,2BAAqC,EACrC,EAAAC,yBAAmC,EACnC,EAAAC,4BAAsC,EAS5C,EAAKla,IAAMa,EACX,EAAKsY,OAASD,E,CAChB,CAkTF,OAhV8B,aAmCnB,YAAAhW,WAAT,WACE,YAAMA,WAAU,WAEhB,IAAoB,UAAAvC,KAAK2B,UAAL,eAAJ,KACRY,YAEV,EAKA,YAAAxC,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","sources":["webpack://scorm-again/./src/constants/enums.ts","webpack://scorm-again/./src/cmi/scorm12/objectives.ts","webpack://scorm-again/./src/exceptions/scorm12_exceptions.ts","webpack://scorm-again/./src/cmi/scorm12/student_preference.ts","webpack://scorm-again/./src/cmi/common/base_cmi.ts","webpack://scorm-again/./src/cmi/scorm12/nav.ts","webpack://scorm-again/./src/constants/api_constants.ts","webpack://scorm-again/./src/constants/regex.ts","webpack://scorm-again/./src/cmi/common/score.ts","webpack://scorm-again/./src/cmi/common/validation.ts","webpack://scorm-again/./src/cmi/scorm12/student_data.ts","webpack://scorm-again/./src/exceptions/scorm2004_exceptions.ts","webpack://scorm-again/./src/cmi/scorm2004/validation.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/sequencing_rules.ts","webpack://scorm-again/./src/cmi/scorm2004/learner_preference.ts","webpack://scorm-again/./src/constants/response_constants.ts","webpack://scorm-again/./src/cmi/scorm2004/interactions.ts","webpack://scorm-again/./src/cmi/scorm2004/score.ts","webpack://scorm-again/./src/cmi/scorm2004/comments.ts","webpack://scorm-again/./src/cmi/scorm2004/objectives.ts","webpack://scorm-again/./src/cmi/scorm2004/metadata.ts","webpack://scorm-again/./src/cmi/scorm2004/learner.ts","webpack://scorm-again/./src/cmi/scorm2004/status.ts","webpack://scorm-again/./src/cmi/scorm2004/session.ts","webpack://scorm-again/./src/cmi/scorm2004/content.ts","webpack://scorm-again/./src/cmi/scorm2004/settings.ts","webpack://scorm-again/./src/cmi/scorm2004/thresholds.ts","webpack://scorm-again/./src/cmi/scorm2004/cmi.ts","webpack://scorm-again/./src/cmi/scorm2004/adl.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/rollup_rules.ts","webpack://scorm-again/./src/constants/language_constants.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/activity.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/activity_tree.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/sequencing_controls.ts","webpack://scorm-again/./src/cmi/scorm2004/sequencing/sequencing.ts","webpack://scorm-again/./src/Scorm2004API.ts","webpack://scorm-again/./src/cmi/common/array.ts","webpack://scorm-again/./node_modules/tslib/tslib.es6.mjs","webpack://scorm-again/./src/constants/default_settings.ts","webpack://scorm-again/./src/helpers/scheduled_commit.ts","webpack://scorm-again/./src/services/HttpService.ts","webpack://scorm-again/./src/services/EventService.ts","webpack://scorm-again/./src/services/SerializationService.ts","webpack://scorm-again/./src/services/ErrorHandlingService.ts","webpack://scorm-again/./src/services/LoggingService.ts","webpack://scorm-again/./src/BaseAPI.ts","webpack://scorm-again/./src/exceptions.ts","webpack://scorm-again/./src/constants/error_codes.ts","webpack://scorm-again/./src/services/ValidationService.ts","webpack://scorm-again/./src/cmi/scorm12/interactions.ts","webpack://scorm-again/./src/utilities.ts","webpack://scorm-again/./src/cmi/scorm12/validation.ts","webpack://scorm-again/./src/exceptions/aicc_exceptions.ts","webpack://scorm-again/./src/cmi/aicc/validation.ts","webpack://scorm-again/./src/cmi/aicc/evaluation.ts","webpack://scorm-again/./src/cmi/aicc/student_preferences.ts","webpack://scorm-again/./src/cmi/aicc/student_demographics.ts","webpack://scorm-again/./src/cmi/aicc/tries.ts","webpack://scorm-again/./src/cmi/aicc/attempts.ts","webpack://scorm-again/./src/cmi/aicc/student_data.ts","webpack://scorm-again/./src/cmi/aicc/paths.ts","webpack://scorm-again/./src/cmi/aicc/cmi.ts","webpack://scorm-again/./src/AICC.ts","webpack://scorm-again/./src/Scorm12API.ts","webpack://scorm-again/./src/cmi/aicc/core.ts","webpack://scorm-again/./src/cmi/scorm12/cmi.ts","webpack://scorm-again/webpack/bootstrap","webpack://scorm-again/webpack/runtime/define property getters","webpack://scorm-again/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["// Using plain objects instead of enums for better compatibility with strip-only mode\n// This approach avoids TypeScript enum runtime code while maintaining the same API\n\n// NAVBoolean values\nexport const NAVBoolean = {\n  UNKNOWN: \"unknown\",\n  TRUE: \"true\",\n  FALSE: \"false\",\n};\n\n// Type for NAVBoolean values\nexport type NAVBoolean = (typeof NAVBoolean)[keyof typeof NAVBoolean];\n\n// SuccessStatus values\nexport const SuccessStatus = {\n  PASSED: \"passed\",\n  FAILED: \"failed\",\n  UNKNOWN: \"unknown\",\n};\n\n// Type for SuccessStatus values\nexport type SuccessStatus = (typeof SuccessStatus)[keyof typeof SuccessStatus];\n\n// CompletionStatus values\nexport const CompletionStatus = {\n  COMPLETED: \"completed\",\n  INCOMPLETE: \"incomplete\",\n  UNKNOWN: \"unknown\",\n};\n\n// Type for CompletionStatus values\nexport type CompletionStatus = (typeof CompletionStatus)[keyof typeof CompletionStatus];\n\n// LogLevelEnum values\nexport const LogLevelEnum = {\n  _: 0,\n  DEBUG: 1,\n  INFO: 2,\n  WARN: 3,\n  ERROR: 4,\n  NONE: 5,\n};\n\n// Type for LogLevelEnum values\nexport type LogLevelEnum = (typeof LogLevelEnum)[keyof typeof LogLevelEnum];\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { check12ValidFormat } from \"./validation\";\nimport { CMIArray } from \"../common/array\";\n\n/**\n * Class representing SCORM 1.2's `cmi.objectives` object\n * @extends CMIArray\n */\nexport class CMIObjectives extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives`\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.objectives\",\n      children: scorm12_constants.objectives_children,\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.objectives.n object\n * @extends BaseCMI\n */\nexport class CMIObjectivesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.objectives.n\n   */\n  constructor() {\n    super(\"cmi.objectives.n\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.objectives.n.score\",\n      score_children: scorm12_constants.score_children,\n      score_range: scorm12_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n\n  public readonly score: CMIScore;\n\n  private _id = \"\";\n  private _status = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._id = \"\";\n    this._status = \"\";\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _status\n   * @return {string}\n   */\n  get status(): string {\n    return this._status;\n  }\n\n  /**\n   * Setter for _status\n   * @param {string} status\n   */\n  set status(status: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".status\",\n        status,\n        scorm12_regex.CMIStatus2,\n      )\n    ) {\n      this._status = status;\n    }\n  }\n\n  /**\n   * toJSON for cmi.objectives.n\n   * @return {\n   *    {\n   *      id: string,\n   *      status: string,\n   *      score: CMIScore\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    status: string;\n    score: CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      status: this.status,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { ValidationError } from \"../exceptions\";\nimport { scorm12_constants } from \"../constants/api_constants\";\n\nconst scorm12_errors = scorm12_constants.error_descriptions;\n\n/**\n * SCORM 1.2 Validation Error\n */\nexport class Scorm12ValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   */\n  constructor(CMIElement: string, errorCode: number) {\n    if ({}.hasOwnProperty.call(scorm12_errors, String(errorCode))) {\n      super(\n        CMIElement,\n        errorCode,\n        scorm12_errors[String(errorCode)].basicMessage,\n        scorm12_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        CMIElement,\n        101,\n        scorm12_errors[\"101\"].basicMessage,\n        scorm12_errors[\"101\"].detailMessage,\n      );\n    }\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, Scorm12ValidationError.prototype);\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Class representing the SCORM 1.2 cmi.student_preference object\n * @extends BaseCMI\n */\nexport class CMIStudentPreference extends BaseCMI {\n  private readonly __children;\n\n  /**\n   * Constructor for cmi.student_preference\n   * @param {string} student_preference_children\n   */\n  constructor(student_preference_children?: string) {\n    super(\"cmi.student_preference\");\n    this.__children = student_preference_children\n      ? student_preference_children\n      : scorm12_constants.student_preference_children;\n  }\n\n  private _audio = \"\";\n  private _language = \"\";\n  private _speed = \"\";\n  private _text = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _audio\n   * @return {string}\n   */\n  get audio(): string {\n    return this._audio;\n  }\n\n  /**\n   * Setter for _audio\n   * @param {string} audio\n   */\n  set audio(audio: string) {\n    if (\n      validationService.validateScorm12Audio(\n        this._cmi_element + \".audio\",\n        audio,\n      )\n    ) {\n      this._audio = audio;\n    }\n  }\n\n  /**\n   * Getter for _language\n   * @return {string}\n   */\n  get language(): string {\n    return this._language;\n  }\n\n  /**\n   * Setter for _language\n   * @param {string} language\n   */\n  set language(language: string) {\n    if (\n      validationService.validateScorm12Language(\n        this._cmi_element + \".language\",\n        language,\n      )\n    ) {\n      this._language = language;\n    }\n  }\n\n  /**\n   * Getter for _speed\n   * @return {string}\n   */\n  get speed(): string {\n    return this._speed;\n  }\n\n  /**\n   * Setter for _speed\n   * @param {string} speed\n   */\n  set speed(speed: string) {\n    if (\n      validationService.validateScorm12Speed(\n        this._cmi_element + \".speed\",\n        speed,\n      )\n    ) {\n      this._speed = speed;\n    }\n  }\n\n  /**\n   * Getter for _text\n   * @return {string}\n   */\n  get text(): string {\n    return this._text;\n  }\n\n  /**\n   * Setter for _text\n   * @param {string} text\n   */\n  set text(text: string) {\n    if (\n      validationService.validateScorm12Text(this._cmi_element + \".text\", text)\n    ) {\n      this._text = text;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_preference\n   *\n   * @return {\n   *    {\n   *      audio: string,\n   *      language: string,\n   *      speed: string,\n   *      text: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    audio: string;\n    language: string;\n    speed: string;\n    text: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      audio: this.audio,\n      language: this.language,\n      speed: this.speed,\n      text: this.text,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Base class for API cmi objects\n */\nexport abstract class BaseCMI {\n  jsonString? = false;\n  protected readonly _cmi_element: string;\n  protected _initialized = false;\n  private _start_time: number | undefined;\n\n  /**\n   * Constructor for BaseCMI\n   * @param {string} cmi_element\n   */\n  constructor(cmi_element: string) {\n    this._cmi_element = cmi_element;\n  }\n\n  /**\n   * Getter for _initialized\n   * @return {boolean}\n   */\n  get initialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Getter for _start_time\n   * @return {number | undefined}\n   */\n  get start_time(): number | undefined {\n    return this._start_time;\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  initialize(): void {\n    this._initialized = true;\n  }\n\n  /**\n   * Called when the player should override the 'session_time' provided by\n   * the module\n   */\n  setStartTime(): void {\n    this._start_time = new Date().getTime();\n  }\n\n  abstract reset(): void;\n}\n\n/**\n * Base class for cmi root objects\n */\nexport abstract class BaseRootCMI extends BaseCMI {\n  abstract getCurrentTotalTime(): string;\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat } from \"./validation\";\nimport { scorm12_regex } from \"../../constants/regex\";\n\n/**\n * Class for AICC Navigation object\n */\nexport class NAV extends BaseCMI {\n  /**\n   * Constructor for NAV object\n   */\n  constructor() {\n    super(\"cmi.nav\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._event = \"\";\n    this._initialized = false;\n  }\n\n  private _event = \"\";\n\n  /**\n   * Getter for _event\n   * @return {string}\n   */\n  get event(): string {\n    return this._event;\n  }\n\n  /**\n   * Setter for _event\n   * @param {string} event\n   */\n  set event(event: string) {\n    if (\n      event === \"\" ||\n      check12ValidFormat(\n        this._cmi_element + \".event\",\n        event,\n        scorm12_regex.NAVEvent,\n      )\n    ) {\n      this._event = event;\n    }\n  }\n\n  /**\n   * toJSON for nav object\n   * @return {\n   *    {\n   *      event: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    event: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      event: this.event,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","interface ErrorDescription {\n  basicMessage: string;\n  detailMessage: string;\n}\n\ninterface ErrorDescriptions {\n  [key: string]: ErrorDescription;\n}\n\ninterface ScormConstants {\n  cmi_children: string;\n  core_children: string;\n  score_children: string;\n  comments_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface AiccConstants extends ScormConstants {\n  student_demographics_children: string;\n  tries_children: string;\n  attempt_records_children: string;\n  paths_children: string;\n}\n\ninterface Scorm2004Constants {\n  cmi_children: string;\n  comments_children: string;\n  score_children: string;\n  objectives_children: string;\n  correct_responses_children: string;\n  student_data_children: string;\n  student_preference_children: string;\n  interactions_children: string;\n  adl_data_children: string;\n  error_descriptions: ErrorDescriptions;\n}\n\ninterface GlobalConstants {\n  SCORM_TRUE: string;\n  SCORM_FALSE: string;\n  STATE_NOT_INITIALIZED: number;\n  STATE_INITIALIZED: number;\n  STATE_TERMINATED: number;\n}\n\nexport const global_constants: GlobalConstants = {\n  SCORM_TRUE: \"true\",\n  SCORM_FALSE: \"false\",\n  STATE_NOT_INITIALIZED: 0,\n  STATE_INITIALIZED: 1,\n  STATE_TERMINATED: 2,\n};\n\nexport const scorm12_constants: ScormConstants = {\n  // Children lists\n  cmi_children:\n    \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions\",\n  core_children:\n    \"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time\",\n  score_children: \"raw,min,max\",\n  comments_children: \"content,location,time\",\n  objectives_children: \"id,score,status\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children: \"audio,language,speed,text\",\n  interactions_children:\n    \"id,objectives,time,type,correct_responses,weighting,student_response,result,latency\",\n  error_descriptions: {\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use LMSGetDiagnostic for more information\",\n    },\n    \"201\": {\n      basicMessage: \"Invalid argument error\",\n      detailMessage:\n        \"Indicates that an argument represents an invalid data model element or is otherwise incorrect.\",\n    },\n    \"202\": {\n      basicMessage: \"Element cannot have children\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_children\" for a data model element that does not support the \"_children\" suffix.',\n    },\n    \"203\": {\n      basicMessage: \"Element not an array - cannot have count\",\n      detailMessage:\n        'Indicates that LMSGetValue was called with a data model element name that ends in \"_count\" for a data model element that does not support the \"_count\" suffix.',\n    },\n    \"301\": {\n      basicMessage: \"Not initialized\",\n      detailMessage: \"Indicates that an API call was made before the call to lmsInitialize.\",\n    },\n    \"401\": {\n      basicMessage: \"Not implemented error\",\n      detailMessage:\n        \"The data model element indicated in a call to LMSGetValue or LMSSetValue is valid, but was not implemented by this LMS. SCORM 1.2 defines a set of data model elements as being optional for an LMS to implement.\",\n    },\n    \"402\": {\n      basicMessage: \"Invalid set value, element is a keyword\",\n      detailMessage:\n        'Indicates that LMSSetValue was called on a data model element that represents a keyword (elements that end in \"_children\" and \"_count\").',\n    },\n    \"403\": {\n      basicMessage: \"Element is read only\",\n      detailMessage: \"LMSSetValue was called with a data model element that can only be read.\",\n    },\n    \"404\": {\n      basicMessage: \"Element is write only\",\n      detailMessage: \"LMSGetValue was called on a data model element that can only be written to.\",\n    },\n    \"405\": {\n      basicMessage: \"Incorrect Data Type\",\n      detailMessage:\n        \"LMSSetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a LMSSetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\nexport const aicc_constants: AiccConstants = {\n  ...scorm12_constants,\n  ...{\n    cmi_children:\n      \"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions,evaluation\",\n    student_preference_children:\n      \"audio,language,lesson_type,speed,text,text_color,text_location,text_size,video,windows\",\n    student_data_children: \"attempt_number,tries,mastery_score,max_time_allowed,time_limit_action\",\n    student_demographics_children:\n      \"city,class,company,country,experience,familiar_name,instructor_name,title,native_language,state,street_address,telephone,years_experience\",\n    tries_children: \"time,status,score\",\n    attempt_records_children: \"score,lesson_status\",\n    paths_children: \"location_id,date,time,status,why_left,time_in_element\",\n  },\n};\n\nexport const scorm2004_constants: Scorm2004Constants = {\n  // Children lists\n  cmi_children:\n    \"_version,comments_from_learner,comments_from_lms,completion_status,credit,entry,exit,interactions,launch_data,learner_id,learner_name,learner_preference,location,max_time_allowed,mode,objectives,progress_measure,scaled_passing_score,score,session_time,success_status,suspend_data,time_limit_action,total_time\",\n  comments_children: \"comment,timestamp,location\",\n  score_children: \"max,raw,scaled,min\",\n  objectives_children: \"progress_measure,completion_status,success_status,description,score,id\",\n  correct_responses_children: \"pattern\",\n  student_data_children: \"mastery_score,max_time_allowed,time_limit_action\",\n  student_preference_children: \"audio_level,audio_captioning,delivery_speed,language\",\n  interactions_children:\n    \"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description\",\n  adl_data_children: \"id,store\",\n  error_descriptions: {\n    \"0\": {\n      basicMessage: \"No Error\",\n      detailMessage: \"No error occurred, the previous API call was successful.\",\n    },\n    \"101\": {\n      basicMessage: \"General Exception\",\n      detailMessage:\n        \"No specific error code exists to describe the error. Use GetDiagnostic for more information.\",\n    },\n    \"102\": {\n      basicMessage: \"General Initialization Failure\",\n      detailMessage: \"Call to Initialize failed for an unknown reason.\",\n    },\n    \"103\": {\n      basicMessage: \"Already Initialized\",\n      detailMessage: \"Call to Initialize failed because Initialize was already called.\",\n    },\n    \"104\": {\n      basicMessage: \"Content Instance Terminated\",\n      detailMessage: \"Call to Initialize failed because Terminate was already called.\",\n    },\n    \"111\": {\n      basicMessage: \"General Termination Failure\",\n      detailMessage: \"Call to Terminate failed for an unknown reason.\",\n    },\n    \"112\": {\n      basicMessage: \"Termination Before Initialization\",\n      detailMessage: \"Call to Terminate failed because it was made before the call to Initialize.\",\n    },\n    \"113\": {\n      basicMessage: \"Termination After Termination\",\n      detailMessage: \"Call to Terminate failed because Terminate was already called.\",\n    },\n    \"122\": {\n      basicMessage: \"Retrieve Data Before Initialization\",\n      detailMessage: \"Call to GetValue failed because it was made before the call to Initialize.\",\n    },\n    \"123\": {\n      basicMessage: \"Retrieve Data After Termination\",\n      detailMessage: \"Call to GetValue failed because it was made after the call to Terminate.\",\n    },\n    \"132\": {\n      basicMessage: \"Store Data Before Initialization\",\n      detailMessage: \"Call to SetValue failed because it was made before the call to Initialize.\",\n    },\n    \"133\": {\n      basicMessage: \"Store Data After Termination\",\n      detailMessage: \"Call to SetValue failed because it was made after the call to Terminate.\",\n    },\n    \"142\": {\n      basicMessage: \"Commit Before Initialization\",\n      detailMessage: \"Call to Commit failed because it was made before the call to Initialize.\",\n    },\n    \"143\": {\n      basicMessage: \"Commit After Termination\",\n      detailMessage: \"Call to Commit failed because it was made after the call to Terminate.\",\n    },\n    \"201\": {\n      basicMessage: \"General Argument Error\",\n      detailMessage:\n        \"An invalid argument was passed to an API method (usually indicates that Initialize, Commit or Terminate did not receive the expected empty string argument.\",\n    },\n    \"301\": {\n      basicMessage: \"General Get Failure\",\n      detailMessage:\n        \"Indicates a failed GetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"351\": {\n      basicMessage: \"General Set Failure\",\n      detailMessage:\n        \"Indicates a failed SetValue call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"391\": {\n      basicMessage: \"General Commit Failure\",\n      detailMessage:\n        \"Indicates a failed Commit call where no other specific error code is applicable. Use GetDiagnostic for more information.\",\n    },\n    \"401\": {\n      basicMessage: \"Undefined Data Model Element\",\n      detailMessage:\n        \"The data model element name passed to GetValue or SetValue is not a valid SCORM data model element.\",\n    },\n    \"402\": {\n      basicMessage: \"Unimplemented Data Model Element\",\n      detailMessage:\n        \"The data model element indicated in a call to GetValue or SetValue is valid, but was not implemented by this LMS. In SCORM 2004, this error would indicate an LMS that is not fully SCORM conformant.\",\n    },\n    \"403\": {\n      basicMessage: \"Data Model Element Value Not Initialized\",\n      detailMessage:\n        \"Attempt to read a data model element that has not been initialized by the LMS or through a SetValue call. This error condition is often reached during normal execution of a SCO.\",\n    },\n    \"404\": {\n      basicMessage: \"Data Model Element Is Read Only\",\n      detailMessage: \"SetValue was called with a data model element that can only be read.\",\n    },\n    \"405\": {\n      basicMessage: \"Data Model Element Is Write Only\",\n      detailMessage: \"GetValue was called on a data model element that can only be written to.\",\n    },\n    \"406\": {\n      basicMessage: \"Data Model Element Type Mismatch\",\n      detailMessage:\n        \"SetValue was called with a value that is not consistent with the data format of the supplied data model element.\",\n    },\n    \"407\": {\n      basicMessage: \"Data Model Element Value Out Of Range\",\n      detailMessage:\n        \"The numeric value supplied to a SetValue call is outside of the numeric range allowed for the supplied data model element.\",\n    },\n    \"408\": {\n      basicMessage: \"Data Model Dependency Not Established\",\n      detailMessage:\n        \"Some data model elements cannot be set until another data model element was set. This error condition indicates that the prerequisite element was not set before the dependent element.\",\n    },\n  },\n};\n","export const scorm12_regex = {\n  CMIString256: \"^.{0,255}$\",\n  CMIString4096: \"^.{0,4096}$\",\n  CMITime: \"^(?:[01]\\\\d|2[0123]):(?:[012345]\\\\d):(?:[012345]\\\\d)$\",\n  CMITimespan: \"^([0-9]{2,}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$\",\n\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{0,3})(.[0-9]*)?$\",\n\n  CMIIdentifier: \"^[\\\\u0021-\\\\u007E\\\\s]{0,255}$\",\n  CMIFeedback: \"^.{0,255}$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMIStatus: \"^(passed|completed|failed|incomplete|browsed)$\",\n  CMIStatus2: \"^(passed|completed|failed|incomplete|browsed|not attempted)$\",\n  CMIExit: \"^(time-out|suspend|logout|)$\",\n  CMIType: \"^(true-false|choice|fill-in|matching|performance|sequencing|likert|numeric)$\",\n  CMIResult: \"^(correct|wrong|unanticipated|neutral|([0-9]{0,3})?(\\\\.[0-9]*)?)$\",\n  NAVEvent: \"^(previous|continue)$\",\n  // Data ranges\n  score_range: \"0#100\",\n  audio_range: \"-1#100\",\n  speed_range: \"-100#100\",\n  weighting_range: \"-100#100\",\n  text_range: \"-1#1\",\n};\nexport const aicc_regex = {\n  ...scorm12_regex,\n  ...{\n    CMIIdentifier: \"^\\\\w{1,255}$\",\n  },\n};\nexport const scorm2004_regex = {\n  CMIString200: \"^[\\\\u0000-\\\\uFFFF]{0,200}$\",\n  CMIString250: \"^[\\\\u0000-\\\\uFFFF]{0,250}$\",\n  CMIString1000: \"^[\\\\u0000-\\\\uFFFF]{0,1000}$\",\n  CMIString4000: \"^[\\\\u0000-\\\\uFFFF]{0,4000}$\",\n  CMIString64000: \"^[\\\\u0000-\\\\uFFFF]{0,64000}$\",\n  CMILang: \"^([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?$|^$\",\n\n  CMILangString250: \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,250}$)?$\",\n\n  CMILangcr: \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?}))(.*?)$\",\n\n  CMILangString250cr: \"^(({lang=([a-zA-Z]{2,3}|i|x)?(-[a-zA-Z0-9-]{2,8})?})?(.{0,250})?)?$\",\n\n  CMILangString4000: \"^({lang=([a-zA-Z]{2,3}|i|x)(-[a-zA-Z0-9-]{2,8})?})?((?!{.*$).{0,4000}$)?$\",\n\n  CMITime:\n    \"^(19[7-9]{1}[0-9]{1}|20[0-2]{1}[0-9]{1}|203[0-8]{1})((-(0[1-9]{1}|1[0-2]{1}))((-(0[1-9]{1}|[1-2]{1}[0-9]{1}|3[0-1]{1}))(T([0-1]{1}[0-9]{1}|2[0-3]{1})((:[0-5]{1}[0-9]{1})((:[0-5]{1}[0-9]{1})((\\\\.[0-9]{1,6})((Z|([+|-]([0-1]{1}[0-9]{1}|2[0-3]{1})))(:[0-5]{1}[0-9]{1})?)?)?)?)?)?)?)?$\",\n  CMITimespan:\n    \"^P(?:([.,\\\\d]+)Y)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)W)?(?:([.,\\\\d]+)D)?(?:T?(?:([.,\\\\d]+)H)?(?:([.,\\\\d]+)M)?(?:([.,\\\\d]+)S)?)?$\",\n  CMIInteger: \"^\\\\d+$\",\n  CMISInteger: \"^-?([0-9]+)$\",\n  CMIDecimal: \"^-?([0-9]{1,5})(\\\\.[0-9]{1,18})?$\",\n  CMIIdentifier: \"^\\\\S{1,250}[a-zA-Z0-9]$\",\n  CMIShortIdentifier: \"^[\\\\w\\\\.\\\\-\\\\_]{1,250}$\",\n  CMILongIdentifier: \"^(?:(?!urn:)\\\\S{1,4000}|urn:[A-Za-z0-9-]{1,31}:\\\\S{1,4000}|.{1,4000})$\",\n  // need to re-examine this\n  CMIFeedback: \"^.*$\",\n  // This must be redefined\n  CMIIndex: \"[._](\\\\d+).\",\n  CMIIndexStore: \".N(\\\\d+).\",\n  // Vocabulary Data Type Definition\n  CMICStatus: \"^(completed|incomplete|not attempted|unknown)$\",\n  CMISStatus: \"^(passed|failed|unknown)$\",\n  CMIExit: \"^(time-out|suspend|logout|normal)$\",\n  CMIType:\n    \"^(true-false|choice|fill-in|long-fill-in|matching|performance|sequencing|likert|numeric|other)$\",\n  CMIResult: \"^(correct|incorrect|unanticipated|neutral|-?([0-9]{1,4})(\\\\.[0-9]{1,18})?)$\",\n  NAVEvent:\n    \"^(previous|continue|exit|exitAll|abandon|abandonAll|suspendAll|_none_|(\\\\{target=(?<choice_target>\\\\S{0,}[a-zA-Z0-9-_]+)})?choice|(\\\\{target=(?<jump_target>\\\\S{0,}[a-zA-Z0-9-_]+)})?jump)$\",\n\n  NAVBoolean: \"^(unknown|true|false$)\",\n  NAVTarget: \"^{target=\\\\S{0,}[a-zA-Z0-9-_]+}$\",\n  // Data ranges\n  scaled_range: \"-1#1\",\n  audio_range: \"0#999.9999999\",\n  speed_range: \"0#999.9999999\",\n  text_range: \"-1#1\",\n  progress_range: \"0#1\",\n};\n","import { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { BaseCMI } from \"./base_cmi\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { BaseScormValidationError } from \"../../exceptions\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Base class for cmi *.score objects\n */\nexport class CMIScore extends BaseCMI {\n  private readonly __children: string;\n  private readonly __score_range: string | false;\n  private readonly __invalid_error_code: number;\n  private readonly __invalid_type_code: number;\n  private readonly __invalid_range_code: number;\n  private readonly __decimal_regex: string;\n  private readonly __error_class: typeof BaseScormValidationError;\n  protected _raw = \"\";\n  protected _min = \"\";\n  protected _max: string;\n\n  /**\n   * Constructor for *.score\n   * @param {\n   *     score_children: string,\n   *     score_range: string,\n   *     max: string,\n   *     invalidErrorCode: number,\n   *     invalidTypeCode: number,\n   *     invalidRangeCode: number,\n   *     decimalRegex: string,\n   *     errorClass: typeof BaseScormValidationError\n   * } params\n   */\n  constructor(params: {\n    CMIElement: string;\n    score_children?: string;\n    score_range?: string;\n    max?: string;\n    invalidErrorCode?: number;\n    invalidTypeCode?: number;\n    invalidRangeCode?: number;\n    decimalRegex?: string;\n    errorClass: typeof BaseScormValidationError;\n  }) {\n    super(params.CMIElement);\n\n    this.__children = params.score_children || scorm12_constants.score_children;\n    this.__score_range = !params.score_range\n      ? false\n      : scorm12_regex.score_range;\n    this._max = params.max || params.max === \"\" ? params.max : \"100\";\n    this.__invalid_error_code =\n      params.invalidErrorCode || scorm12_errors.INVALID_SET_VALUE;\n    this.__invalid_type_code =\n      params.invalidTypeCode || scorm12_errors.TYPE_MISMATCH;\n    this.__invalid_range_code =\n      params.invalidRangeCode || scorm12_errors.VALUE_OUT_OF_RANGE;\n    this.__decimal_regex = params.decimalRegex || scorm12_regex.CMIDecimal;\n    this.__error_class = params.errorClass;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this.__error_class(\n      this._cmi_element + \"._children\",\n      this.__invalid_error_code,\n    );\n  }\n\n  /**\n   * Getter for _raw\n   * @return {string}\n   */\n  get raw(): string {\n    return this._raw;\n  }\n\n  /**\n   * Setter for _raw\n   * @param {string} raw\n   */\n  set raw(raw: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".raw\",\n        raw,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._raw = raw;\n    }\n  }\n\n  /**\n   * Getter for _min\n   * @return {string}\n   */\n  get min(): string {\n    return this._min;\n  }\n\n  /**\n   * Setter for _min\n   * @param {string} min\n   */\n  set min(min: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".min\",\n        min,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._min = min;\n    }\n  }\n\n  /**\n   * Getter for _max\n   * @return {string}\n   */\n  get max(): string {\n    return this._max;\n  }\n\n  /**\n   * Setter for _max\n   * @param {string} max\n   */\n  set max(max: string) {\n    if (\n      validationService.validateScore(\n        this._cmi_element + \".max\",\n        max,\n        this.__decimal_regex,\n        this.__score_range,\n        this.__invalid_type_code,\n        this.__invalid_range_code,\n        this.__error_class,\n      )\n    ) {\n      this._max = max;\n    }\n  }\n\n  /**\n   * toJSON for *.score\n   * @return {\n   *    {\n   *      min: string,\n   *      max: string,\n   *      raw: string\n   *    }\n   *    }\n   */\n  toJSON(): {\n    min: string;\n    max: string;\n    raw: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      raw: this.raw,\n      min: this.min,\n      max: this.max,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseScormValidationError } from \"../../exceptions\";\nimport { memoize } from \"../../utilities\";\n\n/**\n * Check if the value matches the proper format. If not, throw proper error code.\n *\n * @param {string} value\n * @param {string} regexPattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @param {boolean} [allowEmptyString]\n * @return {boolean}\n */\nexport const checkValidFormat = memoize(\n  (\n    CMIElement: string,\n    value: string,\n    regexPattern: string,\n    errorCode: number,\n    errorClass: typeof BaseScormValidationError,\n    allowEmptyString?: boolean,\n  ): boolean => {\n    if (typeof value !== \"string\") {\n      return false;\n    }\n    const formatRegex = new RegExp(regexPattern);\n    const matches = value.match(formatRegex);\n    if (allowEmptyString && value === \"\") {\n      return true;\n    }\n    if (value === undefined || !matches || matches[0] === \"\") {\n      throw new errorClass(CMIElement, errorCode);\n    }\n    return true;\n  },\n  // Custom key function that excludes the error class from the cache key\n  // since it can't be stringified and doesn't affect the validation result\n  (CMIElement, value, regexPattern, errorCode, _errorClass, allowEmptyString) => {\n    // Use typeof for non-string values to ensure consistent cache keys\n    const valueKey = typeof value === 'string' ? value : `[${typeof value}]`;\n    return `${CMIElement}:${valueKey}:${regexPattern}:${errorCode}:${allowEmptyString || false}`;\n  },\n);\n\n/**\n * Check if the value matches the proper range. If not, throw proper error code.\n *\n * @param {any} value\n * @param {string} rangePattern\n * @param {number} errorCode\n * @param {typeof BaseScormValidationError} errorClass\n * @return {boolean}\n */\nexport const checkValidRange = memoize(\n  (\n    CMIElement: string,\n    value: any,\n    rangePattern: string,\n    errorCode: number,\n    errorClass: typeof BaseScormValidationError,\n  ): boolean => {\n    const ranges = rangePattern.split(\"#\");\n    value = value * 1.0;\n    if (value >= ranges[0]) {\n      if (ranges[1] === \"*\" || value <= ranges[1]) {\n        return true;\n      } else {\n        throw new errorClass(CMIElement, errorCode);\n      }\n    } else {\n      throw new errorClass(CMIElement, errorCode);\n    }\n  },\n  // Custom key function that excludes the error class from the cache key\n  // since it can't be stringified and doesn't affect the validation result\n  (CMIElement, value, rangePattern, errorCode, _errorClass) =>\n    `${CMIElement}:${value}:${rangePattern}:${errorCode}`,\n);\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { validationService } from \"../../services/ValidationService\";\n\n/**\n * Class representing the SCORM 1.2 cmi.student_data object\n * @extends BaseCMI\n */\nexport class CMIStudentData extends BaseCMI {\n  private readonly __children;\n  private _mastery_score = \"\";\n  private _max_time_allowed = \"\";\n  private _time_limit_action = \"\";\n\n  /**\n   * Constructor for cmi.student_data\n   * @param {string} student_data_children\n   */\n  constructor(student_data_children?: string) {\n    super(\"cmi.student_data\");\n    this.__children = student_data_children\n      ? student_data_children\n      : scorm12_constants.student_data_children;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _master_score\n   * @return {string}\n   */\n  get mastery_score(): string {\n    return this._mastery_score;\n  }\n\n  /**\n   * Setter for _master_score. Can only be called before  initialization.\n   * @param {string} mastery_score\n   */\n  set mastery_score(mastery_score: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".mastery_score\",\n      this.initialized,\n    );\n    this._mastery_score = mastery_score;\n  }\n\n  /**\n   * Getter for _max_time_allowed\n   * @return {string}\n   */\n  get max_time_allowed(): string {\n    return this._max_time_allowed;\n  }\n\n  /**\n   * Setter for _max_time_allowed. Can only be called before  initialization.\n   * @param {string} max_time_allowed\n   */\n  set max_time_allowed(max_time_allowed: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".max_time_allowed\",\n      this.initialized,\n    );\n    this._max_time_allowed = max_time_allowed;\n  }\n\n  /**\n   * Getter for _time_limit_action\n   * @return {string}\n   */\n  get time_limit_action(): string {\n    return this._time_limit_action;\n  }\n\n  /**\n   * Setter for _time_limit_action. Can only be called before  initialization.\n   * @param {string} time_limit_action\n   */\n  set time_limit_action(time_limit_action: string) {\n    validationService.validateReadOnly(\n      this._cmi_element + \".time_limit_action\",\n      this.initialized,\n    );\n    this._time_limit_action = time_limit_action;\n  }\n\n  /**\n   * toJSON for cmi.student_data\n   *\n   * @return {\n   *    {\n   *      max_time_allowed: string,\n   *      time_limit_action: string,\n   *      mastery_score: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    mastery_score: string;\n    max_time_allowed: string;\n    time_limit_action: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      mastery_score: this.mastery_score,\n      max_time_allowed: this.max_time_allowed,\n      time_limit_action: this.time_limit_action,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { ValidationError } from \"../exceptions\";\nimport { scorm2004_constants } from \"../constants/api_constants\";\n\nconst scorm2004_errors = scorm2004_constants.error_descriptions;\n\n/**\n * SCORM 2004 Validation Error\n */\nexport class Scorm2004ValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   */\n  constructor(CMIElement: string, errorCode: number) {\n    if ({}.hasOwnProperty.call(scorm2004_errors, String(errorCode))) {\n      super(\n        CMIElement,\n        errorCode,\n        scorm2004_errors[String(errorCode)].basicMessage,\n        scorm2004_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(\n        CMIElement,\n        101,\n        scorm2004_errors[\"101\"].basicMessage,\n        scorm2004_errors[\"101\"].detailMessage,\n      );\n    }\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, Scorm2004ValidationError.prototype);\n  }\n}\n","import { checkValidFormat, checkValidRange } from \"../common/validation\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} regexPattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check2004ValidFormat(\n  CMIElement: string,\n  value: string,\n  regexPattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  return checkValidFormat(\n    CMIElement,\n    value,\n    regexPattern,\n    scorm2004_errors.TYPE_MISMATCH,\n    Scorm2004ValidationError,\n    allowEmptyString,\n  );\n}\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} rangePattern\n * @return {boolean}\n */\nexport function check2004ValidRange(\n  CMIElement: string,\n  value: string,\n  rangePattern: string,\n): boolean {\n  return checkValidRange(\n    CMIElement,\n    value,\n    rangePattern,\n    scorm2004_errors.VALUE_OUT_OF_RANGE,\n    Scorm2004ValidationError,\n  );\n}\n","import { BaseCMI } from \"../../common/base_cmi\";\nimport { Activity } from \"./activity\";\nimport { Scorm2004ValidationError } from \"../../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../../constants/error_codes\";\nimport { SuccessStatus } from \"../../../constants/enums\";\n\n/**\n * Enum for rule condition operators\n */\nexport enum RuleConditionOperator {\n  NOT = \"not\",\n  AND = \"and\",\n  OR = \"or\",\n}\n\n/**\n * Enum for rule condition types\n */\nexport enum RuleConditionType {\n  SATISFIED = \"satisfied\",\n  OBJECTIVE_STATUS_KNOWN = \"objectiveStatusKnown\",\n  OBJECTIVE_MEASURE_KNOWN = \"objectiveMeasureKnown\",\n  OBJECTIVE_MEASURE_GREATER_THAN = \"objectiveMeasureGreaterThan\",\n  OBJECTIVE_MEASURE_LESS_THAN = \"objectiveMeasureLessThan\",\n  COMPLETED = \"completed\",\n  PROGRESS_KNOWN = \"progressKnown\",\n  ATTEMPTED = \"attempted\",\n  ATTEMPT_LIMIT_EXCEEDED = \"attemptLimitExceeded\",\n  TIME_LIMIT_EXCEEDED = \"timeLimitExceeded\",\n  OUTSIDE_AVAILABLE_TIME_RANGE = \"outsideAvailableTimeRange\",\n  ALWAYS = \"always\",\n}\n\n/**\n * Enum for rule action types\n */\nexport enum RuleActionType {\n  SKIP = \"skip\",\n  DISABLED = \"disabled\",\n  HIDE_FROM_CHOICE = \"hideFromChoice\",\n  STOP_FORWARD_TRAVERSAL = \"stopForwardTraversal\",\n  EXIT_PARENT = \"exitParent\",\n  EXIT_ALL = \"exitAll\",\n  RETRY = \"retry\",\n  RETRY_ALL = \"retryAll\",\n  CONTINUE = \"continue\",\n  PREVIOUS = \"previous\",\n  EXIT = \"exit\",\n}\n\n/**\n * Class representing a sequencing rule condition\n */\nexport class RuleCondition extends BaseCMI {\n  private _condition: RuleConditionType = RuleConditionType.ALWAYS;\n  private _operator: RuleConditionOperator | null = null;\n  private _parameters: Map<string, any> = new Map();\n\n  /**\n   * Constructor for RuleCondition\n   * @param {RuleConditionType} condition - The condition type\n   * @param {RuleConditionOperator | null} operator - The operator (null for no operator)\n   * @param {Map<string, any>} parameters - Additional parameters for the condition\n   */\n  constructor(\n    condition: RuleConditionType = RuleConditionType.ALWAYS,\n    operator: RuleConditionOperator | null = null,\n    parameters: Map<string, any> = new Map()\n  ) {\n    super(\"ruleCondition\");\n    this._condition = condition;\n    this._operator = operator;\n    this._parameters = parameters;\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for condition\n   * @return {RuleConditionType}\n   */\n  get condition(): RuleConditionType {\n    return this._condition;\n  }\n\n  /**\n   * Setter for condition\n   * @param {RuleConditionType} condition\n   */\n  set condition(condition: RuleConditionType) {\n    this._condition = condition;\n  }\n\n  /**\n   * Getter for operator\n   * @return {RuleConditionOperator | null}\n   */\n  get operator(): RuleConditionOperator | null {\n    return this._operator;\n  }\n\n  /**\n   * Setter for operator\n   * @param {RuleConditionOperator | null} operator\n   */\n  set operator(operator: RuleConditionOperator | null) {\n    this._operator = operator;\n  }\n\n  /**\n   * Getter for parameters\n   * @return {Map<string, any>}\n   */\n  get parameters(): Map<string, any> {\n    return this._parameters;\n  }\n\n  /**\n   * Setter for parameters\n   * @param {Map<string, any>} parameters\n   */\n  set parameters(parameters: Map<string, any>) {\n    this._parameters = parameters;\n  }\n\n  /**\n   * Evaluate the condition for an activity\n   * @param {Activity} activity - The activity to evaluate the condition for\n   * @return {boolean} - True if the condition is met, false otherwise\n   */\n  evaluate(activity: Activity): boolean {\n    switch (this._condition) {\n      case RuleConditionType.SATISFIED:\n        return activity.successStatus === SuccessStatus.PASSED;\n      case RuleConditionType.OBJECTIVE_STATUS_KNOWN:\n        return activity.objectiveMeasureStatus;\n      case RuleConditionType.OBJECTIVE_MEASURE_KNOWN:\n        return activity.objectiveMeasureStatus;\n      case RuleConditionType.OBJECTIVE_MEASURE_GREATER_THAN:\n        const greaterThanValue = this._parameters.get(\"threshold\") || 0;\n        return activity.objectiveMeasureStatus && activity.objectiveNormalizedMeasure > greaterThanValue;\n      case RuleConditionType.OBJECTIVE_MEASURE_LESS_THAN:\n        const lessThanValue = this._parameters.get(\"threshold\") || 0;\n        return activity.objectiveMeasureStatus && activity.objectiveNormalizedMeasure < lessThanValue;\n      case RuleConditionType.COMPLETED:\n        return activity.isCompleted;\n      case RuleConditionType.PROGRESS_KNOWN:\n        return activity.completionStatus !== \"unknown\";\n      case RuleConditionType.ATTEMPTED:\n        return activity.attemptCount > 0;\n      case RuleConditionType.ATTEMPT_LIMIT_EXCEEDED:\n        const attemptLimit = this._parameters.get(\"attemptLimit\") || 0;\n        return attemptLimit > 0 && activity.attemptCount >= attemptLimit;\n      case RuleConditionType.TIME_LIMIT_EXCEEDED:\n        // Time limit exceeded would require additional tracking\n        return false;\n      case RuleConditionType.OUTSIDE_AVAILABLE_TIME_RANGE:\n        // Outside available time range would require additional tracking\n        return false;\n      case RuleConditionType.ALWAYS:\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * toJSON for RuleCondition\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      condition: this._condition,\n      operator: this._operator,\n      parameters: Object.fromEntries(this._parameters),\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing a sequencing rule\n */\nexport class SequencingRule extends BaseCMI {\n  private _conditions: RuleCondition[] = [];\n  private _action: RuleActionType = RuleActionType.SKIP;\n  private _conditionCombination: RuleConditionOperator = RuleConditionOperator.AND;\n\n  /**\n   * Constructor for SequencingRule\n   * @param {RuleActionType} action - The action to take when the rule conditions are met\n   * @param {RuleConditionOperator} conditionCombination - How to combine multiple conditions\n   */\n  constructor(\n    action: RuleActionType = RuleActionType.SKIP,\n    conditionCombination: RuleConditionOperator = RuleConditionOperator.AND\n  ) {\n    super(\"sequencingRule\");\n    this._action = action;\n    this._conditionCombination = conditionCombination;\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._conditions = [];\n  }\n\n  /**\n   * Getter for conditions\n   * @return {RuleCondition[]}\n   */\n  get conditions(): RuleCondition[] {\n    return this._conditions;\n  }\n\n  /**\n   * Add a condition to the rule\n   * @param {RuleCondition} condition - The condition to add\n   */\n  addCondition(condition: RuleCondition): void {\n    if (!(condition instanceof RuleCondition)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".conditions\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._conditions.push(condition);\n  }\n\n  /**\n   * Remove a condition from the rule\n   * @param {RuleCondition} condition - The condition to remove\n   * @return {boolean} - True if the condition was removed, false otherwise\n   */\n  removeCondition(condition: RuleCondition): boolean {\n    const index = this._conditions.indexOf(condition);\n    if (index !== -1) {\n      this._conditions.splice(index, 1);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Getter for action\n   * @return {RuleActionType}\n   */\n  get action(): RuleActionType {\n    return this._action;\n  }\n\n  /**\n   * Setter for action\n   * @param {RuleActionType} action\n   */\n  set action(action: RuleActionType) {\n    this._action = action;\n  }\n\n  /**\n   * Getter for conditionCombination\n   * @return {RuleConditionOperator}\n   */\n  get conditionCombination(): RuleConditionOperator {\n    return this._conditionCombination;\n  }\n\n  /**\n   * Setter for conditionCombination\n   * @param {RuleConditionOperator} conditionCombination\n   */\n  set conditionCombination(conditionCombination: RuleConditionOperator) {\n    this._conditionCombination = conditionCombination;\n  }\n\n  /**\n   * Evaluate the rule for an activity\n   * @param {Activity} activity - The activity to evaluate the rule for\n   * @return {boolean} - True if the rule conditions are met, false otherwise\n   */\n  evaluate(activity: Activity): boolean {\n    if (this._conditions.length === 0) {\n      return true;\n    }\n\n    if (this._conditionCombination === RuleConditionOperator.AND) {\n      return this._conditions.every(condition => condition.evaluate(activity));\n    } else if (this._conditionCombination === RuleConditionOperator.OR) {\n      return this._conditions.some(condition => condition.evaluate(activity));\n    }\n\n    return false;\n  }\n\n  /**\n   * toJSON for SequencingRule\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      conditions: this._conditions,\n      action: this._action,\n      conditionCombination: this._conditionCombination,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing a collection of sequencing rules\n */\nexport class SequencingRules extends BaseCMI {\n  private _preConditionRules: SequencingRule[] = [];\n  private _exitConditionRules: SequencingRule[] = [];\n  private _postConditionRules: SequencingRule[] = [];\n\n  /**\n   * Constructor for SequencingRules\n   */\n  constructor() {\n    super(\"sequencingRules\");\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._preConditionRules = [];\n    this._exitConditionRules = [];\n    this._postConditionRules = [];\n  }\n\n  /**\n   * Getter for preConditionRules\n   * @return {SequencingRule[]}\n   */\n  get preConditionRules(): SequencingRule[] {\n    return this._preConditionRules;\n  }\n\n  /**\n   * Add a pre-condition rule\n   * @param {SequencingRule} rule - The rule to add\n   */\n  addPreConditionRule(rule: SequencingRule): void {\n    if (!(rule instanceof SequencingRule)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".preConditionRules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._preConditionRules.push(rule);\n  }\n\n  /**\n   * Getter for exitConditionRules\n   * @return {SequencingRule[]}\n   */\n  get exitConditionRules(): SequencingRule[] {\n    return this._exitConditionRules;\n  }\n\n  /**\n   * Add an exit condition rule\n   * @param {SequencingRule} rule - The rule to add\n   */\n  addExitConditionRule(rule: SequencingRule): void {\n    if (!(rule instanceof SequencingRule)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".exitConditionRules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._exitConditionRules.push(rule);\n  }\n\n  /**\n   * Getter for postConditionRules\n   * @return {SequencingRule[]}\n   */\n  get postConditionRules(): SequencingRule[] {\n    return this._postConditionRules;\n  }\n\n  /**\n   * Add a post-condition rule\n   * @param {SequencingRule} rule - The rule to add\n   */\n  addPostConditionRule(rule: SequencingRule): void {\n    if (!(rule instanceof SequencingRule)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".postConditionRules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._postConditionRules.push(rule);\n  }\n\n  /**\n   * Evaluate pre-condition rules for an activity\n   * @param {Activity} activity - The activity to evaluate the rules for\n   * @return {RuleActionType | null} - The action to take, or null if no rules are met\n   */\n  evaluatePreConditionRules(activity: Activity): RuleActionType | null {\n    for (const rule of this._preConditionRules) {\n      if (rule.evaluate(activity)) {\n        return rule.action;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Evaluate exit condition rules for an activity\n   * @param {Activity} activity - The activity to evaluate the rules for\n   * @return {RuleActionType | null} - The action to take, or null if no rules are met\n   */\n  evaluateExitConditionRules(activity: Activity): RuleActionType | null {\n    for (const rule of this._exitConditionRules) {\n      if (rule.evaluate(activity)) {\n        return rule.action;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Evaluate post-condition rules for an activity\n   * @param {Activity} activity - The activity to evaluate the rules for\n   * @return {RuleActionType | null} - The action to take, or null if no rules are met\n   */\n  evaluatePostConditionRules(activity: Activity): RuleActionType | null {\n    for (const rule of this._postConditionRules) {\n      if (rule.evaluate(activity)) {\n        return rule.action;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * toJSON for SequencingRules\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      preConditionRules: this._preConditionRules,\n      exitConditionRules: this._exitConditionRules,\n      postConditionRules: this._postConditionRules,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Class for SCORM 2004's cmi.learner_preference object\n */\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\nimport { scorm2004_regex } from \"../../constants/regex\";\n\nexport class CMILearnerPreference extends BaseCMI {\n  private __children = scorm2004_constants.student_preference_children;\n  private _audio_level = \"1\";\n  private _language = \"\";\n  private _delivery_speed = \"1\";\n  private _audio_captioning = \"0\";\n\n  /**\n   * Constructor for cmi.learner_preference\n   */\n  constructor() {\n    super(\"cmi.learner_preference\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset() {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm2004ValidationError(\n      this._cmi_element + \"._children\",\n      scorm2004_errors.READ_ONLY_ELEMENT,\n    );\n  }\n\n  /**\n   * Getter for _audio_level\n   * @return {string}\n   */\n  get audio_level(): string {\n    return this._audio_level;\n  }\n\n  /**\n   * Setter for _audio_level\n   * @param {string} audio_level\n   */\n  set audio_level(audio_level: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".audio_level\",\n        audio_level,\n        scorm2004_regex.CMIDecimal,\n      ) &&\n      check2004ValidRange(\n        this._cmi_element + \".audio_level\",\n        audio_level,\n        scorm2004_regex.audio_range,\n      )\n    ) {\n      this._audio_level = audio_level;\n    }\n  }\n\n  /**\n   * Getter for _language\n   * @return {string}\n   */\n  get language(): string {\n    return this._language;\n  }\n\n  /**\n   * Setter for _language\n   * @param {string} language\n   */\n  set language(language: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".language\",\n        language,\n        scorm2004_regex.CMILang,\n      )\n    ) {\n      this._language = language;\n    }\n  }\n\n  /**\n   * Getter for _delivery_speed\n   * @return {string}\n   */\n  get delivery_speed(): string {\n    return this._delivery_speed;\n  }\n\n  /**\n   * Setter for _delivery_speed\n   * @param {string} delivery_speed\n   */\n  set delivery_speed(delivery_speed: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".delivery_speed\",\n        delivery_speed,\n        scorm2004_regex.CMIDecimal,\n      ) &&\n      check2004ValidRange(\n        this._cmi_element + \".delivery_speed\",\n        delivery_speed,\n        scorm2004_regex.speed_range,\n      )\n    ) {\n      this._delivery_speed = delivery_speed;\n    }\n  }\n\n  /**\n   * Getter for _audio_captioning\n   * @return {string}\n   */\n  get audio_captioning(): string {\n    return this._audio_captioning;\n  }\n\n  /**\n   * Setter for _audio_captioning\n   * @param {string} audio_captioning\n   */\n  set audio_captioning(audio_captioning: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".audio_captioning\",\n        audio_captioning,\n        scorm2004_regex.CMISInteger,\n      ) &&\n      check2004ValidRange(\n        this._cmi_element + \".audio_captioning\",\n        audio_captioning,\n        scorm2004_regex.text_range,\n      )\n    ) {\n      this._audio_captioning = audio_captioning;\n    }\n  }\n\n  /**\n   * toJSON for cmi.learner_preference\n   *\n   * @return {\n   *    {\n   *      audio_level: string,\n   *      language: string,\n   *      delivery_speed: string,\n   *      audio_captioning: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    audio_level: string;\n    language: string;\n    delivery_speed: string;\n    audio_captioning: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      audio_level: this.audio_level,\n      language: this.language,\n      delivery_speed: this.delivery_speed,\n      audio_captioning: this.audio_captioning,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { scorm2004_regex } from \"./regex\";\n\nexport const LearnerResponses: Responses = {\n  \"true-false\": {\n    format: \"^true$|^false$\",\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  choice: {\n    format: scorm2004_regex.CMILongIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    unique: true,\n  },\n  \"fill-in\": {\n    format: scorm2004_regex.CMILangString250,\n    max: 10,\n    delimiter: \"[,]\",\n    unique: false,\n  },\n  \"long-fill-in\": {\n    format: scorm2004_regex.CMILangString4000,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  matching: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIShortIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n  },\n  performance: {\n    format: \"^$|\" + scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIDecimal + \"|^$|\" + scorm2004_regex.CMIShortIdentifier,\n    max: 250,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n  },\n  sequencing: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    max: 36,\n    delimiter: \"[,]\",\n    unique: false,\n  },\n  likert: {\n    format: scorm2004_regex.CMIShortIdentifier,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  numeric: {\n    format: scorm2004_regex.CMIDecimal,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n  other: {\n    format: scorm2004_regex.CMIString4000,\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n  },\n};\nexport const CorrectResponses: Responses = {\n  \"true-false\": {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: \"^true$|^false$\",\n    limit: 1,\n  },\n  choice: {\n    max: 36,\n    delimiter: \"[,]\",\n    unique: true,\n    duplicate: false,\n    format: scorm2004_regex.CMILongIdentifier,\n  },\n  \"fill-in\": {\n    max: 10,\n    delimiter: \"[,]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMILangString250cr,\n  },\n  \"long-fill-in\": {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: true,\n    format: scorm2004_regex.CMILangString4000,\n  },\n  matching: {\n    max: 36,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIShortIdentifier,\n  },\n  performance: {\n    max: 250,\n    delimiter: \"[,]\",\n    delimiter2: \"[.]\",\n    delimiter3: \"[:]\",\n    unique: false,\n    duplicate: false,\n    format: \"^$|\" + scorm2004_regex.CMIShortIdentifier,\n    format2: scorm2004_regex.CMIDecimal + \"|^$|\" + scorm2004_regex.CMIShortIdentifier,\n  },\n  sequencing: {\n    max: 36,\n    delimiter: \"[,]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n  },\n  likert: {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIShortIdentifier,\n    limit: 1,\n  },\n  numeric: {\n    max: 2,\n    delimiter: \"[:]\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIDecimal,\n    limit: 1,\n  },\n  other: {\n    max: 1,\n    delimiter: \"\",\n    unique: false,\n    duplicate: false,\n    format: scorm2004_regex.CMIString4000,\n    limit: 1,\n  },\n};\n\nexport type ResponseType = {\n  format: string;\n  max: number;\n  delimiter: string;\n  unique: boolean;\n  duplicate?: boolean;\n  format2?: string;\n  delimiter2?: string;\n  limit?: number;\n  delimiter3?: string;\n};\n\nexport type Responses = {\n  [key: string]: ResponseType;\n};\n","/**\n * Class representing SCORM 2004's `cmi.interactions` object\n */\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { CMIArray } from \"../common/array\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { check2004ValidFormat } from \"./validation\";\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport {\n  CorrectResponses,\n  LearnerResponses,\n} from \"../../constants/response_constants\";\n\nexport class CMIInteractions extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives` Array\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.interactions\",\n      children: scorm2004_constants.interactions_children,\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class for SCORM 2004's cmi.interaction.n object\n */\n\nexport class CMIInteractionsObject extends BaseCMI {\n  private _id = \"\";\n  private _type = \"\";\n  private _timestamp = \"\";\n  private _weighting = \"\";\n  private _learner_response = \"\";\n  private _result = \"\";\n  private _latency = \"\";\n  private _description = \"\";\n\n  /**\n   * Constructor for cmi.interaction.n\n   */\n  constructor() {\n    super(\"cmi.interactions.n\");\n    this.objectives = new CMIArray({\n      CMIElement: \"cmi.interactions.n.objectives\",\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: scorm2004_constants.objectives_children,\n    });\n    this.correct_responses = new CMIArray({\n      CMIElement: \"cmi.interactions.n.correct_responses\",\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: scorm2004_constants.correct_responses_children,\n    });\n  }\n\n  public objectives: CMIArray;\n  public correct_responses: CMIArray;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.objectives?.initialize();\n    this.correct_responses?.initialize();\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset() {\n    this._initialized = false;\n    this._id = \"\";\n    this._type = \"\";\n    this._timestamp = \"\";\n    this._weighting = \"\";\n    this._learner_response = \"\";\n    this._result = \"\";\n    this._latency = \"\";\n    this._description = \"\";\n    this.objectives = new CMIArray({\n      CMIElement: \"cmi.interactions.n.objectives\",\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: scorm2004_constants.objectives_children,\n    });\n    this.correct_responses = new CMIArray({\n      CMIElement: \"cmi.interactions.n.correct_responses\",\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n      children: scorm2004_constants.correct_responses_children,\n    });\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm2004_regex.CMILongIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _type\n   * @return {string}\n   */\n  get type(): string {\n    return this._type;\n  }\n\n  /**\n   * Setter for _type\n   * @param {string} type\n   */\n  set type(type: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".type\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".type\",\n          type,\n          scorm2004_regex.CMIType,\n        )\n      ) {\n        this._type = type;\n      }\n    }\n  }\n\n  /**\n   * Getter for _timestamp\n   * @return {string}\n   */\n  get timestamp(): string {\n    return this._timestamp;\n  }\n\n  /**\n   * Setter for _timestamp\n   * @param {string} timestamp\n   */\n  set timestamp(timestamp: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".timestamp\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".timestamp\",\n          timestamp,\n          scorm2004_regex.CMITime,\n        )\n      ) {\n        this._timestamp = timestamp;\n      }\n    }\n  }\n\n  /**\n   * Getter for _weighting\n   * @return {string}\n   */\n  get weighting(): string {\n    return this._weighting;\n  }\n\n  /**\n   * Setter for _weighting\n   * @param {string} weighting\n   */\n  set weighting(weighting: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".weighting\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".weighting\",\n          weighting,\n          scorm2004_regex.CMIDecimal,\n        )\n      ) {\n        this._weighting = weighting;\n      }\n    }\n  }\n\n  /**\n   * Getter for _learner_response\n   * @return {string}\n   */\n  get learner_response(): string {\n    return this._learner_response;\n  }\n\n  /**\n   * Setter for _learner_response. Does type validation to make sure response\n   * matches SCORM 2004's spec\n   * @param {string} learner_response\n   */\n  set learner_response(learner_response: string) {\n    if (this.initialized && (this._type === \"\" || this._id === \"\")) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".learner_response\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      let nodes = [];\n      const response_type = LearnerResponses[this.type];\n\n      if (response_type) {\n        if (response_type?.delimiter) {\n          // Convert regex-style delimiter to actual character\n          const delimiter =\n            response_type.delimiter === \"[,]\" ? \",\" : response_type.delimiter;\n          nodes = learner_response.split(delimiter);\n        } else {\n          nodes[0] = learner_response;\n        }\n\n        if (nodes.length > 0 && nodes.length <= response_type.max) {\n          const formatRegex = new RegExp(response_type.format);\n\n          for (let i = 0; i < nodes.length; i++) {\n            if (response_type?.delimiter2) {\n              // Convert regex-style delimiter to actual character\n              const delimiter2 =\n                response_type.delimiter2 === \"[.]\"\n                  ? \".\"\n                  : response_type.delimiter2;\n              const values = nodes[i].split(delimiter2);\n\n              if (values.length === 2) {\n                if (!values[0].match(formatRegex)) {\n                  throw new Scorm2004ValidationError(\n                    this._cmi_element + \".learner_response\",\n                    scorm2004_errors.TYPE_MISMATCH,\n                  );\n                } else {\n                  if (\n                    !response_type.format2 ||\n                    !values[1].match(new RegExp(response_type.format2))\n                  ) {\n                    throw new Scorm2004ValidationError(\n                      this._cmi_element + \".learner_response\",\n                      scorm2004_errors.TYPE_MISMATCH,\n                    );\n                  }\n                }\n              } else {\n                throw new Scorm2004ValidationError(\n                  this._cmi_element + \".learner_response\",\n                  scorm2004_errors.TYPE_MISMATCH,\n                );\n              }\n            } else {\n              if (!nodes[i].match(formatRegex)) {\n                throw new Scorm2004ValidationError(\n                  this._cmi_element + \".learner_response\",\n                  scorm2004_errors.TYPE_MISMATCH,\n                );\n              } else {\n                if (nodes[i] !== \"\" && response_type.unique) {\n                  for (let j = 0; j < i; j++) {\n                    if (nodes[i] === nodes[j]) {\n                      throw new Scorm2004ValidationError(\n                        this._cmi_element + \".learner_response\",\n                        scorm2004_errors.TYPE_MISMATCH,\n                      );\n                    }\n                  }\n                }\n              }\n            }\n          }\n        } else {\n          throw new Scorm2004ValidationError(\n            this._cmi_element + \".learner_response\",\n            scorm2004_errors.GENERAL_SET_FAILURE,\n          );\n        }\n\n        this._learner_response = learner_response;\n      } else {\n        throw new Scorm2004ValidationError(\n          this._cmi_element + \".learner_response\",\n          scorm2004_errors.TYPE_MISMATCH,\n        );\n      }\n    }\n  }\n\n  /**\n   * Getter for _result\n   * @return {string}\n   */\n  get result(): string {\n    return this._result;\n  }\n\n  /**\n   * Setter for _result\n   * @param {string} result\n   */\n  set result(result: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".result\",\n        result,\n        scorm2004_regex.CMIResult,\n      )\n    ) {\n      this._result = result;\n    }\n  }\n\n  /**\n   * Getter for _latency\n   * @return {string}\n   */\n  get latency(): string {\n    return this._latency;\n  }\n\n  /**\n   * Setter for _latency\n   * @param {string} latency\n   */\n  set latency(latency: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".latency\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".latency\",\n          latency,\n          scorm2004_regex.CMITimespan,\n        )\n      ) {\n        this._latency = latency;\n      }\n    }\n  }\n\n  /**\n   * Getter for _description\n   * @return {string}\n   */\n  get description(): string {\n    return this._description;\n  }\n\n  /**\n   * Setter for _description\n   * @param {string} description\n   */\n  set description(description: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".description\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".description\",\n          description,\n          scorm2004_regex.CMILangString250,\n          true,\n        )\n      ) {\n        this._description = description;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      type: string,\n   *      objectives: CMIArray,\n   *      timestamp: string,\n   *      correct_responses: CMIArray,\n   *      weighting: string,\n   *      learner_response: string,\n   *      result: string,\n   *      latency: string,\n   *      description: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    type: string;\n    objectives: CMIArray;\n    timestamp: string;\n    correct_responses: CMIArray;\n    weighting: string;\n    learner_response: string;\n    result: string;\n    latency: string;\n    description: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      type: this.type,\n      objectives: this.objectives,\n      timestamp: this.timestamp,\n      weighting: this.weighting,\n      learner_response: this.learner_response,\n      result: this.result,\n      latency: this.latency,\n      description: this.description,\n      correct_responses: this.correct_responses,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.interactions.n.objectives.n object\n */\nexport class CMIInteractionsObjectivesObject extends BaseCMI {\n  private _id = \"\";\n\n  /**\n   * Constructor for cmi.interactions.n.objectives.n\n   */\n  constructor() {\n    super(\"cmi.interactions.n.objectives.n\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset() {\n    this._initialized = false;\n    this._id = \"\";\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm2004_regex.CMILongIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n.objectives.n\n   * @return {\n   *    {\n   *      id: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.interactions.n.correct_responses.n object\n */\nexport class CMIInteractionsCorrectResponsesObject extends BaseCMI {\n  private _pattern = \"\";\n  private _parent?: CMIInteractionsObject;\n\n  /**\n   * Constructor for cmi.interactions.n.correct_responses.n\n   * @param {CMIInteractionsObject} parent - The parent interaction object\n   */\n  constructor(parent?: CMIInteractionsObject) {\n    super(\"cmi.interactions.n.correct_responses.n\");\n    this._parent = parent;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset() {\n    this._initialized = false;\n    this._pattern = \"\";\n  }\n\n  /**\n   * Getter for _pattern\n   * @return {string}\n   */\n  get pattern(): string {\n    return this._pattern;\n  }\n\n  /**\n   * Setter for _pattern\n   * @param {string} pattern\n   */\n  set pattern(pattern: string) {\n    // First do basic format validation\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".pattern\",\n        pattern,\n        scorm2004_regex.CMIFeedback,\n      )\n    ) {\n      // If we have a parent interaction, validate the pattern against the interaction type\n      if (this._parent && this._parent.type) {\n        const interactionType = this._parent.type;\n        const response = CorrectResponses[interactionType];\n\n        if (response) {\n          // Validate the pattern against the interaction type\n          let isValid = true;\n          let nodes = [];\n\n          if (response?.delimiter) {\n            nodes = String(pattern).split(response.delimiter);\n          } else {\n            nodes[0] = pattern;\n          }\n\n          if (nodes.length > 0 && nodes.length <= response.max) {\n            const formatRegex = new RegExp(response.format);\n\n            for (let i = 0; i < nodes.length && isValid; i++) {\n              if (response?.delimiter2) {\n                const values = nodes[i].split(response.delimiter2);\n                if (values.length === 2) {\n                  const matches = values[0].match(formatRegex);\n                  if (!matches) {\n                    isValid = false;\n                  } else if (\n                    !response.format2 ||\n                    !values[1].match(new RegExp(response.format2))\n                  ) {\n                    isValid = false;\n                  }\n                } else {\n                  isValid = false;\n                }\n              } else {\n                const matches = nodes[i].match(formatRegex);\n                if (\n                  (!matches && pattern !== \"\") ||\n                  (!matches && interactionType === \"true-false\")\n                ) {\n                  isValid = false;\n                }\n              }\n            }\n          } else if (nodes.length > response.max) {\n            isValid = false;\n          }\n\n          if (!isValid) {\n            throw new Scorm2004ValidationError(\n              this._cmi_element + \".pattern\",\n              scorm2004_errors.TYPE_MISMATCH,\n            );\n          }\n        }\n      }\n\n      this._pattern = pattern;\n    }\n  }\n\n  /**\n   * toJSON cmi.interactions.n.correct_responses.n object\n   * @return {\n   *    {\n   *      pattern: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    pattern: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      pattern: this.pattern,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Class for SCORM 2004's cmi *.score object\n */\nimport { CMIScore } from \"../common/score\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\n\nexport class Scorm2004CMIScore extends CMIScore {\n  private _scaled = \"\";\n\n  /**\n   * Constructor for cmi *.score\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.score\",\n      score_children: scorm2004_constants.score_children,\n      max: \"\",\n      invalidErrorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      invalidTypeCode: scorm2004_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm2004_errors.VALUE_OUT_OF_RANGE,\n      decimalRegex: scorm2004_regex.CMIDecimal,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset(): void {\n    this._initialized = false;\n    this._scaled = \"\";\n    this._raw = \"\";\n    this._min = \"\";\n    this._max = \"\";\n  }\n\n  /**\n   * Getter for _scaled\n   * @return {string}\n   */\n  get scaled(): string {\n    return this._scaled;\n  }\n\n  /**\n   * Setter for _scaled\n   * @param {string} scaled\n   */\n  set scaled(scaled: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".scaled\",\n        scaled,\n        scorm2004_regex.CMIDecimal,\n      ) &&\n      check2004ValidRange(\n        this._cmi_element + \".scaled\",\n        scaled,\n        scorm2004_regex.scaled_range,\n      )\n    ) {\n      this._scaled = scaled;\n    }\n  }\n\n  /**\n   * toJSON for cmi *.score\n   *\n   * @return {\n   *    {\n   *      scaled: string,\n   *      raw: string,\n   *      min: string,\n   *      max: string\n   *    }\n   *  }\n   */\n  override toJSON(): {\n    scaled: string;\n    raw: string;\n    min: string;\n    max: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      scaled: this.scaled,\n      raw: this.raw,\n      min: this.min,\n      max: this.max,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat } from \"./validation\";\nimport { scorm2004_regex } from \"../../constants/regex\";\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_lms object\n * @extends CMIArray\n */\nexport class CMICommentsFromLMS extends CMIArray {\n  /**\n   * Constructor for cmi.comments_from_lms Array\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.comments_from_lms\",\n      children: scorm2004_constants.comments_children,\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_learner object\n */\n\nexport class CMICommentsFromLearner extends CMIArray {\n  /**\n   * Constructor for cmi.comments_from_learner Array\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.comments_from_learner\",\n      children: scorm2004_constants.comments_children,\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 2004's cmi.comments_from_learner.n and cmi.comments_from_lms.n object\n */\n\nexport class CMICommentsObject extends BaseCMI {\n  private _comment = \"\";\n  private _location = \"\";\n  private _timestamp = \"\";\n  private readonly _readOnlyAfterInit: boolean;\n\n  /**\n   * Constructor for cmi.comments_from_learner.n and cmi.comments_from_lms.n\n   * @param {boolean} readOnlyAfterInit\n   */\n  constructor(readOnlyAfterInit: boolean = false) {\n    super(\"cmi.comments_from_learner.n\");\n    this._comment = \"\";\n    this._location = \"\";\n    this._timestamp = \"\";\n    this._readOnlyAfterInit = readOnlyAfterInit;\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for _comment\n   * @return {string}\n   */\n  get comment(): string {\n    return this._comment;\n  }\n\n  /**\n   * Setter for _comment\n   * @param {string} comment\n   */\n  set comment(comment: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".comment\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".comment\",\n          comment,\n          scorm2004_regex.CMILangString4000,\n          true,\n        )\n      ) {\n        this._comment = comment;\n      }\n    }\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this._location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".location\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".location\",\n          location,\n          scorm2004_regex.CMIString250,\n        )\n      ) {\n        this._location = location;\n      }\n    }\n  }\n\n  /**\n   * Getter for _timestamp\n   * @return {string}\n   */\n  get timestamp(): string {\n    return this._timestamp;\n  }\n\n  /**\n   * Setter for _timestamp\n   * @param {string} timestamp\n   */\n  set timestamp(timestamp: string) {\n    if (this.initialized && this._readOnlyAfterInit) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".timestamp\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".timestamp\",\n          timestamp,\n          scorm2004_regex.CMITime,\n        )\n      ) {\n        this._timestamp = timestamp;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.comments_from_learner.n object\n   * @return {\n   *    {\n   *      comment: string,\n   *      location: string,\n   *      timestamp: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    comment: string;\n    location: string;\n    timestamp: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      comment: this.comment,\n      location: this.location,\n      timestamp: this.timestamp,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { Scorm2004CMIScore } from \"./score\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\n\n/**\n * Class representing SCORM 2004's `cmi.objectives` object\n * @extends CMIArray\n */\nexport class CMIObjectives extends CMIArray {\n  /**\n   * Constructor for `cmi.objectives` Array\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.objectives\",\n      children: scorm2004_constants.objectives_children,\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n\n  /**\n   * Find an objective by its ID\n   */\n  public findObjectiveById(id: string): CMIObjectivesObject | undefined {\n    return this.childArray.find((objective) => objective.id === id);\n  }\n\n  /**\n   * Find objective by its index\n   */\n  public findObjectiveByIndex(index: number): CMIObjectivesObject {\n    return this.childArray[index];\n  }\n\n  /**\n   * Set an objective at the given index\n   */\n  public setObjectiveByIndex(index: number, objective: CMIObjectivesObject) {\n    this.childArray[index] = objective;\n  }\n}\n\n/**\n * Class for SCORM 2004's cmi.objectives.n object\n */\nexport class CMIObjectivesObject extends BaseCMI {\n  private _id = \"\";\n  private _success_status = \"unknown\";\n  private _completion_status = \"unknown\";\n  private _progress_measure = \"\";\n  private _description = \"\";\n\n  /**\n   * Constructor for cmi.objectives.n\n   */\n  constructor() {\n    super(\"cmi.objectives.n\");\n    this.score = new Scorm2004CMIScore();\n  }\n\n  override reset() {\n    this._initialized = false;\n  }\n\n  public score: Scorm2004CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.score?.initialize();\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm2004_regex.CMILongIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _success_status\n   * @return {string}\n   */\n  get success_status(): string {\n    return this._success_status;\n  }\n\n  /**\n   * Setter for _success_status\n   * @param {string} success_status\n   */\n  set success_status(success_status: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".success_status\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".success_status\",\n          success_status,\n          scorm2004_regex.CMISStatus,\n        )\n      ) {\n        this._success_status = success_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _completion_status\n   * @return {string}\n   */\n  get completion_status(): string {\n    return this._completion_status;\n  }\n\n  /**\n   * Setter for _completion_status\n   * @param {string} completion_status\n   */\n  set completion_status(completion_status: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".completion_status\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".completion_status\",\n          completion_status,\n          scorm2004_regex.CMICStatus,\n        )\n      ) {\n        this._completion_status = completion_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _progress_measure\n   * @return {string}\n   */\n  get progress_measure(): string {\n    return this._progress_measure;\n  }\n\n  /**\n   * Setter for _progress_measure\n   * @param {string} progress_measure\n   */\n  set progress_measure(progress_measure: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".progress_measure\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".progress_measure\",\n          progress_measure,\n          scorm2004_regex.CMIDecimal,\n        ) &&\n        check2004ValidRange(\n          this._cmi_element + \".progress_measure\",\n          progress_measure,\n          scorm2004_regex.progress_range,\n        )\n      ) {\n        this._progress_measure = progress_measure;\n      }\n    }\n  }\n\n  /**\n   * Getter for _description\n   * @return {string}\n   */\n  get description(): string {\n    return this._description;\n  }\n\n  /**\n   * Setter for _description\n   * @param {string} description\n   */\n  set description(description: string) {\n    if (this.initialized && this._id === \"\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".description\",\n        scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED,\n      );\n    } else {\n      if (\n        check2004ValidFormat(\n          this._cmi_element + \".description\",\n          description,\n          scorm2004_regex.CMILangString250,\n          true,\n        )\n      ) {\n        this._description = description;\n      }\n    }\n  }\n\n  /**\n   * toJSON for cmi.objectives.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      success_status: string,\n   *      completion_status: string,\n   *      progress_measure: string,\n   *      description: string,\n   *      score: Scorm2004CMIScore\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    success_status: string;\n    completion_status: string;\n    progress_measure: string;\n    description: string;\n    score: Scorm2004CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      success_status: this.success_status,\n      completion_status: this.completion_status,\n      progress_measure: this.progress_measure,\n      description: this.description,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Class representing metadata properties for SCORM 2004's cmi object\n */\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\n\n/**\n * Class representing metadata properties for SCORM 2004's cmi object\n */\nexport class CMIMetadata extends BaseCMI {\n  private __version = \"1.0\";\n  private __children = scorm2004_constants.cmi_children;\n\n  /**\n   * Constructor for CMIMetadata\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for __version\n   * @return {string}\n   */\n  get _version(): string {\n    return this.__version;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _version\n   */\n  set _version(_version: string) {\n    throw new Scorm2004ValidationError(\n      this._cmi_element + \"._version\",\n      scorm2004_errors.READ_ONLY_ELEMENT,\n    );\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {number} _children\n   */\n  set _children(_children: number) {\n    throw new Scorm2004ValidationError(\n      this._cmi_element + \"._children\",\n      scorm2004_errors.READ_ONLY_ELEMENT,\n    );\n  }\n\n  /**\n   * Reset the metadata properties\n   */\n  reset(): void {\n    this._initialized = false;\n    // No need to reset __version and __children as they are constants\n  }\n}\n","/**\n * Class representing learner properties for SCORM 2004's cmi object\n */\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\n\n/**\n * Class representing learner properties for SCORM 2004's cmi object\n */\nexport class CMILearner extends BaseCMI {\n  private _learner_id = \"\";\n  private _learner_name = \"\";\n\n  /**\n   * Constructor for CMILearner\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _learner_id\n   * @return {string}\n   */\n  get learner_id(): string {\n    return this._learner_id;\n  }\n\n  /**\n   * Setter for _learner_id. Can only be called before initialization.\n   * @param {string} learner_id\n   */\n  set learner_id(learner_id: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".learner_id\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._learner_id = learner_id;\n    }\n  }\n\n  /**\n   * Getter for _learner_name\n   * @return {string}\n   */\n  get learner_name(): string {\n    return this._learner_name;\n  }\n\n  /**\n   * Setter for _learner_name. Can only be called before initialization.\n   * @param {string} learner_name\n   */\n  set learner_name(learner_name: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".learner_name\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._learner_name = learner_name;\n    }\n  }\n\n  /**\n   * Reset the learner properties\n   */\n  reset(): void {\n    this._initialized = false;\n    // Don't reset learner_id and learner_name as they are read-only after initialization\n  }\n}\n","/**\n * Class representing status properties for SCORM 2004's cmi object\n */\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat, check2004ValidRange } from \"./validation\";\n\n/**\n * Class representing status properties for SCORM 2004's cmi object\n */\nexport class CMIStatus extends BaseCMI {\n  private _completion_status = \"unknown\";\n  private _success_status = \"unknown\";\n  private _progress_measure = \"\";\n\n  /**\n   * Constructor for CMIStatus\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _completion_status\n   * @return {string}\n   */\n  get completion_status(): string {\n    return this._completion_status;\n  }\n\n  /**\n   * Setter for _completion_status\n   * @param {string} completion_status\n   */\n  set completion_status(completion_status: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".completion_status\",\n        completion_status,\n        scorm2004_regex.CMICStatus,\n      )\n    ) {\n      this._completion_status = completion_status;\n    }\n  }\n\n  /**\n   * Getter for _success_status\n   * @return {string}\n   */\n  get success_status(): string {\n    return this._success_status;\n  }\n\n  /**\n   * Setter for _success_status\n   * @param {string} success_status\n   */\n  set success_status(success_status: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".success_status\",\n        success_status,\n        scorm2004_regex.CMISStatus,\n      )\n    ) {\n      this._success_status = success_status;\n    }\n  }\n\n  /**\n   * Getter for _progress_measure\n   * @return {string}\n   */\n  get progress_measure(): string {\n    return this._progress_measure;\n  }\n\n  /**\n   * Setter for _progress_measure\n   * @param {string} progress_measure\n   */\n  set progress_measure(progress_measure: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".progress_measure\",\n        progress_measure,\n        scorm2004_regex.CMIDecimal,\n      ) &&\n      check2004ValidRange(\n        this._cmi_element + \".progress_measure\",\n        progress_measure,\n        scorm2004_regex.progress_range,\n      )\n    ) {\n      this._progress_measure = progress_measure;\n    }\n  }\n\n  /**\n   * Reset the status properties\n   */\n  reset(): void {\n    this._initialized = false;\n    this._completion_status = \"unknown\";\n    this._success_status = \"unknown\";\n    this._progress_measure = \"\";\n  }\n}\n","/**\n * Class representing session properties for SCORM 2004's cmi object\n */\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat } from \"./validation\";\nimport * as Util from \"../../utilities\";\n\n/**\n * Class representing session properties for SCORM 2004's cmi object\n */\nexport class CMISession extends BaseCMI {\n  private _entry = \"\";\n  private _exit = \"\";\n  private _session_time = \"PT0H0M0S\";\n  private _total_time = \"\";\n\n  /**\n   * Constructor for CMISession\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _entry\n   * @return {string}\n   */\n  get entry(): string {\n    return this._entry;\n  }\n\n  /**\n   * Setter for _entry. Can only be called before initialization.\n   * @param {string} entry\n   */\n  set entry(entry: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".entry\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._entry = entry;\n    }\n  }\n\n  /**\n   * Getter for _exit. Should only be called during JSON export.\n   * @return {string}\n   */\n  get exit(): string {\n    if (!this.jsonString) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".exit\",\n        scorm2004_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._exit;\n  }\n\n  /**\n   * Setter for _exit\n   * @param {string} exit\n   */\n  set exit(exit: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".exit\",\n        exit,\n        scorm2004_regex.CMIExit,\n        true,\n      )\n    ) {\n      this._exit = exit;\n    }\n  }\n\n  /**\n   * Getter for _session_time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get session_time(): string {\n    if (!this.jsonString) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".session_time\",\n        scorm2004_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._session_time;\n  }\n\n  /**\n   * Setter for _session_time\n   * @param {string} session_time\n   */\n  set session_time(session_time: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".session_time\",\n        session_time,\n        scorm2004_regex.CMITimespan,\n      )\n    ) {\n      this._session_time = session_time;\n    }\n  }\n\n  /**\n   * Getter for _total_time\n   * @return {string}\n   */\n  get total_time(): string {\n    return this._total_time;\n  }\n\n  /**\n   * Setter for _total_time. Can only be called before initialization.\n   * @param {string} total_time\n   */\n  set total_time(total_time: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".total_time\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._total_time = total_time;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   *\n   * @return {string} ISO8601 Duration\n   */\n  getCurrentTotalTime(): string {\n    let sessionTime = this._session_time;\n    const startTime = this.start_time;\n\n    if (typeof startTime !== \"undefined\" && startTime !== null) {\n      const seconds = new Date().getTime() - startTime;\n      sessionTime = Util.getSecondsAsISODuration(seconds / 1000);\n    }\n\n    return Util.addTwoDurations(\n      this._total_time,\n      sessionTime,\n      scorm2004_regex.CMITimespan,\n    );\n  }\n\n  /**\n   * Reset the session properties\n   */\n  reset(): void {\n    this._initialized = false;\n    this._entry = \"\";\n    this._exit = \"\";\n    this._session_time = \"PT0H0M0S\";\n    // Don't reset total_time as it's read-only after initialization\n  }\n}\n","/**\n * Class representing content properties for SCORM 2004's cmi object\n */\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check2004ValidFormat } from \"./validation\";\n\n/**\n * Class representing content properties for SCORM 2004's cmi object\n */\nexport class CMIContent extends BaseCMI {\n  private _location = \"\";\n  private _launch_data = \"\";\n  private _suspend_data = \"\";\n\n  /**\n   * Constructor for CMIContent\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this._location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".location\",\n        location,\n        scorm2004_regex.CMIString1000,\n      )\n    ) {\n      this._location = location;\n    }\n  }\n\n  /**\n   * Getter for _launch_data\n   * @return {string}\n   */\n  get launch_data(): string {\n    return this._launch_data;\n  }\n\n  /**\n   * Setter for _launch_data. Can only be called before initialization.\n   * @param {string} launch_data\n   */\n  set launch_data(launch_data: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".launch_data\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._launch_data = launch_data;\n    }\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this._suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".suspend_data\",\n        suspend_data,\n        scorm2004_regex.CMIString64000,\n        true,\n      )\n    ) {\n      this._suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Reset the content properties\n   */\n  reset(): void {\n    this._initialized = false;\n    this._location = \"\";\n    // Don't reset launch_data as it's read-only after initialization\n    this._suspend_data = \"\";\n  }\n}\n","/**\n * Class representing settings properties for SCORM 2004's cmi object\n */\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\n\n/**\n * Class representing settings properties for SCORM 2004's cmi object\n */\nexport class CMISettings extends BaseCMI {\n  private _credit = \"credit\";\n  private _mode = \"normal\";\n  private _time_limit_action = \"continue,no message\";\n  private _max_time_allowed = \"\";\n\n  /**\n   * Constructor for CMISettings\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _credit\n   * @return {string}\n   */\n  get credit(): string {\n    return this._credit;\n  }\n\n  /**\n   * Setter for _credit. Can only be called before initialization.\n   * @param {string} credit\n   */\n  set credit(credit: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".credit\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._credit = credit;\n    }\n  }\n\n  /**\n   * Getter for _mode\n   * @return {string}\n   */\n  get mode(): string {\n    return this._mode;\n  }\n\n  /**\n   * Setter for _mode. Can only be called before initialization.\n   * @param {string} mode\n   */\n  set mode(mode: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".mode\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._mode = mode;\n    }\n  }\n\n  /**\n   * Getter for _time_limit_action\n   * @return {string}\n   */\n  get time_limit_action(): string {\n    return this._time_limit_action;\n  }\n\n  /**\n   * Setter for _time_limit_action. Can only be called before initialization.\n   * @param {string} time_limit_action\n   */\n  set time_limit_action(time_limit_action: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".time_limit_action\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._time_limit_action = time_limit_action;\n    }\n  }\n\n  /**\n   * Getter for _max_time_allowed\n   * @return {string}\n   */\n  get max_time_allowed(): string {\n    return this._max_time_allowed;\n  }\n\n  /**\n   * Setter for _max_time_allowed. Can only be called before initialization.\n   * @param {string} max_time_allowed\n   */\n  set max_time_allowed(max_time_allowed: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".max_time_allowed\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._max_time_allowed = max_time_allowed;\n    }\n  }\n\n  /**\n   * Reset the settings properties\n   */\n  reset(): void {\n    this._initialized = false;\n    // Don't reset these properties as they are read-only after initialization\n  }\n}\n","/**\n * Class representing threshold properties for SCORM 2004's cmi object\n */\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\n\n/**\n * Class representing threshold properties for SCORM 2004's cmi object\n */\nexport class CMIThresholds extends BaseCMI {\n  private _scaled_passing_score = \"\";\n  private _completion_threshold = \"\";\n\n  /**\n   * Constructor for CMIThresholds\n   */\n  constructor() {\n    super(\"cmi\");\n  }\n\n  /**\n   * Getter for _scaled_passing_score\n   * @return {string}\n   */\n  get scaled_passing_score(): string {\n    return this._scaled_passing_score;\n  }\n\n  /**\n   * Setter for _scaled_passing_score. Can only be called before initialization.\n   * @param {string} scaled_passing_score\n   */\n  set scaled_passing_score(scaled_passing_score: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".scaled_passing_score\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._scaled_passing_score = scaled_passing_score;\n    }\n  }\n\n  /**\n   * Getter for _completion_threshold\n   * @return {string}\n   */\n  get completion_threshold(): string {\n    return this._completion_threshold;\n  }\n\n  /**\n   * Setter for _completion_threshold. Can only be called before initialization.\n   * @param {string} completion_threshold\n   */\n  set completion_threshold(completion_threshold: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".completion_threshold\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._completion_threshold = completion_threshold;\n    }\n  }\n\n  /**\n   * Reset the threshold properties\n   */\n  reset(): void {\n    this._initialized = false;\n    // Don't reset these properties as they are read-only after initialization\n  }\n}\n","import { BaseRootCMI } from \"../common/base_cmi\";\nimport { CMILearnerPreference } from \"./learner_preference\";\nimport { CMIInteractions } from \"./interactions\";\nimport { Scorm2004CMIScore } from \"./score\";\nimport { CMICommentsFromLearner, CMICommentsFromLMS } from \"./comments\";\nimport { CMIObjectives } from \"./objectives\";\nimport { CMIMetadata } from \"./metadata\";\nimport { CMILearner } from \"./learner\";\nimport { CMIStatus } from \"./status\";\nimport { CMISession } from \"./session\";\nimport { CMIContent } from \"./content\";\nimport { CMISettings } from \"./settings\";\nimport { CMIThresholds } from \"./thresholds\";\n\n/**\n * Class representing cmi object for SCORM 2004\n */\nexport class CMI extends BaseRootCMI {\n  /**\n   * Constructor for the SCORM 2004 cmi object\n   * @param {boolean} initialized\n   */\n  constructor(initialized: boolean = false) {\n    super(\"cmi\");\n    this.metadata = new CMIMetadata();\n    this.learner = new CMILearner();\n    this.status = new CMIStatus();\n    this.session = new CMISession();\n    this.content = new CMIContent();\n    this.settings = new CMISettings();\n    this.thresholds = new CMIThresholds();\n    this.learner_preference = new CMILearnerPreference();\n    this.score = new Scorm2004CMIScore();\n    this.comments_from_learner = new CMICommentsFromLearner();\n    this.comments_from_lms = new CMICommentsFromLMS();\n    this.interactions = new CMIInteractions();\n    this.objectives = new CMIObjectives();\n    if (initialized) this.initialize();\n  }\n\n  // New component classes\n  private metadata: CMIMetadata;\n  private learner: CMILearner;\n  private status: CMIStatus;\n  private session: CMISession;\n  private content: CMIContent;\n  private settings: CMISettings;\n  private thresholds: CMIThresholds;\n\n  // Original complex objects\n  public learner_preference: CMILearnerPreference;\n  public score: Scorm2004CMIScore;\n  public comments_from_learner: CMICommentsFromLearner;\n  public comments_from_lms: CMICommentsFromLMS;\n  public interactions: CMIInteractions;\n  public objectives: CMIObjectives;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    // Initialize new component classes\n    this.metadata?.initialize();\n    this.learner?.initialize();\n    this.status?.initialize();\n    this.session?.initialize();\n    this.content?.initialize();\n    this.settings?.initialize();\n    this.thresholds?.initialize();\n\n    // Initialize original complex objects\n    this.learner_preference?.initialize();\n    this.score?.initialize();\n    this.comments_from_learner?.initialize();\n    this.comments_from_lms?.initialize();\n    this.interactions?.initialize();\n    this.objectives?.initialize();\n  }\n\n  /**\n   * Called when API is moving to another SCO\n   */\n  reset() {\n    this._initialized = false;\n\n    // Reset new component classes\n    this.metadata?.reset();\n    this.learner?.reset();\n    this.status?.reset();\n    this.session?.reset();\n    this.content?.reset();\n    this.settings?.reset();\n    this.thresholds?.reset();\n\n    // Reset original complex objects\n    this.objectives?.reset(false);\n    this.interactions?.reset(true);\n    this.score?.reset();\n    this.comments_from_learner?.reset();\n    this.comments_from_lms?.reset();\n    this.learner_preference?.reset();\n  }\n\n  /**\n   * Getter for __version\n   * @return {string}\n   * @private\n   */\n  get _version(): string {\n    return this.metadata._version;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _version\n   * @private\n   */\n  set _version(_version: string) {\n    this.metadata._version = _version;\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.metadata._children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {number} _children\n   * @private\n   */\n  set _children(_children: number) {\n    this.metadata._children = _children;\n  }\n\n  /**\n   * Getter for _completion_status\n   * @return {string}\n   */\n  get completion_status(): string {\n    return this.status.completion_status;\n  }\n\n  /**\n   * Setter for _completion_status\n   * @param {string} completion_status\n   */\n  set completion_status(completion_status: string) {\n    this.status.completion_status = completion_status;\n  }\n\n  /**\n   * Getter for _completion_threshold\n   * @return {string}\n   */\n  get completion_threshold(): string {\n    return this.thresholds.completion_threshold;\n  }\n\n  /**\n   * Setter for _completion_threshold. Can only be called before initialization.\n   * @param {string} completion_threshold\n   */\n  set completion_threshold(completion_threshold: string) {\n    this.thresholds.completion_threshold = completion_threshold;\n  }\n\n  /**\n   * Getter for _credit\n   * @return {string}\n   */\n  get credit(): string {\n    return this.settings.credit;\n  }\n\n  /**\n   * Setter for _credit. Can only be called before initialization.\n   * @param {string} credit\n   */\n  set credit(credit: string) {\n    this.settings.credit = credit;\n  }\n\n  /**\n   * Getter for _entry\n   * @return {string}\n   */\n  get entry(): string {\n    return this.session.entry;\n  }\n\n  /**\n   * Setter for _entry. Can only be called before initialization.\n   * @param {string} entry\n   */\n  set entry(entry: string) {\n    this.session.entry = entry;\n  }\n\n  /**\n   * Getter for _exit. Should only be called during JSON export.\n   * @return {string}\n   */\n  get exit(): string {\n    this.session.jsonString = this.jsonString;\n    return this.session.exit;\n  }\n\n  /**\n   * Setter for _exit\n   * @param {string} exit\n   */\n  set exit(exit: string) {\n    this.session.exit = exit;\n  }\n\n  /**\n   * Getter for _launch_data\n   * @return {string}\n   */\n  get launch_data(): string {\n    return this.content.launch_data;\n  }\n\n  /**\n   * Setter for _launch_data. Can only be called before initialization.\n   * @param {string} launch_data\n   */\n  set launch_data(launch_data: string) {\n    this.content.launch_data = launch_data;\n  }\n\n  /**\n   * Getter for _learner_id\n   * @return {string}\n   */\n  get learner_id(): string {\n    return this.learner.learner_id;\n  }\n\n  /**\n   * Setter for _learner_id. Can only be called before initialization.\n   * @param {string} learner_id\n   */\n  set learner_id(learner_id: string) {\n    this.learner.learner_id = learner_id;\n  }\n\n  /**\n   * Getter for _learner_name\n   * @return {string}\n   */\n  get learner_name(): string {\n    return this.learner.learner_name;\n  }\n\n  /**\n   * Setter for _learner_name. Can only be called before initialization.\n   * @param {string} learner_name\n   */\n  set learner_name(learner_name: string) {\n    this.learner.learner_name = learner_name;\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this.content.location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    this.content.location = location;\n  }\n\n  /**\n   * Getter for _max_time_allowed\n   * @return {string}\n   */\n  get max_time_allowed(): string {\n    return this.settings.max_time_allowed;\n  }\n\n  /**\n   * Setter for _max_time_allowed. Can only be called before initialization.\n   * @param {string} max_time_allowed\n   */\n  set max_time_allowed(max_time_allowed: string) {\n    this.settings.max_time_allowed = max_time_allowed;\n  }\n\n  /**\n   * Getter for _mode\n   * @return {string}\n   */\n  get mode(): string {\n    return this.settings.mode;\n  }\n\n  /**\n   * Setter for _mode. Can only be called before initialization.\n   * @param {string} mode\n   */\n  set mode(mode: string) {\n    this.settings.mode = mode;\n  }\n\n  /**\n   * Getter for _progress_measure\n   * @return {string}\n   */\n  get progress_measure(): string {\n    return this.status.progress_measure;\n  }\n\n  /**\n   * Setter for _progress_measure\n   * @param {string} progress_measure\n   */\n  set progress_measure(progress_measure: string) {\n    this.status.progress_measure = progress_measure;\n  }\n\n  /**\n   * Getter for _scaled_passing_score\n   * @return {string}\n   */\n  get scaled_passing_score(): string {\n    return this.thresholds.scaled_passing_score;\n  }\n\n  /**\n   * Setter for _scaled_passing_score. Can only be called before initialization.\n   * @param {string} scaled_passing_score\n   */\n  set scaled_passing_score(scaled_passing_score: string) {\n    this.thresholds.scaled_passing_score = scaled_passing_score;\n  }\n\n  /**\n   * Getter for _session_time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get session_time(): string {\n    this.session.jsonString = this.jsonString;\n    return this.session.session_time;\n  }\n\n  /**\n   * Setter for _session_time\n   * @param {string} session_time\n   */\n  set session_time(session_time: string) {\n    this.session.session_time = session_time;\n  }\n\n  /**\n   * Getter for _success_status\n   * @return {string}\n   */\n  get success_status(): string {\n    return this.status.success_status;\n  }\n\n  /**\n   * Setter for _success_status\n   * @param {string} success_status\n   */\n  set success_status(success_status: string) {\n    this.status.success_status = success_status;\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this.content.suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    this.content.suspend_data = suspend_data;\n  }\n\n  /**\n   * Getter for _time_limit_action\n   * @return {string}\n   */\n  get time_limit_action(): string {\n    return this.settings.time_limit_action;\n  }\n\n  /**\n   * Setter for _time_limit_action. Can only be called before initialization.\n   * @param {string} time_limit_action\n   */\n  set time_limit_action(time_limit_action: string) {\n    this.settings.time_limit_action = time_limit_action;\n  }\n\n  /**\n   * Getter for _total_time\n   * @return {string}\n   */\n  get total_time(): string {\n    return this.session.total_time;\n  }\n\n  /**\n   * Setter for _total_time. Can only be called before initialization.\n   * @param {string} total_time\n   */\n  set total_time(total_time: string) {\n    this.session.total_time = total_time;\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   *\n   * @return {string} ISO8601 Duration\n   */\n  getCurrentTotalTime(): string {\n    return this.session.getCurrentTotalTime();\n  }\n\n  /**\n   * toJSON for cmi\n   *\n   * @return {\n   *    {\n   *      comments_from_learner: CMICommentsFromLearner,\n   *      comments_from_lms: CMICommentsFromLMS,\n   *      completion_status: string,\n   *      completion_threshold: string,\n   *      credit: string,\n   *      entry: string,\n   *      exit: string,\n   *      interactions: CMIInteractions,\n   *      launch_data: string,\n   *      learner_id: string,\n   *      learner_name: string,\n   *      learner_preference: CMILearnerPreference,\n   *      location: string,\n   *      max_time_allowed: string,\n   *      mode: string,\n   *      objectives: CMIObjectives,\n   *      progress_measure: string,\n   *      scaled_passing_score: string,\n   *      score: Scorm2004CMIScore,\n   *      session_time: string,\n   *      success_status: string,\n   *      suspend_data: string,\n   *      time_limit_action: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    comments_from_learner: CMICommentsFromLearner;\n    comments_from_lms: CMICommentsFromLMS;\n    completion_status: string;\n    completion_threshold: string;\n    credit: string;\n    entry: string;\n    exit: string;\n    interactions: CMIInteractions;\n    launch_data: string;\n    learner_id: string;\n    learner_name: string;\n    learner_preference: CMILearnerPreference;\n    location: string;\n    max_time_allowed: string;\n    mode: string;\n    objectives: CMIObjectives;\n    progress_measure: string;\n    scaled_passing_score: string;\n    score: Scorm2004CMIScore;\n    session_time: string;\n    success_status: string;\n    suspend_data: string;\n    time_limit_action: string;\n  } {\n    this.jsonString = true;\n\n    // Set jsonString flag on component classes that need it\n    this.session.jsonString = true;\n\n    const result = {\n      comments_from_learner: this.comments_from_learner,\n      comments_from_lms: this.comments_from_lms,\n      completion_status: this.completion_status,\n      completion_threshold: this.completion_threshold,\n      credit: this.credit,\n      entry: this.entry,\n      exit: this.exit,\n      interactions: this.interactions,\n      launch_data: this.launch_data,\n      learner_id: this.learner_id,\n      learner_name: this.learner_name,\n      learner_preference: this.learner_preference,\n      location: this.location,\n      max_time_allowed: this.max_time_allowed,\n      mode: this.mode,\n      objectives: this.objectives,\n      progress_measure: this.progress_measure,\n      scaled_passing_score: this.scaled_passing_score,\n      score: this.score,\n      session_time: this.session_time,\n      success_status: this.success_status,\n      suspend_data: this.suspend_data,\n      time_limit_action: this.time_limit_action,\n    };\n\n    // Clean up jsonString flags\n    delete this.jsonString;\n    delete this.session.jsonString;\n\n    return result;\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { Scorm2004ValidationError } from \"../../exceptions/scorm2004_exceptions\";\nimport { check2004ValidFormat } from \"./validation\";\nimport { scorm2004_regex } from \"../../constants/regex\";\nimport { NAVBoolean } from \"../../constants/enums\";\nimport { CMIArray } from \"../common/array\";\nimport { scorm2004_constants } from \"../../constants/api_constants\";\nimport { scorm2004_errors } from \"../../constants/error_codes\";\nimport { Sequencing } from \"./sequencing/sequencing\";\n\n/**\n * Class representing SCORM 2004's adl object\n */\nexport class ADL extends BaseCMI {\n  /**\n   * Constructor for adl\n   */\n  constructor() {\n    super(\"adl\");\n    this.nav = new ADLNav();\n    this.data = new ADLData();\n  }\n\n  public nav: ADLNav;\n  public data = new ADLData();\n  private _sequencing: Sequencing | null = null;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.nav?.initialize();\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this.nav?.reset();\n  }\n\n  /**\n   * Getter for sequencing\n   * @return {Sequencing | null}\n   */\n  get sequencing(): Sequencing | null {\n    return this._sequencing;\n  }\n\n  /**\n   * Setter for sequencing\n   * @param {Sequencing | null} sequencing\n   */\n  set sequencing(sequencing: Sequencing | null) {\n    this._sequencing = sequencing;\n    if (sequencing) {\n      sequencing.adlNav = this.nav;\n      this.nav.sequencing = sequencing;\n    }\n  }\n\n  /**\n   * toJSON for adl\n   * @return {\n   *    {\n   *      nav: ADLNav,\n   *      data: ADLData\n   *    }\n   *  }\n   */\n  toJSON(): {\n    nav: ADLNav;\n    data: ADLData;\n  } {\n    this.jsonString = true;\n    const result = {\n      nav: this.nav,\n      data: this.data,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's `adl.nav` object\n */\n\nexport class ADLNav extends BaseCMI {\n  private _request = \"_none_\";\n  private _sequencing: Sequencing | null = null;\n\n  /**\n   * Constructor for `adl.nav`\n   */\n  constructor() {\n    super(\"adl.nav\");\n    this.request_valid = new ADLNavRequestValid();\n  }\n\n  public request_valid: ADLNavRequestValid;\n\n  /**\n   * Getter for sequencing\n   * @return {Sequencing | null}\n   */\n  get sequencing(): Sequencing | null {\n    return this._sequencing;\n  }\n\n  /**\n   * Setter for sequencing\n   * @param {Sequencing | null} sequencing\n   */\n  set sequencing(sequencing: Sequencing | null) {\n    this._sequencing = sequencing;\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.request_valid?.initialize();\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._request = \"_none_\";\n    this._sequencing = null;\n    this.request_valid?.reset();\n  }\n\n  /**\n   * Getter for _request\n   * @return {string}\n   */\n  get request(): string {\n    return this._request;\n  }\n\n  /**\n   * Setter for _request\n   * @param {string} request\n   */\n  set request(request: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".request\",\n        request,\n        scorm2004_regex.NAVEvent,\n      )\n    ) {\n      // Only process if the request is different from the current request\n      if (this._request !== request) {\n        this._request = request;\n\n        // Process the navigation request using the sequencing implementation\n        if (this._sequencing) {\n          this._sequencing.processNavigationRequest(request);\n        }\n      }\n    }\n  }\n\n  /**\n   * toJSON for adl.nav\n   *\n   * @return {\n   *    {\n   *      request: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    request: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      request: this.request,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's `adl.data` object\n */\nexport class ADLData extends CMIArray {\n  constructor() {\n    super({\n      CMIElement: \"adl.data\",\n      children: scorm2004_constants.adl_data_children,\n      errorCode: scorm2004_errors.READ_ONLY_ELEMENT,\n      errorClass: Scorm2004ValidationError,\n    });\n  }\n}\n\n/**\n * Class for SCORM 2004's adl.data.n object\n */\nexport class ADLDataObject extends BaseCMI {\n  private _id = \"\";\n  private _store = \"\";\n\n  constructor() {\n    super(\"adl.data.n\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset() {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm2004_regex.CMILongIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _store\n   * @return {string}\n   */\n  get store(): string {\n    return this._store;\n  }\n\n  /**\n   * Setter for _store\n   * @param {string} store\n   */\n  set store(store: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".store\",\n        store,\n        scorm2004_regex.CMILangString4000,\n      )\n    ) {\n      this._store = store;\n    }\n  }\n\n  /**\n   * toJSON for adl.data.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      store: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    store: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this._id,\n      store: this._store,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 2004's adl.nav.request_valid object\n */\n\nexport class ADLNavRequestValid extends BaseCMI {\n  private _continue = \"unknown\";\n  private _previous = \"unknown\";\n  private _choice: {\n    [key: string]: NAVBoolean;\n  } = {};\n  private _jump: {\n    [key: string]: NAVBoolean;\n  } = {};\n\n  /**\n   * Constructor for adl.nav.request_valid\n   */\n  constructor() {\n    super(\"adl.nav.request_valid\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset() {\n    this._initialized = false;\n    this._continue = \"unknown\";\n    this._previous = \"unknown\";\n  }\n\n  /**\n   * Getter for _continue\n   * @return {string}\n   */\n  get continue(): string {\n    return this._continue;\n  }\n\n  /**\n   * Setter for _continue. Just throws an error.\n   * @param {string} _continue\n   */\n  set continue(_continue: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".continue\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    }\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".continue\",\n        _continue,\n        scorm2004_regex.NAVBoolean,\n      )\n    ) {\n      this._continue = _continue;\n    }\n  }\n\n  /**\n   * Getter for _previous\n   * @return {string}\n   */\n  get previous(): string {\n    return this._previous;\n  }\n\n  /**\n   * Setter for _previous. Just throws an error.\n   * @param {string} _previous\n   */\n  set previous(_previous: string) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".previous\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    }\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".previous\",\n        _previous,\n        scorm2004_regex.NAVBoolean,\n      )\n    ) {\n      this._previous = _previous;\n    }\n  }\n\n  /**\n   * Getter for _choice\n   * @return {{ [key: string]: NAVBoolean }}\n   */\n  get choice(): { [key: string]: NAVBoolean } {\n    return this._choice;\n  }\n\n  /**\n   * Setter for _choice\n   * @param {{ [key: string]: string }} choice\n   */\n  set choice(choice: { [key: string]: string }) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".choice\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    }\n    if (typeof choice !== \"object\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".choice\",\n        scorm2004_errors.TYPE_MISMATCH,\n      );\n    }\n    for (const key in choice) {\n      if ({}.hasOwnProperty.call(choice, key)) {\n        if (\n          check2004ValidFormat(\n            this._cmi_element + \".choice.\" + key,\n            choice[key],\n            scorm2004_regex.NAVBoolean,\n          ) &&\n          check2004ValidFormat(\n            this._cmi_element + \".choice.\" + key,\n            key,\n            scorm2004_regex.NAVTarget,\n          )\n        ) {\n          // Convert string value to NAVBoolean enum value\n          const value = choice[key];\n          if (value === \"true\") {\n            this._choice[key] = NAVBoolean.TRUE;\n          } else if (value === \"false\") {\n            this._choice[key] = NAVBoolean.FALSE;\n          } else if (value === \"unknown\") {\n            this._choice[key] = NAVBoolean.UNKNOWN;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Getter for _jump\n   * @return {{ [key: string]: NAVBoolean }}\n   */\n  get jump(): { [key: string]: NAVBoolean } {\n    return this._jump;\n  }\n\n  /**\n   * Setter for _jump\n   * @param {{ [key: string]: string }} jump\n   */\n  set jump(jump: { [key: string]: string }) {\n    if (this.initialized) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".jump\",\n        scorm2004_errors.READ_ONLY_ELEMENT,\n      );\n    }\n    if (typeof jump !== \"object\") {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".jump\",\n        scorm2004_errors.TYPE_MISMATCH,\n      );\n    }\n    for (const key in jump) {\n      if ({}.hasOwnProperty.call(jump, key)) {\n        if (\n          check2004ValidFormat(\n            this._cmi_element + \".jump.\" + key,\n            jump[key],\n            scorm2004_regex.NAVBoolean,\n          ) &&\n          check2004ValidFormat(\n            this._cmi_element + \".jump.\" + key,\n            key,\n            scorm2004_regex.NAVTarget,\n          )\n        ) {\n          // Convert string value to NAVBoolean enum value\n          const value = jump[key];\n          if (value === \"true\") {\n            this._jump[key] = NAVBoolean.TRUE;\n          } else if (value === \"false\") {\n            this._jump[key] = NAVBoolean.FALSE;\n          } else if (value === \"unknown\") {\n            this._jump[key] = NAVBoolean.UNKNOWN;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * toJSON for adl.nav.request_valid\n   *\n   * @return {\n   *    {\n   *      previous: string,\n   *      continue: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    previous: string;\n    continue: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      previous: this._previous,\n      continue: this._continue,\n      choice: this._choice,\n      jump: this._jump,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"../../common/base_cmi\";\nimport { Activity } from \"./activity\";\nimport { Scorm2004ValidationError } from \"../../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../../constants/error_codes\";\nimport { CompletionStatus, SuccessStatus } from \"../../../constants/enums\";\n\n/**\n * Enum for rollup action types\n */\nexport enum RollupActionType {\n  SATISFIED = \"satisfied\",\n  NOT_SATISFIED = \"notSatisfied\",\n  COMPLETED = \"completed\",\n  INCOMPLETE = \"incomplete\",\n}\n\n/**\n * Enum for rollup condition types\n */\nexport enum RollupConditionType {\n  SATISFIED = \"satisfied\",\n  OBJECTIVE_STATUS_KNOWN = \"objectiveStatusKnown\",\n  OBJECTIVE_MEASURE_KNOWN = \"objectiveMeasureKnown\",\n  OBJECTIVE_MEASURE_GREATER_THAN = \"objectiveMeasureGreaterThan\",\n  OBJECTIVE_MEASURE_LESS_THAN = \"objectiveMeasureLessThan\",\n  COMPLETED = \"completed\",\n  PROGRESS_KNOWN = \"progressKnown\",\n  ATTEMPTED = \"attempted\",\n  NOT_ATTEMPTED = \"notAttempted\",\n  ALWAYS = \"always\",\n}\n\n/**\n * Enum for rollup consideration types\n */\nexport enum RollupConsiderationType {\n  ALL = \"all\",\n  ANY = \"any\",\n  NONE = \"none\",\n  AT_LEAST_COUNT = \"atLeastCount\",\n  AT_LEAST_PERCENT = \"atLeastPercent\",\n}\n\n/**\n * Class representing a rollup condition\n */\nexport class RollupCondition extends BaseCMI {\n  private _condition: RollupConditionType = RollupConditionType.ALWAYS;\n  private _parameters: Map<string, any> = new Map();\n\n  /**\n   * Constructor for RollupCondition\n   * @param {RollupConditionType} condition - The condition type\n   * @param {Map<string, any>} parameters - Additional parameters for the condition\n   */\n  constructor(\n    condition: RollupConditionType = RollupConditionType.ALWAYS,\n    parameters: Map<string, any> = new Map()\n  ) {\n    super(\"rollupCondition\");\n    this._condition = condition;\n    this._parameters = parameters;\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for condition\n   * @return {RollupConditionType}\n   */\n  get condition(): RollupConditionType {\n    return this._condition;\n  }\n\n  /**\n   * Setter for condition\n   * @param {RollupConditionType} condition\n   */\n  set condition(condition: RollupConditionType) {\n    this._condition = condition;\n  }\n\n  /**\n   * Getter for parameters\n   * @return {Map<string, any>}\n   */\n  get parameters(): Map<string, any> {\n    return this._parameters;\n  }\n\n  /**\n   * Setter for parameters\n   * @param {Map<string, any>} parameters\n   */\n  set parameters(parameters: Map<string, any>) {\n    this._parameters = parameters;\n  }\n\n  /**\n   * Evaluate the condition for an activity\n   * @param {Activity} activity - The activity to evaluate the condition for\n   * @return {boolean} - True if the condition is met, false otherwise\n   */\n  evaluate(activity: Activity): boolean {\n    switch (this._condition) {\n      case RollupConditionType.SATISFIED:\n        return activity.successStatus === SuccessStatus.PASSED;\n      case RollupConditionType.OBJECTIVE_STATUS_KNOWN:\n        return activity.objectiveMeasureStatus;\n      case RollupConditionType.OBJECTIVE_MEASURE_KNOWN:\n        return activity.objectiveMeasureStatus;\n      case RollupConditionType.OBJECTIVE_MEASURE_GREATER_THAN:\n        const greaterThanValue = this._parameters.get(\"threshold\") || 0;\n        return activity.objectiveMeasureStatus && activity.objectiveNormalizedMeasure > greaterThanValue;\n      case RollupConditionType.OBJECTIVE_MEASURE_LESS_THAN:\n        const lessThanValue = this._parameters.get(\"threshold\") || 0;\n        return activity.objectiveMeasureStatus && activity.objectiveNormalizedMeasure < lessThanValue;\n      case RollupConditionType.COMPLETED:\n        return activity.isCompleted;\n      case RollupConditionType.PROGRESS_KNOWN:\n        return activity.completionStatus !== CompletionStatus.UNKNOWN;\n      case RollupConditionType.ATTEMPTED:\n        return activity.attemptCount > 0;\n      case RollupConditionType.NOT_ATTEMPTED:\n        return activity.attemptCount === 0;\n      case RollupConditionType.ALWAYS:\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * toJSON for RollupCondition\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      condition: this._condition,\n      parameters: Object.fromEntries(this._parameters),\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing a rollup rule\n */\nexport class RollupRule extends BaseCMI {\n  private _conditions: RollupCondition[] = [];\n  private _action: RollupActionType = RollupActionType.SATISFIED;\n  private _consideration: RollupConsiderationType = RollupConsiderationType.ALL;\n  private _minimumCount: number = 0;\n  private _minimumPercent: number = 0;\n\n  /**\n   * Constructor for RollupRule\n   * @param {RollupActionType} action - The action to take when the rule conditions are met\n   * @param {RollupConsiderationType} consideration - How to consider child activities\n   * @param {number} minimumCount - The minimum count for AT_LEAST_COUNT consideration\n   * @param {number} minimumPercent - The minimum percent for AT_LEAST_PERCENT consideration\n   */\n  constructor(\n    action: RollupActionType = RollupActionType.SATISFIED,\n    consideration: RollupConsiderationType = RollupConsiderationType.ALL,\n    minimumCount: number = 0,\n    minimumPercent: number = 0\n  ) {\n    super(\"rollupRule\");\n    this._action = action;\n    this._consideration = consideration;\n    this._minimumCount = minimumCount;\n    this._minimumPercent = minimumPercent;\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._conditions = [];\n  }\n\n  /**\n   * Getter for conditions\n   * @return {RollupCondition[]}\n   */\n  get conditions(): RollupCondition[] {\n    return this._conditions;\n  }\n\n  /**\n   * Add a condition to the rule\n   * @param {RollupCondition} condition - The condition to add\n   */\n  addCondition(condition: RollupCondition): void {\n    if (!(condition instanceof RollupCondition)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".conditions\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._conditions.push(condition);\n  }\n\n  /**\n   * Remove a condition from the rule\n   * @param {RollupCondition} condition - The condition to remove\n   * @return {boolean} - True if the condition was removed, false otherwise\n   */\n  removeCondition(condition: RollupCondition): boolean {\n    const index = this._conditions.indexOf(condition);\n    if (index !== -1) {\n      this._conditions.splice(index, 1);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Getter for action\n   * @return {RollupActionType}\n   */\n  get action(): RollupActionType {\n    return this._action;\n  }\n\n  /**\n   * Setter for action\n   * @param {RollupActionType} action\n   */\n  set action(action: RollupActionType) {\n    this._action = action;\n  }\n\n  /**\n   * Getter for consideration\n   * @return {RollupConsiderationType}\n   */\n  get consideration(): RollupConsiderationType {\n    return this._consideration;\n  }\n\n  /**\n   * Setter for consideration\n   * @param {RollupConsiderationType} consideration\n   */\n  set consideration(consideration: RollupConsiderationType) {\n    this._consideration = consideration;\n  }\n\n  /**\n   * Getter for minimumCount\n   * @return {number}\n   */\n  get minimumCount(): number {\n    return this._minimumCount;\n  }\n\n  /**\n   * Setter for minimumCount\n   * @param {number} minimumCount\n   */\n  set minimumCount(minimumCount: number) {\n    if (minimumCount >= 0) {\n      this._minimumCount = minimumCount;\n    }\n  }\n\n  /**\n   * Getter for minimumPercent\n   * @return {number}\n   */\n  get minimumPercent(): number {\n    return this._minimumPercent;\n  }\n\n  /**\n   * Setter for minimumPercent\n   * @param {number} minimumPercent\n   */\n  set minimumPercent(minimumPercent: number) {\n    if (minimumPercent >= 0 && minimumPercent <= 100) {\n      this._minimumPercent = minimumPercent;\n    }\n  }\n\n  /**\n   * Evaluate the rule for a set of child activities\n   * @param {Activity[]} children - The child activities to evaluate the rule for\n   * @return {boolean} - True if the rule conditions are met, false otherwise\n   */\n  evaluate(children: Activity[]): boolean {\n    if (children.length === 0) {\n      return false;\n    }\n\n    // Filter children that meet all conditions\n    const matchingChildren = children.filter(child => {\n      return this._conditions.every(condition => condition.evaluate(child));\n    });\n\n    // Apply consideration\n    switch (this._consideration) {\n      case RollupConsiderationType.ALL:\n        return matchingChildren.length === children.length;\n      case RollupConsiderationType.ANY:\n        return matchingChildren.length > 0;\n      case RollupConsiderationType.NONE:\n        return matchingChildren.length === 0;\n      case RollupConsiderationType.AT_LEAST_COUNT:\n        return matchingChildren.length >= this._minimumCount;\n      case RollupConsiderationType.AT_LEAST_PERCENT:\n        const percent = (matchingChildren.length / children.length) * 100;\n        return percent >= this._minimumPercent;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * toJSON for RollupRule\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      conditions: this._conditions,\n      action: this._action,\n      consideration: this._consideration,\n      minimumCount: this._minimumCount,\n      minimumPercent: this._minimumPercent,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing a collection of rollup rules\n */\nexport class RollupRules extends BaseCMI {\n  private _rules: RollupRule[] = [];\n\n  /**\n   * Constructor for RollupRules\n   */\n  constructor() {\n    super(\"rollupRules\");\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._rules = [];\n  }\n\n  /**\n   * Getter for rules\n   * @return {RollupRule[]}\n   */\n  get rules(): RollupRule[] {\n    return this._rules;\n  }\n\n  /**\n   * Add a rule\n   * @param {RollupRule} rule - The rule to add\n   */\n  addRule(rule: RollupRule): void {\n    if (!(rule instanceof RollupRule)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".rules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._rules.push(rule);\n  }\n\n  /**\n   * Remove a rule\n   * @param {RollupRule} rule - The rule to remove\n   * @return {boolean} - True if the rule was removed, false otherwise\n   */\n  removeRule(rule: RollupRule): boolean {\n    const index = this._rules.indexOf(rule);\n    if (index !== -1) {\n      this._rules.splice(index, 1);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Process rollup for an activity\n   * @param {Activity} activity - The activity to process rollup for\n   */\n  processRollup(activity: Activity): void {\n    if (!activity || activity.children.length === 0) {\n      return;\n    }\n\n    const children = activity.children;\n    let completionRollup = false;\n    let successRollup = false;\n\n    // Process each rule\n    for (const rule of this._rules) {\n      if (rule.evaluate(children)) {\n        switch (rule.action) {\n          case RollupActionType.SATISFIED:\n            activity.successStatus = SuccessStatus.PASSED;\n            successRollup = true;\n            break;\n          case RollupActionType.NOT_SATISFIED:\n            activity.successStatus = SuccessStatus.FAILED;\n            successRollup = true;\n            break;\n          case RollupActionType.COMPLETED:\n            activity.completionStatus = CompletionStatus.COMPLETED;\n            activity.isCompleted = true;\n            completionRollup = true;\n            break;\n          case RollupActionType.INCOMPLETE:\n            activity.completionStatus = CompletionStatus.INCOMPLETE;\n            activity.isCompleted = false;\n            completionRollup = true;\n            break;\n        }\n      }\n    }\n\n    // If no rules applied for completion, use default rollup\n    if (!completionRollup) {\n      this._defaultCompletionRollup(activity, children);\n    }\n\n    // If no rules applied for success, use default rollup\n    if (!successRollup) {\n      this._defaultSuccessRollup(activity, children);\n    }\n  }\n\n  /**\n   * Default completion rollup\n   * @param {Activity} activity - The activity to process rollup for\n   * @param {Activity[]} children - The child activities\n   * @private\n   */\n  private _defaultCompletionRollup(activity: Activity, children: Activity[]): void {\n    // If all children are completed, mark the parent as completed\n    const allCompleted = children.every(child => child.isCompleted);\n    if (allCompleted) {\n      activity.completionStatus = CompletionStatus.COMPLETED;\n      activity.isCompleted = true;\n    } else {\n      // If any child is incomplete, mark the parent as incomplete\n      const anyIncomplete = children.some(child => child.completionStatus === CompletionStatus.INCOMPLETE);\n      if (anyIncomplete) {\n        activity.completionStatus = CompletionStatus.INCOMPLETE;\n        activity.isCompleted = false;\n      }\n    }\n  }\n\n  /**\n   * Default success rollup\n   * @param {Activity} activity - The activity to process rollup for\n   * @param {Activity[]} children - The child activities\n   * @private\n   */\n  private _defaultSuccessRollup(activity: Activity, children: Activity[]): void {\n    // If all children are satisfied, mark the parent as satisfied\n    const allSatisfied = children.every(child => child.successStatus === SuccessStatus.PASSED);\n    if (allSatisfied) {\n      activity.successStatus = SuccessStatus.PASSED;\n    } else {\n      // If any child is not satisfied, mark the parent as not satisfied\n      const anyNotSatisfied = children.some(child => child.successStatus === SuccessStatus.FAILED);\n      if (anyNotSatisfied) {\n        activity.successStatus = SuccessStatus.FAILED;\n      }\n    }\n  }\n\n  /**\n   * toJSON for RollupRules\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      rules: this._rules,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","const ValidLanguages: string[] = [\n  \"aa\",\n  \"ab\",\n  \"ae\",\n  \"af\",\n  \"ak\",\n  \"am\",\n  \"an\",\n  \"ar\",\n  \"as\",\n  \"av\",\n  \"ay\",\n  \"az\",\n  \"ba\",\n  \"be\",\n  \"bg\",\n  \"bh\",\n  \"bi\",\n  \"bm\",\n  \"bn\",\n  \"bo\",\n  \"br\",\n  \"bs\",\n  \"ca\",\n  \"ce\",\n  \"ch\",\n  \"co\",\n  \"cr\",\n  \"cs\",\n  \"cu\",\n  \"cv\",\n  \"cy\",\n  \"da\",\n  \"de\",\n  \"dv\",\n  \"dz\",\n  \"ee\",\n  \"el\",\n  \"en\",\n  \"eo\",\n  \"es\",\n  \"et\",\n  \"eu\",\n  \"fa\",\n  \"ff\",\n  \"fi\",\n  \"fj\",\n  \"fo\",\n  \"fr\",\n  \"fy\",\n  \"ga\",\n  \"gd\",\n  \"gl\",\n  \"gn\",\n  \"gu\",\n  \"gv\",\n  \"ha\",\n  \"he\",\n  \"hi\",\n  \"ho\",\n  \"hr\",\n  \"ht\",\n  \"hu\",\n  \"hy\",\n  \"hz\",\n  \"ia\",\n  \"id\",\n  \"ie\",\n  \"ig\",\n  \"ii\",\n  \"ik\",\n  \"io\",\n  \"is\",\n  \"it\",\n  \"iu\",\n  \"ja\",\n  \"jv\",\n  \"ka\",\n  \"kg\",\n  \"ki\",\n  \"kj\",\n  \"kk\",\n  \"kl\",\n  \"km\",\n  \"kn\",\n  \"ko\",\n  \"kr\",\n  \"ks\",\n  \"ku\",\n  \"kv\",\n  \"kw\",\n  \"ky\",\n  \"la\",\n  \"lb\",\n  \"lg\",\n  \"li\",\n  \"ln\",\n  \"lo\",\n  \"lt\",\n  \"lu\",\n  \"lv\",\n  \"mg\",\n  \"mh\",\n  \"mi\",\n  \"mk\",\n  \"ml\",\n  \"mn\",\n  \"mo\",\n  \"mr\",\n  \"ms\",\n  \"mt\",\n  \"my\",\n  \"na\",\n  \"nb\",\n  \"nd\",\n  \"ne\",\n  \"ng\",\n  \"nl\",\n  \"nn\",\n  \"no\",\n  \"nr\",\n  \"nv\",\n  \"ny\",\n  \"oc\",\n  \"oj\",\n  \"om\",\n  \"or\",\n  \"os\",\n  \"pa\",\n  \"pi\",\n  \"pl\",\n  \"ps\",\n  \"pt\",\n  \"qu\",\n  \"rm\",\n  \"rn\",\n  \"ro\",\n  \"ru\",\n  \"rw\",\n  \"sa\",\n  \"sc\",\n  \"sd\",\n  \"se\",\n  \"sg\",\n  \"sh\",\n  \"si\",\n  \"sk\",\n  \"sl\",\n  \"sm\",\n  \"sn\",\n  \"so\",\n  \"sq\",\n  \"sr\",\n  \"ss\",\n  \"st\",\n  \"su\",\n  \"sv\",\n  \"sw\",\n  \"ta\",\n  \"te\",\n  \"tg\",\n  \"th\",\n  \"ti\",\n  \"tk\",\n  \"tl\",\n  \"tn\",\n  \"to\",\n  \"tr\",\n  \"ts\",\n  \"tt\",\n  \"tw\",\n  \"ty\",\n  \"ug\",\n  \"uk\",\n  \"ur\",\n  \"uz\",\n  \"ve\",\n  \"vi\",\n  \"vo\",\n  \"wa\",\n  \"wo\",\n  \"xh\",\n  \"yi\",\n  \"yo\",\n  \"za\",\n  \"zh\",\n  \"zu\",\n  \"aar\",\n  \"abk\",\n  \"ave\",\n  \"afr\",\n  \"aka\",\n  \"amh\",\n  \"arg\",\n  \"ara\",\n  \"asm\",\n  \"ava\",\n  \"aym\",\n  \"aze\",\n  \"bak\",\n  \"bel\",\n  \"bul\",\n  \"bih\",\n  \"bis\",\n  \"bam\",\n  \"ben\",\n  \"tib\",\n  \"bod\",\n  \"bre\",\n  \"bos\",\n  \"cat\",\n  \"che\",\n  \"cha\",\n  \"cos\",\n  \"cre\",\n  \"cze\",\n  \"ces\",\n  \"chu\",\n  \"chv\",\n  \"wel\",\n  \"cym\",\n  \"dan\",\n  \"ger\",\n  \"deu\",\n  \"div\",\n  \"dzo\",\n  \"ewe\",\n  \"gre\",\n  \"ell\",\n  \"eng\",\n  \"epo\",\n  \"spa\",\n  \"est\",\n  \"baq\",\n  \"eus\",\n  \"per\",\n  \"fas\",\n  \"ful\",\n  \"fin\",\n  \"fij\",\n  \"fao\",\n  \"fre\",\n  \"fra\",\n  \"fry\",\n  \"gle\",\n  \"gla\",\n  \"glg\",\n  \"grn\",\n  \"guj\",\n  \"glv\",\n  \"hau\",\n  \"heb\",\n  \"hin\",\n  \"hmo\",\n  \"hrv\",\n  \"hat\",\n  \"hun\",\n  \"arm\",\n  \"hye\",\n  \"her\",\n  \"ina\",\n  \"ind\",\n  \"ile\",\n  \"ibo\",\n  \"iii\",\n  \"ipk\",\n  \"ido\",\n  \"ice\",\n  \"isl\",\n  \"ita\",\n  \"iku\",\n  \"jpn\",\n  \"jav\",\n  \"geo\",\n  \"kat\",\n  \"kon\",\n  \"kik\",\n  \"kua\",\n  \"kaz\",\n  \"kal\",\n  \"khm\",\n  \"kan\",\n  \"kor\",\n  \"kau\",\n  \"kas\",\n  \"kur\",\n  \"kom\",\n  \"cor\",\n  \"kir\",\n  \"lat\",\n  \"ltz\",\n  \"lug\",\n  \"lim\",\n  \"lin\",\n  \"lao\",\n  \"lit\",\n  \"lub\",\n  \"lav\",\n  \"mlg\",\n  \"mah\",\n  \"mao\",\n  \"mri\",\n  \"mac\",\n  \"mkd\",\n  \"mal\",\n  \"mon\",\n  \"mol\",\n  \"mar\",\n  \"may\",\n  \"msa\",\n  \"mlt\",\n  \"bur\",\n  \"mya\",\n  \"nau\",\n  \"nob\",\n  \"nde\",\n  \"nep\",\n  \"ndo\",\n  \"dut\",\n  \"nld\",\n  \"nno\",\n  \"nor\",\n  \"nbl\",\n  \"nav\",\n  \"nya\",\n  \"oci\",\n  \"oji\",\n  \"orm\",\n  \"ori\",\n  \"oss\",\n  \"pan\",\n  \"pli\",\n  \"pol\",\n  \"pus\",\n  \"por\",\n  \"que\",\n  \"roh\",\n  \"run\",\n  \"rum\",\n  \"ron\",\n  \"rus\",\n  \"kin\",\n  \"san\",\n  \"srd\",\n  \"snd\",\n  \"sme\",\n  \"sag\",\n  \"slo\",\n  \"sin\",\n  \"slk\",\n  \"slv\",\n  \"smo\",\n  \"sna\",\n  \"som\",\n  \"alb\",\n  \"sqi\",\n  \"srp\",\n  \"ssw\",\n  \"sot\",\n  \"sun\",\n  \"swe\",\n  \"swa\",\n  \"tam\",\n  \"tel\",\n  \"tgk\",\n  \"tha\",\n  \"tir\",\n  \"tuk\",\n  \"tgl\",\n  \"tsn\",\n  \"ton\",\n  \"tur\",\n  \"tso\",\n  \"tat\",\n  \"twi\",\n  \"tah\",\n  \"uig\",\n  \"ukr\",\n  \"urd\",\n  \"uzb\",\n  \"ven\",\n  \"vie\",\n  \"vol\",\n  \"wln\",\n  \"wol\",\n  \"xho\",\n  \"yid\",\n  \"yor\",\n  \"zha\",\n  \"chi\",\n  \"zho\",\n  \"zul\",\n];\nexport default ValidLanguages;\n","import { BaseCMI } from \"../../common/base_cmi\";\nimport { scorm2004_regex } from \"../../../constants/regex\";\nimport { check2004ValidFormat } from \"../validation\";\nimport { Scorm2004ValidationError } from \"../../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../../constants/error_codes\";\nimport { CompletionStatus, SuccessStatus } from \"../../../constants/enums\";\n\n/**\n * Class representing a single activity in the SCORM 2004 activity tree\n */\nexport class Activity extends BaseCMI {\n  private _id: string = \"\";\n  private _title: string = \"\";\n  private _children: Activity[] = [];\n  private _parent: Activity | null = null;\n  private _isVisible: boolean = true;\n  private _isActive: boolean = false;\n  private _isSuspended: boolean = false;\n  private _isCompleted: boolean = false;\n  private _completionStatus: CompletionStatus = CompletionStatus.UNKNOWN;\n  private _successStatus: SuccessStatus = SuccessStatus.UNKNOWN;\n  private _attemptCount: number = 0;\n  private _attemptCompletionAmount: number = 0;\n  private _attemptAbsoluteDuration: string = \"PT0H0M0S\";\n  private _attemptExperiencedDuration: string = \"PT0H0M0S\";\n  private _activityAbsoluteDuration: string = \"PT0H0M0S\";\n  private _activityExperiencedDuration: string = \"PT0H0M0S\";\n  private _objectiveSatisfiedStatus: boolean = false;\n  private _objectiveMeasureStatus: boolean = false;\n  private _objectiveNormalizedMeasure: number = 0;\n\n  /**\n   * Constructor for Activity\n   * @param {string} id - The unique identifier for this activity\n   * @param {string} title - The title of this activity\n   */\n  constructor(id: string = \"\", title: string = \"\") {\n    super(\"activity\");\n    this._id = id;\n    this._title = title;\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    // Initialize children\n    for (const child of this._children) {\n      child.initialize();\n    }\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._isActive = false;\n    this._isSuspended = false;\n    this._isCompleted = false;\n    this._completionStatus = CompletionStatus.UNKNOWN;\n    this._successStatus = SuccessStatus.UNKNOWN;\n    this._attemptCount = 0;\n    this._attemptCompletionAmount = 0;\n    this._attemptAbsoluteDuration = \"PT0H0M0S\";\n    this._attemptExperiencedDuration = \"PT0H0M0S\";\n    this._activityAbsoluteDuration = \"PT0H0M0S\";\n    this._activityExperiencedDuration = \"PT0H0M0S\";\n    this._objectiveSatisfiedStatus = false;\n    this._objectiveMeasureStatus = false;\n    this._objectiveNormalizedMeasure = 0;\n\n    // Reset children\n    for (const child of this._children) {\n      child.reset();\n    }\n  }\n\n  /**\n   * Getter for id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm2004_regex.CMILongIdentifier\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for title\n   * @return {string}\n   */\n  get title(): string {\n    return this._title;\n  }\n\n  /**\n   * Setter for title\n   * @param {string} title\n   */\n  set title(title: string) {\n    if (\n      check2004ValidFormat(\n        this._cmi_element + \".title\",\n        title,\n        scorm2004_regex.CMILangString250\n      )\n    ) {\n      this._title = title;\n    }\n  }\n\n  /**\n   * Getter for children\n   * @return {Activity[]}\n   */\n  get children(): Activity[] {\n    return this._children;\n  }\n\n  /**\n   * Add a child activity to this activity\n   * @param {Activity} child - The child activity to add\n   */\n  addChild(child: Activity): void {\n    if (!(child instanceof Activity)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".children\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    child._parent = this;\n    this._children.push(child);\n  }\n\n  /**\n   * Remove a child activity from this activity\n   * @param {Activity} child - The child activity to remove\n   * @return {boolean} - True if the child was removed, false otherwise\n   */\n  removeChild(child: Activity): boolean {\n    const index = this._children.indexOf(child);\n    if (index !== -1) {\n      this._children.splice(index, 1);\n      child._parent = null;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Getter for parent\n   * @return {Activity | null}\n   */\n  get parent(): Activity | null {\n    return this._parent;\n  }\n\n  /**\n   * Getter for isVisible\n   * @return {boolean}\n   */\n  get isVisible(): boolean {\n    return this._isVisible;\n  }\n\n  /**\n   * Setter for isVisible\n   * @param {boolean} isVisible\n   */\n  set isVisible(isVisible: boolean) {\n    this._isVisible = isVisible;\n  }\n\n  /**\n   * Getter for isActive\n   * @return {boolean}\n   */\n  get isActive(): boolean {\n    return this._isActive;\n  }\n\n  /**\n   * Setter for isActive\n   * @param {boolean} isActive\n   */\n  set isActive(isActive: boolean) {\n    this._isActive = isActive;\n  }\n\n  /**\n   * Getter for isSuspended\n   * @return {boolean}\n   */\n  get isSuspended(): boolean {\n    return this._isSuspended;\n  }\n\n  /**\n   * Setter for isSuspended\n   * @param {boolean} isSuspended\n   */\n  set isSuspended(isSuspended: boolean) {\n    this._isSuspended = isSuspended;\n  }\n\n  /**\n   * Getter for isCompleted\n   * @return {boolean}\n   */\n  get isCompleted(): boolean {\n    return this._isCompleted;\n  }\n\n  /**\n   * Setter for isCompleted\n   * @param {boolean} isCompleted\n   */\n  set isCompleted(isCompleted: boolean) {\n    this._isCompleted = isCompleted;\n  }\n\n  /**\n   * Getter for completionStatus\n   * @return {CompletionStatus}\n   */\n  get completionStatus(): CompletionStatus {\n    return this._completionStatus;\n  }\n\n  /**\n   * Setter for completionStatus\n   * @param {CompletionStatus} completionStatus\n   */\n  set completionStatus(completionStatus: CompletionStatus) {\n    this._completionStatus = completionStatus;\n    this._isCompleted = completionStatus === CompletionStatus.COMPLETED;\n  }\n\n  /**\n   * Getter for successStatus\n   * @return {SuccessStatus}\n   */\n  get successStatus(): SuccessStatus {\n    return this._successStatus;\n  }\n\n  /**\n   * Setter for successStatus\n   * @param {SuccessStatus} successStatus\n   */\n  set successStatus(successStatus: SuccessStatus) {\n    this._successStatus = successStatus;\n  }\n\n  /**\n   * Getter for attemptCount\n   * @return {number}\n   */\n  get attemptCount(): number {\n    return this._attemptCount;\n  }\n\n  /**\n   * Increment the attempt count\n   */\n  incrementAttemptCount(): void {\n    this._attemptCount++;\n  }\n\n  /**\n   * Getter for objectiveMeasureStatus\n   * @return {boolean}\n   */\n  get objectiveMeasureStatus(): boolean {\n    return this._objectiveMeasureStatus;\n  }\n\n  /**\n   * Setter for objectiveMeasureStatus\n   * @param {boolean} objectiveMeasureStatus\n   */\n  set objectiveMeasureStatus(objectiveMeasureStatus: boolean) {\n    this._objectiveMeasureStatus = objectiveMeasureStatus;\n  }\n\n  /**\n   * Getter for objectiveNormalizedMeasure\n   * @return {number}\n   */\n  get objectiveNormalizedMeasure(): number {\n    return this._objectiveNormalizedMeasure;\n  }\n\n  /**\n   * Setter for objectiveNormalizedMeasure\n   * @param {number} objectiveNormalizedMeasure\n   */\n  set objectiveNormalizedMeasure(objectiveNormalizedMeasure: number) {\n    this._objectiveNormalizedMeasure = objectiveNormalizedMeasure;\n  }\n\n  /**\n   * toJSON for Activity\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      id: this._id,\n      title: this._title,\n      isVisible: this._isVisible,\n      isActive: this._isActive,\n      isSuspended: this._isSuspended,\n      isCompleted: this._isCompleted,\n      completionStatus: this._completionStatus,\n      successStatus: this._successStatus,\n      attemptCount: this._attemptCount,\n      attemptCompletionAmount: this._attemptCompletionAmount,\n      attemptAbsoluteDuration: this._attemptAbsoluteDuration,\n      attemptExperiencedDuration: this._attemptExperiencedDuration,\n      activityAbsoluteDuration: this._activityAbsoluteDuration,\n      activityExperiencedDuration: this._activityExperiencedDuration,\n      objectiveSatisfiedStatus: this._objectiveSatisfiedStatus,\n      objectiveMeasureStatus: this._objectiveMeasureStatus,\n      objectiveNormalizedMeasure: this._objectiveNormalizedMeasure,\n      children: this._children.map(child => child.toJSON()),\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"../../common/base_cmi\";\nimport { Activity } from \"./activity\";\nimport { Scorm2004ValidationError } from \"../../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../../constants/error_codes\";\n\n/**\n * Class representing the SCORM 2004 activity tree\n */\nexport class ActivityTree extends BaseCMI {\n  private _root: Activity | null = null;\n  private _currentActivity: Activity | null = null;\n  private _suspendedActivity: Activity | null = null;\n  private _activities: Map<string, Activity> = new Map();\n\n  /**\n   * Constructor for ActivityTree\n   */\n  constructor() {\n    super(\"activityTree\");\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    if (this._root) {\n      this._root.initialize();\n    }\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._currentActivity = null;\n    this._suspendedActivity = null;\n    if (this._root) {\n      this._root.reset();\n    }\n  }\n\n  /**\n   * Getter for root\n   * @return {Activity | null}\n   */\n  get root(): Activity | null {\n    return this._root;\n  }\n\n  /**\n   * Setter for root\n   * @param {Activity} root\n   */\n  set root(root: Activity | null) {\n    if (root !== null && !(root instanceof Activity)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".root\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._root = root;\n    if (root) {\n      this._activities.set(root.id, root);\n      this._addActivitiesToMap(root);\n    }\n  }\n\n  /**\n   * Recursively add activities to the activities map\n   * @param {Activity} activity\n   * @private\n   */\n  private _addActivitiesToMap(activity: Activity): void {\n    for (const child of activity.children) {\n      this._activities.set(child.id, child);\n      this._addActivitiesToMap(child);\n    }\n  }\n\n  /**\n   * Getter for currentActivity\n   * @return {Activity | null}\n   */\n  get currentActivity(): Activity | null {\n    return this._currentActivity;\n  }\n\n  /**\n   * Setter for currentActivity\n   * @param {Activity | null} activity\n   */\n  set currentActivity(activity: Activity | null) {\n    if (activity !== null && !(activity instanceof Activity)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".currentActivity\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    \n    // If there's already a current activity, deactivate it\n    if (this._currentActivity) {\n      this._currentActivity.isActive = false;\n    }\n    \n    // Set the new current activity and activate it\n    this._currentActivity = activity;\n    if (activity) {\n      activity.isActive = true;\n    }\n  }\n\n  /**\n   * Getter for suspendedActivity\n   * @return {Activity | null}\n   */\n  get suspendedActivity(): Activity | null {\n    return this._suspendedActivity;\n  }\n\n  /**\n   * Setter for suspendedActivity\n   * @param {Activity | null} activity\n   */\n  set suspendedActivity(activity: Activity | null) {\n    if (activity !== null && !(activity instanceof Activity)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".suspendedActivity\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    \n    // If there's already a suspended activity, unsuspend it\n    if (this._suspendedActivity) {\n      this._suspendedActivity.isSuspended = false;\n    }\n    \n    // Set the new suspended activity and mark it as suspended\n    this._suspendedActivity = activity;\n    if (activity) {\n      activity.isSuspended = true;\n    }\n  }\n\n  /**\n   * Get an activity by ID\n   * @param {string} id - The ID of the activity to get\n   * @return {Activity | undefined} - The activity with the given ID, or undefined if not found\n   */\n  getActivity(id: string): Activity | undefined {\n    return this._activities.get(id);\n  }\n\n  /**\n   * Get all activities in the tree\n   * @return {Activity[]} - An array of all activities in the tree\n   */\n  getAllActivities(): Activity[] {\n    return Array.from(this._activities.values());\n  }\n\n  /**\n   * Get the parent of an activity\n   * @param {Activity} activity - The activity to get the parent of\n   * @return {Activity | null} - The parent of the activity, or null if it has no parent\n   */\n  getParent(activity: Activity): Activity | null {\n    return activity.parent;\n  }\n\n  /**\n   * Get the children of an activity\n   * @param {Activity} activity - The activity to get the children of\n   * @return {Activity[]} - An array of the activity's children\n   */\n  getChildren(activity: Activity): Activity[] {\n    return activity.children;\n  }\n\n  /**\n   * Get the siblings of an activity\n   * @param {Activity} activity - The activity to get the siblings of\n   * @return {Activity[]} - An array of the activity's siblings\n   */\n  getSiblings(activity: Activity): Activity[] {\n    if (!activity.parent) {\n      return [];\n    }\n    return activity.parent.children.filter(child => child !== activity);\n  }\n\n  /**\n   * Get the next sibling of an activity\n   * @param {Activity} activity - The activity to get the next sibling of\n   * @return {Activity | null} - The next sibling of the activity, or null if it has no next sibling\n   */\n  getNextSibling(activity: Activity): Activity | null {\n    if (!activity.parent) {\n      return null;\n    }\n    const siblings = activity.parent.children;\n    const index = siblings.indexOf(activity);\n    if (index === -1 || index === siblings.length - 1) {\n      return null;\n    }\n    return siblings[index + 1];\n  }\n\n  /**\n   * Get the previous sibling of an activity\n   * @param {Activity} activity - The activity to get the previous sibling of\n   * @return {Activity | null} - The previous sibling of the activity, or null if it has no previous sibling\n   */\n  getPreviousSibling(activity: Activity): Activity | null {\n    if (!activity.parent) {\n      return null;\n    }\n    const siblings = activity.parent.children;\n    const index = siblings.indexOf(activity);\n    if (index <= 0) {\n      return null;\n    }\n    return siblings[index - 1];\n  }\n\n  /**\n   * Get the first child of an activity\n   * @param {Activity} activity - The activity to get the first child of\n   * @return {Activity | null} - The first child of the activity, or null if it has no children\n   */\n  getFirstChild(activity: Activity): Activity | null {\n    if (activity.children.length === 0) {\n      return null;\n    }\n    return activity.children[0];\n  }\n\n  /**\n   * Get the last child of an activity\n   * @param {Activity} activity - The activity to get the last child of\n   * @return {Activity | null} - The last child of the activity, or null if it has no children\n   */\n  getLastChild(activity: Activity): Activity | null {\n    if (activity.children.length === 0) {\n      return null;\n    }\n    return activity.children[activity.children.length - 1];\n  }\n\n  /**\n   * Get the common ancestor of two activities\n   * @param {Activity} activity1 - The first activity\n   * @param {Activity} activity2 - The second activity\n   * @return {Activity | null} - The common ancestor of the two activities, or null if they have no common ancestor\n   */\n  getCommonAncestor(activity1: Activity, activity2: Activity): Activity | null {\n    // Get the path from the root to activity1\n    const path1: Activity[] = [];\n    let current: Activity | null = activity1;\n    while (current) {\n      path1.unshift(current);\n      current = current.parent;\n    }\n    \n    // Check if activity2 is in the path from the root to activity1\n    current = activity2;\n    while (current) {\n      if (path1.includes(current)) {\n        return current;\n      }\n      current = current.parent;\n    }\n    \n    return null;\n  }\n\n  /**\n   * toJSON for ActivityTree\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      root: this._root,\n      currentActivity: this._currentActivity ? this._currentActivity.id : null,\n      suspendedActivity: this._suspendedActivity ? this._suspendedActivity.id : null,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}","import { BaseCMI } from \"../../common/base_cmi\";\n\n/**\n * Class representing SCORM 2004 sequencing controls\n */\nexport class SequencingControls extends BaseCMI {\n  // Sequencing Control Modes\n  private _enabled: boolean = true;\n  private _choiceExit: boolean = true;\n  private _flow: boolean = false;\n  private _forwardOnly: boolean = false;\n  private _useCurrentAttemptObjectiveInfo: boolean = true;\n  private _useCurrentAttemptProgressInfo: boolean = true;\n\n  // Constrain Choice Controls\n  private _preventActivation: boolean = false;\n  private _constrainChoice: boolean = false;\n\n  // Rollup Controls\n  private _rollupObjectiveSatisfied: boolean = true;\n  private _rollupProgressCompletion: boolean = true;\n  private _objectiveMeasureWeight: number = 1.0;\n\n  /**\n   * Constructor for SequencingControls\n   */\n  constructor() {\n    super(\"sequencingControls\");\n  }\n\n  /**\n   * Reset the sequencing controls to their default values\n   */\n  reset() {\n    this._initialized = false;\n    this._enabled = true;\n    this._choiceExit = true;\n    this._flow = false;\n    this._forwardOnly = false;\n    this._useCurrentAttemptObjectiveInfo = true;\n    this._useCurrentAttemptProgressInfo = true;\n    this._preventActivation = false;\n    this._constrainChoice = false;\n    this._rollupObjectiveSatisfied = true;\n    this._rollupProgressCompletion = true;\n    this._objectiveMeasureWeight = 1.0;\n  }\n\n  /**\n   * Getter for enabled\n   * @return {boolean}\n   */\n  get enabled(): boolean {\n    return this._enabled;\n  }\n\n  /**\n   * Setter for enabled\n   * @param {boolean} enabled\n   */\n  set enabled(enabled: boolean) {\n    this._enabled = enabled;\n  }\n\n  /**\n   * Getter for choiceExit\n   * @return {boolean}\n   */\n  get choiceExit(): boolean {\n    return this._choiceExit;\n  }\n\n  /**\n   * Setter for choiceExit\n   * @param {boolean} choiceExit\n   */\n  set choiceExit(choiceExit: boolean) {\n    this._choiceExit = choiceExit;\n  }\n\n  /**\n   * Getter for flow\n   * @return {boolean}\n   */\n  get flow(): boolean {\n    return this._flow;\n  }\n\n  /**\n   * Setter for flow\n   * @param {boolean} flow\n   */\n  set flow(flow: boolean) {\n    this._flow = flow;\n  }\n\n  /**\n   * Getter for forwardOnly\n   * @return {boolean}\n   */\n  get forwardOnly(): boolean {\n    return this._forwardOnly;\n  }\n\n  /**\n   * Setter for forwardOnly\n   * @param {boolean} forwardOnly\n   */\n  set forwardOnly(forwardOnly: boolean) {\n    this._forwardOnly = forwardOnly;\n  }\n\n  /**\n   * Getter for useCurrentAttemptObjectiveInfo\n   * @return {boolean}\n   */\n  get useCurrentAttemptObjectiveInfo(): boolean {\n    return this._useCurrentAttemptObjectiveInfo;\n  }\n\n  /**\n   * Setter for useCurrentAttemptObjectiveInfo\n   * @param {boolean} useCurrentAttemptObjectiveInfo\n   */\n  set useCurrentAttemptObjectiveInfo(useCurrentAttemptObjectiveInfo: boolean) {\n    this._useCurrentAttemptObjectiveInfo = useCurrentAttemptObjectiveInfo;\n  }\n\n  /**\n   * Getter for useCurrentAttemptProgressInfo\n   * @return {boolean}\n   */\n  get useCurrentAttemptProgressInfo(): boolean {\n    return this._useCurrentAttemptProgressInfo;\n  }\n\n  /**\n   * Setter for useCurrentAttemptProgressInfo\n   * @param {boolean} useCurrentAttemptProgressInfo\n   */\n  set useCurrentAttemptProgressInfo(useCurrentAttemptProgressInfo: boolean) {\n    this._useCurrentAttemptProgressInfo = useCurrentAttemptProgressInfo;\n  }\n\n  /**\n   * Getter for preventActivation\n   * @return {boolean}\n   */\n  get preventActivation(): boolean {\n    return this._preventActivation;\n  }\n\n  /**\n   * Setter for preventActivation\n   * @param {boolean} preventActivation\n   */\n  set preventActivation(preventActivation: boolean) {\n    this._preventActivation = preventActivation;\n  }\n\n  /**\n   * Getter for constrainChoice\n   * @return {boolean}\n   */\n  get constrainChoice(): boolean {\n    return this._constrainChoice;\n  }\n\n  /**\n   * Setter for constrainChoice\n   * @param {boolean} constrainChoice\n   */\n  set constrainChoice(constrainChoice: boolean) {\n    this._constrainChoice = constrainChoice;\n  }\n\n  /**\n   * Getter for rollupObjectiveSatisfied\n   * @return {boolean}\n   */\n  get rollupObjectiveSatisfied(): boolean {\n    return this._rollupObjectiveSatisfied;\n  }\n\n  /**\n   * Setter for rollupObjectiveSatisfied\n   * @param {boolean} rollupObjectiveSatisfied\n   */\n  set rollupObjectiveSatisfied(rollupObjectiveSatisfied: boolean) {\n    this._rollupObjectiveSatisfied = rollupObjectiveSatisfied;\n  }\n\n  /**\n   * Getter for rollupProgressCompletion\n   * @return {boolean}\n   */\n  get rollupProgressCompletion(): boolean {\n    return this._rollupProgressCompletion;\n  }\n\n  /**\n   * Setter for rollupProgressCompletion\n   * @param {boolean} rollupProgressCompletion\n   */\n  set rollupProgressCompletion(rollupProgressCompletion: boolean) {\n    this._rollupProgressCompletion = rollupProgressCompletion;\n  }\n\n  /**\n   * Getter for objectiveMeasureWeight\n   * @return {number}\n   */\n  get objectiveMeasureWeight(): number {\n    return this._objectiveMeasureWeight;\n  }\n\n  /**\n   * Setter for objectiveMeasureWeight\n   * @param {number} objectiveMeasureWeight\n   */\n  set objectiveMeasureWeight(objectiveMeasureWeight: number) {\n    if (objectiveMeasureWeight >= 0 && objectiveMeasureWeight <= 1) {\n      this._objectiveMeasureWeight = objectiveMeasureWeight;\n    }\n  }\n\n  /**\n   * Check if choice navigation is allowed\n   * @return {boolean} - True if choice navigation is allowed, false otherwise\n   */\n  isChoiceNavigationAllowed(): boolean {\n    return this._enabled && !this._constrainChoice;\n  }\n\n  /**\n   * Check if flow navigation is allowed\n   * @return {boolean} - True if flow navigation is allowed, false otherwise\n   */\n  isFlowNavigationAllowed(): boolean {\n    return this._enabled && this._flow;\n  }\n\n  /**\n   * Check if forward navigation is allowed\n   * @return {boolean} - True if forward navigation is allowed, false otherwise\n   */\n  isForwardNavigationAllowed(): boolean {\n    return this._enabled && (!this._forwardOnly || this._flow);\n  }\n\n  /**\n   * Check if backward navigation is allowed\n   * @return {boolean} - True if backward navigation is allowed, false otherwise\n   */\n  isBackwardNavigationAllowed(): boolean {\n    return this._enabled && !this._forwardOnly;\n  }\n\n  /**\n   * toJSON for SequencingControls\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      enabled: this._enabled,\n      choiceExit: this._choiceExit,\n      flow: this._flow,\n      forwardOnly: this._forwardOnly,\n      useCurrentAttemptObjectiveInfo: this._useCurrentAttemptObjectiveInfo,\n      useCurrentAttemptProgressInfo: this._useCurrentAttemptProgressInfo,\n      preventActivation: this._preventActivation,\n      constrainChoice: this._constrainChoice,\n      rollupObjectiveSatisfied: this._rollupObjectiveSatisfied,\n      rollupProgressCompletion: this._rollupProgressCompletion,\n      objectiveMeasureWeight: this._objectiveMeasureWeight,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}","import { BaseCMI } from \"../../common/base_cmi\";\nimport { Activity } from \"./activity\";\nimport { ActivityTree } from \"./activity_tree\";\nimport { SequencingRules, RuleActionType } from \"./sequencing_rules\";\nimport { SequencingControls } from \"./sequencing_controls\";\nimport { RollupRules } from \"./rollup_rules\";\nimport { ADLNav } from \"../adl\";\nimport { Scorm2004ValidationError } from \"../../../exceptions/scorm2004_exceptions\";\nimport { scorm2004_errors } from \"../../../constants/error_codes\";\n\n/**\n * Class representing SCORM 2004 sequencing\n */\nexport class Sequencing extends BaseCMI {\n  private _activityTree: ActivityTree;\n  private _sequencingRules: SequencingRules;\n  private _sequencingControls: SequencingControls;\n  private _rollupRules: RollupRules;\n  private _adlNav: ADLNav | null = null;\n\n  /**\n   * Constructor for Sequencing\n   */\n  constructor() {\n    super(\"sequencing\");\n    this._activityTree = new ActivityTree();\n    this._sequencingRules = new SequencingRules();\n    this._sequencingControls = new SequencingControls();\n    this._rollupRules = new RollupRules();\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this._activityTree.initialize();\n    this._sequencingRules.initialize();\n    this._sequencingControls.initialize();\n    this._rollupRules.initialize();\n  }\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset() {\n    this._initialized = false;\n    this._activityTree.reset();\n    this._sequencingRules.reset();\n    this._sequencingControls.reset();\n    this._rollupRules.reset();\n  }\n\n  /**\n   * Getter for activityTree\n   * @return {ActivityTree}\n   */\n  get activityTree(): ActivityTree {\n    return this._activityTree;\n  }\n\n  /**\n   * Setter for activityTree\n   * @param {ActivityTree} activityTree\n   */\n  set activityTree(activityTree: ActivityTree) {\n    if (!(activityTree instanceof ActivityTree)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".activityTree\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._activityTree = activityTree;\n  }\n\n  /**\n   * Getter for sequencingRules\n   * @return {SequencingRules}\n   */\n  get sequencingRules(): SequencingRules {\n    return this._sequencingRules;\n  }\n\n  /**\n   * Setter for sequencingRules\n   * @param {SequencingRules} sequencingRules\n   */\n  set sequencingRules(sequencingRules: SequencingRules) {\n    if (!(sequencingRules instanceof SequencingRules)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".sequencingRules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._sequencingRules = sequencingRules;\n  }\n\n  /**\n   * Getter for sequencingControls\n   * @return {SequencingControls}\n   */\n  get sequencingControls(): SequencingControls {\n    return this._sequencingControls;\n  }\n\n  /**\n   * Setter for sequencingControls\n   * @param {SequencingControls} sequencingControls\n   */\n  set sequencingControls(sequencingControls: SequencingControls) {\n    if (!(sequencingControls instanceof SequencingControls)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".sequencingControls\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._sequencingControls = sequencingControls;\n  }\n\n  /**\n   * Getter for rollupRules\n   * @return {RollupRules}\n   */\n  get rollupRules(): RollupRules {\n    return this._rollupRules;\n  }\n\n  /**\n   * Setter for rollupRules\n   * @param {RollupRules} rollupRules\n   */\n  set rollupRules(rollupRules: RollupRules) {\n    if (!(rollupRules instanceof RollupRules)) {\n      throw new Scorm2004ValidationError(\n        this._cmi_element + \".rollupRules\",\n        scorm2004_errors.TYPE_MISMATCH\n      );\n    }\n    this._rollupRules = rollupRules;\n  }\n\n  /**\n   * Getter for adlNav\n   * @return {ADLNav | null}\n   */\n  get adlNav(): ADLNav | null {\n    return this._adlNav;\n  }\n\n  /**\n   * Setter for adlNav\n   * @param {ADLNav | null} adlNav\n   */\n  set adlNav(adlNav: ADLNav | null) {\n    this._adlNav = adlNav;\n  }\n\n  /**\n   * Process navigation request\n   * @param {string} request - The navigation request\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processNavigationRequest(request: string): boolean {\n    if (!this._adlNav) {\n      return false;\n    }\n\n    // Set the navigation request\n    this._adlNav.request = request;\n\n    // Get the current activity\n    const currentActivity = this._activityTree.currentActivity;\n    if (!currentActivity) {\n      return false;\n    }\n\n    // Evaluate pre-condition rules\n    const preConditionAction = this._sequencingRules.evaluatePreConditionRules(currentActivity);\n    if (preConditionAction) {\n      // Handle pre-condition action\n      switch (preConditionAction) {\n        case RuleActionType.SKIP:\n          // Skip this activity\n          return false;\n        case RuleActionType.DISABLED:\n          // Disable this activity\n          return false;\n        case RuleActionType.HIDE_FROM_CHOICE:\n          // Hide this activity from choice\n          return false;\n        case RuleActionType.STOP_FORWARD_TRAVERSAL:\n          // Stop forward traversal\n          return false;\n        default:\n          break;\n      }\n    }\n\n    // Process the navigation request based on the request type\n    switch (request) {\n      case \"continue\":\n        return this.processContinueRequest(currentActivity);\n      case \"previous\":\n        return this.processPreviousRequest(currentActivity);\n      case \"choice\":\n        // Choice navigation would require additional parameters\n        return false;\n      case \"exit\":\n        return this.processExitRequest(currentActivity);\n      case \"exitAll\":\n        return this.processExitAllRequest(currentActivity);\n      case \"abandon\":\n        return this.processAbandonRequest(currentActivity);\n      case \"abandonAll\":\n        return this.processAbandonAllRequest(currentActivity);\n      case \"suspendAll\":\n        return this.processSuspendAllRequest(currentActivity);\n      case \"resumeAll\":\n        return this.processResumeAllRequest();\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Process continue request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processContinueRequest(currentActivity: Activity): boolean {\n    // Check if continue is allowed\n    if (!this._sequencingControls.isForwardNavigationAllowed()) {\n      return false;\n    }\n\n    // Get the next activity\n    const nextActivity = this._activityTree.getNextSibling(currentActivity);\n    if (!nextActivity) {\n      return false;\n    }\n\n    // Evaluate exit condition rules\n    const exitConditionAction = this._sequencingRules.evaluateExitConditionRules(currentActivity);\n    if (exitConditionAction) {\n      // Handle exit condition action\n      switch (exitConditionAction) {\n        case RuleActionType.EXIT_PARENT:\n          // Exit to parent\n          const parent = currentActivity.parent;\n          if (parent) {\n            this._activityTree.currentActivity = parent;\n            return true;\n          }\n          return false;\n        case RuleActionType.EXIT_ALL:\n          // Exit all\n          this._activityTree.currentActivity = null;\n          return true;\n        default:\n          break;\n      }\n    }\n\n    // Set the next activity as current\n    this._activityTree.currentActivity = nextActivity;\n\n    // Evaluate post-condition rules\n    const postConditionAction = this._sequencingRules.evaluatePostConditionRules(nextActivity);\n    if (postConditionAction) {\n      // Handle post-condition action\n      switch (postConditionAction) {\n        case RuleActionType.RETRY:\n          // Retry this activity\n          nextActivity.incrementAttemptCount();\n          return true;\n        case RuleActionType.RETRY_ALL:\n          // Retry all activities\n          this._activityTree.getAllActivities().forEach(activity => {\n            activity.incrementAttemptCount();\n          });\n          return true;\n        case RuleActionType.CONTINUE:\n          // Continue to next activity\n          return this.processContinueRequest(nextActivity);\n        case RuleActionType.PREVIOUS:\n          // Go to previous activity\n          return this.processPreviousRequest(nextActivity);\n        case RuleActionType.EXIT:\n          // Exit this activity\n          this._activityTree.currentActivity = currentActivity;\n          return true;\n        default:\n          break;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Process previous request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processPreviousRequest(currentActivity: Activity): boolean {\n    // Check if backward navigation is allowed\n    if (!this._sequencingControls.isBackwardNavigationAllowed()) {\n      return false;\n    }\n\n    // Get the previous activity\n    const previousActivity = this._activityTree.getPreviousSibling(currentActivity);\n    if (!previousActivity) {\n      return false;\n    }\n\n    // Evaluate exit condition rules\n    const exitConditionAction = this._sequencingRules.evaluateExitConditionRules(currentActivity);\n    if (exitConditionAction) {\n      // Handle exit condition action\n      switch (exitConditionAction) {\n        case RuleActionType.EXIT_PARENT:\n          // Exit to parent\n          const parent = currentActivity.parent;\n          if (parent) {\n            this._activityTree.currentActivity = parent;\n            return true;\n          }\n          return false;\n        case RuleActionType.EXIT_ALL:\n          // Exit all\n          this._activityTree.currentActivity = null;\n          return true;\n        default:\n          break;\n      }\n    }\n\n    // Set the previous activity as current\n    this._activityTree.currentActivity = previousActivity;\n\n    // Evaluate post-condition rules\n    const postConditionAction = this._sequencingRules.evaluatePostConditionRules(previousActivity);\n    if (postConditionAction) {\n      // Handle post-condition action\n      switch (postConditionAction) {\n        case RuleActionType.RETRY:\n          // Retry this activity\n          previousActivity.incrementAttemptCount();\n          return true;\n        case RuleActionType.RETRY_ALL:\n          // Retry all activities\n          this._activityTree.getAllActivities().forEach(activity => {\n            activity.incrementAttemptCount();\n          });\n          return true;\n        case RuleActionType.CONTINUE:\n          // Continue to next activity\n          return this.processContinueRequest(previousActivity);\n        case RuleActionType.PREVIOUS:\n          // Go to previous activity\n          return this.processPreviousRequest(previousActivity);\n        case RuleActionType.EXIT:\n          // Exit this activity\n          this._activityTree.currentActivity = currentActivity;\n          return true;\n        default:\n          break;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Process exit request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processExitRequest(currentActivity: Activity): boolean {\n    // Check if exit is allowed\n    if (!this._sequencingControls.choiceExit) {\n      return false;\n    }\n\n    // Get the parent activity\n    const parent = currentActivity.parent;\n    if (!parent) {\n      return false;\n    }\n\n    // Set the parent activity as current\n    this._activityTree.currentActivity = parent;\n\n    return true;\n  }\n\n  /**\n   * Process exit all request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processExitAllRequest(currentActivity: Activity): boolean {\n    // Check if exit is allowed\n    if (!this._sequencingControls.choiceExit) {\n      return false;\n    }\n\n    // Set no activity as current\n    this._activityTree.currentActivity = null;\n\n    return true;\n  }\n\n  /**\n   * Process abandon request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processAbandonRequest(currentActivity: Activity): boolean {\n    // Get the parent activity\n    const parent = currentActivity.parent;\n    if (!parent) {\n      return false;\n    }\n\n    // Set the parent activity as current without processing exit rules\n    this._activityTree.currentActivity = parent;\n\n    return true;\n  }\n\n  /**\n   * Process abandon all request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processAbandonAllRequest(currentActivity: Activity): boolean {\n    // Set no activity as current without processing exit rules\n    this._activityTree.currentActivity = null;\n\n    return true;\n  }\n\n  /**\n   * Process suspend all request\n   * @param {Activity} currentActivity - The current activity\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processSuspendAllRequest(currentActivity: Activity): boolean {\n    // Set the current activity as suspended\n    this._activityTree.suspendedActivity = currentActivity;\n    this._activityTree.currentActivity = null;\n\n    return true;\n  }\n\n  /**\n   * Process resume all request\n   * @return {boolean} - True if the request is valid, false otherwise\n   */\n  processResumeAllRequest(): boolean {\n    // Get the suspended activity\n    const suspendedActivity = this._activityTree.suspendedActivity;\n    if (!suspendedActivity) {\n      return false;\n    }\n\n    // Set the suspended activity as current\n    this._activityTree.currentActivity = suspendedActivity;\n    this._activityTree.suspendedActivity = null;\n\n    return true;\n  }\n\n  /**\n   * Process rollup for the entire activity tree\n   */\n  processRollup(): void {\n    // Get the root activity\n    const root = this._activityTree.root;\n    if (!root) {\n      return;\n    }\n\n    // Process rollup from the bottom up\n    this._processRollupRecursive(root);\n  }\n\n  /**\n   * Process rollup recursively\n   * @param {Activity} activity - The activity to process rollup for\n   * @private\n   */\n  private _processRollupRecursive(activity: Activity): void {\n    // Process rollup for children first\n    for (const child of activity.children) {\n      this._processRollupRecursive(child);\n    }\n\n    // Process rollup for this activity\n    this._rollupRules.processRollup(activity);\n  }\n\n  /**\n   * toJSON for Sequencing\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result = {\n      activityTree: this._activityTree,\n      sequencingRules: this._sequencingRules,\n      sequencingControls: this._sequencingControls,\n      rollupRules: this._rollupRules,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}","import BaseAPI from \"./BaseAPI\";\nimport { CMI } from \"./cmi/scorm2004/cmi\";\nimport * as Utilities from \"./utilities\";\nimport { StringKeyMap, stringMatches } from \"./utilities\";\nimport { global_constants, scorm2004_constants } from \"./constants/api_constants\";\nimport { scorm2004_errors } from \"./constants/error_codes\";\nimport { CMIObjectivesObject } from \"./cmi/scorm2004/objectives\";\nimport { ADL, ADLDataObject } from \"./cmi/scorm2004/adl\";\nimport { CommitObject, ResultObject, ScoreObject, Settings } from \"./types/api_types\";\nimport { ActivitySettings, SequencingSettings, SequencingRulesSettings, SequencingControlsSettings, RollupRulesSettings, SequencingRuleSettings, RollupRuleSettings } from \"./types/sequencing_types\";\nimport { SequencingRule, RuleCondition } from \"./cmi/scorm2004/sequencing/sequencing_rules\";\nimport { RollupRule, RollupCondition } from \"./cmi/scorm2004/sequencing/rollup_rules\";\nimport { scorm2004_regex } from \"./constants/regex\"; // Import functions from extracted modules\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport {\n  CMIInteractionsCorrectResponsesObject,\n  CMIInteractionsObject,\n  CMIInteractionsObjectivesObject,\n} from \"./cmi/scorm2004/interactions\";\nimport { CMIArray } from \"./cmi/common/array\";\nimport { CorrectResponses, ResponseType } from \"./constants/response_constants\";\nimport { CMICommentsObject } from \"./cmi/scorm2004/comments\";\nimport ValidLanguages from \"./constants/language_constants\";\nimport { CompletionStatus, SuccessStatus } from \"./constants/enums\";\nimport { Sequencing } from \"./cmi/scorm2004/sequencing/sequencing\";\nimport { Activity } from \"./cmi/scorm2004/sequencing/activity\";\n\n/**\n * API class for SCORM 2004\n */\nclass Scorm2004Impl extends BaseAPI {\n  private _version: string = \"1.0\";\n  private _globalObjectives: CMIObjectivesObject[] = [];\n  private _sequencing: Sequencing;\n\n  /**\n   * Constructor for SCORM 2004 API\n   * @param {Settings} settings\n   */\n  constructor(settings?: Settings) {\n    if (settings) {\n      if (settings.mastery_override === undefined) {\n        settings.mastery_override = false;\n      }\n    }\n\n    super(scorm2004_errors, settings);\n\n    this.cmi = new CMI();\n    this.adl = new ADL();\n    this._sequencing = new Sequencing();\n\n    // Connect the sequencing object to the ADL's sequencing property\n    this.adl.sequencing = this._sequencing;\n\n    // Configure sequencing if settings are provided\n    if (settings?.sequencing) {\n      this.configureSequencing(settings.sequencing);\n    }\n\n    // Rename functions to match 2004 Spec and expose to modules\n    this.Initialize = this.lmsInitialize;\n    this.Terminate = this.lmsFinish;\n    this.GetValue = this.lmsGetValue;\n    this.SetValue = this.lmsSetValue;\n    this.Commit = this.lmsCommit;\n    this.GetLastError = this.lmsGetLastError;\n    this.GetErrorString = this.lmsGetErrorString;\n    this.GetDiagnostic = this.lmsGetDiagnostic;\n  }\n\n  public cmi: CMI;\n  public adl: ADL;\n\n  public Initialize: () => string;\n  public Terminate: () => string;\n  public GetValue: (CMIElement: string) => string;\n  public SetValue: (CMIElement: string, value: any) => string;\n  public Commit: () => string;\n  public GetLastError: () => string;\n  public GetErrorString: (CMIErrorCode: string | number) => string;\n  public GetDiagnostic: (CMIErrorCode: string | number) => string;\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset(settings?: Settings) {\n    this.commonReset(settings);\n\n    this.cmi?.reset();\n    this.adl?.reset();\n    this._sequencing?.reset();\n  }\n\n  /**\n   * Getter for _version\n   * @return {string}\n   */\n  get version(): string {\n    return this._version;\n  }\n\n  /**\n   * Getter for _globalObjectives\n   */\n  get globalObjectives(): CMIObjectivesObject[] {\n    return this._globalObjectives;\n  }\n\n  /**\n   * Initialize function from SCORM 2004 Spec\n   *\n   * @return {string} bool\n   */\n  lmsInitialize(): string {\n    this.cmi.initialize();\n    return this.initialize(\n      \"Initialize\",\n      \"LMS was already initialized!\",\n      \"LMS is already finished!\",\n    );\n  }\n\n  /**\n   * Terminate function from SCORM 2004 Spec\n   *\n   * @return {string} bool\n   */\n  lmsFinish(): string {\n    (async () => {\n      await this.internalFinish();\n    })();\n    return global_constants.SCORM_TRUE;\n  }\n\n  async internalFinish(): Promise<string> {\n    const result = await this.terminate(\"Terminate\", true);\n\n    if (result === global_constants.SCORM_TRUE) {\n      if (this.adl.nav.request !== \"_none_\") {\n        const navActions: { [key: string]: string } = {\n          continue: \"SequenceNext\",\n          previous: \"SequencePrevious\",\n          choice: \"SequenceChoice\",\n          jump: \"SequenceJump\",\n          exit: \"SequenceExit\",\n          exitAll: \"SequenceExitAll\",\n          abandon: \"SequenceAbandon\",\n          abandonAll: \"SequenceAbandonAll\",\n        };\n\n        let request = this.adl.nav.request;\n        const choiceJumpRegex = new RegExp(scorm2004_regex.NAVEvent);\n        const matches = request.match(choiceJumpRegex);\n        let target = \"\";\n        if (matches) {\n          if (matches.groups?.choice_target) {\n            target = matches.groups?.choice_target;\n            request = \"choice\";\n          } else if (matches.groups?.jump_target) {\n            target = matches.groups?.jump_target;\n            request = \"jump\";\n          }\n        }\n        const action = navActions[request];\n        if (action) {\n          this.processListeners(action, \"adl.nav.request\", target);\n        }\n      } else if (this.settings.autoProgress) {\n        this.processListeners(\"SequenceNext\", null, \"next\");\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * GetValue function from SCORM 2004 Spec\n   *\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  lmsGetValue(CMIElement: string): string {\n    const adlNavRequestRegex =\n      \"^adl\\\\.nav\\\\.request_valid\\\\.(choice|jump)\\\\.{target=\\\\S{0,}([a-zA-Z0-9-_]+)}$\";\n    if (stringMatches(CMIElement, adlNavRequestRegex)) {\n      const matches = CMIElement.match(adlNavRequestRegex);\n      const request = matches[1];\n      const target = matches[2].replace(\"{target=\", \"\").replace(\"}\", \"\");\n      if (request === \"choice\" || request === \"jump\") {\n        if (this.settings.scoItemIdValidator) {\n          return String(this.settings.scoItemIdValidator(target));\n        }\n        return String(this.settings.scoItemIds.includes(target));\n      }\n    }\n    return this.getValue(\"GetValue\", true, CMIElement);\n  }\n\n  /**\n   * SetValue function from SCORM 2004 Spec\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  lmsSetValue(CMIElement: string, value: any): string {\n    // Proceed with regular setting for non-objective elements or fallback behavior\n    return this.setValue(\"SetValue\", \"Commit\", true, CMIElement, value);\n  }\n\n  /**\n   * Commit function from SCORM 2004 Spec\n   *\n   * @return {string} bool\n   */\n  lmsCommit(): string {\n    if (this.settings.asyncCommit) {\n      this.scheduleCommit(500, \"Commit\");\n    } else {\n      (async () => {\n        await this.commit(\"Commit\", false);\n      })();\n    }\n    return global_constants.SCORM_TRUE;\n  }\n\n  /**\n   * GetLastError function from SCORM 2004 Spec\n   *\n   * @return {string}\n   */\n  lmsGetLastError(): string {\n    return this.getLastError(\"GetLastError\");\n  }\n\n  /**\n   * GetErrorString function from SCORM 2004 Spec\n   *\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetErrorString(CMIErrorCode: string | number): string {\n    return this.getErrorString(\"GetErrorString\", CMIErrorCode);\n  }\n\n  /**\n   * GetDiagnostic function from SCORM 2004 Spec\n   *\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetDiagnostic(CMIErrorCode: string | number): string {\n    return this.getDiagnostic(\"GetDiagnostic\", CMIErrorCode);\n  }\n\n  /**\n   * Sets a value on the CMI Object - delegates to CMIValueHandlerModule\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  override setCMIValue(CMIElement: string, value: any): string {\n    // Check if we're updating a global or local objective\n    if (stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\")) {\n      const parts = CMIElement.split(\".\");\n      const index = Number(parts[2]);\n      const element_base = `cmi.objectives.${index}`;\n\n      let objective_id;\n      const setting_id = stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\\\\.id\");\n\n      if (setting_id) {\n        // If we're setting the objective ID, capture it directly\n        objective_id = value;\n      } else {\n        // Find existing objective ID if available\n        const objective = this.cmi.objectives.findObjectiveByIndex(index);\n        objective_id = objective ? objective.id : undefined;\n      }\n\n      // Check if the objective ID matches a global objective\n      const is_global = objective_id && this.settings.globalObjectiveIds.includes(objective_id);\n\n      if (is_global) {\n        // Locate or create an entry in _globalObjectives for the global objective\n        let global_index = this._globalObjectives.findIndex((obj) => obj.id === objective_id);\n\n        if (global_index === -1) {\n          global_index = this._globalObjectives.length;\n          const newGlobalObjective = new CMIObjectivesObject();\n          newGlobalObjective.id = objective_id;\n          this._globalObjectives.push(newGlobalObjective);\n        }\n\n        // Update the global objective\n        const global_element = CMIElement.replace(\n          element_base,\n          `_globalObjectives.${global_index}`,\n        );\n        this._commonSetCMIValue(\"SetGlobalObjectiveValue\", true, global_element, value);\n      }\n    }\n    return this._commonSetCMIValue(\"SetValue\", true, CMIElement, value);\n  }\n\n  /**\n   * Gets or builds a new child element to add to the array - delegates to CMIElementHandlerModule\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @param {boolean} foundFirstIndex\n   * @return {BaseCMI|null}\n   */\n  getChildElement(CMIElement: string, value: any, foundFirstIndex: boolean): BaseCMI | null {\n    if (stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\")) {\n      return new CMIObjectivesObject();\n    }\n\n    if (foundFirstIndex) {\n      if (stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\\\\.correct_responses\\\\.\\\\d+\")) {\n        return this.createCorrectResponsesObject(CMIElement, value);\n      } else if (stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\\\\.objectives\\\\.\\\\d+\")) {\n        return new CMIInteractionsObjectivesObject();\n      }\n    } else if (stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\")) {\n      return new CMIInteractionsObject();\n    }\n\n    if (stringMatches(CMIElement, \"cmi\\\\.comments_from_learner\\\\.\\\\d+\")) {\n      return new CMICommentsObject();\n    } else if (stringMatches(CMIElement, \"cmi\\\\.comments_from_lms\\\\.\\\\d+\")) {\n      return new CMICommentsObject(true);\n    }\n\n    if (stringMatches(CMIElement, \"adl\\\\.data\\\\.\\\\d+\")) {\n      return new ADLDataObject();\n    }\n\n    return null;\n  }\n\n  /**\n   * Creates a correct responses object for an interaction - delegates to CMIElementHandlerModule\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {BaseCMI|null}\n   */\n  private createCorrectResponsesObject(CMIElement: string, value: any): BaseCMI | null {\n    const parts = CMIElement.split(\".\");\n    const index = Number(parts[2]);\n    const interaction = this.cmi.interactions.childArray[index];\n\n    if (this.isInitialized()) {\n      if (typeof interaction === \"undefined\" || !interaction.type) {\n        this.throwSCORMError(CMIElement, scorm2004_errors.DEPENDENCY_NOT_ESTABLISHED, CMIElement);\n        return null;\n      } else {\n        this.checkDuplicateChoiceResponse(CMIElement, interaction, value);\n        const response_type = CorrectResponses[interaction.type];\n        if (response_type) {\n          this.checkValidResponseType(CMIElement, response_type, value, interaction.type);\n        } else {\n          this.throwSCORMError(\n            CMIElement,\n            scorm2004_errors.GENERAL_SET_FAILURE,\n            `Incorrect Response Type: ${interaction.type}`,\n          );\n          return null;\n        }\n      }\n    }\n\n    if (this.lastErrorCode === \"0\") {\n      return new CMIInteractionsCorrectResponsesObject(interaction);\n    }\n\n    return null;\n  }\n\n  /**\n   * Checks for valid response types - delegates to ValidationModule\n   * @param {string} CMIElement\n   * @param {ResponseType} response_type\n   * @param {any} value\n   * @param {string} interaction_type\n   */\n  checkValidResponseType(\n    CMIElement: string,\n    response_type: ResponseType,\n    value: any,\n    interaction_type: string,\n  ) {\n    let nodes = [];\n    if (response_type?.delimiter) {\n      nodes = String(value).split(response_type.delimiter);\n    } else {\n      nodes[0] = value;\n    }\n\n    if (nodes.length > 0 && nodes.length <= response_type.max) {\n      this.checkCorrectResponseValue(CMIElement, interaction_type, nodes, value);\n    } else if (nodes.length > response_type.max) {\n      this.throwSCORMError(\n        CMIElement,\n        scorm2004_errors.GENERAL_SET_FAILURE,\n        `Data Model Element Pattern Too Long: ${value}`,\n      );\n    }\n  }\n\n  /**\n   * Checks for duplicate 'choice' responses - delegates to ValidationModule\n   * @param {string} CMIElement\n   * @param {CMIInteractionsObject} interaction\n   * @param {any} value\n   */\n  checkDuplicateChoiceResponse(CMIElement: string, interaction: CMIInteractionsObject, value: any) {\n    const interaction_count = interaction.correct_responses._count;\n    if (interaction.type === \"choice\") {\n      for (let i = 0; i < interaction_count && this.lastErrorCode === \"0\"; i++) {\n        const response = interaction.correct_responses.childArray[i];\n        if (response.pattern === value) {\n          this.throwSCORMError(CMIElement, scorm2004_errors.GENERAL_SET_FAILURE, `${value}`);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validate correct response - delegates to ValidationModule\n   * @param {string} CMIElement\n   * @param {*} value\n   */\n  validateCorrectResponse(CMIElement: string, value: any) {\n    const parts = CMIElement.split(\".\");\n    const index = Number(parts[2]);\n    const pattern_index = Number(parts[4]);\n    const interaction = this.cmi.interactions.childArray[index];\n\n    const interaction_count = interaction.correct_responses._count;\n    this.checkDuplicateChoiceResponse(CMIElement, interaction, value);\n\n    const response_type = CorrectResponses[interaction.type];\n    if (typeof response_type.limit === \"undefined\" || interaction_count <= response_type.limit) {\n      this.checkValidResponseType(CMIElement, response_type, value, interaction.type);\n\n      if (\n        (this.lastErrorCode === \"0\" &&\n          (!response_type.duplicate ||\n            !this.checkDuplicatedPattern(interaction.correct_responses, pattern_index, value))) ||\n        (this.lastErrorCode === \"0\" && value === \"\")\n      ) {\n        // do nothing, we want the inverse\n      } else {\n        if (this.lastErrorCode === \"0\") {\n          this.throwSCORMError(\n            CMIElement,\n            scorm2004_errors.GENERAL_SET_FAILURE,\n            `Data Model Element Pattern Already Exists: ${CMIElement} - ${value}`,\n          );\n        }\n      }\n    } else {\n      this.throwSCORMError(\n        CMIElement,\n        scorm2004_errors.GENERAL_SET_FAILURE,\n        `Data Model Element Collection Limit Reached: ${CMIElement} - ${value}`,\n      );\n    }\n  }\n\n  /**\n   * Gets a value from the CMI Object - delegates to CMIValueHandlerModule\n   *\n   * @param {string} CMIElement\n   * @return {*}\n   */\n  override getCMIValue(CMIElement: string): any {\n    return this._commonGetCMIValue(\"GetValue\", true, CMIElement);\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber.\n   *\n   * @param {(string|number)} errorNumber\n   * @param {boolean} detail\n   * @return {string}\n   */\n  override getLmsErrorMessageDetails(errorNumber: string | number, detail: boolean): string {\n    let basicMessage = \"\";\n    let detailMessage = \"\";\n\n    // Set error number to string since inconsistent from modules if string or number\n    errorNumber = String(errorNumber);\n    if (scorm2004_constants.error_descriptions[errorNumber]) {\n      basicMessage = scorm2004_constants.error_descriptions[errorNumber].basicMessage;\n      detailMessage = scorm2004_constants.error_descriptions[errorNumber].detailMessage;\n    }\n\n    return detail ? detailMessage : basicMessage;\n  }\n\n  /**\n   * Check to see if a correct_response value has been duplicated - delegates to ValidationModule\n   * @param {CMIArray} correct_response\n   * @param {number} current_index\n   * @param {*} value\n   * @return {boolean}\n   */\n  checkDuplicatedPattern(correct_response: CMIArray, current_index: number, value: any): boolean {\n    let found = false;\n    const count = correct_response._count;\n    for (let i = 0; i < count && !found; i++) {\n      if (i !== current_index && correct_response.childArray[i] === value) {\n        found = true;\n      }\n    }\n    return found;\n  }\n\n  /**\n   * Checks for a valid correct_response value - delegates to ValidationModule\n   * @param {string} CMIElement\n   * @param {string} interaction_type\n   * @param {Array} nodes\n   * @param {*} value\n   */\n  checkCorrectResponseValue(\n    CMIElement: string,\n    interaction_type: string,\n    nodes: Array<any>,\n    value: any,\n  ) {\n    const response = CorrectResponses[interaction_type];\n    if (!response) {\n      this.throwSCORMError(\n        CMIElement,\n        scorm2004_errors.TYPE_MISMATCH,\n        `Incorrect Response Type: ${interaction_type}`,\n      );\n      return;\n    }\n    const formatRegex = new RegExp(response.format);\n    for (let i = 0; i < nodes.length && this.lastErrorCode === \"0\"; i++) {\n      if (interaction_type.match(\"^(fill-in|long-fill-in|matching|performance|sequencing)$\")) {\n        nodes[i] = this.removeCorrectResponsePrefixes(CMIElement, nodes[i]);\n      }\n\n      if (response?.delimiter2) {\n        const values = nodes[i].split(response.delimiter2);\n        if (values.length === 2) {\n          const matches = values[0].match(formatRegex);\n          if (!matches) {\n            this.throwSCORMError(\n              CMIElement,\n              scorm2004_errors.TYPE_MISMATCH,\n              `${interaction_type}: ${value}`,\n            );\n          } else {\n            if (!response.format2 || !values[1].match(new RegExp(response.format2))) {\n              this.throwSCORMError(\n                CMIElement,\n                scorm2004_errors.TYPE_MISMATCH,\n                `${interaction_type}: ${value}`,\n              );\n            }\n          }\n        } else {\n          this.throwSCORMError(\n            CMIElement,\n            scorm2004_errors.TYPE_MISMATCH,\n            `${interaction_type}: ${value}`,\n          );\n        }\n      } else {\n        const matches = nodes[i].match(formatRegex);\n        if ((!matches && value !== \"\") || (!matches && interaction_type === \"true-false\")) {\n          this.throwSCORMError(\n            CMIElement,\n            scorm2004_errors.TYPE_MISMATCH,\n            `${interaction_type}: ${value}`,\n          );\n        } else {\n          if (interaction_type === \"numeric\" && nodes.length > 1) {\n            if (Number(nodes[0]) > Number(nodes[1])) {\n              this.throwSCORMError(\n                CMIElement,\n                scorm2004_errors.TYPE_MISMATCH,\n                `${interaction_type}: ${value}`,\n              );\n            }\n          } else {\n            if (nodes[i] !== \"\" && response.unique) {\n              for (let j = 0; j < i && this.lastErrorCode === \"0\"; j++) {\n                if (nodes[i] === nodes[j]) {\n                  this.throwSCORMError(\n                    CMIElement,\n                    scorm2004_errors.TYPE_MISMATCH,\n                    `${interaction_type}: ${value}`,\n                  );\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove prefixes from correct_response - delegates to ValidationModule\n   * @param {string} CMIElement\n   * @param {string} node\n   * @return {*}\n   */\n  removeCorrectResponsePrefixes(CMIElement: string, node: string): any {\n    let seenOrder = false;\n    let seenCase = false;\n    let seenLang = false;\n\n    const prefixRegex = new RegExp(\"^({(lang|case_matters|order_matters)=([^}]+)})\");\n    let matches = node.match(prefixRegex);\n    let langMatches = null;\n    while (matches) {\n      switch (matches[2]) {\n        case \"lang\":\n          langMatches = node.match(scorm2004_regex.CMILangcr);\n          if (langMatches) {\n            const lang = langMatches[3];\n            if (lang !== undefined && lang.length > 0) {\n              if (!ValidLanguages.includes(lang.toLowerCase())) {\n                this.throwSCORMError(CMIElement, scorm2004_errors.TYPE_MISMATCH, `${node}`);\n              }\n            }\n          }\n          seenLang = true;\n          break;\n        case \"case_matters\":\n          if (!seenLang && !seenOrder && !seenCase) {\n            if (matches[3] !== \"true\" && matches[3] !== \"false\") {\n              this.throwSCORMError(CMIElement, scorm2004_errors.TYPE_MISMATCH, `${node}`);\n            }\n          }\n\n          seenCase = true;\n          break;\n        case \"order_matters\":\n          if (!seenCase && !seenLang && !seenOrder) {\n            if (matches[3] !== \"true\" && matches[3] !== \"false\") {\n              this.throwSCORMError(CMIElement, scorm2004_errors.TYPE_MISMATCH, `${node}`);\n            }\n          }\n\n          seenOrder = true;\n          break;\n      }\n      node = node.substring(matches[1].length);\n      matches = node.match(prefixRegex);\n    }\n\n    return node;\n  }\n\n  /**\n   * Replace the whole API with another\n   * @param {Scorm2004Impl} newAPI\n   */\n  replaceWithAnotherScormAPI(newAPI: Scorm2004Impl) {\n    // Data Model\n    this.cmi = newAPI.cmi;\n    this.adl = newAPI.adl;\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit - delegates to DataSerializationModule\n   *\n   * @param {boolean} terminateCommit\n   * @return {object|Array}\n   */\n  renderCommitCMI(terminateCommit: boolean): StringKeyMap | Array<any> {\n    const cmiExport: StringKeyMap = this.renderCMIToJSONObject();\n\n    if (terminateCommit) {\n      (cmiExport.cmi as any).total_time = (this.cmi as any).getCurrentTotalTime();\n    }\n\n    const result = [];\n    const flattened: StringKeyMap = Utilities.flatten(cmiExport);\n    switch (this.settings.dataCommitFormat) {\n      case \"flattened\":\n        return Utilities.flatten(cmiExport);\n      case \"params\":\n        for (const item in flattened) {\n          if ({}.hasOwnProperty.call(flattened, item)) {\n            result.push(`${item}=${flattened[item]}`);\n          }\n        }\n        return result;\n      case \"json\":\n      default:\n        return cmiExport;\n    }\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit - delegates to DataSerializationModule\n   * @param {boolean} terminateCommit\n   * @return {CommitObject}\n   */\n  renderCommitObject(terminateCommit: boolean): CommitObject {\n    const cmiExport = this.renderCommitCMI(terminateCommit);\n    const totalTimeDuration = this.cmi.getCurrentTotalTime();\n    const totalTimeSeconds = Utilities.getDurationAsSeconds(\n      totalTimeDuration,\n      scorm2004_regex.CMITimespan,\n    );\n\n    let completionStatus = CompletionStatus.UNKNOWN;\n    let successStatus = SuccessStatus.UNKNOWN;\n    if (this.cmi.completion_status) {\n      if (this.cmi.completion_status === \"completed\") {\n        completionStatus = CompletionStatus.COMPLETED;\n      } else if (this.cmi.completion_status === \"incomplete\") {\n        completionStatus = CompletionStatus.INCOMPLETE;\n      }\n    }\n    if (this.cmi.success_status) {\n      if (this.cmi.success_status === \"passed\") {\n        successStatus = SuccessStatus.PASSED;\n      } else if (this.cmi.success_status === \"failed\") {\n        successStatus = SuccessStatus.FAILED;\n      }\n    }\n\n    const score = this.cmi.score;\n    let scoreObject: ScoreObject = null;\n    if (score) {\n      scoreObject = {};\n\n      if (!Number.isNaN(Number.parseFloat(score.raw))) {\n        scoreObject.raw = Number.parseFloat(score.raw);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.min))) {\n        scoreObject.min = Number.parseFloat(score.min);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.max))) {\n        scoreObject.max = Number.parseFloat(score.max);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.scaled))) {\n        scoreObject.scaled = Number.parseFloat(score.scaled);\n      }\n    }\n\n    const commitObject: CommitObject = {\n      completionStatus: completionStatus,\n      successStatus: successStatus,\n      totalTimeSeconds: totalTimeSeconds,\n      runtimeData: cmiExport as StringKeyMap,\n    };\n    if (scoreObject) {\n      commitObject.score = scoreObject;\n    }\n    return commitObject;\n  }\n\n  /**\n   * Attempts to store the data to the LMS - delegates to DataSerializationModule\n   *\n   * @param {boolean} terminateCommit\n   * @return {ResultObject}\n   */\n  async storeData(terminateCommit: boolean): Promise<ResultObject> {\n    if (terminateCommit) {\n      if (this.cmi.mode === \"normal\") {\n        if (this.cmi.credit === \"credit\") {\n          if (this.cmi.completion_threshold && this.cmi.progress_measure) {\n            if (this.cmi.progress_measure >= this.cmi.completion_threshold) {\n              this.cmi.completion_status = \"completed\";\n            } else {\n              this.cmi.completion_status = \"incomplete\";\n            }\n          }\n          if (this.cmi.scaled_passing_score && this.cmi.score.scaled) {\n            if (this.cmi.score.scaled >= this.cmi.scaled_passing_score) {\n              this.cmi.success_status = \"passed\";\n            } else {\n              this.cmi.success_status = \"failed\";\n            }\n          }\n        }\n      }\n    }\n\n    let navRequest = false;\n    if (\n      this.adl.nav.request !==\n        ((this.startingData?.adl as StringKeyMap)?.nav as StringKeyMap)?.request &&\n      this.adl.nav.request !== \"_none_\"\n    ) {\n      navRequest = true;\n    }\n\n    const commitObject = this.getCommitObject(terminateCommit);\n    if (typeof this.settings.lmsCommitUrl === \"string\") {\n      const result = await this.processHttpRequest(\n        this.settings.lmsCommitUrl,\n        {\n          commitObject: commitObject,\n        },\n        terminateCommit,\n      );\n\n      // Check if this is a sequencing call, and then call the necessary JS\n      if (\n        navRequest &&\n        result.navRequest !== undefined &&\n        result.navRequest !== \"\" &&\n        typeof result.navRequest === \"string\"\n      ) {\n        Function(`\"use strict\";(() => { ${result.navRequest} })()`)();\n      } else if (result?.navRequest && !navRequest) {\n        if (\n          typeof result.navRequest === \"object\" &&\n          Object.hasOwnProperty.call(result.navRequest, \"name\")\n        ) {\n          this.processListeners(result.navRequest.name as string, result.navRequest.data as string);\n        }\n      }\n\n      return result;\n    }\n\n    return {\n      result: \"true\",\n      errorCode: 0,\n    };\n  }\n\n  /**\n   * Configure sequencing based on provided settings\n   * @param {SequencingSettings} sequencingSettings - The sequencing settings\n   */\n  private configureSequencing(sequencingSettings: SequencingSettings): void {\n    // Configure activity tree\n    if (sequencingSettings.activityTree) {\n      this.configureActivityTree(sequencingSettings.activityTree);\n    }\n\n    // Configure sequencing rules\n    if (sequencingSettings.sequencingRules) {\n      this.configureSequencingRules(sequencingSettings.sequencingRules);\n    }\n\n    // Configure sequencing controls\n    if (sequencingSettings.sequencingControls) {\n      this.configureSequencingControls(sequencingSettings.sequencingControls);\n    }\n\n    // Configure rollup rules\n    if (sequencingSettings.rollupRules) {\n      this.configureRollupRules(sequencingSettings.rollupRules);\n    }\n  }\n\n  /**\n   * Configure activity tree based on provided settings\n   * @param {ActivitySettings} activityTreeSettings - The activity tree settings\n   */\n  private configureActivityTree(activityTreeSettings: ActivitySettings): void {\n    // Create root activity\n    const rootActivity = this.createActivity(activityTreeSettings);\n\n    // Create activity tree\n    const activityTree = this._sequencing.activityTree;\n    activityTree.root = rootActivity;\n  }\n\n  /**\n   * Create an activity from settings\n   * @param {ActivitySettings} activitySettings - The activity settings\n   * @return {Activity} - The created activity\n   */\n  private createActivity(activitySettings: ActivitySettings): Activity {\n    // Create activity\n    const activity = new Activity(activitySettings.id, activitySettings.title);\n\n    // Set activity properties\n    if (activitySettings.isVisible !== undefined) {\n      activity.isVisible = activitySettings.isVisible;\n    }\n    if (activitySettings.isActive !== undefined) {\n      activity.isActive = activitySettings.isActive;\n    }\n    if (activitySettings.isSuspended !== undefined) {\n      activity.isSuspended = activitySettings.isSuspended;\n    }\n    if (activitySettings.isCompleted !== undefined) {\n      activity.isCompleted = activitySettings.isCompleted;\n    }\n\n    // Create child activities\n    if (activitySettings.children) {\n      for (const childSettings of activitySettings.children) {\n        const childActivity = this.createActivity(childSettings);\n        activity.addChild(childActivity);\n      }\n    }\n\n    return activity;\n  }\n\n  /**\n   * Configure sequencing rules based on provided settings\n   * @param {SequencingRulesSettings} sequencingRulesSettings - The sequencing rules settings\n   */\n  private configureSequencingRules(sequencingRulesSettings: SequencingRulesSettings): void {\n    const sequencingRules = this._sequencing.sequencingRules;\n\n    // Configure pre-condition rules\n    if (sequencingRulesSettings.preConditionRules) {\n      for (const ruleSettings of sequencingRulesSettings.preConditionRules) {\n        const rule = this.createSequencingRule(ruleSettings);\n        sequencingRules.addPreConditionRule(rule);\n      }\n    }\n\n    // Configure exit condition rules\n    if (sequencingRulesSettings.exitConditionRules) {\n      for (const ruleSettings of sequencingRulesSettings.exitConditionRules) {\n        const rule = this.createSequencingRule(ruleSettings);\n        sequencingRules.addExitConditionRule(rule);\n      }\n    }\n\n    // Configure post-condition rules\n    if (sequencingRulesSettings.postConditionRules) {\n      for (const ruleSettings of sequencingRulesSettings.postConditionRules) {\n        const rule = this.createSequencingRule(ruleSettings);\n        sequencingRules.addPostConditionRule(rule);\n      }\n    }\n  }\n\n  /**\n   * Create a sequencing rule from settings\n   * @param {SequencingRuleSettings} ruleSettings - The sequencing rule settings\n   * @return {SequencingRule} - The created sequencing rule\n   */\n  private createSequencingRule(ruleSettings: SequencingRuleSettings): SequencingRule {\n\n    // Create rule\n    const rule = new SequencingRule(\n      ruleSettings.action,\n      ruleSettings.conditionCombination\n    );\n\n    // Add conditions\n    for (const conditionSettings of ruleSettings.conditions) {\n      const condition = new RuleCondition(\n        conditionSettings.condition,\n        conditionSettings.operator,\n        new Map(Object.entries(conditionSettings.parameters || {}))\n      );\n      rule.addCondition(condition);\n    }\n\n    return rule;\n  }\n\n  /**\n   * Configure sequencing controls based on provided settings\n   * @param {SequencingControlsSettings} sequencingControlsSettings - The sequencing controls settings\n   */\n  private configureSequencingControls(sequencingControlsSettings: SequencingControlsSettings): void {\n    const sequencingControls = this._sequencing.sequencingControls;\n\n    // Set sequencing control properties\n    if (sequencingControlsSettings.enabled !== undefined) {\n      sequencingControls.enabled = sequencingControlsSettings.enabled;\n    }\n    if (sequencingControlsSettings.choiceExit !== undefined) {\n      sequencingControls.choiceExit = sequencingControlsSettings.choiceExit;\n    }\n    if (sequencingControlsSettings.flow !== undefined) {\n      sequencingControls.flow = sequencingControlsSettings.flow;\n    }\n    if (sequencingControlsSettings.forwardOnly !== undefined) {\n      sequencingControls.forwardOnly = sequencingControlsSettings.forwardOnly;\n    }\n    if (sequencingControlsSettings.useCurrentAttemptObjectiveInfo !== undefined) {\n      sequencingControls.useCurrentAttemptObjectiveInfo = sequencingControlsSettings.useCurrentAttemptObjectiveInfo;\n    }\n    if (sequencingControlsSettings.useCurrentAttemptProgressInfo !== undefined) {\n      sequencingControls.useCurrentAttemptProgressInfo = sequencingControlsSettings.useCurrentAttemptProgressInfo;\n    }\n    if (sequencingControlsSettings.preventActivation !== undefined) {\n      sequencingControls.preventActivation = sequencingControlsSettings.preventActivation;\n    }\n    if (sequencingControlsSettings.constrainChoice !== undefined) {\n      sequencingControls.constrainChoice = sequencingControlsSettings.constrainChoice;\n    }\n    if (sequencingControlsSettings.rollupObjectiveSatisfied !== undefined) {\n      sequencingControls.rollupObjectiveSatisfied = sequencingControlsSettings.rollupObjectiveSatisfied;\n    }\n    if (sequencingControlsSettings.rollupProgressCompletion !== undefined) {\n      sequencingControls.rollupProgressCompletion = sequencingControlsSettings.rollupProgressCompletion;\n    }\n    if (sequencingControlsSettings.objectiveMeasureWeight !== undefined) {\n      sequencingControls.objectiveMeasureWeight = sequencingControlsSettings.objectiveMeasureWeight;\n    }\n  }\n\n  /**\n   * Configure rollup rules based on provided settings\n   * @param {RollupRulesSettings} rollupRulesSettings - The rollup rules settings\n   */\n  private configureRollupRules(rollupRulesSettings: RollupRulesSettings): void {\n    const rollupRules = this._sequencing.rollupRules;\n\n    // Configure rollup rules\n    if (rollupRulesSettings.rules) {\n      for (const ruleSettings of rollupRulesSettings.rules) {\n        const rule = this.createRollupRule(ruleSettings);\n        rollupRules.addRule(rule);\n      }\n    }\n  }\n\n  /**\n   * Create a rollup rule from settings\n   * @param {RollupRuleSettings} ruleSettings - The rollup rule settings\n   * @return {RollupRule} - The created rollup rule\n   */\n  private createRollupRule(ruleSettings: RollupRuleSettings): RollupRule {\n\n    // Create rule\n    const rule = new RollupRule(\n      ruleSettings.action,\n      ruleSettings.consideration,\n      ruleSettings.minimumCount,\n      ruleSettings.minimumPercent\n    );\n\n    // Add conditions\n    for (const conditionSettings of ruleSettings.conditions) {\n      const condition = new RollupCondition(\n        conditionSettings.condition,\n        new Map(Object.entries(conditionSettings.parameters || {}))\n      );\n      rule.addCondition(condition);\n    }\n\n    return rule;\n  }\n}\n\nexport { Scorm2004Impl as Scorm2004API };\n","import { BaseCMI } from \"./base_cmi\";\nimport { BaseScormValidationError } from \"../../exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\n\n/**\n * Base class for cmi *.n objects\n */\nexport class CMIArray extends BaseCMI {\n  private readonly _errorCode: number;\n  private readonly _errorClass: typeof BaseScormValidationError;\n  private readonly __children: string;\n  public childArray: any[];\n\n  /**\n   * Constructor cmi *.n arrays\n   * @param {object} params\n   */\n  constructor(params: {\n    CMIElement: string;\n    children: string;\n    errorCode?: number;\n    errorClass?: typeof BaseScormValidationError;\n  }) {\n    super(params.CMIElement);\n    this.__children = params.children;\n    this._errorCode = params.errorCode || scorm12_errors.GENERAL;\n    this._errorClass = params.errorClass || BaseScormValidationError;\n    this.childArray = [];\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(wipe: boolean = false): void {\n    this._initialized = false;\n    if (wipe) {\n      this.childArray = [];\n    } else {\n      // Reset all children\n      for (let i = 0; i < this.childArray.length; i++) {\n        this.childArray[i].reset();\n      }\n    }\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for _children. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new this._errorClass(\n      this._cmi_element + \"._children\",\n      this._errorCode,\n    );\n  }\n\n  /**\n   * Getter for _count\n   * @return {number}\n   */\n  get _count(): number {\n    return this.childArray.length;\n  }\n\n  /**\n   * Setter for _count. Just throws an error.\n   * @param {number} _count\n   */\n  set _count(_count: number) {\n    throw new this._errorClass(this._cmi_element + \"._count\", this._errorCode);\n  }\n\n  /**\n   * toJSON for *.n arrays\n   * @return {object}\n   */\n  toJSON(): object {\n    this.jsonString = true;\n    const result: { [key: string]: any } = {};\n    for (let i = 0; i < this.childArray.length; i++) {\n      result[i + \"\"] = this.childArray[i];\n    }\n    delete this.jsonString;\n    return result;\n  }\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","import { LogLevel, ResultObject, Settings } from \"../types/api_types\";\nimport { global_constants } from \"./api_constants\";\nimport { LogLevelEnum } from \"./enums\";\n\n/**\n * Default settings for the SCORM API\n */\nexport const DefaultSettings: Settings = {\n  autocommit: false,\n  autocommitSeconds: 10,\n  asyncCommit: false,\n  sendFullCommit: true,\n  lmsCommitUrl: false,\n  dataCommitFormat: \"json\",\n  commitRequestDataType: \"application/json;charset=UTF-8\",\n  autoProgress: false,\n  logLevel: LogLevelEnum.ERROR,\n  selfReportSessionTime: false,\n  alwaysSendTotalTime: false,\n  renderCommonCommitFields: false,\n  strict_errors: true,\n  xhrHeaders: {},\n  xhrWithCredentials: false,\n  fetchMode: \"cors\",\n  responseHandler: async function (response: Response): Promise<ResultObject> {\n    if (typeof response !== \"undefined\") {\n      const responseText = await response.text();\n      let httpResult = null;\n      if (responseText) {\n        httpResult = JSON.parse(responseText);\n      }\n      if (httpResult === null || !{}.hasOwnProperty.call(httpResult, \"result\")) {\n        if (response.status === 200) {\n          return {\n            result: global_constants.SCORM_TRUE,\n            errorCode: 0,\n          };\n        } else {\n          return {\n            result: global_constants.SCORM_FALSE,\n            errorCode: 101,\n          };\n        }\n      } else {\n        return {\n          result: httpResult.result,\n          errorCode: httpResult.errorCode\n            ? httpResult.errorCode\n            : httpResult.result === global_constants.SCORM_TRUE\n              ? 0\n              : 101,\n        };\n      }\n    }\n    return {\n      result: global_constants.SCORM_FALSE,\n      errorCode: 101,\n    };\n  },\n  requestHandler: function (commitObject) {\n    return commitObject;\n  },\n  onLogMessage: defaultLogHandler,\n  scoItemIds: [],\n  scoItemIdValidator: false,\n  globalObjectiveIds: [],\n};\n\nexport function defaultLogHandler(messageLevel: LogLevel, logMessage: string): void {\n  switch (messageLevel) {\n    case \"4\":\n    case 4:\n    case \"ERROR\":\n    case LogLevelEnum.ERROR:\n      console.error(logMessage);\n      break;\n    case \"3\":\n    case 3:\n    case \"WARN\":\n    case LogLevelEnum.WARN:\n      console.warn(logMessage);\n      break;\n    case \"2\":\n    case 2:\n    case \"INFO\":\n    case LogLevelEnum.INFO:\n      console.info(logMessage);\n      break;\n    case \"1\":\n    case 1:\n    case \"DEBUG\":\n    case LogLevelEnum.DEBUG:\n      if (console.debug) {\n        console.debug(logMessage);\n      } else {\n        console.log(logMessage);\n      }\n      break;\n  }\n}\n","import BaseAPI from \"../BaseAPI\";\n\n/**\n * Private class that wraps a timeout call to the commit() function\n */\nexport class ScheduledCommit {\n  private _API;\n  private _cancelled = false;\n  private readonly _timeout;\n  private readonly _callback;\n\n  /**\n   * Constructor for ScheduledCommit\n   * @param {BaseAPI} API\n   * @param {number} when\n   * @param {string} callback\n   */\n  constructor(API: BaseAPI, when: number, callback: string) {\n    this._API = API;\n    this._timeout = setTimeout(this.wrapper.bind(this), when);\n    this._callback = callback;\n  }\n\n  /**\n   * Cancel any currently scheduled commit\n   */\n  cancel() {\n    this._cancelled = true;\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n  }\n\n  /**\n   * Wrap the API commit call to check if the call has already been cancelled\n   */\n  wrapper() {\n    if (!this._cancelled) {\n      (async () => await this._API.commit(this._callback))();\n    }\n  }\n}\n","import { CommitObject, ResultObject, Settings } from \"../types/api_types\";\nimport { global_constants } from \"../constants/api_constants\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { IHttpService } from \"../interfaces/services\";\nimport { ErrorCode } from \"../constants/error_codes\";\nimport { StringKeyMap } from \"../utilities\";\n\n/**\n * Service for handling HTTP communication with the LMS\n */\nexport class HttpService implements IHttpService {\n  private settings: Settings;\n  private error_codes: ErrorCode;\n\n  /**\n   * Constructor for HttpService\n   * @param {Settings} settings - The settings object\n   * @param {ErrorCode} error_codes - The error codes object\n   */\n  constructor(settings: Settings, error_codes: ErrorCode) {\n    this.settings = settings;\n    this.error_codes = error_codes;\n  }\n\n  /**\n   * Sends HTTP requests to the LMS with special handling for immediate and standard requests.\n   *\n   * This method handles communication with the LMS server, implementing two distinct\n   * request handling strategies based on the context:\n   *\n   * 1. Immediate Mode (used during termination):\n   *    When immediate=true, the method:\n   *    - Initiates the fetch request but doesn't wait for it to complete\n   *    - Returns a success result immediately\n   *    - Processes the response asynchronously when it arrives\n   *\n   *    This is critical for browser compatibility during page unload/termination,\n   *    as some browsers (especially Chrome) may cancel synchronous or awaited\n   *    requests when a page is closing.\n   *\n   * 2. Standard Mode (normal operation):\n   *    When immediate=false, the method:\n   *    - Processes the request parameters through the configured requestHandler\n   *    - Awaits the fetch response completely\n   *    - Transforms the response using the configured responseHandler\n   *    - Triggers appropriate event listeners based on success/failure\n   *    - Returns the complete result with appropriate error codes\n   *\n   * The method also includes error handling to catch network failures or other\n   * exceptions that might occur during the request process.\n   *\n   * @param {string} url - The URL endpoint to send the request to\n   * @param {CommitObject|StringKeyMap|Array} params - The data to send to the LMS\n   * @param {boolean} immediate - Whether to send the request immediately without waiting (true) or process normally (false)\n   * @param {Function} apiLog - Function to log API messages with appropriate levels\n   * @param {Function} processListeners - Function to trigger event listeners for commit events\n   * @return {Promise<ResultObject>} - A promise that resolves with the result of the request\n   *\n   * @example\n   * // Standard request (waits for response)\n   * const result = await httpService.processHttpRequest(\n   *   \"https://lms.example.com/commit\",\n   *   { cmi: { core: { lesson_status: \"completed\" } } },\n   *   false,\n   *   console.log,\n   *   (event) => dispatchEvent(new CustomEvent(event))\n   * );\n   *\n   * @example\n   * // Immediate request (for termination)\n   * const result = await httpService.processHttpRequest(\n   *   \"https://lms.example.com/commit\",\n   *   { cmi: { core: { lesson_status: \"completed\" } } },\n   *   true,\n   *   console.log,\n   *   (event) => dispatchEvent(new CustomEvent(event))\n   * );\n   * // result will be success immediately, regardless of actual HTTP result\n   */\n  async processHttpRequest(\n    url: string,\n    params: CommitObject | StringKeyMap | Array<any>,\n    immediate: boolean = false,\n    apiLog: (\n      functionName: string,\n      message: any,\n      messageLevel: LogLevelEnum,\n      CMIElement?: string,\n    ) => void,\n    processListeners: (functionName: string, CMIElement?: string, value?: any) => void,\n  ): Promise<ResultObject> {\n    const genericError: ResultObject = {\n      result: global_constants.SCORM_FALSE,\n      errorCode: this.error_codes.GENERAL,\n    };\n\n    // if we are terminating the module or closing the browser window/tab, we need to make this fetch ASAP.\n    // Some browsers, especially Chrome, do not like synchronous requests to be made when the window is closing.\n    if (immediate) {\n      this.performFetch(url, params).then(async (response) => {\n        await this.transformResponse(response, processListeners);\n      });\n      return {\n        result: global_constants.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n\n    const process = async (\n      url: string,\n      params: CommitObject | StringKeyMap | Array<any>,\n      settings: Settings,\n    ): Promise<ResultObject> => {\n      try {\n        params = settings.requestHandler(params) as CommitObject | StringKeyMap | Array<any>;\n        const response = await this.performFetch(url, params);\n\n        return this.transformResponse(response, processListeners);\n      } catch (e) {\n        apiLog(\"processHttpRequest\", e, LogLevelEnum.ERROR);\n        processListeners(\"CommitError\");\n        return genericError;\n      }\n    };\n\n    return await process(url, params, this.settings);\n  }\n\n  /**\n   * Perform the fetch request to the LMS\n   * @param {string} url - The URL to send the request to\n   * @param {StringKeyMap|Array} params - The parameters to include in the request\n   * @return {Promise<Response>} - The response from the LMS\n   * @private\n   */\n  private async performFetch(url: string, params: StringKeyMap | Array<any>): Promise<Response> {\n    return fetch(url, {\n      method: \"POST\",\n      mode: this.settings.fetchMode,\n      body: params instanceof Array ? params.join(\"&\") : JSON.stringify(params),\n      headers: {\n        ...this.settings.xhrHeaders,\n        \"Content-Type\": this.settings.commitRequestDataType,\n      },\n      credentials: this.settings.xhrWithCredentials ? \"include\" : undefined,\n      keepalive: true,\n    });\n  }\n\n  /**\n   * Transforms the response from the LMS to a ResultObject\n   * @param {Response} response - The response from the LMS\n   * @param {Function} processListeners - Function to process event listeners\n   * @return {Promise<ResultObject>} - The transformed response\n   * @private\n   */\n  private async transformResponse(\n    response: Response,\n    processListeners: (functionName: string, CMIElement?: string, value?: any) => void,\n  ): Promise<ResultObject> {\n    const result =\n      typeof this.settings.responseHandler === \"function\"\n        ? await this.settings.responseHandler(response)\n        : await response.json();\n\n    if (\n      response.status >= 200 &&\n      response.status <= 299 &&\n      (result.result === true || result.result === global_constants.SCORM_TRUE)\n    ) {\n      processListeners(\"CommitSuccess\");\n      if (!Object.hasOwnProperty.call(result, \"errorCode\")) {\n        result.errorCode = 0;\n      }\n    } else {\n      if (!Object.hasOwnProperty.call(result, \"errorCode\")) {\n        result.errorCode = this.error_codes.GENERAL;\n      }\n      processListeners(\"CommitError\", null, result.errorCode);\n    }\n    return result;\n  }\n\n  /**\n   * Updates the service settings\n   * @param {Settings} settings - The new settings\n   */\n  updateSettings(settings: Settings): void {\n    this.settings = settings;\n  }\n}\n","import { LogLevel } from \"../types/api_types\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { stringMatches } from \"../utilities\";\nimport { IEventService } from \"../interfaces/services\";\n\n/**\n * Interface for a listener object\n */\ninterface Listener {\n  functionName: string;\n  CMIElement: string | null;\n  callback: Function;\n}\n\n/**\n * Type for parsed listener information\n */\ninterface ParsedListener {\n  functionName: string;\n  CMIElement: string | null;\n}\n\n/**\n * Service for handling event listeners and event processing\n */\nexport class EventService implements IEventService {\n  // Map of function names to listeners for faster lookups\n  private listenerMap: Map<string, Listener[]> = new Map();\n  // Total count of listeners for logging\n  private listenerCount = 0;\n  // Function to log API messages\n  private readonly apiLog: (\n    functionName: string,\n    message: string,\n    messageLevel: LogLevel,\n    CMIElement?: string,\n  ) => void;\n\n  /**\n   * Constructor for EventService\n   * @param {Function} apiLog - Function to log API messages\n   */\n  constructor(\n    apiLog: (\n      functionName: string,\n      message: string,\n      messageLevel: LogLevel,\n      CMIElement?: string,\n    ) => void,\n  ) {\n    this.apiLog = apiLog;\n  }\n\n  /**\n   * Parses a listener name into its components\n   *\n   * @param {string} listenerName - The name of the listener\n   * @returns {ParsedListener|null} - The parsed listener information or null if invalid\n   */\n  private parseListenerName(listenerName: string): ParsedListener | null {\n    const listenerSplit = listenerName.split(\".\");\n    if (listenerSplit.length === 0) return null;\n\n    const functionName = listenerSplit[0];\n    let CMIElement = null;\n\n    if (listenerSplit.length > 1) {\n      CMIElement = listenerName.replace(`${functionName}.`, \"\");\n    }\n\n    return { functionName, CMIElement };\n  }\n\n  /**\n   * Provides a mechanism for attaching to a specific SCORM event\n   *\n   * @param {string} listenerName - The name of the listener\n   * @param {Function} callback - The callback function to execute when the event occurs\n   */\n  on(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // Get or create the array for this function name\n      const listeners = this.listenerMap.get(functionName) ?? [];\n\n      // Add the new listener\n      listeners.push({\n        functionName,\n        CMIElement,\n        callback,\n      });\n\n      // Update the map and count\n      this.listenerMap.set(functionName, listeners);\n      this.listenerCount++;\n\n      this.apiLog(\n        \"on\",\n        `Added event listener: ${this.listenerCount}`,\n        LogLevelEnum.INFO,\n        functionName,\n      );\n    }\n  }\n\n  /**\n   * Provides a mechanism for detaching a specific SCORM event listener\n   *\n   * @param {string} listenerName - The name of the listener to remove\n   * @param {Function} callback - The callback function to remove\n   */\n  off(listenerName: string, callback: Function) {\n    if (!callback) return;\n\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // Get the listeners for this function name\n      const listeners = this.listenerMap.get(functionName);\n      if (!listeners) continue;\n\n      // Find the index of the listener to remove\n      const removeIndex = listeners.findIndex(\n        (obj) => obj.CMIElement === CMIElement && obj.callback === callback,\n      );\n\n      if (removeIndex !== -1) {\n        // Remove the listener\n        listeners.splice(removeIndex, 1);\n        this.listenerCount--;\n\n        // Update the map or remove the entry if empty\n        if (listeners.length === 0) {\n          this.listenerMap.delete(functionName);\n        } else {\n          this.listenerMap.set(functionName, listeners);\n        }\n\n        this.apiLog(\n          \"off\",\n          `Removed event listener: ${this.listenerCount}`,\n          LogLevelEnum.INFO,\n          functionName,\n        );\n      }\n    }\n  }\n\n  /**\n   * Provides a mechanism for clearing all listeners from a specific SCORM event\n   *\n   * @param {string} listenerName - The name of the listener to clear\n   */\n  clear(listenerName: string) {\n    const listenerFunctions = listenerName.split(\" \");\n    for (const listenerFunction of listenerFunctions) {\n      const parsedListener = this.parseListenerName(listenerFunction);\n      if (!parsedListener) continue;\n\n      const { functionName, CMIElement } = parsedListener;\n\n      // If we have listeners for this function name\n      if (this.listenerMap.has(functionName)) {\n        const listeners = this.listenerMap.get(functionName)!;\n\n        // Filter out listeners that match the criteria\n        const newListeners = listeners.filter((obj) => obj.CMIElement !== CMIElement);\n\n        // Update the count and map\n        this.listenerCount -= listeners.length - newListeners.length;\n\n        if (newListeners.length === 0) {\n          this.listenerMap.delete(functionName);\n        } else {\n          this.listenerMap.set(functionName, newListeners);\n        }\n      }\n    }\n  }\n\n  /**\n   * Processes any 'on' listeners that have been created\n   *\n   * @param {string} functionName - The name of the function that triggered the event\n   * @param {string} CMIElement - The CMI element that was affected\n   * @param {any} value - The value that was set\n   */\n  processListeners(functionName: string, CMIElement?: string, value?: any) {\n    this.apiLog(functionName, value, LogLevelEnum.INFO, CMIElement);\n\n    // Get listeners for this function name\n    const listeners = this.listenerMap.get(functionName);\n    if (!listeners) return;\n\n    for (const listener of listeners) {\n      const listenerHasCMIElement = !!listener.CMIElement;\n      let CMIElementsMatch = false;\n\n      // Check if CMI elements match\n      if (CMIElement && listener.CMIElement) {\n        if (listener.CMIElement.endsWith(\"*\")) {\n          // For wildcard matches, check if the CMI element starts with the prefix\n          const prefix = listener.CMIElement.slice(0, -1);\n          CMIElementsMatch = CMIElement.startsWith(prefix);\n        } else {\n          // For exact matches, compare the strings directly\n          CMIElementsMatch = listener.CMIElement === CMIElement;\n        }\n      }\n\n      // If the listener matches, call the callback\n      if (!listenerHasCMIElement || CMIElementsMatch) {\n        this.apiLog(\n          \"processListeners\",\n          `Processing listener: ${listener.functionName}`,\n          LogLevelEnum.DEBUG,\n          CMIElement,\n        );\n\n        // Handle special event types\n        if (functionName.startsWith(\"Sequence\")) {\n          // For sequence events, pass the target as the first argument\n          listener.callback(value);\n        } else if (functionName === \"CommitError\") {\n          // For commit error events, pass the error code\n          listener.callback(value);\n        } else if (functionName === \"CommitSuccess\") {\n          // For commit success events, pass no arguments\n          listener.callback();\n        } else {\n          // For regular events, pass CMIElement and value\n          listener.callback(CMIElement, value);\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the event service by clearing all listeners\n   */\n  reset() {\n    this.listenerMap.clear();\n    this.listenerCount = 0;\n  }\n}\n","import { CommitObject, LogLevel } from \"../types/api_types\";\nimport { StringKeyMap, unflatten } from \"../utilities\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { BaseCMI } from \"../cmi/common/base_cmi\";\nimport { ISerializationService } from \"../interfaces/services\";\n\n/**\n * Service for handling data serialization and deserialization in SCORM Again\n */\nexport class SerializationService implements ISerializationService {\n  /**\n   * Loads CMI data from a flattened JSON object with special handling for arrays and ordering.\n   *\n   * This method implements a complex algorithm for loading flattened JSON data into the CMI\n   * object structure. It handles several key challenges:\n   *\n   * 1. Ordering dependencies: Some CMI elements (like interactions and objectives) must be\n   *    loaded in a specific order to ensure proper initialization.\n   *\n   * 2. Array handling: Interactions and objectives are stored as arrays, and their properties\n   *    must be loaded in the correct order (e.g., 'id' and 'type' must be set before other properties).\n   *\n   * 3. Unflattening: The method converts flattened dot notation (e.g., \"cmi.objectives.0.id\")\n   *    back into nested objects before loading.\n   *\n   * The algorithm works by:\n   * - Categorizing keys into interactions, objectives, and other properties\n   * - Sorting interactions to prioritize 'id' and 'type' fields within each index\n   * - Sorting objectives to prioritize 'id' fields within each index\n   * - Processing each category in order: interactions, objectives, then other properties\n   *\n   * @param {StringKeyMap} json - The flattened JSON object with dot notation keys\n   * @param {string} CMIElement - The CMI element to start from (usually empty or \"cmi\")\n   * @param {Function} setCMIValue - Function to set CMI value\n   * @param {Function} isNotInitialized - Function to check if API is not initialized\n   *\n   * @param setStartingData\n   * @example\n   * // Example of flattened JSON input:\n   * // {\n   * //   \"cmi.objectives.0.id\": \"obj1\",\n   * //   \"cmi.objectives.0.score.raw\": \"80\",\n   * //   \"cmi.interactions.0.id\": \"int1\",\n   * //   \"cmi.interactions.0.type\": \"choice\",\n   * //   \"cmi.interactions.0.result\": \"correct\"\n   * // }\n   */\n  loadFromFlattenedJSON(\n    json: StringKeyMap,\n    CMIElement: string = \"\",\n    setCMIValue: (CMIElement: string, value: any) => void,\n    isNotInitialized: () => boolean,\n    setStartingData: (data: StringKeyMap) => void,\n  ): void {\n    if (!isNotInitialized()) {\n      console.error(\"loadFromFlattenedJSON can only be called before the call to lmsInitialize.\");\n      return;\n    }\n\n    const int_pattern = /^(cmi\\.interactions\\.)(\\d+)\\.(.*)$/;\n    const obj_pattern = /^(cmi\\.objectives\\.)(\\d+)\\.(.*)$/;\n\n    // Extract and categorize keys for better sorting\n    const interactions: {\n      key: string;\n      value: any;\n      index: number;\n      field: string;\n    }[] = [];\n    const objectives: {\n      key: string;\n      value: any;\n      index: number;\n      field: string;\n    }[] = [];\n    const others: { key: string; value: any }[] = [];\n\n    // Categorize keys\n    for (const key in json) {\n      if (Object.prototype.hasOwnProperty.call(json, key)) {\n        const intMatch = key.match(int_pattern);\n        if (intMatch) {\n          interactions.push({\n            key,\n            value: json[key],\n            index: Number(intMatch[2]),\n            field: intMatch[3],\n          });\n          continue;\n        }\n\n        const objMatch = key.match(obj_pattern);\n        if (objMatch) {\n          objectives.push({\n            key,\n            value: json[key],\n            index: Number(objMatch[2]),\n            field: objMatch[3],\n          });\n          continue;\n        }\n\n        others.push({ key, value: json[key] });\n      }\n    }\n\n    // Sort interactions: first by index, then prioritize 'id' and 'type' fields\n    interactions.sort((a, b) => {\n      if (a.index !== b.index) {\n        return a.index - b.index;\n      }\n\n      // Same index, prioritize id and type\n      if (a.field === \"id\") return -1;\n      if (b.field === \"id\") return 1;\n      if (a.field === \"type\") return -1;\n      if (b.field === \"type\") return 1;\n\n      return a.field.localeCompare(b.field);\n    });\n\n    // Sort objectives: first by index, then prioritize 'id' field\n    objectives.sort((a, b) => {\n      if (a.index !== b.index) {\n        return a.index - b.index;\n      }\n\n      // Same index, prioritize id\n      if (a.field === \"id\") return -1;\n      if (b.field === \"id\") return 1;\n\n      return a.field.localeCompare(b.field);\n    });\n\n    // Sort other keys alphabetically\n    others.sort((a, b) => a.key.localeCompare(b.key));\n\n    // Process all items in the correct order\n    const processItems = (items: { key: string; value: any }[]) => {\n      items.forEach((item) => {\n        const obj: StringKeyMap = {};\n        obj[item.key] = item.value;\n        this.loadFromJSON(\n          unflatten(obj) as StringKeyMap,\n          CMIElement,\n          setCMIValue,\n          isNotInitialized,\n          setStartingData,\n        );\n      });\n    };\n\n    // Process in order: interactions, objectives, others\n    processItems(interactions);\n    processItems(objectives);\n    processItems(others);\n  }\n\n  /**\n   * Loads CMI data from a nested JSON object with recursive traversal.\n   *\n   * This method implements a recursive algorithm for loading nested JSON data into the CMI\n   * object structure. It handles several key aspects:\n   *\n   * 1. Recursive traversal: The method recursively traverses the nested JSON structure,\n   *    building CMI element paths as it goes (e.g., \"cmi.core.student_id\").\n   *\n   * 2. Type-specific handling: Different data types are handled differently:\n   *    - Arrays: Each array element is processed individually with its index in the path\n   *    - Objects: Recursively processed with updated path\n   *    - Primitives: Set directly using setCMIValue\n   *\n   * 3. Initialization check: Ensures the method is only called before API initialization\n   *\n   * 4. Starting data storage: Stores the original JSON data for potential future use\n   *\n   * The algorithm works by:\n   * - First storing the complete JSON object via setStartingData\n   * - Iterating through each property in the JSON object\n   * - For each property, determining its type and handling it accordingly\n   * - Building the CMI element path as it traverses the structure\n   * - Setting values at the appropriate paths using setCMIValue\n   *\n   * @param {{[key: string]: any}} json - The nested JSON object to load\n   * @param {string} CMIElement - The CMI element to start from (usually empty or \"cmi\")\n   * @param {Function} setCMIValue - Function to set CMI value at a specific path\n   * @param {Function} isNotInitialized - Function to check if API is not initialized\n   * @param {Function} setStartingData - Function to store the original JSON data\n   *\n   * @example\n   * // Example of nested JSON input:\n   * // {\n   * //   \"core\": {\n   * //     \"student_id\": \"12345\",\n   * //     \"student_name\": \"John Doe\"\n   * //   },\n   * //   \"objectives\": [\n   * //     { \"id\": \"obj1\", \"score\": { \"raw\": 80 } },\n   * //     { \"id\": \"obj2\", \"score\": { \"raw\": 90 } }\n   * //   ]\n   * // }\n   */\n  loadFromJSON(\n    json: { [key: string]: any },\n    CMIElement: string = \"\",\n    setCMIValue: (CMIElement: string, value: any) => void,\n    isNotInitialized: () => boolean,\n    setStartingData: (data: StringKeyMap) => void,\n  ): void {\n    if (!isNotInitialized()) {\n      console.error(\"loadFromJSON can only be called before the call to lmsInitialize.\");\n      return;\n    }\n\n    CMIElement = CMIElement !== undefined ? CMIElement : \"cmi\";\n\n    setStartingData(json);\n\n    // could this be refactored down to flatten(json) then setCMIValue on each?\n    for (const key in json) {\n      if (Object.prototype.hasOwnProperty.call(json, key) && json[key]) {\n        const currentCMIElement = (CMIElement ? CMIElement + \".\" : \"\") + key;\n        const value = json[key];\n\n        if (value.constructor === Array) {\n          for (let i = 0; i < value.length; i++) {\n            if (value[i]) {\n              const item = value[i];\n              const tempCMIElement = `${currentCMIElement}.${i}`;\n\n              if (item.constructor === Object) {\n                this.loadFromJSON(\n                  item,\n                  tempCMIElement,\n                  setCMIValue,\n                  isNotInitialized,\n                  setStartingData,\n                );\n              } else {\n                setCMIValue(tempCMIElement, item);\n              }\n            }\n          }\n        } else if (value.constructor === Object) {\n          this.loadFromJSON(\n            value,\n            currentCMIElement,\n            setCMIValue,\n            isNotInitialized,\n            setStartingData,\n          );\n        } else {\n          setCMIValue(currentCMIElement, value);\n        }\n      }\n    }\n  }\n\n  /**\n   * Render the CMI object to JSON for sending to an LMS.\n   *\n   * @param {BaseCMI|StringKeyMap} cmi - The CMI object\n   * @param {boolean} sendFullCommit - Whether to send the full commit\n   * @return {string}\n   */\n  renderCMIToJSONString(cmi: BaseCMI | StringKeyMap, sendFullCommit: boolean): string {\n    // Do we want/need to return fields that have no set value?\n    if (sendFullCommit) {\n      return JSON.stringify({ cmi });\n    }\n    return JSON.stringify({ cmi }, (k, v) => (v === undefined ? null : v), 2);\n  }\n\n  /**\n   * Returns a JS object representing the current cmi\n   * @param {BaseCMI|StringKeyMap} cmi - The CMI object\n   * @param {boolean} sendFullCommit - Whether to send the full commit\n   * @return {object}\n   */\n  renderCMIToJSONObject(cmi: BaseCMI | StringKeyMap, sendFullCommit: boolean): StringKeyMap {\n    // Revert to the original implementation to maintain compatibility with tests\n    return JSON.parse(this.renderCMIToJSONString(cmi, sendFullCommit));\n  }\n\n  /**\n   * Builds the commit object to be sent to the LMS\n   * @param {boolean} terminateCommit - Whether this is a termination commit\n   * @param {boolean} alwaysSendTotalTime - Whether to always send total time\n   * @param {boolean|Function} renderCommonCommitFields - Whether to render common commit fields\n   * @param {Function} renderCommitObject - Function to render commit object\n   * @param {Function} renderCommitCMI - Function to render commit CMI\n   * @param {LogLevel} apiLogLevel - The API log level\n   * @return {CommitObject|StringKeyMap|Array<any>}\n   */\n  getCommitObject(\n    terminateCommit: boolean,\n    alwaysSendTotalTime: boolean,\n    renderCommonCommitFields: boolean | ((commitObject: CommitObject) => boolean),\n    renderCommitObject: (terminateCommit: boolean) => CommitObject,\n    renderCommitCMI: (terminateCommit: boolean) => StringKeyMap | Array<any>,\n    apiLogLevel: LogLevel,\n  ): CommitObject | StringKeyMap | Array<any> {\n    const shouldTerminateCommit = terminateCommit || alwaysSendTotalTime;\n    const commitObject = renderCommonCommitFields\n      ? renderCommitObject(shouldTerminateCommit)\n      : renderCommitCMI(shouldTerminateCommit);\n\n    if ([LogLevelEnum.DEBUG, \"1\", 1, \"DEBUG\"].includes(apiLogLevel)) {\n      console.debug(\"Commit (terminated: \" + (terminateCommit ? \"yes\" : \"no\") + \"): \");\n      console.debug(commitObject);\n    }\n    return commitObject;\n  }\n}\n","import {LogLevelEnum} from \"../constants/enums\";\nimport {global_constants} from \"../constants/api_constants\";\nimport {ErrorCode} from \"../constants/error_codes\";\nimport {ValidationError} from \"../exceptions\";\nimport {IErrorHandlingService} from \"../interfaces/services\";\n\n/**\n * Service for handling SCORM errors\n */\nexport class ErrorHandlingService implements IErrorHandlingService {\n  private _lastErrorCode: string = \"0\";\n  private readonly _errorCodes: ErrorCode;\n  private readonly _apiLog: (\n    functionName: string,\n    message: string,\n    logLevel?: LogLevelEnum,\n    CMIElement?: string,\n  ) => void;\n  private readonly _getLmsErrorMessageDetails: (errorCode: number, detail: boolean) => string;\n\n  /**\n   * Constructor for ErrorHandlingService\n   *\n   * @param {ErrorCode} errorCodes - The error codes object\n   * @param {Function} apiLog - Function for logging API calls\n   * @param {Function} getLmsErrorMessageDetails - Function for getting error message details\n   */\n  constructor(\n    errorCodes: ErrorCode,\n    apiLog: (\n      functionName: string,\n      message: string,\n      logLevel?: LogLevelEnum,\n      CMIElement?: string,\n    ) => void,\n    getLmsErrorMessageDetails: (errorCode: number, detail: boolean) => string,\n  ) {\n    this._errorCodes = errorCodes;\n    this._apiLog = apiLog;\n    this._getLmsErrorMessageDetails = getLmsErrorMessageDetails;\n  }\n\n  /**\n   * Get the last error code\n   *\n   * @return {string} - The last error code\n   */\n  get lastErrorCode(): string {\n    return this._lastErrorCode;\n  }\n\n  /**\n   * Set the last error code\n   *\n   * @param {string} errorCode - The error code to set\n   */\n  set lastErrorCode(errorCode: string) {\n    this._lastErrorCode = errorCode;\n  }\n\n  /**\n   * Throws a SCORM error\n   *\n   * @param {string} CMIElement\n   * @param {number} errorNumber - The error number\n   * @param {string} message - The error message\n   * @throws {ValidationError} - If throwException is true, throws a ValidationError\n   */\n  throwSCORMError(CMIElement: string, errorNumber: number, message?: string): void {\n    if (!message) {\n      message = this._getLmsErrorMessageDetails(errorNumber, true);\n    }\n\n    this._apiLog(\"throwSCORMError\", errorNumber + \": \" + message, LogLevelEnum.ERROR, CMIElement);\n\n    this._lastErrorCode = String(errorNumber);\n  }\n\n  /**\n   * Clears the last SCORM error code on success.\n   *\n   * @param {string} success - Whether the operation was successful\n   */\n  clearSCORMError(success: string): void {\n    if (success !== undefined && success !== global_constants.SCORM_FALSE) {\n      this._lastErrorCode = \"0\";\n    }\n  }\n\n  /**\n   * Handles exceptions that occur when accessing or setting CMI values.\n   *\n   * This method provides centralized error handling for exceptions that occur during\n   * CMI data operations. It differentiates between different types of errors and\n   * handles them appropriately:\n   *\n   * 1. ValidationError: These are expected errors from the validation system that\n   *    indicate a specific SCORM error condition (like invalid data format or range).\n   *    For these errors, the method:\n   *    - Sets the lastErrorCode to the error code from the ValidationError\n   *    - Returns SCORM_FALSE to indicate failure to the caller\n   *\n   * 2. Standard JavaScript Error: For general JavaScript errors (like TypeError,\n   *    ReferenceError, etc.), the method:\n   *    - Logs the error message to the console\n   *    - Sets a general SCORM error\n   *    - Returns SCORM_FALSE to indicate failure\n   *\n   * 3. Unknown exceptions: For any other type of exception that doesn't match the\n   *    above categories, the method:\n   *    - Logs the entire exception object to the console\n   *    - Sets a general SCORM error\n   *    - Returns SCORM_FALSE to indicate failure\n   *\n   * This method is critical for maintaining SCORM compliance by ensuring that\n   * all errors are properly translated into the appropriate SCORM error codes.\n   *\n   * @param {string} CMIElement\n   * @param {ValidationError|Error|unknown} e - The exception that was thrown\n   * @param {string} returnValue - The default return value (typically an empty string)\n   * @return {string} - Either the original returnValue or SCORM_FALSE if an error occurred\n   *\n   * @example\n   * try {\n   *   const value = getCMIValue(\"cmi.core.score.raw\");\n   *   return value;\n   * } catch (e) {\n   *   return handleValueAccessException(e, \"\");\n   * }\n   */\n  handleValueAccessException(\n    CMIElement: string,\n    e: Error | ValidationError,\n    returnValue: string,\n  ): string {\n    if (e instanceof ValidationError) {\n      const validationError = e as ValidationError;\n      this._lastErrorCode = String(validationError.errorCode);\n      returnValue = global_constants.SCORM_FALSE;\n    } else {\n      if (e instanceof Error && e.message) {\n        console.error(e.message);\n        this.throwSCORMError(CMIElement, this._errorCodes.GENERAL, e.message);\n      } else {\n        console.error(e);\n        this.throwSCORMError(CMIElement, this._errorCodes.GENERAL, \"Unknown error\");\n      }\n    }\n    return returnValue;\n  }\n\n  /**\n   * Get the error codes object\n   *\n   * @return {ErrorCode} - The error codes object\n   */\n  get errorCodes(): ErrorCode {\n    return this._errorCodes;\n  }\n}\n\n// Export a factory function to create the service\nexport function createErrorHandlingService(\n  errorCodes: ErrorCode,\n  apiLog: (\n    functionName: string,\n    message: string,\n    logLevel?: LogLevelEnum,\n    CMIElement?: string,\n  ) => void,\n  getLmsErrorMessageDetails: (errorCode: number, detail: boolean) => string,\n): ErrorHandlingService {\n  return new ErrorHandlingService(errorCodes, apiLog, getLmsErrorMessageDetails);\n}\n","import { LogLevel } from \"../types/api_types\";\nimport { LogLevelEnum } from \"../constants/enums\";\nimport { ILoggingService } from \"../interfaces/services\";\nimport { defaultLogHandler } from \"../constants/default_settings\";\n\n/**\n * Centralized logging service implemented as a singleton\n * Provides methods for logging at different levels and configuring the log level\n */\nexport class LoggingService implements ILoggingService {\n  private static _instance: LoggingService;\n  private _logLevel: LogLevel = LogLevelEnum.ERROR;\n  private _logHandler: (messageLevel: LogLevel, logMessage: string) => void;\n\n  /**\n   * Private constructor to prevent direct instantiation\n   */\n  private constructor() {\n    // Default log handler uses console methods based on log level\n    this._logHandler = defaultLogHandler;\n  }\n\n  /**\n   * Get the singleton instance of LoggingService\n   *\n   * @returns {LoggingService} The singleton instance\n   */\n  public static getInstance(): LoggingService {\n    if (!LoggingService._instance) {\n      LoggingService._instance = new LoggingService();\n    }\n    return LoggingService._instance;\n  }\n\n  /**\n   * Set the log level\n   *\n   * @param {LogLevel} level - The log level to set\n   */\n  public setLogLevel(level: LogLevel): void {\n    this._logLevel = level;\n  }\n\n  /**\n   * Get the current log level\n   *\n   * @returns {LogLevel} The current log level\n   */\n  public getLogLevel(): LogLevel {\n    return this._logLevel;\n  }\n\n  /**\n   * Set a custom log handler\n   *\n   * @param {Function} handler - The function to handle log messages\n   */\n  public setLogHandler(handler: (messageLevel: LogLevel, logMessage: string) => void): void {\n    this._logHandler = handler;\n  }\n\n  /**\n   * Log a message if the message level is greater than or equal to the current log level\n   *\n   * @param {LogLevel} messageLevel - The level of the message\n   * @param {string} logMessage - The message to log\n   */\n  public log(messageLevel: LogLevel, logMessage: string): void {\n    if (this.shouldLog(messageLevel)) {\n      this._logHandler(messageLevel, logMessage);\n    }\n  }\n\n  /**\n   * Log a message at ERROR level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public error(logMessage: string): void {\n    this.log(LogLevelEnum.ERROR, logMessage);\n  }\n\n  /**\n   * Log a message at WARN level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public warn(logMessage: string): void {\n    this.log(LogLevelEnum.WARN, logMessage);\n  }\n\n  /**\n   * Log a message at INFO level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public info(logMessage: string): void {\n    this.log(LogLevelEnum.INFO, logMessage);\n  }\n\n  /**\n   * Log a message at DEBUG level\n   *\n   * @param {string} logMessage - The message to log\n   */\n  public debug(logMessage: string): void {\n    this.log(LogLevelEnum.DEBUG, logMessage);\n  }\n\n  /**\n   * Determine if a message should be logged based on its level and the current log level\n   *\n   * @param {LogLevel} messageLevel - The level of the message\n   * @returns {boolean} Whether the message should be logged\n   */\n  private shouldLog(messageLevel: LogLevel): boolean {\n    // Convert string levels to numbers for comparison\n    const numericMessageLevel = this.getNumericLevel(messageLevel);\n    const numericLogLevel = this.getNumericLevel(this._logLevel);\n\n    return numericMessageLevel >= numericLogLevel;\n  }\n\n  /**\n   * Convert a log level to its numeric value\n   *\n   * @param {LogLevel} level - The log level to convert\n   * @returns {number} The numeric value of the log level\n   */\n  private getNumericLevel(level: LogLevel): number {\n    if (level === undefined) return LogLevelEnum.NONE;\n\n    if (typeof level === \"number\") return level;\n\n    switch (level) {\n      case \"1\":\n      case \"DEBUG\":\n        return LogLevelEnum.DEBUG;\n      case \"2\":\n      case \"INFO\":\n        return LogLevelEnum.INFO;\n      case \"3\":\n      case \"WARN\":\n        return LogLevelEnum.WARN;\n      case \"4\":\n      case \"ERROR\":\n        return LogLevelEnum.ERROR;\n      case \"5\":\n      case \"NONE\":\n        return LogLevelEnum.NONE;\n      default:\n        return LogLevelEnum.ERROR; // Default to ERROR if unknown\n    }\n  }\n}\n\n// Export a function to get the singleton instance\nexport function getLoggingService(): LoggingService {\n  return LoggingService.getInstance();\n}\n","import {ErrorCode} from \"./constants/error_codes\";\nimport {global_constants} from \"./constants/api_constants\";\nimport {formatMessage, StringKeyMap, stringMatches} from \"./utilities\";\nimport {BaseCMI} from \"./cmi/common/base_cmi\";\nimport {CommitObject, LogLevel, ResultObject, Settings} from \"./types/api_types\";\nimport {DefaultSettings} from \"./constants/default_settings\";\nimport {IBaseAPI} from \"./interfaces/IBaseAPI\";\nimport {ScheduledCommit} from \"./helpers/scheduled_commit\";\nimport {LogLevelEnum} from \"./constants/enums\";\nimport {HttpService} from \"./services/HttpService\";\nimport {EventService} from \"./services/EventService\";\nimport {SerializationService} from \"./services/SerializationService\";\nimport {createErrorHandlingService} from \"./services/ErrorHandlingService\";\nimport {getLoggingService} from \"./services/LoggingService\";\nimport {\n  ICMIDataService,\n  IErrorHandlingService,\n  IEventService,\n  IHttpService,\n  ILoggingService,\n  ISerializationService,\n} from \"./interfaces/services\";\nimport {CMIArray} from \"./cmi/common/array\";\nimport {ValidationError} from \"./exceptions\";\n\n/**\n * Base API class for AICC, SCORM 1.2, and SCORM 2004. Should be considered\n * abstract, and never initialized on its own.\n */\nexport default abstract class BaseAPI implements IBaseAPI {\n  private _timeout?: ScheduledCommit;\n  private readonly _error_codes: ErrorCode;\n  private _settings: Settings = DefaultSettings;\n  private readonly _httpService: IHttpService;\n  private _eventService: IEventService;\n  private _serializationService: ISerializationService;\n  private readonly _errorHandlingService: IErrorHandlingService;\n  private readonly _loggingService: ILoggingService;\n\n  /**\n   * Constructor for Base API class. Sets some shared API fields, as well as\n   * sets up options for the API.\n   * @param {ErrorCode} error_codes - The error codes object\n   * @param {Settings} settings - Optional settings for the API\n   * @param {IHttpService} httpService - Optional HTTP service instance\n   * @param {IEventService} eventService - Optional Event service instance\n   * @param {ISerializationService} serializationService - Optional Serialization service instance\n   * @param {ICMIDataService} cmiDataService - Optional CMI Data service instance\n   * @param {IErrorHandlingService} errorHandlingService - Optional Error Handling service instance\n   * @param {ILoggingService} loggingService - Optional Logging service instance\n   */\n  protected constructor(\n    error_codes: ErrorCode,\n    settings?: Settings,\n    httpService?: IHttpService,\n    eventService?: IEventService,\n    serializationService?: ISerializationService,\n    cmiDataService?: ICMIDataService,\n    errorHandlingService?: IErrorHandlingService,\n    loggingService?: ILoggingService,\n  ) {\n    if (new.target === BaseAPI) {\n      throw new TypeError(\"Cannot construct BaseAPI instances directly\");\n    }\n    this.currentState = global_constants.STATE_NOT_INITIALIZED;\n\n    this._error_codes = error_codes;\n\n    if (settings) {\n      this.settings = settings;\n    }\n    this.apiLogLevel = this.settings.logLevel;\n    this.selfReportSessionTime = this.settings.selfReportSessionTime;\n\n    if (this.apiLogLevel === undefined) {\n      this.apiLogLevel = LogLevelEnum.NONE;\n    }\n\n    // Initialize and configure LoggingService\n    this._loggingService = loggingService || getLoggingService();\n    this._loggingService.setLogLevel(this.apiLogLevel);\n\n    // If settings include a custom onLogMessage function, use it as the log handler\n    if (this.settings.onLogMessage) {\n      this._loggingService.setLogHandler(this.settings.onLogMessage);\n    }\n\n    // Initialize HTTP service\n    this._httpService = httpService || new HttpService(this.settings, this._error_codes);\n\n    // Initialize Event service\n    this._eventService =\n      eventService ||\n      new EventService((functionName, message, level, element) =>\n        this.apiLog(functionName, message, level, element),\n      );\n\n    // Initialize Serialization service\n    this._serializationService = serializationService || new SerializationService();\n\n    // Initialize Error Handling service\n    this._errorHandlingService =\n      errorHandlingService ||\n      createErrorHandlingService(\n        this._error_codes,\n        (functionName, message, level, element) =>\n          this.apiLog(functionName, message, level, element),\n        (errorNumber, detail) => this.getLmsErrorMessageDetails(errorNumber, detail),\n      );\n  }\n\n  public abstract cmi: BaseCMI;\n  public startingData?: StringKeyMap;\n\n  public currentState: number;\n  public apiLogLevel: LogLevel;\n  public selfReportSessionTime: boolean;\n\n  /**\n   * Get the last error code\n   * @return {string}\n   */\n  get lastErrorCode(): string {\n    return this._errorHandlingService?.lastErrorCode ?? \"0\";\n  }\n\n  /**\n   * Set the last error code\n   * @param {string} errorCode\n   */\n  set lastErrorCode(errorCode: string) {\n    if (this._errorHandlingService) {\n      this._errorHandlingService.lastErrorCode = errorCode;\n    }\n  }\n\n  /**\n   * Reset the API to its initial state.\n   * This method clears all current data and resets the API to an uninitialized state.\n   * It can optionally accept new settings to configure the API after reset.\n   *\n   * @param {Settings} settings - Optional new settings to apply after reset\n   */\n  abstract reset(settings?: Settings): void;\n\n  /**\n   * Common reset method for all APIs. New settings are merged with the existing settings.\n   * @param {Settings} settings\n   * @protected\n   */\n  commonReset(settings?: Settings): void {\n    this.apiLog(\"reset\", \"Called\", LogLevelEnum.INFO);\n\n    this.settings = { ...this.settings, ...settings };\n\n    this.clearScheduledCommit();\n    this.currentState = global_constants.STATE_NOT_INITIALIZED;\n    this.lastErrorCode = \"0\";\n    this._eventService.reset();\n    this.startingData = undefined;\n  }\n\n  /**\n   * Initialize the API\n   * @param {string} callbackName\n   * @param {string} initializeMessage\n   * @param {string} terminationMessage\n   * @return {string}\n   */\n  initialize(\n    callbackName: string,\n    initializeMessage?: string,\n    terminationMessage?: string,\n  ): string {\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (this.isInitialized()) {\n      this.throwSCORMError(\"api\", this._error_codes.INITIALIZED, initializeMessage);\n    } else if (this.isTerminated()) {\n      this.throwSCORMError(\"api\", this._error_codes.TERMINATED, terminationMessage);\n    } else {\n      if (this.selfReportSessionTime) {\n        this.cmi.setStartTime();\n      }\n\n      this.currentState = global_constants.STATE_INITIALIZED;\n      this.lastErrorCode = \"0\";\n      returnValue = global_constants.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Initialize the LMS API\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsInitialize(): string;\n\n  /**\n   * Finish the current LMS API session\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsFinish(): string;\n\n  /**\n   * Get the value of a CMI element from the LMS\n   * @param {string} CMIElement - The CMI element to get the value of\n   * @return {string} The value of the CMI element\n   */\n  abstract lmsGetValue(CMIElement: string): string;\n\n  /**\n   * Set the value of a CMI element in the LMS\n   * @param {string} CMIElement - The CMI element to set the value of\n   * @param {any} value - The value to set\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsSetValue(CMIElement: string, value: any): string;\n\n  /**\n   * Commit the current data to the LMS\n   * @return {string} \"true\" if successful, \"false\" otherwise\n   */\n  abstract lmsCommit(): string;\n\n  /**\n   * Get the last error code from the LMS\n   * @return {string} The last error code\n   */\n  abstract lmsGetLastError(): string;\n\n  /**\n   * Get the error string for a specific error code\n   * @param {string|number} CMIErrorCode - The error code to get the string for\n   * @return {string} The error string\n   */\n  abstract lmsGetErrorString(CMIErrorCode: string | number): string;\n\n  /**\n   * Get diagnostic information for a specific error code\n   * @param {string|number} CMIErrorCode - The error code to get diagnostic information for\n   * @return {string} The diagnostic information\n   */\n  abstract lmsGetDiagnostic(CMIErrorCode: string | number): string;\n\n  /**\n   * Abstract method for validating that a response is correct.\n   * This method is used to validate the format and content of a response\n   * before it is set in the CMI data model.\n   *\n   * @param {string} _CMIElement - The CMI element path to validate\n   * @param {any} _value - The value to validate\n   * @throws {Error} If the response format is invalid\n   */\n  abstract validateCorrectResponse(_CMIElement: string, _value: any): void;\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   * APIs that inherit BaseAPI should override this method.\n   *\n   * @param {string} _CMIElement - unused\n   * @param {*} _value - unused\n   * @param {boolean} _foundFirstIndex - unused\n   * @return {BaseCMI|null}\n   * @abstract\n   */\n  abstract getChildElement(\n    _CMIElement: string,\n    _value: any,\n    _foundFirstIndex: boolean,\n  ): BaseCMI | null;\n\n  /**\n   * Attempts to store the data to the LMS, logs data if no LMS configured\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _calculateTotalTime\n   * @return {ResultObject}\n   * @abstract\n   */\n  abstract storeData(_calculateTotalTime: boolean): Promise<ResultObject>;\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {boolean} _terminateCommit\n   * @return {StringKeyMap|Array}\n   * @abstract\n   */\n  abstract renderCommitCMI(_terminateCommit: boolean): StringKeyMap | Array<string>;\n\n  /**\n   * Render the commit object to the shortened format for LMS commit.\n   * This method transforms the CMI data into a format suitable for sending to the LMS.\n   * It is called during the commit process to prepare the data for transmission.\n   *\n   * @param {boolean} _terminateCommit - Whether this commit is part of the termination process\n   * @return {CommitObject} A formatted object containing the data to be sent to the LMS\n   * @example\n   * // Example of a commit object structure\n   * {\n   *   method: \"POST\",\n   *   params: {\n   *     cmi: { ... },\n   *     finishState: \"COMPLETED\"\n   *   }\n   * }\n   */\n  abstract renderCommitObject(_terminateCommit: boolean): CommitObject;\n\n  /**\n   * Logging for all SCORM actions\n   *\n   * @param {string} functionName\n   * @param {string} logMessage\n   * @param {number} messageLevel\n   * @param {string} CMIElement\n   */\n  apiLog(functionName: string, logMessage: string, messageLevel: LogLevel, CMIElement?: string) {\n    logMessage = formatMessage(functionName, logMessage, CMIElement);\n\n    if (messageLevel >= this.apiLogLevel) {\n      // Use the injected LoggingService\n      this._loggingService.log(messageLevel, logMessage);\n\n      // For backward compatibility, also call the settings.onLogMessage if it exists\n      // and is different from the LoggingService's handler\n      if (\n        this.settings.onLogMessage &&\n        this.settings.onLogMessage !== (this._loggingService as any)[\"_logHandler\"]\n      ) {\n        this.settings.onLogMessage(messageLevel, logMessage);\n      }\n    }\n  }\n\n  /**\n   * Getter for _error_codes\n   * @return {ErrorCode}\n   */\n  get error_codes(): ErrorCode {\n    return this._error_codes;\n  }\n\n  /**\n   * Getter for _settings\n   * @return {Settings}\n   */\n  get settings(): Settings {\n    return this._settings;\n  }\n\n  /**\n   * Setter for _settings\n   * @param {Settings} settings\n   */\n  set settings(settings: Settings) {\n    const previousSettings = this._settings;\n    this._settings = { ...this._settings, ...settings };\n\n    // Update HTTP service settings\n    this._httpService?.updateSettings(this._settings);\n\n    // Update log level if it changed\n    if (settings.logLevel !== undefined && settings.logLevel !== previousSettings.logLevel) {\n      this.apiLogLevel = settings.logLevel;\n      this._loggingService?.setLogLevel(settings.logLevel);\n    }\n\n    // Update log handler if onLogMessage changed\n    if (\n      settings.onLogMessage !== undefined &&\n      settings.onLogMessage !== previousSettings.onLogMessage\n    ) {\n      this._loggingService?.setLogHandler(settings.onLogMessage);\n    }\n  }\n\n  /**\n   * Terminates the current run of the API\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async terminate(callbackName: string, checkTerminated: boolean): Promise<string> {\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.TERMINATION_BEFORE_INIT,\n        this._error_codes.MULTIPLE_TERMINATION,\n      )\n    ) {\n      this.currentState = global_constants.STATE_TERMINATED;\n\n      const result: ResultObject = await this.storeData(true);\n      if ((result.errorCode ?? 0) > 0) {\n        this.throwSCORMError(\"api\", result.errorCode);\n      }\n      returnValue = result?.result ?? global_constants.SCORM_FALSE;\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      returnValue = global_constants.SCORM_TRUE;\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n    this.clearSCORMError(returnValue);\n\n    return returnValue;\n  }\n\n  /**\n   * Get the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  getValue(callbackName: string, checkTerminated: boolean, CMIElement: string): string {\n    let returnValue: string = \"\";\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.RETRIEVE_BEFORE_INIT,\n        this._error_codes.RETRIEVE_AFTER_TERM,\n      )\n    ) {\n      // Only reset the error code if there's no error and checkTerminated is true\n      // This is a no-op if lastErrorCode is already \"0\"\n      try {\n        returnValue = this.getCMIValue(CMIElement);\n      } catch (e) {\n        returnValue = this.handleValueAccessException(CMIElement, e, returnValue);\n      }\n      this.processListeners(callbackName, CMIElement);\n    }\n\n    this.apiLog(callbackName, \": returned: \" + returnValue, LogLevelEnum.INFO, CMIElement);\n\n    if (returnValue === undefined) {\n      return \"\";\n    }\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Sets the value of the CMIElement.\n   *\n   * @param {string} callbackName\n   * @param {string} commitCallback\n   * @param {boolean} checkTerminated\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  setValue(\n    callbackName: string,\n    commitCallback: string,\n    checkTerminated: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (value !== undefined) {\n      value = String(value);\n    }\n    let returnValue: string = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.STORE_BEFORE_INIT,\n        this._error_codes.STORE_AFTER_TERM,\n      )\n    ) {\n      // Only reset the error code if there's no error and checkTerminated is true\n      // This is a no-op if lastErrorCode is already \"0\"\n      try {\n        returnValue = this.setCMIValue(CMIElement, value);\n      } catch (e) {\n        returnValue = this.handleValueAccessException(CMIElement, e, returnValue);\n      }\n      this.processListeners(callbackName, CMIElement, value);\n    }\n\n    if (returnValue === undefined) {\n      returnValue = global_constants.SCORM_FALSE;\n    }\n\n    // If we didn't have any errors while setting the data, go ahead and\n    // schedule a commit, if autocommit is turned on\n    if (String(this.lastErrorCode) === \"0\") {\n      if (this.settings.autocommit) {\n        this.scheduleCommit(this.settings.autocommitSeconds * 1000, commitCallback);\n      }\n    }\n\n    this.apiLog(\n      callbackName,\n      \": \" + value + \": result: \" + returnValue,\n      LogLevelEnum.INFO,\n      CMIElement,\n    );\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Orders LMS to store all content parameters\n   * @param {string} callbackName\n   * @param {boolean} checkTerminated\n   * @return {string}\n   */\n  async commit(callbackName: string, checkTerminated: boolean = false): Promise<string> {\n    this.clearScheduledCommit();\n\n    let returnValue = global_constants.SCORM_FALSE;\n\n    if (\n      this.checkState(\n        checkTerminated,\n        this._error_codes.COMMIT_BEFORE_INIT,\n        this._error_codes.COMMIT_AFTER_TERM,\n      )\n    ) {\n      const result = await this.storeData(false);\n      if ((result.errorCode ?? 0) > 0) {\n        this.throwSCORMError(\"api\", result.errorCode);\n      }\n      returnValue = result?.result ?? global_constants.SCORM_FALSE;\n\n      this.apiLog(callbackName, \" Result: \" + returnValue, LogLevelEnum.DEBUG, \"HttpRequest\");\n\n      if (checkTerminated) this.lastErrorCode = \"0\";\n\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    // Only clear the error code if there's no error\n    if (this.lastErrorCode === \"0\") {\n      this.clearSCORMError(returnValue);\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Returns last error code\n   * @param {string} callbackName\n   * @return {string}\n   */\n  getLastError(callbackName: string): string {\n    const returnValue = String(this.lastErrorCode);\n\n    this.processListeners(callbackName);\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Returns the errorNumber error description\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getErrorString(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Returns a comprehensive description of the errorNumber error.\n   *\n   * @param {string} callbackName\n   * @param {(string|number)} CMIErrorCode\n   * @return {string}\n   */\n  getDiagnostic(callbackName: string, CMIErrorCode: string | number): string {\n    let returnValue = \"\";\n\n    if (CMIErrorCode !== null && CMIErrorCode !== \"\") {\n      returnValue = this.getLmsErrorMessageDetails(CMIErrorCode, true);\n      this.processListeners(callbackName);\n    }\n\n    this.apiLog(callbackName, \"returned: \" + returnValue, LogLevelEnum.INFO);\n\n    return returnValue;\n  }\n\n  /**\n   * Checks the LMS state and ensures it has been initialized.\n   *\n   * @param {boolean} checkTerminated\n   * @param {number} beforeInitError\n   * @param {number} afterTermError\n   * @return {boolean}\n   */\n  checkState(checkTerminated: boolean, beforeInitError: number, afterTermError: number): boolean {\n    if (this.isNotInitialized()) {\n      this.throwSCORMError(\"api\", beforeInitError);\n      return false;\n    } else if (checkTerminated && this.isTerminated()) {\n      this.throwSCORMError(\"api\", afterTermError);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {(string|number)} _errorNumber\n   * @param {boolean} _detail\n   * @return {string}\n   * @abstract\n   */\n  getLmsErrorMessageDetails(_errorNumber: string | number, _detail: boolean = false): string {\n    throw new Error(\"The getLmsErrorMessageDetails method has not been implemented\");\n  }\n\n  /**\n   * Gets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @return {string}\n   * @abstract\n   */\n  getCMIValue(_CMIElement: string): string {\n    throw new Error(\"The getCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Sets the value for the specific element.\n   * APIs that inherit BaseAPI should override this function\n   *\n   * @param {string} _CMIElement\n   * @param {any} _value\n   * @return {string}\n   * @abstract\n   */\n  setCMIValue(_CMIElement: string, _value: any): string {\n    throw new Error(\"The setCMIValue method has not been implemented\");\n  }\n\n  /**\n   * Shared API method to set a valid for a given element.\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @param {any} value\n   * @return {string}\n   */\n  _commonSetCMIValue(\n    methodName: string,\n    scorm2004: boolean,\n    CMIElement: string,\n    value: any,\n  ): string {\n    if (!CMIElement || CMIElement === \"\") {\n      return global_constants.SCORM_FALSE;\n    }\n\n    this.lastErrorCode = \"0\";\n\n    const structure = CMIElement.split(\".\");\n    let refObject: StringKeyMap | BaseCMI = this as StringKeyMap;\n    let returnValue = global_constants.SCORM_FALSE;\n    let foundFirstIndex = false;\n\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      const attribute = structure[idx];\n\n      if (idx === structure.length - 1) {\n        if (scorm2004 && attribute.substring(0, 8) === \"{target=\") {\n          if (this.isInitialized()) {\n            this.throwSCORMError(CMIElement, this._error_codes.READ_ONLY_ELEMENT);\n            break;\n          } else {\n            refObject = {\n              ...refObject,\n              attribute: value,\n            };\n          }\n        } else if (!this._checkObjectHasProperty(refObject as StringKeyMap, attribute)) {\n          this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n          break;\n        } else {\n          if (\n            stringMatches(CMIElement, \"\\\\.correct_responses\\\\.\\\\d+$\") &&\n            this.isInitialized() &&\n            attribute !== \"pattern\"\n          ) {\n            this.validateCorrectResponse(CMIElement, value);\n            if (this.lastErrorCode !== \"0\") {\n              this.throwSCORMError(CMIElement, this._error_codes.TYPE_MISMATCH);\n              break;\n            }\n          }\n\n          if (!scorm2004 || this._errorHandlingService.lastErrorCode === \"0\") {\n            (refObject as StringKeyMap)[attribute] = value;\n            returnValue = global_constants.SCORM_TRUE;\n          }\n        }\n      } else {\n        refObject = (refObject as StringKeyMap)[attribute] as StringKeyMap;\n        if (!refObject) {\n          this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n          break;\n        }\n\n        if (refObject instanceof CMIArray) {\n          const index = parseInt(structure[idx + 1], 10);\n\n          // SCO is trying to set an item on an array\n          if (!isNaN(index)) {\n            const item = refObject.childArray[index];\n\n            if (item) {\n              refObject = item;\n              foundFirstIndex = true;\n            } else {\n              const newChild = this.getChildElement(CMIElement, value, foundFirstIndex);\n              foundFirstIndex = true;\n\n              if (!newChild) {\n                if (this.lastErrorCode === \"0\") {\n                  this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n                }\n                break;\n              } else {\n                if (refObject.initialized) newChild.initialize();\n                refObject.childArray[index] = newChild;\n                refObject = newChild;\n              }\n            }\n\n            // Have to update idx value to skip the array position\n            idx++;\n          }\n        }\n      }\n    }\n\n    if (returnValue === global_constants.SCORM_FALSE) {\n      this.apiLog(\n        methodName,\n        `There was an error setting the value for: ${CMIElement}, value of: ${value}`,\n        LogLevelEnum.WARN,\n      );\n    }\n\n    return returnValue;\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} methodName\n   * @param {boolean} scorm2004\n   * @param {string} CMIElement\n   * @return {any}\n   */\n  _commonGetCMIValue(methodName: string, scorm2004: boolean, CMIElement: string): any {\n    if (!CMIElement || CMIElement === \"\") {\n      return \"\";\n    }\n\n    const structure = CMIElement.split(\".\");\n    let refObject: StringKeyMap = this as StringKeyMap;\n    let attribute = null;\n\n    const uninitializedErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) has not been initialized.`;\n    const invalidErrorMessage = `The data model element passed to ${methodName} (${CMIElement}) is not a valid SCORM data model element.`;\n    const invalidErrorCode = scorm2004\n      ? this._error_codes.UNDEFINED_DATA_MODEL\n      : this._error_codes.GENERAL;\n\n    for (let idx = 0; idx < structure.length; idx++) {\n      attribute = structure[idx];\n\n      if (!scorm2004) {\n        if (idx === structure.length - 1) {\n          if (!this._checkObjectHasProperty(refObject, attribute)) {\n            this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n            return;\n          }\n        }\n      } else {\n        if (\n          String(attribute).substring(0, 8) === \"{target=\" &&\n          typeof refObject._isTargetValid == \"function\"\n        ) {\n          const target = String(attribute).substring(8, String(attribute).length - 9);\n          return refObject._isTargetValid(target);\n        } else if (!this._checkObjectHasProperty(refObject, attribute)) {\n          this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n          return;\n        }\n      }\n\n      refObject = refObject[attribute] as StringKeyMap;\n      if (refObject === undefined) {\n        this.throwSCORMError(CMIElement, invalidErrorCode, invalidErrorMessage);\n        break;\n      }\n\n      if (refObject instanceof CMIArray) {\n        const index = parseInt(structure[idx + 1], 10);\n\n        // SCO is trying to set an item on an array\n        if (!isNaN(index)) {\n          const item = refObject.childArray[index];\n\n          if (item) {\n            refObject = item;\n          } else {\n            this.throwSCORMError(\n              CMIElement,\n              this._error_codes.VALUE_NOT_INITIALIZED,\n              uninitializedErrorMessage,\n            );\n            break;\n          }\n\n          // Have to update idx value to skip the array position\n          idx++;\n        }\n      }\n    }\n\n    if (refObject === null || refObject === undefined) {\n      if (!scorm2004) {\n        if (attribute === \"_children\") {\n          this.throwSCORMError(CMIElement, this._error_codes.CHILDREN_ERROR, undefined);\n        } else if (attribute === \"_count\") {\n          this.throwSCORMError(CMIElement, this._error_codes.COUNT_ERROR, undefined);\n        }\n      }\n    } else {\n      return refObject;\n    }\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isInitialized(): boolean {\n    return this.currentState === global_constants.STATE_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_NOT_INITIALIZED\n   *\n   * @return {boolean}\n   */\n  isNotInitialized(): boolean {\n    return this.currentState === global_constants.STATE_NOT_INITIALIZED;\n  }\n\n  /**\n   * Returns true if the API's current state is STATE_TERMINATED\n   *\n   * @return {boolean}\n   */\n  isTerminated(): boolean {\n    return this.currentState === global_constants.STATE_TERMINATED;\n  }\n\n  /**\n   * Provides a mechanism for attaching to a specific SCORM event.\n   * This method allows you to register a callback function that will be executed\n   * when the specified event occurs.\n   *\n   * @param {string} listenerName - The name of the event to listen for (e.g., \"Initialize\", \"Terminate\", \"GetValue\", \"SetValue\", \"Commit\")\n   * @param {function} callback - The function to execute when the event occurs. The callback will receive relevant event data.\n   * @example\n   * // Listen for Initialize events\n   * api.on(\"Initialize\", function() {\n   *   console.log(\"API has been initialized\");\n   * });\n   *\n   * // Listen for SetValue events\n   * api.on(\"SetValue\", function(element, value) {\n   *   console.log(\"Setting \" + element + \" to \" + value);\n   * });\n   */\n  on(listenerName: string, callback: Function) {\n    this._eventService.on(listenerName, callback);\n  }\n\n  /**\n   * Provides a mechanism for detaching a specific SCORM event listener.\n   * This method removes a previously registered callback for an event.\n   * Both the event name and the callback reference must match what was used in the 'on' method.\n   *\n   * @param {string} listenerName - The name of the event to stop listening for\n   * @param {function} callback - The callback function to remove\n   * @example\n   * // Remove a specific listener\n   * const myCallback = function() { console.log(\"API initialized\"); };\n   * api.on(\"Initialize\", myCallback);\n   * // Later, when you want to remove it:\n   * api.off(\"Initialize\", myCallback);\n   */\n  off(listenerName: string, callback: Function) {\n    this._eventService.off(listenerName, callback);\n  }\n\n  /**\n   * Provides a mechanism for clearing all listeners from a specific SCORM event.\n   * This method removes all callbacks registered for the specified event.\n   *\n   * @param {string} listenerName - The name of the event to clear all listeners for\n   * @example\n   * // Remove all listeners for the Initialize event\n   * api.clear(\"Initialize\");\n   */\n  clear(listenerName: string) {\n    this._eventService.clear(listenerName);\n  }\n\n  /**\n   * Processes any 'on' listeners that have been created for a specific event.\n   * This method is called internally when SCORM events occur to notify all registered listeners.\n   * It triggers all callback functions registered for the specified event.\n   *\n   * @param {string} functionName - The name of the function/event that occurred\n   * @param {string} CMIElement - Optional CMI element involved in the event\n   * @param {any} value - Optional value associated with the event\n   */\n  processListeners(functionName: string, CMIElement?: string, value?: any) {\n    this._eventService.processListeners(functionName, CMIElement, value);\n  }\n\n  /**\n   * Throws a SCORM error with the specified error number and optional message.\n   * This method sets the last error code and can be used to indicate that an operation failed.\n   * The error number should correspond to one of the standard SCORM error codes.\n   *\n   * @param {string} CMIElement\n   * @param {number} errorNumber - The SCORM error code to set\n   * @param {string} message - Optional custom error message to provide additional context\n   * @example\n   * // Throw a \"not initialized\" error\n   * this.throwSCORMError(301, \"The API must be initialized before calling GetValue\");\n   */\n  throwSCORMError(CMIElement: string, errorNumber: number, message?: string) {\n    this._errorHandlingService.throwSCORMError(CMIElement, errorNumber, message);\n  }\n\n  /**\n   * Clears the last SCORM error code when an operation succeeds.\n   * This method is typically called after successful API operations to reset the error state.\n   * It only clears the error if the success parameter is \"true\".\n   *\n   * @param {string} success - A string indicating whether the operation succeeded (\"true\" or \"false\")\n   * @example\n   * // Clear error after successful operation\n   * this.clearSCORMError(\"true\");\n   */\n  clearSCORMError(success: string) {\n    this._errorHandlingService.clearSCORMError(success);\n  }\n\n  /**\n   * Load the CMI from a flattened JSON object.\n   * This method populates the CMI data model from a flattened JSON structure\n   * where keys represent CMI element paths (e.g., \"cmi.core.student_id\").\n   *\n   * @param {StringKeyMap} json - The flattened JSON object containing CMI data\n   * @param {string} CMIElement - Optional base CMI element path to prepend to all keys\n   * @example\n   * // Load data from a flattened JSON structure\n   * api.loadFromFlattenedJSON({\n   *   \"cmi.core.student_id\": \"12345\",\n   *   \"cmi.core.student_name\": \"John Doe\",\n   *   \"cmi.core.lesson_status\": \"incomplete\"\n   * });\n   */\n  loadFromFlattenedJSON(json: StringKeyMap, CMIElement?: string) {\n    if (!CMIElement) {\n      // by default, we start from a blank string because we're expecting each element to start with `cmi`\n      CMIElement = \"\";\n    }\n\n    this._serializationService.loadFromFlattenedJSON(\n      json,\n      CMIElement,\n      (CMIElement, value) => this.setCMIValue(CMIElement, value),\n      () => this.isNotInitialized(),\n      (data: StringKeyMap) => {\n        this.startingData = data;\n      },\n    );\n  }\n\n  /**\n   * Loads CMI data from a hierarchical JSON object.\n   * This method populates the CMI data model from a nested JSON structure\n   * that mirrors the CMI object hierarchy.\n   *\n   * @param {StringKeyMap} json - The hierarchical JSON object containing CMI data\n   * @param {string} CMIElement - Optional base CMI element path to prepend to all keys\n   * @example\n   * // Load data from a hierarchical JSON structure\n   * api.loadFromJSON({\n   *   core: {\n   *     student_id: \"12345\",\n   *     student_name: \"John Doe\",\n   *     lesson_status: \"incomplete\"\n   *   },\n   *   objectives: [\n   *     { id: \"obj1\", score: { raw: 85 } }\n   *   ]\n   * });\n   */\n  loadFromJSON(json: StringKeyMap, CMIElement: string = \"\") {\n    this._serializationService.loadFromJSON(\n      json,\n      CMIElement,\n      (CMIElement, value) => this.setCMIValue(CMIElement, value),\n      () => this.isNotInitialized(),\n      (data: StringKeyMap) => {\n        this.startingData = data;\n      },\n    );\n  }\n\n  /**\n   * Render the CMI object to a JSON string for sending to an LMS.\n   * This method serializes the current CMI data model to a JSON string.\n   * The output format is controlled by the sendFullCommit setting.\n   *\n   * @return {string} A JSON string representation of the CMI data\n   * @example\n   * // Get the current CMI data as a JSON string\n   * const jsonString = api.renderCMIToJSONString();\n   * console.log(jsonString); // '{\"core\":{\"student_id\":\"12345\",...}}'\n   */\n  renderCMIToJSONString(): string {\n    return this._serializationService.renderCMIToJSONString(this.cmi, this.settings.sendFullCommit);\n  }\n\n  /**\n   * Returns a JavaScript object representing the current CMI data.\n   * This method creates a plain JavaScript object that mirrors the\n   * structure of the CMI data model, suitable for further processing.\n   *\n   * @return {StringKeyMap} A JavaScript object representing the CMI data\n   * @example\n   * // Get the current CMI data as a JavaScript object\n   * const cmiObject = api.renderCMIToJSONObject();\n   * console.log(cmiObject.core.student_id); // \"12345\"\n   */\n  renderCMIToJSONObject(): StringKeyMap {\n    return this._serializationService.renderCMIToJSONObject(this.cmi, this.settings.sendFullCommit);\n  }\n\n  /**\n   * Sends a request to the LMS with the specified parameters.\n   * This method handles communication with the LMS server, including\n   * formatting the request, handling the response, and triggering appropriate events.\n   *\n   * @param {string} url - The URL endpoint to send the request to\n   * @param {CommitObject|StringKeyMap|Array} params - The data to send to the LMS\n   * @param {boolean} immediate - Whether to send the request immediately (true) or queue it (false)\n   * @return {Promise<ResultObject>} A promise that resolves with the result of the request\n   * @example\n   * // Send data to the LMS immediately\n   * const result = await api.processHttpRequest(\n   *   \"https://lms.example.com/scorm/commit\",\n   *   { method: \"POST\", params: { cmi: { core: { lesson_status: \"completed\" } } } },\n   *   true\n   * );\n   * console.log(result.errorCode === 0 ? \"Success\" : \"Failed\");\n   */\n  async processHttpRequest(\n    url: string,\n    params: CommitObject | StringKeyMap | Array<any>,\n    immediate: boolean = false,\n  ): Promise<ResultObject> {\n    return this._httpService.processHttpRequest(\n      url,\n      params,\n      immediate,\n      (functionName, message, level, element) => this.apiLog(functionName, message, level, element),\n      (functionName, CMIElement, value) => this.processListeners(functionName, CMIElement, value),\n    );\n  }\n\n  /**\n   * Schedules a commit operation to occur after a specified delay.\n   * This method is used to implement auto-commit functionality, where data\n   * is periodically sent to the LMS without requiring explicit commit calls.\n   *\n   * @param {number} when - The number of milliseconds to wait before committing\n   * @param {string} callback - The name of the commit event callback\n   * @example\n   * // Schedule a commit to happen in 60 seconds\n   * api.scheduleCommit(60000, \"commit\");\n   */\n  scheduleCommit(when: number, callback: string) {\n    if (!this._timeout) {\n      this._timeout = new ScheduledCommit(this, when, callback);\n      this.apiLog(\"scheduleCommit\", \"scheduled\", LogLevelEnum.DEBUG, \"\");\n    }\n  }\n\n  /**\n   * Clears and cancels any currently scheduled commits.\n   * This method is typically called when an explicit commit is performed\n   * or when the API is terminated, to prevent redundant commits.\n   *\n   * @example\n   * // Cancel any pending scheduled commits\n   * api.clearScheduledCommit();\n   */\n  clearScheduledCommit() {\n    if (this._timeout) {\n      this._timeout.cancel();\n      this._timeout = undefined;\n      this.apiLog(\"clearScheduledCommit\", \"cleared\", LogLevelEnum.DEBUG, \"\");\n    }\n  }\n\n  /**\n   * Checks if an object has a specific property, using multiple detection methods.\n   * This method performs a thorough check for property existence by:\n   * 1. Checking if it's an own property using Object.hasOwnProperty\n   * 2. Checking if it's defined in the prototype with a property descriptor\n   * 3. Checking if it's accessible via the 'in' operator (includes inherited properties)\n   *\n   * @param {StringKeyMap} StringKeyMap - The object to check for the property\n   * @param {string} attribute - The property name to look for\n   * @return {boolean} True if the property exists on the object or its prototype chain\n   * @private\n   *\n   * @example\n   * // Check for an own property\n   * const obj = { name: \"John\" };\n   * this._checkObjectHasProperty(obj, \"name\"); // Returns true\n   *\n   * @example\n   * // Check for an inherited property\n   * class Parent { get type() { return \"parent\"; } }\n   * const child = Object.create(new Parent());\n   * this._checkObjectHasProperty(child, \"type\"); // Returns true\n   *\n   * @example\n   * // Check for a non-existent property\n   * const obj = { name: \"John\" };\n   * this._checkObjectHasProperty(obj, \"age\"); // Returns false\n   */\n  private _checkObjectHasProperty(StringKeyMap: StringKeyMap, attribute: string): boolean {\n    return (\n      Object.hasOwnProperty.call(StringKeyMap, attribute) ||\n      Object.getOwnPropertyDescriptor(Object.getPrototypeOf(StringKeyMap), attribute) != null ||\n      attribute in StringKeyMap\n    );\n  }\n\n  /**\n   * Handles exceptions that occur when accessing CMI values.\n   * This method delegates to the ErrorHandlingService to process exceptions\n   * that occur during CMI data operations, ensuring consistent error handling\n   * throughout the API.\n   *\n   * @param {string} CMIElement\n   * @param {any} e - The exception that was thrown\n   * @param {string} returnValue - The default return value to use if an error occurs\n   * @return {string} Either the original returnValue or SCORM_FALSE if an error occurred\n   * @private\n   *\n   * @example\n   * // Handle a validation error when getting a CMI value\n   * try {\n   *   return this.getCMIValue(\"cmi.core.score.raw\");\n   * } catch (e) {\n   *   return this.handleValueAccessException(e, \"\");\n   * }\n   *\n   * @example\n   * // Handle a general error when setting a CMI value\n   * try {\n   *   this.setCMIValue(\"cmi.core.lesson_status\", \"completed\");\n   *   return \"true\";\n   * } catch (e) {\n   *   return this.handleValueAccessException(e, \"false\");\n   * }\n   */\n  private handleValueAccessException(CMIElement: string, e: any, returnValue: string): string {\n    if (e instanceof ValidationError) {\n      this.lastErrorCode = String(e.errorCode);\n      returnValue = global_constants.SCORM_FALSE;\n      this.throwSCORMError(CMIElement, e.errorCode, e.errorMessage);\n    } else {\n      if (e instanceof Error && e.message) {\n        console.error(e.message);\n        this.throwSCORMError(CMIElement, this._error_codes.GENERAL, e.message);\n      } else {\n        console.error(e);\n        this.throwSCORMError(CMIElement, this._error_codes.GENERAL, \"Unknown error\");\n      }\n    }\n    return returnValue;\n  }\n\n  /**\n   * Builds the commit object to be sent to the LMS.\n   * This method delegates to the SerializationService to create a properly\n   * formatted object containing the CMI data that needs to be sent to the LMS.\n   * The format and content of the commit object depend on whether this is a\n   * regular commit or a termination commit.\n   *\n   * @param {boolean} terminateCommit - Whether this is a termination commit\n   * @return {CommitObject|StringKeyMap|Array} The formatted commit object\n   * @protected\n   *\n   * @example\n   * // Create a regular commit object\n   * const regularCommit = this.getCommitObject(false);\n   * // Result might be: { cmi: { core: { lesson_status: \"incomplete\" } } }\n   *\n   * @example\n   * // Create a termination commit object (includes total_time)\n   * const terminationCommit = this.getCommitObject(true);\n   * // Result might be: { cmi: { core: { lesson_status: \"completed\", total_time: \"PT1H30M\" } } }\n   */\n  protected getCommitObject(terminateCommit: boolean): CommitObject | StringKeyMap | Array<any> {\n    return this._serializationService.getCommitObject(\n      terminateCommit,\n      this.settings.alwaysSendTotalTime,\n      this.settings.renderCommonCommitFields,\n      (terminateCommit) => this.renderCommitObject(terminateCommit),\n      (terminateCommit) => this.renderCommitCMI(terminateCommit),\n      this.apiLogLevel,\n    );\n  }\n}\n","type APIError = {\n  errorCode: number;\n  errorMessage: string;\n  detailedMessage: string;\n};\n\nexport class BaseScormValidationError extends Error {\n  constructor(CMIElement: string, errorCode: number) {\n    super(`${CMIElement} : ${errorCode.toString()}`);\n    this._errorCode = errorCode;\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, BaseScormValidationError.prototype);\n  }\n\n  private readonly _errorCode: number;\n\n  /**\n   * Getter for _errorCode\n   * @return {number}\n   */\n  get errorCode(): number {\n    return this._errorCode;\n  }\n}\n\n/**\n * Base Validation Exception\n */\nexport class ValidationError extends BaseScormValidationError implements APIError {\n  /**\n   * Constructor to take in an error message and code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   * @param {string} errorMessage\n   * @param {string} detailedMessage\n   */\n  constructor(\n    CMIElement: string,\n    errorCode: number,\n    errorMessage: string,\n    detailedMessage?: string,\n  ) {\n    super(CMIElement, errorCode);\n    this.message = `${CMIElement} : ${errorMessage}`;\n    this._errorMessage = errorMessage;\n    if (detailedMessage) {\n      this._detailedMessage = detailedMessage;\n    }\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, ValidationError.prototype);\n  }\n\n  private readonly _errorMessage: string;\n  private readonly _detailedMessage: string = \"\";\n\n  /**\n   * Getter for _errorMessage\n   * @return {string}\n   */\n  get errorMessage(): string {\n    return this._errorMessage;\n  }\n\n  /**\n   * Getter for _detailedMessage\n   * @return {string}\n   */\n  get detailedMessage(): string {\n    return this._detailedMessage;\n  }\n}\n","export type ErrorCode = {\n  [key: string]: number;\n};\n\nexport const global_errors: ErrorCode = {\n  GENERAL: 101,\n  INITIALIZATION_FAILED: 101,\n  INITIALIZED: 101,\n  TERMINATED: 101,\n  TERMINATION_FAILURE: 101,\n  TERMINATION_BEFORE_INIT: 101,\n  MULTIPLE_TERMINATION: 101,\n  RETRIEVE_BEFORE_INIT: 101,\n  RETRIEVE_AFTER_TERM: 101,\n  STORE_BEFORE_INIT: 101,\n  STORE_AFTER_TERM: 101,\n  COMMIT_BEFORE_INIT: 101,\n  COMMIT_AFTER_TERM: 101,\n  ARGUMENT_ERROR: 101,\n  CHILDREN_ERROR: 101,\n  COUNT_ERROR: 101,\n  GENERAL_GET_FAILURE: 101,\n  GENERAL_SET_FAILURE: 101,\n  GENERAL_COMMIT_FAILURE: 101,\n  UNDEFINED_DATA_MODEL: 101,\n  UNIMPLEMENTED_ELEMENT: 101,\n  VALUE_NOT_INITIALIZED: 101,\n  INVALID_SET_VALUE: 101,\n  READ_ONLY_ELEMENT: 101,\n  WRITE_ONLY_ELEMENT: 101,\n  TYPE_MISMATCH: 101,\n  VALUE_OUT_OF_RANGE: 101,\n  DEPENDENCY_NOT_ESTABLISHED: 101,\n};\n\nexport const scorm12_errors: ErrorCode = {\n  ...global_errors,\n  RETRIEVE_BEFORE_INIT: 301,\n  STORE_BEFORE_INIT: 301,\n  COMMIT_BEFORE_INIT: 301,\n  ARGUMENT_ERROR: 201,\n  CHILDREN_ERROR: 202,\n  COUNT_ERROR: 203,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 401,\n  VALUE_NOT_INITIALIZED: 301,\n  INVALID_SET_VALUE: 402,\n  READ_ONLY_ELEMENT: 403,\n  WRITE_ONLY_ELEMENT: 404,\n  TYPE_MISMATCH: 405,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n\nexport const scorm2004_errors: ErrorCode = {\n  ...global_errors,\n  INITIALIZATION_FAILED: 102,\n  INITIALIZED: 103,\n  TERMINATED: 104,\n  TERMINATION_FAILURE: 111,\n  TERMINATION_BEFORE_INIT: 112,\n  MULTIPLE_TERMINATIONS: 113,\n  RETRIEVE_BEFORE_INIT: 122,\n  RETRIEVE_AFTER_TERM: 123,\n  STORE_BEFORE_INIT: 132,\n  STORE_AFTER_TERM: 133,\n  COMMIT_BEFORE_INIT: 142,\n  COMMIT_AFTER_TERM: 143,\n  ARGUMENT_ERROR: 201,\n  GENERAL_GET_FAILURE: 301,\n  GENERAL_SET_FAILURE: 351,\n  GENERAL_COMMIT_FAILURE: 391,\n  UNDEFINED_DATA_MODEL: 401,\n  UNIMPLEMENTED_ELEMENT: 402,\n  VALUE_NOT_INITIALIZED: 403,\n  READ_ONLY_ELEMENT: 404,\n  WRITE_ONLY_ELEMENT: 405,\n  TYPE_MISMATCH: 406,\n  VALUE_OUT_OF_RANGE: 407,\n  DEPENDENCY_NOT_ESTABLISHED: 408,\n};\n","import { BaseScormValidationError } from \"../exceptions\";\nimport { checkValidFormat, checkValidRange } from \"../cmi/common/validation\";\nimport { check12ValidFormat, check12ValidRange } from \"../cmi/scorm12/validation\";\nimport { scorm12_regex } from \"../constants/regex\";\nimport { scorm12_errors } from \"../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../exceptions/scorm12_exceptions\";\n\n/**\n * Service for validating CMI data model properties\n */\nexport class ValidationService {\n  /**\n   * Validates a score property (raw, min, max)\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @param {string} decimalRegex - The regex pattern for decimal validation\n   * @param {string | false} scoreRange - The range pattern for score validation, or false if no range validation is needed\n   * @param {number} invalidTypeCode - The error code for invalid type\n   * @param {number} invalidRangeCode - The error code for invalid range\n   * @param {typeof BaseScormValidationError} errorClass - The error class to use for validation errors\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScore(\n    CMIElement: string,\n    value: string,\n    decimalRegex: string,\n    scoreRange: string | false,\n    invalidTypeCode: number,\n    invalidRangeCode: number,\n    errorClass: typeof BaseScormValidationError,\n  ): boolean {\n    return (\n      checkValidFormat(CMIElement, value, decimalRegex, invalidTypeCode, errorClass) &&\n      (!scoreRange || checkValidRange(CMIElement, value, scoreRange, invalidRangeCode, errorClass))\n    );\n    // This line should never be reached due to exceptions being thrown\n  }\n\n  /**\n   * Validates a SCORM 1.2 audio property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Audio(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.audio_range)\n    );\n  }\n\n  /**\n   * Validates a SCORM 1.2 language property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Language(CMIElement: string, value: string): boolean {\n    return check12ValidFormat(CMIElement, value, scorm12_regex.CMIString256);\n  }\n\n  /**\n   * Validates a SCORM 1.2 speed property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Speed(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.speed_range)\n    );\n  }\n\n  /**\n   * Validates a SCORM 1.2 text property\n   *\n   * @param {string} CMIElement\n   * @param {string} value - The value to validate\n   * @return {boolean} - True if validation passes, throws an error otherwise\n   */\n  validateScorm12Text(CMIElement: string, value: string): boolean {\n    return (\n      check12ValidFormat(CMIElement, value, scorm12_regex.CMISInteger) &&\n      check12ValidRange(CMIElement, value, scorm12_regex.text_range)\n    );\n  }\n\n  /**\n   * Validates if a property is read-only\n   *\n   * @param {string} CMIElement\n   * @param {boolean} initialized - Whether the object is initialized\n   * @throws {BaseScormValidationError} - Throws an error if the object is initialized\n   */\n  validateReadOnly(CMIElement: string, initialized: boolean): void {\n    if (initialized) {\n      throw new Scorm12ValidationError(CMIElement, scorm12_errors.READ_ONLY_ELEMENT);\n    }\n  }\n}\n\n// Export a singleton instance of the ValidationService\nexport const validationService = new ValidationService();\n","import { CMIArray } from \"../common/array\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat, check12ValidRange } from \"./validation\";\nimport { scorm12_regex } from \"../../constants/regex\";\n\n/**\n * Class representing the SCORM 1.2 `cmi.interactions`\n * @extends CMIArray\n */\nexport class CMIInteractions extends CMIArray {\n  /**\n   * Constructor for `cmi.interactions`\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.interactions\",\n      children: scorm12_constants.interactions_children,\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.n object\n   */\n  constructor() {\n    super(\"cmi.interactions.n\");\n    this.objectives = new CMIArray({\n      CMIElement: \"cmi.interactions.n.objectives\",\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n      children: scorm12_constants.objectives_children,\n    });\n    this.correct_responses = new CMIArray({\n      CMIElement: \"cmi.interactions.correct_responses\",\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: Scorm12ValidationError,\n      children: scorm12_constants.correct_responses_children,\n    });\n  }\n\n  public readonly objectives: CMIArray;\n  public readonly correct_responses: CMIArray;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.objectives?.initialize();\n    this.correct_responses?.initialize();\n  }\n\n  private _id = \"\";\n  private _time = \"\";\n  private _type = \"\";\n  private _weighting = \"\";\n  private _student_response = \"\";\n  private _result = \"\";\n  private _latency = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset(): void {\n    this._initialized = false;\n\n    this._id = \"\";\n    this._time = \"\";\n    this._type = \"\";\n    this._weighting = \"\";\n    this._student_response = \"\";\n    this._result = \"\";\n    this._latency = \"\";\n\n    this.objectives?.reset();\n    this.correct_responses?.reset();\n  }\n\n  /**\n   * Getter for _id. Should only be called during JSON export.\n   * @return {string}\n   */\n  get id(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".id\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * Getter for _time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get time(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".time\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._time;\n  }\n\n  /**\n   * Setter for _time\n   * @param {string} time\n   */\n  set time(time: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".time\",\n        time,\n        scorm12_regex.CMITime,\n      )\n    ) {\n      this._time = time;\n    }\n  }\n\n  /**\n   * Getter for _type. Should only be called during JSON export.\n   * @return {string}\n   */\n  get type(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".type\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._type;\n  }\n\n  /**\n   * Setter for _type\n   * @param {string} type\n   */\n  set type(type: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".type\",\n        type,\n        scorm12_regex.CMIType,\n      )\n    ) {\n      this._type = type;\n    }\n  }\n\n  /**\n   * Getter for _weighting. Should only be called during JSON export.\n   * @return {string}\n   */\n  get weighting(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".weighting\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._weighting;\n  }\n\n  /**\n   * Setter for _weighting\n   * @param {string} weighting\n   */\n  set weighting(weighting: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".weighting\",\n        weighting,\n        scorm12_regex.CMIDecimal,\n      ) &&\n      check12ValidRange(\n        this._cmi_element + \".weighting\",\n        weighting,\n        scorm12_regex.weighting_range,\n      )\n    ) {\n      this._weighting = weighting;\n    }\n  }\n\n  /**\n   * Getter for _student_response. Should only be called during JSON export.\n   * @return {string}\n   */\n  get student_response(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_response\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._student_response;\n  }\n\n  /**\n   * Setter for _student_response\n   * @param {string} student_response\n   */\n  set student_response(student_response: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".student_response\",\n        student_response,\n        scorm12_regex.CMIFeedback,\n        true,\n      )\n    ) {\n      this._student_response = student_response;\n    }\n  }\n\n  /**\n   * Getter for _result. Should only be called during JSON export.\n   * @return {string}\n   */\n  get result(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".result\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._result;\n  }\n\n  /**\n   * Setter for _result\n   * @param {string} result\n   */\n  set result(result: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".result\",\n        result,\n        scorm12_regex.CMIResult,\n      )\n    ) {\n      this._result = result;\n    }\n  }\n\n  /**\n   * Getter for _latency. Should only be called during JSON export.\n   * @return {string}\n   */\n  get latency(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".latency\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._latency;\n  }\n\n  /**\n   * Setter for _latency\n   * @param {string} latency\n   */\n  set latency(latency: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".latency\",\n        latency,\n        scorm12_regex.CMITimespan,\n      )\n    ) {\n      this._latency = latency;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n\n   *\n   * @return {\n   *    {\n   *      id: string,\n   *      time: string,\n   *      type: string,\n   *      weighting: string,\n   *      student_response: string,\n   *      result: string,\n   *      latency: string,\n   *      objectives: CMIArray,\n   *      correct_responses: CMIArray\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n    time: string;\n    type: string;\n    weighting: string;\n    student_response: string;\n    result: string;\n    latency: string;\n    objectives: CMIArray;\n    correct_responses: CMIArray;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n      time: this.time,\n      type: this.type,\n      weighting: this.weighting,\n      student_response: this.student_response,\n      result: this.result,\n      latency: this.latency,\n      objectives: this.objectives,\n      correct_responses: this.correct_responses,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.n.objectives.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsObjectivesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.n.objectives.n\n   */\n  constructor() {\n    super(\"cmi.interactions.n.objectives.n\");\n  }\n\n  private _id = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._id = \"\";\n  }\n\n  /**\n   * Getter for _id\n   * @return {string}\n   */\n  get id(): string {\n    return this._id;\n  }\n\n  /**\n   * Setter for _id\n   * @param {string} id\n   */\n  set id(id: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".id\",\n        id,\n        scorm12_regex.CMIIdentifier,\n      )\n    ) {\n      this._id = id;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.n.objectives.n\n   * @return {\n   *    {\n   *      id: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    id: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      id: this.id,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing SCORM 1.2's cmi.interactions.correct_responses.n object\n * @extends BaseCMI\n */\nexport class CMIInteractionsCorrectResponsesObject extends BaseCMI {\n  /**\n   * Constructor for cmi.interactions.correct_responses.n\n   */\n  constructor() {\n    super(\"cmi.interactions.correct_responses.n\");\n  }\n\n  private _pattern = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._pattern = \"\";\n  }\n\n  /**\n   * Getter for _pattern\n   * @return {string}\n   */\n  get pattern(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".pattern\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._pattern;\n  }\n\n  /**\n   * Setter for _pattern\n   * @param {string} pattern\n   */\n  set pattern(pattern: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".pattern\",\n        pattern,\n        scorm12_regex.CMIFeedback,\n        true,\n      )\n    ) {\n      this._pattern = pattern;\n    }\n  }\n\n  /**\n   * toJSON for cmi.interactions.correct_responses.n\n   * @return {\n   *    {\n   *      pattern: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    pattern: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      pattern: this._pattern,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","/**\n * Constants for time conversion calculations.\n * These are used throughout the codebase for converting between different time formats.\n */\nexport const SECONDS_PER_SECOND = 1.0;\nexport const SECONDS_PER_MINUTE = 60;\nexport const SECONDS_PER_HOUR = 60 * SECONDS_PER_MINUTE;\nexport const SECONDS_PER_DAY = 24 * SECONDS_PER_HOUR;\n\ntype Designation = {\n  [key: string]: number;\n};\n\n/**\n * A record with string keys and unknown values.\n * This is a more type-safe alternative to using `any`.\n */\nexport type StringKeyMap = Record<string, unknown>;\n\nconst designations: Designation = {\n  D: SECONDS_PER_DAY,\n  H: SECONDS_PER_HOUR,\n  M: SECONDS_PER_MINUTE,\n  S: SECONDS_PER_SECOND,\n};\n\n/**\n * Converts a number of seconds to a formatted time string in HH:MM:SS format.\n * This function handles decimal seconds and ensures proper formatting with leading zeros.\n *\n * @param {number|null} totalSeconds - The total number of seconds to convert. If null or negative, returns \"00:00:00\".\n * @return {string} A formatted time string in HH:MM:SS format, with up to 2 decimal places for seconds if applicable.\n *\n * @example\n * // Returns \"01:30:45\"\n * getSecondsAsHHMMSS(5445);\n *\n * @example\n * // Returns \"00:00:30.5\"\n * getSecondsAsHHMMSS(30.5);\n *\n * @example\n * // Returns \"00:00:00\"\n * getSecondsAsHHMMSS(null);\n */\nexport const getSecondsAsHHMMSS = memoize((totalSeconds: number | null): string => {\n  // SCORM spec does not deal with negative durations, give zero back\n  if (!totalSeconds || totalSeconds <= 0) {\n    return \"00:00:00\";\n  }\n\n  const hours = Math.floor(totalSeconds / SECONDS_PER_HOUR);\n  const dateObj = new Date(totalSeconds * 1000);\n  const minutes = dateObj.getUTCMinutes();\n  // make sure we add any possible decimal value\n  const seconds = dateObj.getSeconds();\n  const ms = totalSeconds % 1.0;\n  let msStr = \"\";\n\n  if (countDecimals(ms) > 0) {\n    if (countDecimals(ms) > 2) {\n      msStr = ms.toFixed(2);\n    } else {\n      msStr = String(ms);\n    }\n\n    msStr = \".\" + msStr.split(\".\")[1];\n  }\n\n  return (hours + \":\" + minutes + \":\" + seconds).replace(/\\b\\d\\b/g, \"0$&\") + msStr;\n});\n\n/**\n * Converts a number of seconds to an ISO 8601 duration string (e.g., \"PT1H30M45S\").\n * This function handles the complexity of formatting according to the ISO 8601 standard,\n * including the proper placement of the \"T\" separator for time components.\n *\n * @param {number|null} seconds - The number of seconds to convert. If null or negative, returns \"PT0S\".\n * @return {string} An ISO 8601 formatted duration string.\n *\n * @example\n * // Returns \"PT1H30M45S\" (1 hour, 30 minutes, 45 seconds)\n * getSecondsAsISODuration(5445);\n *\n * @example\n * // Returns \"PT30.5S\" (30.5 seconds)\n * getSecondsAsISODuration(30.5);\n *\n * @example\n * // Returns \"P1DT1H\" (1 day, 1 hour)\n * getSecondsAsISODuration(90000);\n *\n * @example\n * // Returns \"PT0S\" (0 seconds)\n * getSecondsAsISODuration(null);\n */\nexport const getSecondsAsISODuration = memoize((seconds: number | null): string => {\n  // SCORM spec does not deal with negative durations, give zero back\n  if (!seconds || seconds <= 0) {\n    return \"PT0S\";\n  }\n\n  let duration = \"P\";\n  let remainder = seconds;\n\n  // Convert to array of entries and use functional methods\n  const designationEntries = Object.entries(designations);\n\n  // Process each time designation\n  designationEntries.forEach(([designationsKey, current_seconds]) => {\n    let value = Math.floor(remainder / current_seconds);\n    remainder = remainder % current_seconds;\n\n    // Limit decimal places\n    if (countDecimals(remainder) > 2) {\n      remainder = Number(Number(remainder).toFixed(2));\n    }\n\n    // If we have anything left in the remainder, and we're currently adding\n    // seconds to the duration, go ahead and add the decimal to the seconds\n    if (designationsKey === \"S\" && remainder > 0) {\n      value += remainder;\n    }\n\n    if (value) {\n      // Add the 'T' separator for time components if needed\n      const needsTimeSeparator =\n        (duration.indexOf(\"D\") > 0 || [\"H\", \"M\", \"S\"].includes(designationsKey)) &&\n        duration.indexOf(\"T\") === -1;\n\n      if (needsTimeSeparator) {\n        duration += \"T\";\n      }\n\n      duration += `${value}${designationsKey}`;\n    }\n  });\n\n  return duration;\n});\n\n/**\n * Converts a time string in HH:MM:SS format to the equivalent number of seconds.\n * This function is flexible and can handle various input types, converting them to strings as needed.\n *\n * @param {string|number|boolean|null} timeString - The time string to convert, typically in HH:MM:SS format.\n *                                                 If not a string, it will be converted to one.\n *                                                 If null, invalid, or doesn't match the regex, returns 0.\n * @param {RegExp|string} timeRegex - The regular expression used to validate the time string format.\n *                                    If a string is provided, it will be converted to a RegExp.\n * @return {number} The total number of seconds represented by the time string.\n *\n * @example\n * // Returns 5445 (1 hour, 30 minutes, 45 seconds)\n * getTimeAsSeconds(\"01:30:45\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns 0 (invalid format)\n * getTimeAsSeconds(\"invalid\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns 30 (converts number to string \"30\" then parses as 0:0:30)\n * getTimeAsSeconds(30, /^(\\d+):(\\d+):(\\d+)$/);\n */\nexport const getTimeAsSeconds = memoize(\n  (timeString: string | number | boolean | null, timeRegex: RegExp | string): number => {\n    if (typeof timeString === \"number\" || typeof timeString === \"boolean\") {\n      timeString = String(timeString);\n    }\n    if (typeof timeRegex === \"string\") {\n      timeRegex = new RegExp(timeRegex);\n    }\n    if (!timeString || !timeString?.match?.(timeRegex)) {\n      return 0;\n    }\n\n    const parts = timeString.split(\":\");\n    const hours = Number(parts[0]);\n    const minutes = Number(parts[1]);\n    const seconds = Number(parts[2]);\n    return hours * 3600 + minutes * 60 + seconds;\n  },\n  // Custom key function to handle RegExp objects which can't be stringified\n  (timeString, timeRegex) => {\n    const timeStr = typeof timeString === \"string\" ? timeString : String(timeString ?? \"\");\n    const regexStr = typeof timeRegex === \"string\" ? timeRegex : (timeRegex?.toString() ?? \"\");\n    return `${timeStr}:${regexStr}`;\n  },\n);\n\n/**\n * Converts an ISO 8601 duration string (e.g., \"PT1H30M45S\") to the equivalent number of seconds.\n * This function parses the duration string using a regular expression to extract years, days,\n * hours, minutes, and seconds components.\n *\n * @param {string|null} duration - The ISO 8601 duration string to convert.\n *                                If null, invalid, or doesn't match the regex, returns 0.\n * @param {RegExp|string} durationRegex - The regular expression used to parse the duration components.\n *                                       If a string is provided, it will be converted to a RegExp.\n *                                       The regex should have capture groups for years, days, hours, minutes, and seconds.\n * @return {number} The total number of seconds represented by the duration string.\n *\n * @example\n * // Returns 5445 (1 hour, 30 minutes, 45 seconds)\n * getDurationAsSeconds(\"PT1H30M45S\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns 90000 (1 day, 1 hour)\n * getDurationAsSeconds(\"P1DT1H\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns 0 (invalid format)\n * getDurationAsSeconds(\"invalid\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n */\nexport const getDurationAsSeconds = memoize(\n  (duration: string | null, durationRegex: RegExp | string): number => {\n    if (typeof durationRegex === \"string\") {\n      durationRegex = new RegExp(durationRegex);\n    }\n\n    if (!duration || !duration?.match?.(durationRegex)) {\n      return 0;\n    }\n\n    const [, years, _, , days, hours, minutes, seconds] =\n      new RegExp(durationRegex).exec?.(duration) ?? [];\n    let result = 0.0;\n    result += Number(seconds) || 0.0;\n    result += Number(minutes) * 60.0 || 0.0;\n    result += Number(hours) * 3600.0 || 0.0;\n    result += Number(days) * (60 * 60 * 24.0) || 0.0;\n    result += Number(years) * (60 * 60 * 24 * 365.0) || 0.0;\n    return result;\n  },\n  // Custom key function to handle RegExp objects which can't be stringified\n  (duration, durationRegex) => {\n    const durationStr = duration ?? \"\";\n    const regexStr =\n      typeof durationRegex === \"string\" ? durationRegex : (durationRegex?.toString() ?? \"\");\n    return `${durationStr}:${regexStr}`;\n  },\n);\n\n/**\n * Adds together two ISO 8601 duration strings and returns the result as a new ISO 8601 duration string.\n * This function works by converting both durations to seconds, adding them together, and then\n * converting the result back to an ISO 8601 duration string.\n *\n * @param {string} first - The first ISO 8601 duration string.\n * @param {string} second - The second ISO 8601 duration string.\n * @param {RegExp|string} durationRegex - The regular expression used to parse the duration components.\n *                                       If a string is provided, it will be converted to a RegExp.\n * @return {string} A new ISO 8601 duration string representing the sum of the two input durations.\n *\n * @example\n * // Returns \"PT2H\" (1 hour + 1 hour = 2 hours)\n * addTwoDurations(\"PT1H\", \"PT1H\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns \"PT1H30M\" (1 hour + 30 minutes = 1 hour and 30 minutes)\n * addTwoDurations(\"PT1H\", \"PT30M\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n *\n * @example\n * // Returns \"P1DT1H30M\" (1 day + 1 hour and 30 minutes = 1 day, 1 hour, and 30 minutes)\n * addTwoDurations(\"P1D\", \"PT1H30M\", /^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$/);\n */\nexport function addTwoDurations(\n  first: string,\n  second: string,\n  durationRegex: RegExp | string,\n): string {\n  const regex: RegExp =\n    typeof durationRegex === \"string\" ? new RegExp(durationRegex) : durationRegex;\n  return getSecondsAsISODuration(\n    getDurationAsSeconds(first, regex) + getDurationAsSeconds(second, regex),\n  );\n}\n\n/**\n * Adds together two time strings in HH:MM:SS format and returns the result as a new time string.\n * This function works by converting both time strings to seconds, adding them together, and then\n * converting the result back to an HH:MM:SS format.\n *\n * @param {string} first - The first time string in HH:MM:SS format.\n * @param {string} second - The second time string in HH:MM:SS format.\n * @param {RegExp|string} timeRegex - The regular expression used to validate and parse the time strings.\n *                                   If a string is provided, it will be converted to a RegExp.\n * @return {string} A new time string in HH:MM:SS format representing the sum of the two input times.\n *\n * @example\n * // Returns \"02:00:00\" (1 hour + 1 hour = 2 hours)\n * addHHMMSSTimeStrings(\"01:00:00\", \"01:00:00\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns \"01:30:00\" (1 hour + 30 minutes = 1 hour and 30 minutes)\n * addHHMMSSTimeStrings(\"01:00:00\", \"00:30:00\", /^(\\d+):(\\d+):(\\d+)$/);\n *\n * @example\n * // Returns \"01:30:45\" (1 hour + 30 minutes and 45 seconds = 1 hour, 30 minutes, and 45 seconds)\n * addHHMMSSTimeStrings(\"01:00:00\", \"00:30:45\", /^(\\d+):(\\d+):(\\d+)$/);\n */\nexport function addHHMMSSTimeStrings(\n  first: string,\n  second: string,\n  timeRegex: RegExp | string,\n): string {\n  if (typeof timeRegex === \"string\") {\n    timeRegex = new RegExp(timeRegex);\n  }\n  return getSecondsAsHHMMSS(\n    getTimeAsSeconds(first, timeRegex) + getTimeAsSeconds(second, timeRegex),\n  );\n}\n\n/**\n * Flattens a nested JSON object into a flat object with dot notation for nested properties.\n * This function recursively traverses the object and creates new keys using dot notation\n * for nested objects and bracket notation for arrays.\n *\n * @param {StringKeyMap} data - The nested object to flatten.\n * @return {StringKeyMap} A flattened object where nested properties are represented with dot notation.\n *\n * @example\n * // Returns { \"a\": 1, \"b.c\": 2, \"b.d\": 3, \"e[0]\": 4, \"e[1]\": 5 }\n * flatten({\n *   a: 1,\n *   b: { c: 2, d: 3 },\n *   e: [4, 5]\n * });\n *\n * @example\n * // Returns { \"\": [] } for an empty array\n * flatten([]);\n *\n * @example\n * // Returns { \"\": {} } for an empty object\n * flatten({});\n */\nexport function flatten(data: StringKeyMap): StringKeyMap {\n  const result: StringKeyMap = {};\n\n  /**\n   * Recurse through the object\n   * @param {*} cur\n   * @param {*} prop\n   */\n  function recurse(cur: any, prop: any) {\n    if (Object(cur) !== cur) {\n      result[prop] = cur;\n    } else if (Array.isArray(cur)) {\n      // Use forEach instead of for loop\n      cur.forEach((item, i) => {\n        recurse(item, `${prop}[${i}]`);\n      });\n\n      if (cur.length === 0) result[prop] = [];\n    } else {\n      const keys = Object.keys(cur).filter((p) => Object.prototype.hasOwnProperty.call(cur, p));\n\n      const isEmpty = keys.length === 0;\n\n      // Use forEach instead of for...in loop\n      keys.forEach((p) => {\n        recurse(cur[p], prop ? `${prop}.${p}` : p);\n      });\n\n      if (isEmpty && prop) result[prop] = {};\n    }\n  }\n\n  recurse(data, \"\");\n  return result;\n}\n\n/**\n * Converts a flattened object back into a nested object structure.\n * This function is the inverse of `flatten()`. It parses dot notation and bracket notation\n * in property names to recreate the original nested structure.\n *\n * @param {StringKeyMap} data - The flattened object to unflatten.\n * @return {object} A nested object recreated from the flattened structure.\n *\n * @example\n * // Returns { a: 1, b: { c: 2, d: 3 }, e: [4, 5] }\n * unflatten({\n *   \"a\": 1,\n *   \"b.c\": 2,\n *   \"b.d\": 3,\n *   \"e[0]\": 4,\n *   \"e[1]\": 5\n * });\n *\n * @example\n * // Handles array indices correctly\n * unflatten({\n *   \"users[0].name\": \"John\",\n *   \"users[0].email\": \"john@example.com\",\n *   \"users[1].name\": \"Jane\",\n *   \"users[1].email\": \"jane@example.com\"\n * });\n * // Returns:\n * // {\n * //   users: [\n * //     { name: \"John\", email: \"john@example.com\" },\n * //     { name: \"Jane\", email: \"jane@example.com\" }\n * //   ]\n * // }\n */\nexport function unflatten(data: StringKeyMap): object {\n  \"use strict\";\n\n  if (Object(data) !== data || Array.isArray(data)) return data;\n  const result: StringKeyMap = {};\n\n  // Regex pattern for parsing property paths\n  const pattern = /\\.?([^.[\\]]+)|\\[(\\d+)]/g;\n\n  // Get all own properties and process them\n  Object.keys(data)\n    .filter((p) => Object.prototype.hasOwnProperty.call(data, p))\n    .forEach((p) => {\n      let cur = result;\n      let prop = \"\";\n\n      // Create a new regex instance for each property to reset lastIndex\n      const regex = new RegExp(pattern);\n\n      // Process all matches in the property path\n      Array.from({ length: p.match(new RegExp(pattern, \"g\"))?.length ?? 0 }, () =>\n        regex.exec(p),\n      ).forEach((m) => {\n        if (m) {\n          // Create array or object as needed\n          cur = (cur[prop] ?? (cur[prop] = m[2] ? [] : ({} as StringKeyMap))) as StringKeyMap;\n          prop = m[2] || m[1];\n        }\n      });\n\n      cur[prop] = data[p];\n    });\n\n  return (result[\"\"] ?? result) as object;\n}\n\n/**\n * Counts the number of decimal places in a number.\n * This function handles both integer and floating-point numbers.\n *\n * @param {number} num - The number to analyze.\n * @return {number} The number of decimal places. Returns 0 for integers or if the number doesn't have a decimal point.\n *\n * @example\n * // Returns 0\n * countDecimals(42);\n *\n * @example\n * // Returns 2\n * countDecimals(3.14);\n *\n * @example\n * // Returns 5\n * countDecimals(1.23456);\n */\nexport function countDecimals(num: number): number {\n  if (Math.floor(num) === num || String(num)?.indexOf?.(\".\") < 0) return 0;\n  const parts = num.toString().split(\".\")?.[1];\n  return parts?.length ?? 0;\n}\n\n/**\n * Formats SCORM messages for consistent and readable logging.\n * This function pads the function name and CMI element to create aligned log messages\n * that are easier to read in log files or console output.\n *\n * @param {string} functionName - The name of the function that generated the message.\n * @param {string} message - The message content to be logged.\n * @param {string} [CMIElement] - Optional. The CMI element related to the message.\n * @return {string} A formatted message string with consistent padding.\n *\n * @example\n * // Returns \"initialize          : Successfully initialized\"\n * formatMessage(\"initialize\", \"Successfully initialized\");\n *\n * @example\n * // Returns \"getValue            : cmi.core.student_id                                             : 12345\"\n * formatMessage(\"getValue\", \"12345\", \"cmi.core.student_id\");\n *\n * @example\n * // Returns \"setValue            : cmi.core.lesson_status                                          : completed\"\n * formatMessage(\"setValue\", \"completed\", \"cmi.core.lesson_status\");\n */\nexport function formatMessage(functionName: string, message: string, CMIElement?: string): string {\n  const baseLength = 20;\n\n  // Use string padding instead of loops\n  const paddedFunction = functionName.padEnd(baseLength);\n  let messageString = `${paddedFunction}: `;\n\n  if (CMIElement) {\n    const CMIElementBaseLength = 70;\n    // Add CMIElement and pad to the required length\n    messageString += CMIElement;\n    messageString = messageString.padEnd(CMIElementBaseLength);\n  }\n\n  // Add the message (or empty string if null/undefined)\n  messageString += message ?? \"\";\n\n  return messageString;\n}\n\n/**\n * Checks if a string contains a specific pattern using regular expression matching.\n * This function is a wrapper around JavaScript's String.match() method that handles\n * null/undefined values gracefully.\n *\n * @param {string} str - The string to search within. If null or undefined, returns false.\n * @param {string} tester - The pattern to search for. Can be a regular expression pattern.\n * @return {boolean} True if the pattern is found in the string, false otherwise.\n *\n * @example\n * // Returns true\n * stringMatches(\"Hello, world!\", \"world\");\n *\n * @example\n * // Returns true\n * stringMatches(\"The quick brown fox\", \"\\\\w+\\\\s+\\\\w+\");\n *\n * @example\n * // Returns false\n * stringMatches(\"Hello, world!\", \"universe\");\n *\n * @example\n * // Returns false (handles null gracefully)\n * stringMatches(null, \"test\");\n */\nexport function stringMatches(str: string, tester: string): boolean {\n  return str?.match(tester) !== null;\n}\n\n/**\n * Creates a memoized (cached) version of a function for performance optimization.\n * This function caches the results of previous calls with the same arguments,\n * avoiding redundant calculations for repeated calls with the same input.\n *\n * @template T - The type of the function to memoize\n * @param {T} fn - The function to memoize\n * @param {Function} [keyFn] - Optional function to generate a custom cache key.\n *                           Useful for functions with complex arguments that can't be serialized.\n * @return {T} A memoized version of the input function with the same signature\n *\n * @example\n * // Basic usage with a simple function\n * const memoizedAdd = memoize((a, b) => {\n *   console.log('Calculating...');\n *   return a + b;\n * });\n *\n * memoizedAdd(1, 2); // Logs \"Calculating...\" and returns 3\n * memoizedAdd(1, 2); // Returns 3 without logging (uses cached result)\n *\n * @example\n * // Using a custom key function for objects that can't be serialized\n * const memoizedProcessUser = memoize(\n *   (user) => {\n *     console.log('Processing user...');\n *     return { ...user, processed: true };\n *   },\n *   (user) => user.id // Use user.id as the cache key\n * );\n *\n * memoizedProcessUser({ id: 123, name: 'John' }); // Logs and processes\n * memoizedProcessUser({ id: 123, name: 'John' }); // Uses cached result\n */\nexport function memoize<T extends (...args: any[]) => any>(\n  fn: T,\n  keyFn?: (...args: Parameters<T>) => string,\n): T {\n  const cache = new Map<string, ReturnType<T>>();\n\n  return ((...args: Parameters<T>): ReturnType<T> => {\n    const key = keyFn ? keyFn(...args) : JSON.stringify(args);\n\n    return cache.has(key)\n      ? (cache.get(key) as ReturnType<T>)\n      : (() => {\n          const result = fn(...args);\n          cache.set(key, result);\n          return result;\n        })();\n  }) as T;\n}\n","import { checkValidFormat, checkValidRange } from \"../common/validation\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} regexPattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check12ValidFormat(\n  CMIElement: string,\n  value: string,\n  regexPattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  return checkValidFormat(\n    CMIElement,\n    value,\n    regexPattern,\n    scorm12_errors.TYPE_MISMATCH,\n    Scorm12ValidationError,\n    allowEmptyString,\n  );\n}\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} rangePattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function check12ValidRange(\n  CMIElement: string,\n  value: any,\n  rangePattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  if (!allowEmptyString && value === \"\") {\n    throw new Scorm12ValidationError(\n      CMIElement,\n      scorm12_errors.VALUE_OUT_OF_RANGE,\n    );\n  }\n\n  return checkValidRange(\n    CMIElement,\n    value,\n    rangePattern,\n    scorm12_errors.VALUE_OUT_OF_RANGE,\n    Scorm12ValidationError,\n  );\n}\n","import { ValidationError } from \"../exceptions\";\nimport { aicc_constants } from \"../constants/api_constants\";\n\nconst aicc_errors = aicc_constants.error_descriptions;\n\n/**\n * AICC Validation Error\n */\nexport class AICCValidationError extends ValidationError {\n  /**\n   * Constructor to take in an error code\n   * @param {string} CMIElement\n   * @param {number} errorCode\n   */\n  constructor(CMIElement: string, errorCode: number) {\n    if ({}.hasOwnProperty.call(aicc_errors, String(errorCode))) {\n      super(\n        CMIElement,\n        errorCode,\n        aicc_errors[String(errorCode)].basicMessage,\n        aicc_errors[String(errorCode)].detailMessage,\n      );\n    } else {\n      super(CMIElement, 101, aicc_errors[\"101\"].basicMessage, aicc_errors[\"101\"].detailMessage);\n    }\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, AICCValidationError.prototype);\n  }\n}\n","import { checkValidFormat } from \"../common/validation\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\n\n/**\n * Helper method, no reason to have to pass the same error codes every time\n * @param {string} CMIElement\n * @param {string} value\n * @param {string} regexPattern\n * @param {boolean} allowEmptyString\n * @return {boolean}\n */\nexport function checkAICCValidFormat(\n  CMIElement: string,\n  value: string,\n  regexPattern: string,\n  allowEmptyString?: boolean,\n): boolean {\n  return checkValidFormat(\n    CMIElement,\n    value,\n    regexPattern,\n    scorm12_errors.TYPE_MISMATCH,\n    AICCValidationError,\n    allowEmptyString,\n  );\n}\n","import { CMIArray } from \"../common/array\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { checkAICCValidFormat } from \"./validation\";\nimport { aicc_regex } from \"../../constants/regex\";\n\n/**\n * AICC Evaluation object\n */\nexport class CMIEvaluation extends BaseCMI {\n  /**\n   * Constructor for AICC Evaluation object\n   */\n  constructor() {\n    super(\"cmi.evaluation\");\n    this.comments = new CMIEvaluationComments();\n  }\n\n  public comments: CMIEvaluationComments;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.comments?.initialize();\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this.comments?.reset();\n  }\n\n  /**\n   * toJSON for cmi.evaluation object\n   * @return {{comments: CMIEvaluationComments}}\n   */\n  toJSON(): {\n    comments: CMIEvaluationComments;\n  } {\n    this.jsonString = true;\n    const result = {\n      comments: this.comments,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n\n/**\n * Class representing AICC's cmi.evaluation.comments object\n */\n\nclass CMIEvaluationComments extends CMIArray {\n  /**\n   * Constructor for AICC Evaluation Comments object\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.evaluation.comments\",\n      children: aicc_constants.comments_children,\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: AICCValidationError,\n    });\n  }\n}\n\n/**\n * Class for AICC Evaluation Comments\n */\nexport class CMIEvaluationCommentsObject extends BaseCMI {\n  private _content = \"\";\n  private _location = \"\";\n  private _time = \"\";\n\n  /**\n   * Constructor for Evaluation Comments\n   */\n  constructor() {\n    super(\"cmi.evaluation.comments.n\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._content = \"\";\n    this._location = \"\";\n    this._time = \"\";\n  }\n\n  /**\n   * Getter for _content\n   * @return {string}\n   */\n  get content(): string {\n    return this._content;\n  }\n\n  /**\n   * Setter for _content\n   * @param {string} content\n   */\n  set content(content: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".content\",\n        content,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._content = content;\n    }\n  }\n\n  /**\n   * Getter for _location\n   * @return {string}\n   */\n  get location(): string {\n    return this._location;\n  }\n\n  /**\n   * Setter for _location\n   * @param {string} location\n   */\n  set location(location: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".location\",\n        location,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._location = location;\n    }\n  }\n\n  /**\n   * Getter for _time\n   * @return {string}\n   */\n  get time(): string {\n    return this._time;\n  }\n\n  /**\n   * Setting for _time\n   * @param {string} time\n   */\n  set time(time: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".time\",\n        time,\n        aicc_regex.CMITime,\n      )\n    ) {\n      this._time = time;\n    }\n  }\n\n  /**\n   * toJSON for cmi.evaluation.comments.n object\n   * @return {\n   *    {\n   *      content: string,\n   *      location: string,\n   *      time: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    content: string;\n    location: string;\n    time: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      content: this.content,\n      location: this.location,\n      time: this.time,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { checkAICCValidFormat } from \"./validation\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { aicc_regex } from \"../../constants/regex\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { CMIStudentPreference } from \"../scorm12/student_preference\";\n\n/**\n * StudentPreferences class for AICC\n */\nexport class AICCStudentPreferences extends CMIStudentPreference {\n  /**\n   * Constructor for AICC Student Preferences object\n   */\n  constructor() {\n    super(aicc_constants.student_preference_children);\n    this.windows = new CMIArray({\n      CMIElement: \"cmi.student_preference.windows\",\n      errorCode: scorm12_errors.INVALID_SET_VALUE,\n      errorClass: AICCValidationError,\n      children: \"\",\n    });\n  }\n\n  public windows: CMIArray;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.windows?.initialize();\n  }\n\n  private _lesson_type = \"\";\n  private _text_color = \"\";\n  private _text_location = \"\";\n  private _text_size = \"\";\n  private _video = \"\";\n\n  /**\n   * Getter for _lesson_type\n   * @return {string}\n   */\n  get lesson_type(): string {\n    return this._lesson_type;\n  }\n\n  /**\n   * Setter for _lesson_type\n   * @param {string} lesson_type\n   */\n  set lesson_type(lesson_type: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".lesson_type\",\n        lesson_type,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._lesson_type = lesson_type;\n    }\n  }\n\n  /**\n   * Getter for _text_color\n   * @return {string}\n   */\n  get text_color(): string {\n    return this._text_color;\n  }\n\n  /**\n   * Setter for _text_color\n   * @param {string} text_color\n   */\n  set text_color(text_color: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".text_color\",\n        text_color,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._text_color = text_color;\n    }\n  }\n\n  /**\n   * Getter for _text_location\n   * @return {string}\n   */\n  get text_location(): string {\n    return this._text_location;\n  }\n\n  /**\n   * Setter for _text_location\n   * @param {string} text_location\n   */\n  set text_location(text_location: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".text_location\",\n        text_location,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._text_location = text_location;\n    }\n  }\n\n  /**\n   * Getter for _text_size\n   * @return {string}\n   */\n  get text_size(): string {\n    return this._text_size;\n  }\n\n  /**\n   * Setter for _text_size\n   * @param {string} text_size\n   */\n  set text_size(text_size: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".text_size\",\n        text_size,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._text_size = text_size;\n    }\n  }\n\n  /**\n   * Getter for _video\n   * @return {string}\n   */\n  get video(): string {\n    return this._video;\n  }\n\n  /**\n   * Setter for _video\n   * @param {string} video\n   */\n  set video(video: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".video\",\n        video,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._video = video;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_preference\n   *\n   * @return {\n   *    {\n   *      audio: string,\n   *      language: string,\n   *      speed: string,\n   *      text: string,\n   *      text_color: string,\n   *      text_location: string,\n   *      text_size: string,\n   *      video: string,\n   *      windows: CMIArray\n   *    }\n   *  }\n   */\n  override toJSON(): {\n    audio: string;\n    language: string;\n    lesson_type: string;\n    speed: string;\n    text: string;\n    text_color: string;\n    text_location: string;\n    text_size: string;\n    video: string;\n    windows: CMIArray;\n  } {\n    this.jsonString = true;\n    const result = {\n      audio: this.audio,\n      language: this.language,\n      lesson_type: this.lesson_type,\n      speed: this.speed,\n      text: this.text,\n      text_color: this.text_color,\n      text_location: this.text_location,\n      text_size: this.text_size,\n      video: this.video,\n      windows: this.windows,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\n\n/**\n * Class representing the AICC cmi.student_demographics object\n */\nexport class CMIStudentDemographics extends BaseCMI {\n  private __children = aicc_constants.student_demographics_children;\n  private _city = \"\";\n  private _class = \"\";\n  private _company = \"\";\n  private _country = \"\";\n  private _experience = \"\";\n  private _familiar_name = \"\";\n  private _instructor_name = \"\";\n  private _title = \"\";\n  private _native_language = \"\";\n  private _state = \"\";\n  private _street_address = \"\";\n  private _telephone = \"\";\n  private _years_experience = \"\";\n\n  /**\n   * Constructor for AICC StudentDemographics object\n   */\n  constructor() {\n    super(\"cmi.student_demographics\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n  }\n\n  /**\n   * Getter for _children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Getter for city\n   * @return {string}\n   */\n  get city(): string {\n    return this._city;\n  }\n\n  /**\n   * Setter for _city. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} city\n   */\n  set city(city: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.city\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._city = city;\n    }\n  }\n\n  /**\n   * Getter for class\n   * @return {string}\n   */\n  get class(): string {\n    return this._class;\n  }\n\n  /**\n   * Setter for _class. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} clazz\n   */\n  set class(clazz: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.class\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._class = clazz;\n    }\n  }\n\n  /**\n   * Getter for company\n   * @return {string}\n   */\n  get company(): string {\n    return this._company;\n  }\n\n  /**\n   * Setter for _company. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} company\n   */\n  set company(company: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.company\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._company = company;\n    }\n  }\n\n  /**\n   * Getter for country\n   * @return {string}\n   */\n  get country(): string {\n    return this._country;\n  }\n\n  /**\n   * Setter for _country. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} country\n   */\n  set country(country: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.country\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._country = country;\n    }\n  }\n\n  /**\n   * Getter for experience\n   * @return {string}\n   */\n  get experience(): string {\n    return this._experience;\n  }\n\n  /**\n   * Setter for _experience. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} experience\n   */\n  set experience(experience: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.experience\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._experience = experience;\n    }\n  }\n\n  /**\n   * Getter for familiar_name\n   * @return {string}\n   */\n  get familiar_name(): string {\n    return this._familiar_name;\n  }\n\n  /**\n   * Setter for _familiar_name. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} familiar_name\n   */\n  set familiar_name(familiar_name: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.familiar_name\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._familiar_name = familiar_name;\n    }\n  }\n\n  /**\n   * Getter for instructor_name\n   * @return {string}\n   */\n  get instructor_name(): string {\n    return this._instructor_name;\n  }\n\n  /**\n   * Setter for _instructor_name. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} instructor_name\n   */\n  set instructor_name(instructor_name: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.instructor_name\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._instructor_name = instructor_name;\n    }\n  }\n\n  /**\n   * Getter for title\n   * @return {string}\n   */\n  get title(): string {\n    return this._title;\n  }\n\n  /**\n   * Setter for _title. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} title\n   */\n  set title(title: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.title\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._title = title;\n    }\n  }\n\n  /**\n   * Getter for native_language\n   * @return {string}\n   */\n  get native_language(): string {\n    return this._native_language;\n  }\n\n  /**\n   * Setter for _native_language. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} native_language\n   */\n  set native_language(native_language: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.native_language\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._native_language = native_language;\n    }\n  }\n\n  /**\n   * Getter for state\n   * @return {string}\n   */\n  get state(): string {\n    return this._state;\n  }\n\n  /**\n   * Setter for _state. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} state\n   */\n  set state(state: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.state\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._state = state;\n    }\n  }\n\n  /**\n   * Getter for street_address\n   * @return {string}\n   */\n  get street_address(): string {\n    return this._street_address;\n  }\n\n  /**\n   * Setter for _street_address. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} street_address\n   */\n  set street_address(street_address: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.street_address\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._street_address = street_address;\n    }\n  }\n\n  /**\n   * Getter for telephone\n   * @return {string}\n   */\n  get telephone(): string {\n    return this._telephone;\n  }\n\n  /**\n   * Setter for _telephone. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} telephone\n   */\n  set telephone(telephone: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.telephone\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._telephone = telephone;\n    }\n  }\n\n  /**\n   * Getter for years_experience\n   * @return {string}\n   */\n  get years_experience(): string {\n    return this._years_experience;\n  }\n\n  /**\n   * Setter for _years_experience. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} years_experience\n   */\n  set years_experience(years_experience: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_demographics.years_experience\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._years_experience = years_experience;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_demographics object\n   * @return {\n   *      {\n   *        city: string,\n   *        class: string,\n   *        company: string,\n   *        country: string,\n   *        experience: string,\n   *        familiar_name: string,\n   *        instructor_name: string,\n   *        title: string,\n   *        native_language: string,\n   *        state: string,\n   *        street_address: string,\n   *        telephone: string,\n   *        years_experience: string\n   *      }\n   *    }\n   */\n  toJSON(): {\n    city: string;\n    class: string;\n    company: string;\n    country: string;\n    experience: string;\n    familiar_name: string;\n    instructor_name: string;\n    title: string;\n    native_language: string;\n    state: string;\n    street_address: string;\n    telephone: string;\n    years_experience: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      city: this.city,\n      class: this.class,\n      company: this.company,\n      country: this.country,\n      experience: this.experience,\n      familiar_name: this.familiar_name,\n      instructor_name: this.instructor_name,\n      title: this.title,\n      native_language: this.native_language,\n      state: this.state,\n      street_address: this.street_address,\n      telephone: this.telephone,\n      years_experience: this.years_experience,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { CMIArray } from \"../common/array\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { aicc_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { checkAICCValidFormat } from \"./validation\";\n\n/**\n * Class representing the AICC cmi.student_data.tries object\n */\nexport class CMITries extends CMIArray {\n  /**\n   * Constructor for inline Tries Array class\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.student_data.tries\",\n      children: aicc_constants.tries_children,\n    });\n  }\n}\n\n/**\n * Class for AICC Tries\n */\nexport class CMITriesObject extends BaseCMI {\n  private _status = \"\";\n  private _time = \"\";\n\n  /**\n   * Constructor for AICC Tries object\n   */\n  constructor() {\n    super(\"cmi.student_data.tries.n\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.student_data.tries.n.score\",\n      score_children: aicc_constants.score_children,\n      score_range: aicc_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: AICCValidationError,\n    });\n  }\n\n  public score: CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.score?.initialize();\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this._status = \"\";\n    this._time = \"\";\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for _status\n   * @return {string}\n   */\n  get status(): string {\n    return this._status;\n  }\n\n  /**\n   * Setter for _status\n   * @param {string} status\n   */\n  set status(status: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".status\",\n        status,\n        aicc_regex.CMIStatus2,\n      )\n    ) {\n      this._status = status;\n    }\n  }\n\n  /**\n   * Getter for _time\n   * @return {string}\n   */\n  get time(): string {\n    return this._time;\n  }\n\n  /**\n   * Setter for _time\n   * @param {string} time\n   */\n  set time(time: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".time\",\n        time,\n        aicc_regex.CMITime,\n      )\n    ) {\n      this._time = time;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_data.tries.n object\n   * @return {\n   *    {\n   *      status: string,\n   *      time: string,\n   *      score: CMIScore\n   *    }\n   *  }\n   */\n  toJSON(): {\n    status: string;\n    time: string;\n    score: CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      status: this.status,\n      time: this.time,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { aicc_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { checkAICCValidFormat } from \"./validation\";\nimport { CMIArray } from \"../common/array\";\n\n/**\n * Class for cmi.student_data.attempt_records array\n */\nexport class CMIAttemptRecords extends CMIArray {\n  /**\n   * Constructor for inline Tries Array class\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.student_data.attempt_records\",\n      children: aicc_constants.attempt_records_children,\n    });\n  }\n}\n\n/**\n * Class for AICC Attempt Records\n */\nexport class CMIAttemptRecordsObject extends BaseCMI {\n  private _lesson_status = \"\";\n\n  /**\n   * Constructor for AICC Attempt Records object\n   */\n  constructor() {\n    super(\"cmi.student_data.attempt_records.n\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.student_data.attempt_records.n.score\",\n      score_children: aicc_constants.score_children,\n      score_range: aicc_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: AICCValidationError,\n    });\n  }\n\n  public score: CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n\n    this._lesson_status = \"\";\n    this.score?.initialize();\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for _lesson_status\n   * @return {string}\n   */\n  get lesson_status(): string {\n    return this._lesson_status;\n  }\n\n  /**\n   * Setter for _lesson_status\n   * @param {string} lesson_status\n   */\n  set lesson_status(lesson_status: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".lesson_status\",\n        lesson_status,\n        aicc_regex.CMIStatus2,\n      )\n    ) {\n      this._lesson_status = lesson_status;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_data.attempt_records.n object\n   * @return {\n   *    {\n   *         lesson_status: string,\n   *         score: CMIScore\n   *     }\n   *  }\n   */\n  toJSON(): {\n    lesson_status: string;\n    score: CMIScore;\n  } {\n    this.jsonString = true;\n    const result = {\n      lesson_status: this.lesson_status,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { AICCValidationError } from \"../../exceptions/aicc_exceptions\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { CMITries } from \"./tries\";\nimport { CMIStudentData } from \"../scorm12/student_data\";\nimport { CMIAttemptRecords } from \"./attempts\";\n\n/**\n * StudentData class for AICC\n */\nexport class AICCCMIStudentData extends CMIStudentData {\n  /**\n   * Constructor for AICC StudentData object\n   */\n  constructor() {\n    super(aicc_constants.student_data_children);\n    this.tries = new CMITries();\n    this.attempt_records = new CMIAttemptRecords();\n  }\n\n  public tries: CMITries;\n  public attempt_records: CMIAttemptRecords;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.tries?.initialize();\n    this.attempt_records?.initialize();\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  override reset(): void {\n    this._initialized = false;\n    this.tries?.reset(true);\n    this.attempt_records?.reset(true);\n  }\n\n  private _tries_during_lesson = \"\";\n\n  /**\n   * Getter for tries_during_lesson\n   * @return {string}\n   */\n  get tries_during_lesson(): string {\n    return this._tries_during_lesson;\n  }\n\n  /**\n   * Setter for _tries_during_lesson. Sets an error if trying to set after\n   *  initialization.\n   * @param {string} tries_during_lesson\n   */\n  set tries_during_lesson(tries_during_lesson: string) {\n    if (this.initialized) {\n      throw new AICCValidationError(\n        \"cmi.student_data.tries_during_lesson\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._tries_during_lesson = tries_during_lesson;\n    }\n  }\n\n  /**\n   * toJSON for cmi.student_data object\n   * @return {\n   *    {\n   *      mastery_score: string,\n   *      max_time_allowed: string,\n   *      time_limit_action: string,\n   *      tries: CMITries,\n   *      attempt_records: CMIAttemptRecords\n   *    }\n   *  }\n   */\n  override toJSON(): {\n    mastery_score: string;\n    max_time_allowed: string;\n    time_limit_action: string;\n    tries: CMITries;\n    attempt_records: CMIAttemptRecords;\n  } {\n    this.jsonString = true;\n    const result = {\n      mastery_score: this.mastery_score,\n      max_time_allowed: this.max_time_allowed,\n      time_limit_action: this.time_limit_action,\n      tries: this.tries,\n      attempt_records: this.attempt_records,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { checkAICCValidFormat } from \"./validation\";\nimport { CMIArray } from \"../common/array\";\nimport { aicc_regex } from \"../../constants/regex\";\nimport { aicc_constants } from \"../../constants/api_constants\";\n\n/**\n * Class representing the AICC `cmi.paths` object\n */\nexport class CMIPaths extends CMIArray {\n  /**\n   * Constructor for inline Paths Array class\n   */\n  constructor() {\n    super({\n      CMIElement: \"cmi.paths\",\n      children: aicc_constants.paths_children,\n    });\n  }\n}\n\n/**\n * Class for AICC Paths\n */\nexport class CMIPathsObject extends BaseCMI {\n  private _location_id = \"\";\n  private _date = \"\";\n  private _time = \"\";\n  private _status = \"\";\n  private _why_left = \"\";\n  private _time_in_element = \"\";\n\n  /**\n   * Constructor for AICC Paths objects\n   */\n  constructor() {\n    super(\"cmi.paths.n\");\n  }\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._location_id = \"\";\n    this._date = \"\";\n    this._time = \"\";\n    this._status = \"\";\n    this._why_left = \"\";\n    this._time_in_element = \"\";\n  }\n\n  /**\n   * Getter for _location_id\n   * @return {string}\n   */\n  get location_id(): string {\n    return this._location_id;\n  }\n\n  /**\n   * Setter for _location_id\n   * @param {string} location_id\n   */\n  set location_id(location_id: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".location_id\",\n        location_id,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._location_id = location_id;\n    }\n  }\n\n  /**\n   * Getter for _date\n   * @return {string}\n   */\n  get date(): string {\n    return this._date;\n  }\n\n  /**\n   * Setter for _date\n   * @param {string} date\n   */\n  set date(date: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".date\",\n        date,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._date = date;\n    }\n  }\n\n  /**\n   * Getter for _time\n   * @return {string}\n   */\n  get time(): string {\n    return this._time;\n  }\n\n  /**\n   * Setter for _time\n   * @param {string} time\n   */\n  set time(time: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".time\",\n        time,\n        aicc_regex.CMITime,\n      )\n    ) {\n      this._time = time;\n    }\n  }\n\n  /**\n   * Getter for _status\n   * @return {string}\n   */\n  get status(): string {\n    return this._status;\n  }\n\n  /**\n   * Setter for _status\n   * @param {string} status\n   */\n  set status(status: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".status\",\n        status,\n        aicc_regex.CMIStatus2,\n      )\n    ) {\n      this._status = status;\n    }\n  }\n\n  /**\n   * Getter for _why_left\n   * @return {string}\n   */\n  get why_left(): string {\n    return this._why_left;\n  }\n\n  /**\n   * Setter for _why_left\n   * @param {string} why_left\n   */\n  set why_left(why_left: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".why_left\",\n        why_left,\n        aicc_regex.CMIString256,\n      )\n    ) {\n      this._why_left = why_left;\n    }\n  }\n\n  /**\n   * Getter for _time_in_element\n   * @return {string}\n   */\n  get time_in_element(): string {\n    return this._time_in_element;\n  }\n\n  /**\n   * Setter for _time_in_element\n   * @param {string} time_in_element\n   */\n  set time_in_element(time_in_element: string) {\n    if (\n      checkAICCValidFormat(\n        this._cmi_element + \".time_in_element\",\n        time_in_element,\n        aicc_regex.CMITime,\n      )\n    ) {\n      this._time_in_element = time_in_element;\n    }\n  }\n\n  /**\n   * toJSON for cmi.paths.n object\n   * @return {\n   *    {\n   *      location_id: string,\n   *      date: string,\n   *      time: string,\n   *      status: string,\n   *      why_left: string,\n   *      time_in_element: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    location_id: string;\n    date: string;\n    time: string;\n    status: string;\n    why_left: string;\n    time_in_element: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      location_id: this.location_id,\n      date: this.date,\n      time: this.time,\n      status: this.status,\n      why_left: this.why_left,\n      time_in_element: this.time_in_element,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import * as Scorm12CMI from \"../scorm12/cmi\";\nimport { aicc_constants } from \"../../constants/api_constants\";\nimport { CMIEvaluation } from \"./evaluation\";\nimport { AICCStudentPreferences } from \"./student_preferences\";\nimport { CMIStudentDemographics } from \"./student_demographics\";\nimport { AICCCMIStudentData } from \"./student_data\";\nimport { CMIPaths } from \"./paths\";\nimport { CMICore } from \"./core\";\nimport { CMIObjectives } from \"../scorm12/objectives\";\nimport { CMIStudentData } from \"../scorm12/student_data\";\nimport { CMIStudentPreference } from \"../scorm12/student_preference\";\nimport { CMIInteractions } from \"../scorm12/interactions\";\n\n/**\n * CMI Class for AICC\n */\nexport class CMI extends Scorm12CMI.CMI {\n  /**\n   * Constructor for AICC CMI object\n   * @param {boolean} initialized\n   */\n  constructor(initialized: boolean = false) {\n    super(aicc_constants.cmi_children);\n    if (initialized) this.initialize();\n    this.student_preference = new AICCStudentPreferences();\n    this.student_data = new AICCCMIStudentData();\n    this.student_demographics = new CMIStudentDemographics();\n    this.evaluation = new CMIEvaluation();\n    this.paths = new CMIPaths();\n  }\n\n  public override student_data: AICCCMIStudentData;\n  public override student_preference: AICCStudentPreferences;\n  public student_demographics: CMIStudentDemographics;\n  public evaluation: CMIEvaluation;\n  public paths: CMIPaths;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.student_preference?.initialize();\n    this.student_data?.initialize();\n    this.student_demographics?.initialize();\n    this.evaluation?.initialize();\n    this.paths?.initialize();\n  }\n\n  /**\n   * toJSON for cmi\n   *\n   * @return {\n   *    {\n   *      suspend_data: string,\n   *      launch_data: string,\n   *      comments: string,\n   *      comments_from_lms: string,\n   *      core: CMICore,\n   *      objectives: CMIObjectives,\n   *      student_data: CMIStudentData,\n   *      student_preference: CMIStudentPreference,\n   *      interactions: CMIInteractions,\n   *      paths: CMIPaths\n   *    }\n   *  }\n   */\n  override toJSON(): {\n    suspend_data: string;\n    launch_data: string;\n    comments: string;\n    comments_from_lms: string;\n    core: CMICore;\n    objectives: CMIObjectives;\n    student_data: CMIStudentData;\n    student_preference: CMIStudentPreference;\n    student_demographics: CMIStudentDemographics;\n    interactions: CMIInteractions;\n    evaluation: CMIEvaluation;\n    paths: CMIPaths;\n  } {\n    this.jsonString = true;\n    const result = {\n      suspend_data: this.suspend_data,\n      launch_data: this.launch_data,\n      comments: this.comments,\n      comments_from_lms: this.comments_from_lms,\n      core: this.core,\n      objectives: this.objectives,\n      student_data: this.student_data,\n      student_preference: this.student_preference,\n      student_demographics: this.student_demographics,\n      interactions: this.interactions,\n      evaluation: this.evaluation,\n      paths: this.paths,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { Scorm12API } from \"./Scorm12API\";\nimport { CMI } from \"./cmi/aicc/cmi\";\n\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport { CMITriesObject } from \"./cmi/aicc/tries\";\nimport { CMIAttemptRecordsObject } from \"./cmi/aicc/attempts\";\nimport { CMIEvaluationCommentsObject } from \"./cmi/aicc/evaluation\";\nimport { NAV } from \"./cmi/scorm12/nav\";\nimport { CMIPathsObject } from \"./cmi/aicc/paths\";\nimport { Settings } from \"./types/api_types\";\nimport { stringMatches } from \"./utilities\";\n\n/**\n * The AICC API class\n */\nclass AICCImpl extends Scorm12API {\n  /**\n   * Constructor to create AICC API object\n   * @param {Settings} settings\n   */\n  constructor(settings?: Settings) {\n    super(settings);\n\n    this.cmi = new CMI();\n    this.nav = new NAV();\n  }\n\n  override cmi: CMI;\n  override nav: NAV;\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   *\n   * @param {string} CMIElement\n   * @param {any} value\n   * @param {boolean} foundFirstIndex\n   * @return {BaseCMI | null}\n   */\n  override getChildElement(\n    CMIElement: string,\n    value: any,\n    foundFirstIndex: boolean,\n  ): BaseCMI | null {\n    let newChild = super.getChildElement(CMIElement, value, foundFirstIndex);\n\n    if (!newChild) {\n      if (stringMatches(CMIElement, \"cmi\\\\.evaluation\\\\.comments\\\\.\\\\d+\")) {\n        newChild = new CMIEvaluationCommentsObject();\n      } else if (stringMatches(CMIElement, \"cmi\\\\.student_data\\\\.tries\\\\.\\\\d+\")) {\n        newChild = new CMITriesObject();\n      } else if (stringMatches(CMIElement, \"cmi\\\\.student_data\\\\.attempt_records\\\\.\\\\d+\")) {\n        newChild = new CMIAttemptRecordsObject();\n      } else if (stringMatches(CMIElement, \"cmi\\\\.paths\\\\.\\\\d+\")) {\n        newChild = new CMIPathsObject();\n      }\n    }\n\n    return newChild;\n  }\n\n  /**\n   * Replace the whole API with another\n   *\n   * @param {AICCImpl} newAPI\n   */\n  override replaceWithAnotherScormAPI(newAPI: AICCImpl) {\n    // Data Model\n    this.cmi = newAPI.cmi;\n    this.nav = newAPI.nav;\n  }\n}\n\nexport { AICCImpl as AICC };\n","import { CMI } from \"./cmi/scorm12/cmi\";\nimport * as Utilities from \"./utilities\";\nimport { StringKeyMap, stringMatches } from \"./utilities\";\nimport { global_constants, scorm12_constants } from \"./constants/api_constants\";\nimport { scorm12_errors } from \"./constants/error_codes\";\n\nimport { BaseCMI } from \"./cmi/common/base_cmi\";\nimport { CMIObjectivesObject } from \"./cmi/scorm12/objectives\";\nimport {\n  CMIInteractionsCorrectResponsesObject,\n  CMIInteractionsObject,\n  CMIInteractionsObjectivesObject,\n} from \"./cmi/scorm12/interactions\";\nimport { NAV } from \"./cmi/scorm12/nav\";\nimport { CommitObject, ResultObject, ScoreObject, Settings } from \"./types/api_types\";\nimport { CompletionStatus, SuccessStatus } from \"./constants/enums\";\nimport BaseAPI from \"./BaseAPI\";\nimport { scorm12_regex } from \"./constants/regex\";\n\n/**\n * API class for SCORM 1.2\n */\nclass Scorm12Impl extends BaseAPI {\n  /**\n   * Constructor for SCORM 1.2 API\n   * @param {object} settings\n   */\n  constructor(settings?: Settings) {\n    if (settings) {\n      if (settings.mastery_override === undefined) {\n        settings.mastery_override = false;\n      }\n    }\n\n    super(scorm12_errors, settings);\n\n    this.cmi = new CMI();\n    this.nav = new NAV();\n\n    // Rename functions to match 1.2 Spec and expose to modules\n    this.LMSInitialize = this.lmsInitialize;\n    this.LMSFinish = this.lmsFinish;\n    this.LMSGetValue = this.lmsGetValue;\n    this.LMSSetValue = this.lmsSetValue;\n    this.LMSCommit = this.lmsCommit;\n    this.LMSGetLastError = this.lmsGetLastError;\n    this.LMSGetErrorString = this.lmsGetErrorString;\n    this.LMSGetDiagnostic = this.lmsGetDiagnostic;\n  }\n\n  public statusSetByModule = false;\n\n  cmi: CMI;\n  nav: NAV;\n\n  LMSInitialize: () => string;\n  LMSFinish: () => string;\n  LMSGetValue: (CMIElement: string) => string;\n  LMSSetValue: (CMIElement: string, value: any) => string;\n  LMSCommit: () => string;\n  LMSGetLastError: () => string;\n  LMSGetErrorString: (CMIErrorCode: string) => string;\n  LMSGetDiagnostic: (CMIErrorCode: string) => string;\n\n  /**\n   * Called when the API needs to be reset\n   */\n  reset(settings?: Settings) {\n    this.commonReset(settings);\n\n    this.cmi?.reset();\n    this.nav?.reset();\n  }\n\n  /**\n   * lmsInitialize function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsInitialize(): string {\n    this.cmi.initialize();\n    if (this.cmi.core.lesson_status) {\n      this.statusSetByModule = true;\n    } else {\n      this.cmi.core.lesson_status = \"not attempted\";\n    }\n    return this.initialize(\n      \"LMSInitialize\",\n      \"LMS was already initialized!\",\n      \"LMS is already finished!\",\n    );\n  }\n\n  /**\n   * LMSFinish function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsFinish(): string {\n    (async () => {\n      await this.internalFinish();\n    })();\n    return global_constants.SCORM_TRUE;\n  }\n\n  async internalFinish(): Promise<string> {\n    const result = await this.terminate(\"LMSFinish\", true);\n\n    if (result === global_constants.SCORM_TRUE) {\n      if (this.nav.event !== \"\") {\n        if (this.nav.event === \"continue\") {\n          this.processListeners(\"SequenceNext\");\n        } else {\n          this.processListeners(\"SequencePrevious\");\n        }\n      } else if (this.settings.autoProgress) {\n        this.processListeners(\"SequenceNext\");\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * LMSGetValue function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIElement\n   * @return {string}\n   */\n  lmsGetValue(CMIElement: string): string {\n    return this.getValue(\"LMSGetValue\", false, CMIElement);\n  }\n\n  /**\n   * LMSSetValue function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  lmsSetValue(CMIElement: string, value: any): string {\n    if (CMIElement === \"cmi.core.lesson_status\") {\n      this.statusSetByModule = true;\n    }\n    return this.setValue(\"LMSSetValue\", \"LMSCommit\", false, CMIElement, value);\n  }\n\n  /**\n   * LMSCommit function from SCORM 1.2 Spec\n   *\n   * @return {string} bool\n   */\n  lmsCommit(): string {\n    if (this.settings.asyncCommit) {\n      this.scheduleCommit(500, \"LMSCommit\");\n    } else {\n      (async () => {\n        await this.commit(\"LMSCommit\", false);\n      })();\n    }\n    return global_constants.SCORM_TRUE;\n  }\n\n  /**\n   * LMSGetLastError function from SCORM 1.2 Spec\n   *\n   * @return {string}\n   */\n  lmsGetLastError(): string {\n    return this.getLastError(\"LMSGetLastError\");\n  }\n\n  /**\n   * LMSGetErrorString function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetErrorString(CMIErrorCode: string): string {\n    return this.getErrorString(\"LMSGetErrorString\", CMIErrorCode);\n  }\n\n  /**\n   * LMSGetDiagnostic function from SCORM 1.2 Spec\n   *\n   * @param {string} CMIErrorCode\n   * @return {string}\n   */\n  lmsGetDiagnostic(CMIErrorCode: string): string {\n    return this.getDiagnostic(\"LMSGetDiagnostic\", CMIErrorCode);\n  }\n\n  /**\n   * Sets a value on the CMI Object\n   *\n   * @param {string} CMIElement\n   * @param {*} value\n   * @return {string}\n   */\n  override setCMIValue(CMIElement: string, value: any): string {\n    return this._commonSetCMIValue(\"LMSSetValue\", false, CMIElement, value);\n  }\n\n  /**\n   * Gets a value from the CMI Object\n   *\n   * @param {string} CMIElement\n   * @return {*}\n   */\n  override getCMIValue(CMIElement: string): any {\n    return this._commonGetCMIValue(\"getCMIValue\", false, CMIElement);\n  }\n\n  /**\n   * Gets or builds a new child element to add to the array.\n   *\n   * @param {string} CMIElement\n   * @param {*} _value\n   * @param {boolean} foundFirstIndex\n   * @return {BaseCMI|null}\n   */\n  getChildElement(CMIElement: string, _value: any, foundFirstIndex: boolean): BaseCMI | null {\n    if (stringMatches(CMIElement, \"cmi\\\\.objectives\\\\.\\\\d+\")) {\n      return new CMIObjectivesObject();\n    } else if (\n      foundFirstIndex &&\n      stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\\\\.correct_responses\\\\.\\\\d+\")\n    ) {\n      return new CMIInteractionsCorrectResponsesObject();\n    } else if (\n      foundFirstIndex &&\n      stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\\\\.objectives\\\\.\\\\d+\")\n    ) {\n      return new CMIInteractionsObjectivesObject();\n    } else if (!foundFirstIndex && stringMatches(CMIElement, \"cmi\\\\.interactions\\\\.\\\\d+\")) {\n      return new CMIInteractionsObject();\n    }\n\n    return null;\n  }\n\n  /**\n   * Validates Correct Response values\n   *\n   * @param {string} _CMIElement\n   * @param {*} _value\n   */\n  validateCorrectResponse(_CMIElement: string, _value: any) {\n    // do nothing\n  }\n\n  /**\n   * Returns the message that corresponds to errorNumber.\n   *\n   * @param {number|string} errorNumber\n   * @param {boolean} detail\n   * @return {string}\n   */\n  override getLmsErrorMessageDetails(errorNumber: number | string, detail: boolean): string {\n    let basicMessage = \"No Error\";\n    let detailMessage = \"No Error\";\n\n    // Set error number to string since inconsistent from modules if string or number\n    errorNumber = String(errorNumber);\n    if (scorm12_constants.error_descriptions[errorNumber]) {\n      basicMessage = scorm12_constants.error_descriptions[errorNumber].basicMessage;\n      detailMessage = scorm12_constants.error_descriptions[errorNumber].detailMessage;\n    }\n\n    return detail ? detailMessage : basicMessage;\n  }\n\n  /**\n   * Replace the whole API with another\n   *\n   * @param {Scorm12Impl} newAPI\n   */\n  replaceWithAnotherScormAPI(newAPI: Scorm12Impl) {\n    // Data Model\n    this.cmi = newAPI.cmi;\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   *\n   * @param {boolean} terminateCommit\n   * @return {object|Array}\n   */\n  renderCommitCMI(terminateCommit: boolean): StringKeyMap | Array<string> {\n    const cmiExport: StringKeyMap = this.renderCMIToJSONObject();\n\n    if (terminateCommit) {\n      (cmiExport.cmi as any).core.total_time = this.cmi.getCurrentTotalTime();\n    }\n\n    const result = [];\n    const flattened: StringKeyMap = Utilities.flatten(cmiExport);\n    switch (this.settings.dataCommitFormat) {\n      case \"flattened\":\n        return Utilities.flatten(cmiExport);\n      case \"params\":\n        for (const item in flattened) {\n          if ({}.hasOwnProperty.call(flattened, item)) {\n            result.push(`${item}=${flattened[item]}`);\n          }\n        }\n        return result;\n      case \"json\":\n      default:\n        return cmiExport;\n    }\n  }\n\n  /**\n   * Render the cmi object to the proper format for LMS commit\n   * @param {boolean} terminateCommit\n   * @return {CommitObject}\n   */\n  renderCommitObject(terminateCommit: boolean): CommitObject {\n    const cmiExport = this.renderCommitCMI(terminateCommit);\n    const totalTimeHHMMSS = this.cmi.getCurrentTotalTime();\n    const totalTimeSeconds = Utilities.getTimeAsSeconds(totalTimeHHMMSS, scorm12_regex.CMITimespan);\n    const lessonStatus = this.cmi.core.lesson_status;\n    let completionStatus = CompletionStatus.UNKNOWN;\n    let successStatus = SuccessStatus.UNKNOWN;\n    if (lessonStatus) {\n      completionStatus =\n        lessonStatus === \"completed\" || lessonStatus === \"passed\"\n          ? CompletionStatus.COMPLETED\n          : CompletionStatus.INCOMPLETE;\n      if (lessonStatus === \"passed\") {\n        successStatus = SuccessStatus.PASSED;\n      } else if (lessonStatus === \"failed\") {\n        successStatus = SuccessStatus.FAILED;\n      }\n    }\n\n    const score = this.cmi.core.score;\n    let scoreObject: ScoreObject = null;\n    if (score) {\n      scoreObject = {};\n\n      if (!Number.isNaN(Number.parseFloat(score.raw))) {\n        scoreObject.raw = Number.parseFloat(score.raw);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.min))) {\n        scoreObject.min = Number.parseFloat(score.min);\n      }\n      if (!Number.isNaN(Number.parseFloat(score.max))) {\n        scoreObject.max = Number.parseFloat(score.max);\n      }\n    }\n\n    const commitObject: CommitObject = {\n      successStatus: successStatus,\n      completionStatus: completionStatus,\n      runtimeData: cmiExport as StringKeyMap,\n      totalTimeSeconds: totalTimeSeconds,\n    };\n    if (scoreObject) {\n      commitObject.score = scoreObject;\n    }\n    return commitObject;\n  }\n\n  /**\n   * Attempts to store the data to the LMS\n   *\n   * @param {boolean} terminateCommit\n   * @return {ResultObject}\n   */\n  async storeData(terminateCommit: boolean): Promise<ResultObject> {\n    if (terminateCommit) {\n      const originalStatus = this.cmi.core.lesson_status;\n      if (\n        !this.cmi.core.lesson_status ||\n        (!this.statusSetByModule && this.cmi.core.lesson_status === \"not attempted\")\n      ) {\n        this.cmi.core.lesson_status = \"completed\";\n      }\n\n      if (this.cmi.core.lesson_mode === \"normal\") {\n        if (this.cmi.core.credit === \"credit\") {\n          if (\n            this.settings.mastery_override &&\n            this.cmi.student_data.mastery_score !== \"\" &&\n            this.cmi.core.score.raw !== \"\"\n          ) {\n            this.cmi.core.lesson_status =\n              parseFloat(this.cmi.core.score.raw) >= parseFloat(this.cmi.student_data.mastery_score)\n                ? \"passed\"\n                : \"failed\";\n          }\n        }\n      } else if (this.cmi.core.lesson_mode === \"browse\") {\n        if (\n          ((this.startingData?.cmi as any)?.core?.lesson_status || \"\") === \"\" &&\n          originalStatus === \"not attempted\"\n        ) {\n          this.cmi.core.lesson_status = \"browsed\";\n        }\n      }\n    }\n\n    const commitObject = this.getCommitObject(terminateCommit);\n    if (typeof this.settings.lmsCommitUrl === \"string\") {\n      return await this.processHttpRequest(\n        this.settings.lmsCommitUrl,\n        commitObject,\n        terminateCommit,\n      );\n    } else {\n      return {\n        result: global_constants.SCORM_TRUE,\n        errorCode: 0,\n      };\n    }\n  }\n}\n\nexport { Scorm12Impl as Scorm12API };\n","import { BaseCMI } from \"../common/base_cmi\";\nimport { CMIScore } from \"../common/score\";\nimport { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { check12ValidFormat } from \"../scorm12/validation\";\nimport * as Util from \"../../utilities\";\n\n/**\n * Class representing the `cmi.core` object\n * @extends BaseCMI\n */\nexport class CMICore extends BaseCMI {\n  /**\n   * Constructor for `cmi.core`\n   */\n  constructor() {\n    super(\"cmi.core\");\n    this.score = new CMIScore({\n      CMIElement: \"cmi.core.score\",\n      score_children: scorm12_constants.score_children,\n      score_range: scorm12_regex.score_range,\n      invalidErrorCode: scorm12_errors.INVALID_SET_VALUE,\n      invalidTypeCode: scorm12_errors.TYPE_MISMATCH,\n      invalidRangeCode: scorm12_errors.VALUE_OUT_OF_RANGE,\n      errorClass: Scorm12ValidationError,\n    });\n  }\n\n  public readonly score: CMIScore;\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.score?.initialize();\n  }\n\n  private __children = scorm12_constants.core_children;\n  private _student_id = \"\";\n  private _student_name = \"\";\n  private _lesson_location = \"\";\n  private _credit = \"\";\n  private _lesson_status = \"not attempted\";\n  private _entry = \"\";\n  private _total_time = \"\";\n  private _lesson_mode = \"normal\";\n  private _exit = \"\";\n  private _session_time = \"00:00:00\";\n  private _suspend_data = \"\";\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._exit = \"\";\n    this._entry = \"\";\n\n    /**\n     * Resetting ensures we accurately track the time spent on each individual SCO session independently. Each new\n     * session should start from zero, so we can reset cmi.core.session_time at the beginning of each session.\n     */\n    this._session_time = \"00:00:00\";\n\n    this.score?.reset();\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   * @private\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __children. Just throws an error.\n   * @param {string} _children\n   * @private\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _student_id\n   * @return {string}\n   */\n  get student_id(): string {\n    return this._student_id;\n  }\n\n  /**\n   * Setter for _student_id. Can only be called before  initialization.\n   * @param {string} student_id\n   */\n  set student_id(student_id: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_id\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._student_id = student_id;\n    }\n  }\n\n  /**\n   * Getter for _student_name\n   * @return {string}\n   */\n  get student_name(): string {\n    return this._student_name;\n  }\n\n  /**\n   * Setter for _student_name. Can only be called before  initialization.\n   * @param {string} student_name\n   */\n  set student_name(student_name: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".student_name\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._student_name = student_name;\n    }\n  }\n\n  /**\n   * Getter for _lesson_location\n   * @return {string}\n   */\n  get lesson_location(): string {\n    return this._lesson_location;\n  }\n\n  /**\n   * Setter for _lesson_location\n   * @param {string} lesson_location\n   */\n  set lesson_location(lesson_location: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".lesson_location\",\n        lesson_location,\n        scorm12_regex.CMIString256,\n        true,\n      )\n    ) {\n      this._lesson_location = lesson_location;\n    }\n  }\n\n  /**\n   * Getter for _credit\n   * @return {string}\n   */\n  get credit(): string {\n    return this._credit;\n  }\n\n  /**\n   * Setter for _credit. Can only be called before  initialization.\n   * @param {string} credit\n   */\n  set credit(credit: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".credit\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._credit = credit;\n    }\n  }\n\n  /**\n   * Getter for _lesson_status\n   * @return {string}\n   */\n  get lesson_status(): string {\n    return this._lesson_status;\n  }\n\n  /**\n   * Setter for _lesson_status\n   * @param {string} lesson_status\n   */\n  set lesson_status(lesson_status: string) {\n    if (this.initialized) {\n      if (\n        check12ValidFormat(\n          this._cmi_element + \".lesson_status\",\n          lesson_status,\n          scorm12_regex.CMIStatus,\n        )\n      ) {\n        this._lesson_status = lesson_status;\n      }\n    } else {\n      if (\n        check12ValidFormat(\n          this._cmi_element + \".lesson_status\",\n          lesson_status,\n          scorm12_regex.CMIStatus2,\n        )\n      ) {\n        this._lesson_status = lesson_status;\n      }\n    }\n  }\n\n  /**\n   * Getter for _entry\n   * @return {string}\n   */\n  get entry(): string {\n    return this._entry;\n  }\n\n  /**\n   * Setter for _entry. Can only be called before  initialization.\n   * @param {string} entry\n   */\n  set entry(entry: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".entry\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._entry = entry;\n    }\n  }\n\n  /**\n   * Getter for _total_time\n   * @return {string}\n   */\n  get total_time(): string {\n    return this._total_time;\n  }\n\n  /**\n   * Setter for _total_time. Can only be called before  initialization.\n   * @param {string} total_time\n   */\n  set total_time(total_time: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".total_time\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._total_time = total_time;\n    }\n  }\n\n  /**\n   * Getter for _lesson_mode\n   * @return {string}\n   */\n  get lesson_mode(): string {\n    return this._lesson_mode;\n  }\n\n  /**\n   * Setter for _lesson_mode. Can only be called before  initialization.\n   * @param {string} lesson_mode\n   */\n  set lesson_mode(lesson_mode: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".lesson_mode\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._lesson_mode = lesson_mode;\n    }\n  }\n\n  /**\n   * Getter for _exit. Should only be called during JSON export.\n   * @return {string}\n   */\n  get exit(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".exit\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._exit;\n  }\n\n  /**\n   * Setter for _exit\n   * @param {string} exit\n   */\n  set exit(exit: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".exit\",\n        exit,\n        scorm12_regex.CMIExit,\n        true,\n      )\n    ) {\n      this._exit = exit;\n    }\n  }\n\n  /**\n   * Getter for _session_time. Should only be called during JSON export.\n   * @return {string}\n   */\n  get session_time(): string {\n    if (!this.jsonString) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".session_time\",\n        scorm12_errors.WRITE_ONLY_ELEMENT,\n      );\n    }\n    return this._session_time;\n  }\n\n  /**\n   * Setter for _session_time\n   * @param {string} session_time\n   */\n  set session_time(session_time: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".session_time\",\n        session_time,\n        scorm12_regex.CMITimespan,\n      )\n    ) {\n      this._session_time = session_time;\n    }\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this._suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".suspend_data\",\n        suspend_data,\n        scorm12_regex.CMIString4096,\n        true,\n      )\n    ) {\n      this._suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   * @param {number} start_time\n   * @return {string}\n   */\n  getCurrentTotalTime(start_time: number | undefined): string {\n    let sessionTime = this._session_time;\n    const startTime = start_time;\n\n    if (typeof startTime !== \"undefined\" && startTime !== null) {\n      const seconds = new Date().getTime() - startTime;\n      sessionTime = Util.getSecondsAsHHMMSS(seconds / 1000);\n    }\n\n    return Util.addHHMMSSTimeStrings(\n      this._total_time,\n      sessionTime,\n      new RegExp(scorm12_regex.CMITimespan),\n    );\n  }\n\n  /**\n   * toJSON for cmi.core\n   *\n   * @return {\n   *    {\n   *      student_name: string,\n   *      entry: string,\n   *      exit: string,\n   *      score: CMIScore,\n   *      student_id: string,\n   *      lesson_mode: string,\n   *      lesson_location: string,\n   *      lesson_status: string,\n   *      credit: string,\n   *      session_time: string\n   *    }\n   *  }\n   */\n  toJSON(): {\n    student_name: string;\n    entry: string;\n    exit: string;\n    score: CMIScore;\n    student_id: string;\n    lesson_mode: string;\n    lesson_location: string;\n    lesson_status: string;\n    credit: string;\n    session_time: string;\n  } {\n    this.jsonString = true;\n    const result = {\n      student_id: this.student_id,\n      student_name: this.student_name,\n      lesson_location: this.lesson_location,\n      credit: this.credit,\n      lesson_status: this.lesson_status,\n      entry: this.entry,\n      lesson_mode: this.lesson_mode,\n      exit: this.exit,\n      session_time: this.session_time,\n      score: this.score,\n    };\n    delete this.jsonString;\n    return result;\n  }\n}\n","import { scorm12_constants } from \"../../constants/api_constants\";\nimport { scorm12_errors } from \"../../constants/error_codes\";\nimport { scorm12_regex } from \"../../constants/regex\";\nimport { Scorm12ValidationError } from \"../../exceptions/scorm12_exceptions\";\nimport { BaseRootCMI } from \"../common/base_cmi\";\nimport { check12ValidFormat } from \"./validation\";\nimport { CMICore } from \"../aicc/core\";\nimport { CMIObjectives } from \"./objectives\";\nimport { CMIStudentData } from \"./student_data\";\nimport { CMIStudentPreference } from \"./student_preference\";\nimport { CMIInteractions } from \"./interactions\";\n\n/**\n * Class representing the cmi object for SCORM 1.2\n */\nexport class CMI extends BaseRootCMI {\n  private readonly __children: string = \"\";\n  private __version: string = \"3.4\";\n  private _launch_data: string = \"\";\n  private _comments: string = \"\";\n  private _comments_from_lms: string = \"\";\n\n  /**\n   * Constructor for the SCORM 1.2 cmi object\n   * @param {string} cmi_children\n   * @param {(CMIStudentData|AICCCMIStudentData)} student_data\n   * @param {boolean} initialized\n   */\n  constructor(\n    cmi_children?: string,\n    student_data?: CMIStudentData,\n    initialized?: boolean,\n  ) {\n    super(\"cmi\");\n    if (initialized) this.initialize();\n    this.__children = cmi_children\n      ? cmi_children\n      : scorm12_constants.cmi_children;\n    this.core = new CMICore();\n    this.objectives = new CMIObjectives();\n    this.student_data = student_data ? student_data : new CMIStudentData();\n    this.student_preference = new CMIStudentPreference();\n    this.interactions = new CMIInteractions();\n  }\n\n  public core: CMICore;\n  public objectives: CMIObjectives;\n  public student_data: CMIStudentData;\n  public student_preference: CMIStudentPreference;\n  public interactions: CMIInteractions;\n\n  /**\n   * Called when the API has been reset\n   */\n  reset(): void {\n    this._initialized = false;\n\n    this._launch_data = \"\";\n    this._comments = \"\";\n    this.core?.reset();\n    this.objectives = new CMIObjectives();\n    this.interactions = new CMIInteractions();\n    this.student_data?.reset();\n    this.student_preference?.reset();\n  }\n\n  /**\n   * Called when the API has been initialized after the CMI has been created\n   */\n  override initialize() {\n    super.initialize();\n    this.core?.initialize();\n    this.objectives?.initialize();\n    this.student_data?.initialize();\n    this.student_preference?.initialize();\n    this.interactions?.initialize();\n  }\n\n  /**\n   * toJSON for cmi\n   *\n   * @return {\n   *    {\n   *      suspend_data: string,\n   *      launch_data: string,\n   *      comments: string,\n   *      comments_from_lms: string,\n   *      core: CMICore,\n   *      objectives: CMIObjectives,\n   *      student_data: CMIStudentData,\n   *      student_preference: CMIStudentPreference,\n   *      interactions: CMIInteractions\n   *    }\n   *  }\n   */\n  toJSON(): {\n    suspend_data: string;\n    launch_data: string;\n    comments: string;\n    comments_from_lms: string;\n    core: CMICore;\n    objectives: CMIObjectives;\n    student_data: CMIStudentData;\n    student_preference: CMIStudentPreference;\n    interactions: CMIInteractions;\n  } {\n    this.jsonString = true;\n    const result = {\n      suspend_data: this.suspend_data,\n      launch_data: this.launch_data,\n      comments: this.comments,\n      comments_from_lms: this.comments_from_lms,\n      core: this.core,\n      objectives: this.objectives,\n      student_data: this.student_data,\n      student_preference: this.student_preference,\n      interactions: this.interactions,\n    };\n    delete this.jsonString;\n    return result;\n  }\n\n  /**\n   * Getter for __version\n   * @return {string}\n   */\n  get _version(): string {\n    return this.__version;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _version\n   */\n  set _version(_version: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._version\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for __children\n   * @return {string}\n   */\n  get _children(): string {\n    return this.__children;\n  }\n\n  /**\n   * Setter for __version. Just throws an error.\n   * @param {string} _children\n   */\n  set _children(_children: string) {\n    throw new Scorm12ValidationError(\n      this._cmi_element + \"._children\",\n      scorm12_errors.INVALID_SET_VALUE,\n    );\n  }\n\n  /**\n   * Getter for _suspend_data\n   * @return {string}\n   */\n  get suspend_data(): string {\n    return this.core?.suspend_data;\n  }\n\n  /**\n   * Setter for _suspend_data\n   * @param {string} suspend_data\n   */\n  set suspend_data(suspend_data: string) {\n    if (this.core) {\n      this.core.suspend_data = suspend_data;\n    }\n  }\n\n  /**\n   * Getter for _launch_data\n   * @return {string}\n   */\n  get launch_data(): string {\n    return this._launch_data;\n  }\n\n  /**\n   * Setter for _launch_data. Can only be called before  initialization.\n   * @param {string} launch_data\n   */\n  set launch_data(launch_data: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".launch_data\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._launch_data = launch_data;\n    }\n  }\n\n  /**\n   * Getter for _comments\n   * @return {string}\n   */\n  get comments(): string {\n    return this._comments;\n  }\n\n  /**\n   * Setter for _comments\n   * @param {string} comments\n   */\n  set comments(comments: string) {\n    if (\n      check12ValidFormat(\n        this._cmi_element + \".comments\",\n        comments,\n        scorm12_regex.CMIString4096,\n        true,\n      )\n    ) {\n      this._comments = comments;\n    }\n  }\n\n  /**\n   * Getter for _comments_from_lms\n   * @return {string}\n   */\n  get comments_from_lms(): string {\n    return this._comments_from_lms;\n  }\n\n  /**\n   * Setter for _comments_from_lms. Can only be called before  initialization.\n   * @param {string} comments_from_lms\n   */\n  set comments_from_lms(comments_from_lms: string) {\n    if (this.initialized) {\n      throw new Scorm12ValidationError(\n        this._cmi_element + \".comments_from_lms\",\n        scorm12_errors.READ_ONLY_ELEMENT,\n      );\n    } else {\n      this._comments_from_lms = comments_from_lms;\n    }\n  }\n\n  /**\n   * Adds the current session time to the existing total time.\n   *\n   * @return {string}\n   */\n  getCurrentTotalTime(): string {\n    return this.core.getCurrentTotalTime(this.start_time);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }"],"names":["NAVBoolean","UNKNOWN","TRUE","FALSE","SuccessStatus","PASSED","FAILED","CompletionStatus","COMPLETED","INCOMPLETE","LogLevelEnum","_","DEBUG","INFO","WARN","ERROR","NONE","CMIElement","children","objectives_children","errorCode","INVALID_SET_VALUE","errorClass","_id","_status","score","score_children","score_range","invalidErrorCode","invalidTypeCode","TYPE_MISMATCH","invalidRangeCode","VALUE_OUT_OF_RANGE","reset","this","_initialized","id","_cmi_element","CMIIdentifier","status","CMIStatus2","toJSON","jsonString","result","scorm12_errors","error_descriptions","hasOwnProperty","call","String","basicMessage","detailMessage","Object","setPrototypeOf","Scorm12ValidationError","prototype","student_preference_children","_audio","_language","_speed","_text","__children","_children","audio","v","validateScorm12Audio","language","validateScorm12Language","speed","validateScorm12Speed","text","validateScorm12Text","cmi_element","_start_time","initialize","setStartTime","Date","getTime","BaseCMI","_event","event","NAVEvent","global_constants","SCORM_TRUE","SCORM_FALSE","STATE_NOT_INITIALIZED","STATE_INITIALIZED","STATE_TERMINATED","scorm12_constants","cmi_children","core_children","comments_children","correct_responses_children","student_data_children","interactions_children","aicc_constants","student_demographics_children","tries_children","attempt_records_children","paths_children","scorm2004_constants","adl_data_children","scorm12_regex","CMIString256","CMIString4096","CMITime","CMITimespan","CMIInteger","CMISInteger","CMIDecimal","CMIFeedback","CMIIndex","CMIStatus","CMIExit","CMIType","CMIResult","audio_range","speed_range","weighting_range","text_range","aicc_regex","scorm2004_regex","CMIString200","CMIString250","CMIString1000","CMIString4000","CMIString64000","CMILang","CMILangString250","CMILangcr","CMILangString250cr","CMILangString4000","CMIShortIdentifier","CMILongIdentifier","CMIIndexStore","CMICStatus","CMISStatus","NAVTarget","scaled_range","progress_range","params","_raw","_min","__score_range","_max","max","__invalid_error_code","__invalid_type_code","__invalid_range_code","__decimal_regex","decimalRegex","__error_class","raw","validateScore","min","checkValidFormat","value","regexPattern","allowEmptyString","formatRegex","RegExp","matches","match","undefined","_errorClass","valueKey","checkValidRange","rangePattern","ranges","split","_mastery_score","_max_time_allowed","_time_limit_action","mastery_score","validateReadOnly","initialized","max_time_allowed","time_limit_action","scorm2004_errors","Scorm2004ValidationError","check2004ValidFormat","check2004ValidRange","RuleConditionOperator","RuleConditionType","RuleActionType","_audio_level","_delivery_speed","_audio_captioning","READ_ONLY_ELEMENT","audio_level","delivery_speed","audio_captioning","LearnerResponses","format","delimiter","unique","choice","matching","format2","delimiter2","performance","sequencing","likert","numeric","other","CorrectResponses","duplicate","limit","delimiter3","_type","_timestamp","_weighting","_learner_response","_result","_latency","_description","objectives","correct_responses","type","DEPENDENCY_NOT_ESTABLISHED","timestamp","weighting","learner_response","nodes","response_type","length","GENERAL_SET_FAILURE","i","values","j","latency","description","parent","_pattern","_parent","pattern","interactionType","response","isValid","_scaled","scaled","readOnlyAfterInit","_comment","_location","_readOnlyAfterInit","comment","location","findObjectiveById","childArray","find","objective","findObjectiveByIndex","index","setObjectiveByIndex","_success_status","_completion_status","_progress_measure","Scorm2004CMIScore","success_status","completion_status","progress_measure","__version","_version","_learner_id","_learner_name","learner_id","learner_name","_entry","_exit","_session_time","_total_time","entry","WRITE_ONLY_ELEMENT","exit","session_time","total_time","getCurrentTotalTime","sessionTime","startTime","start_time","seconds","_launch_data","_suspend_data","launch_data","suspend_data","_credit","_mode","credit","mode","_scaled_passing_score","_completion_threshold","scaled_passing_score","completion_threshold","metadata","CMIMetadata","learner","CMILearner","session","CMISession","content","CMIContent","settings","CMISettings","thresholds","CMIThresholds","learner_preference","CMILearnerPreference","comments_from_learner","CMICommentsFromLearner","comments_from_lms","CMICommentsFromLMS","interactions","CMIInteractions","CMIObjectives","data","ADLData","_sequencing","nav","ADLNav","adlNav","_request","request_valid","ADLNavRequestValid","request","processNavigationRequest","_store","store","_continue","_previous","_choice","_jump","key","jump","previous","continue","RollupActionType","RollupConditionType","RollupConsiderationType","condition","operator","parameters","ALWAYS","Map","_condition","_operator","_parameters","evaluate","activity","SATISFIED","successStatus","OBJECTIVE_STATUS_KNOWN","OBJECTIVE_MEASURE_KNOWN","objectiveMeasureStatus","OBJECTIVE_MEASURE_GREATER_THAN","greaterThanValue","get","objectiveNormalizedMeasure","OBJECTIVE_MEASURE_LESS_THAN","lessThanValue","isCompleted","PROGRESS_KNOWN","completionStatus","ATTEMPTED","attemptCount","ATTEMPT_LIMIT_EXCEEDED","attemptLimit","TIME_LIMIT_EXCEEDED","OUTSIDE_AVAILABLE_TIME_RANGE","fromEntries","action","conditionCombination","SKIP","AND","_conditions","_action","_conditionCombination","addCondition","RuleCondition","push","removeCondition","indexOf","splice","every","OR","some","conditions","_preConditionRules","_exitConditionRules","_postConditionRules","addPreConditionRule","rule","SequencingRule","addExitConditionRule","addPostConditionRule","evaluatePreConditionRules","evaluateExitConditionRules","evaluatePostConditionRules","preConditionRules","exitConditionRules","postConditionRules","NOT_ATTEMPTED","consideration","minimumCount","minimumPercent","ALL","_consideration","_minimumCount","_minimumPercent","RollupCondition","matchingChildren","filter","child","ANY","AT_LEAST_COUNT","AT_LEAST_PERCENT","_rules","addRule","RollupRule","removeRule","processRollup","completionRollup","successRollup","NOT_SATISFIED","_defaultCompletionRollup","_defaultSuccessRollup","rules","title","_title","_isVisible","_isActive","_isSuspended","_isCompleted","_completionStatus","_successStatus","_attemptCount","_attemptCompletionAmount","_attemptAbsoluteDuration","_attemptExperiencedDuration","_activityAbsoluteDuration","_activityExperiencedDuration","_objectiveSatisfiedStatus","_objectiveMeasureStatus","_objectiveNormalizedMeasure","addChild","Activity","removeChild","isVisible","isActive","isSuspended","incrementAttemptCount","attemptCompletionAmount","attemptAbsoluteDuration","attemptExperiencedDuration","activityAbsoluteDuration","activityExperiencedDuration","objectiveSatisfiedStatus","map","_root","_currentActivity","_suspendedActivity","_activities","root","set","_addActivitiesToMap","getActivity","getAllActivities","Array","from","getParent","getChildren","getSiblings","getNextSibling","siblings","getPreviousSibling","getFirstChild","getLastChild","getCommonAncestor","activity1","activity2","path1","current","unshift","includes","currentActivity","suspendedActivity","_enabled","_choiceExit","_flow","_forwardOnly","_useCurrentAttemptObjectiveInfo","_useCurrentAttemptProgressInfo","_preventActivation","_constrainChoice","_rollupObjectiveSatisfied","_rollupProgressCompletion","_objectiveMeasureWeight","enabled","choiceExit","flow","forwardOnly","useCurrentAttemptObjectiveInfo","useCurrentAttemptProgressInfo","preventActivation","constrainChoice","rollupObjectiveSatisfied","rollupProgressCompletion","objectiveMeasureWeight","isChoiceNavigationAllowed","isFlowNavigationAllowed","isForwardNavigationAllowed","isBackwardNavigationAllowed","_adlNav","_activityTree","ActivityTree","_sequencingRules","SequencingRules","_sequencingControls","SequencingControls","_rollupRules","RollupRules","activityTree","sequencingRules","sequencingControls","rollupRules","preConditionAction","DISABLED","HIDE_FROM_CHOICE","STOP_FORWARD_TRAVERSAL","processContinueRequest","processPreviousRequest","processExitRequest","processExitAllRequest","processAbandonRequest","processAbandonAllRequest","processSuspendAllRequest","processResumeAllRequest","nextActivity","exitConditionAction","EXIT_PARENT","EXIT_ALL","postConditionAction","RETRY","RETRY_ALL","forEach","CONTINUE","PREVIOUS","EXIT","previousActivity","_processRollupRecursive","mastery_override","_globalObjectives","cmi","CMI","adl","ADL","Sequencing","configureSequencing","Initialize","lmsInitialize","Terminate","lmsFinish","GetValue","lmsGetValue","SetValue","lmsSetValue","Commit","lmsCommit","GetLastError","lmsGetLastError","GetErrorString","lmsGetErrorString","GetDiagnostic","lmsGetDiagnostic","commonReset","internalFinish","terminate","navActions","exitAll","abandon","abandonAll","choiceJumpRegex","target","groups","choice_target","jump_target","processListeners","autoProgress","adlNavRequestRegex","replace","scoItemIdValidator","scoItemIds","getValue","setValue","asyncCommit","scheduleCommit","commit","getLastError","CMIErrorCode","getErrorString","getDiagnostic","setCMIValue","element_base","globalObjectiveIds","global_index","findIndex","obj","newGlobalObjective","CMIObjectivesObject","global_element","_commonSetCMIValue","getChildElement","foundFirstIndex","createCorrectResponsesObject","CMIInteractionsObjectivesObject","CMIInteractionsObject","CMICommentsObject","ADLDataObject","parts","interaction","isInitialized","throwSCORMError","checkDuplicateChoiceResponse","checkValidResponseType","lastErrorCode","CMIInteractionsCorrectResponsesObject","interaction_type","checkCorrectResponseValue","interaction_count","_count","validateCorrectResponse","pattern_index","checkDuplicatedPattern","getCMIValue","_commonGetCMIValue","getLmsErrorMessageDetails","errorNumber","detail","correct_response","current_index","found","count","removeCorrectResponsePrefixes","node","seenOrder","seenCase","seenLang","prefixRegex","langMatches","lang","toLowerCase","substring","replaceWithAnotherScormAPI","newAPI","renderCommitCMI","terminateCommit","cmiExport","renderCMIToJSONObject","flattened","dataCommitFormat","item","renderCommitObject","totalTimeDuration","totalTimeSeconds","scoreObject","Number","isNaN","parseFloat","commitObject","runtimeData","storeData","navRequest","startingData","getCommitObject","lmsCommitUrl","processHttpRequest","Function","name","sequencingSettings","configureActivityTree","configureSequencingRules","configureSequencingControls","configureRollupRules","activityTreeSettings","rootActivity","createActivity","activitySettings","childActivity","sequencingRulesSettings","createSequencingRule","ruleSettings","conditionSettings","entries","sequencingControlsSettings","rollupRulesSettings","createRollupRule","BaseAPI","_errorCode","GENERAL","wipe","extendStatics","d","b","__proto__","p","__extends","TypeError","__","constructor","create","__assign","assign","t","s","n","arguments","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","__generator","body","f","y","label","sent","trys","ops","g","Iterator","verb","Symbol","iterator","op","pop","SuppressedError","DefaultSettings","autocommit","autocommitSeconds","sendFullCommit","commitRequestDataType","logLevel","selfReportSessionTime","alwaysSendTotalTime","renderCommonCommitFields","strict_errors","xhrHeaders","xhrWithCredentials","fetchMode","responseHandler","responseText","httpResult","JSON","parse","requestHandler","onLogMessage","defaultLogHandler","messageLevel","logMessage","console","error","warn","info","debug","log","API","when","callback","_cancelled","_API","_timeout","setTimeout","wrapper","bind","_callback","cancel","clearTimeout","error_codes","url","immediate","apiLog","genericError","performFetch","transformResponse","process","fetch","method","join","stringify","headers","credentials","keepalive","json","updateSettings","listenerMap","listenerCount","parseListenerName","listenerName","listenerSplit","functionName","on","parsedListener","listeners","off","listenerFunctions","listenerFunction","removeIndex","delete","clear","has","newListeners","listener","listenerHasCMIElement","CMIElementsMatch","endsWith","prefix","slice","startsWith","loadFromFlattenedJSON","isNotInitialized","setStartingData","int_pattern","obj_pattern","others","intMatch","field","objMatch","sort","a","localeCompare","processItems","items","loadFromJSON","currentCMIElement","tempCMIElement","renderCMIToJSONString","k","apiLogLevel","shouldTerminateCommit","errorCodes","_lastErrorCode","_errorCodes","_apiLog","_getLmsErrorMessageDetails","message","clearSCORMError","success","handleValueAccessException","returnValue","Error","_logLevel","_logHandler","getInstance","LoggingService","_instance","setLogLevel","level","getLogLevel","setLogHandler","handler","shouldLog","getNumericLevel","httpService","eventService","serializationService","cmiDataService","errorHandlingService","loggingService","_settings","currentState","_error_codes","_loggingService","_httpService","HttpService","_eventService","EventService","element","_serializationService","SerializationService","_errorHandlingService","ErrorHandlingService","clearScheduledCommit","callbackName","initializeMessage","terminationMessage","INITIALIZED","isTerminated","TERMINATED","previousSettings","checkTerminated","checkState","TERMINATION_BEFORE_INIT","MULTIPLE_TERMINATION","RETRIEVE_BEFORE_INIT","RETRIEVE_AFTER_TERM","commitCallback","STORE_BEFORE_INIT","STORE_AFTER_TERM","COMMIT_BEFORE_INIT","COMMIT_AFTER_TERM","beforeInitError","afterTermError","_errorNumber","_detail","_CMIElement","_value","methodName","scorm2004","structure","refObject","invalidErrorMessage","UNDEFINED_DATA_MODEL","idx","attribute","_checkObjectHasProperty","parseInt","newChild","uninitializedErrorMessage","_isTargetValid","VALUE_NOT_INITIALIZED","CHILDREN_ERROR","COUNT_ERROR","ScheduledCommit","StringKeyMap","getOwnPropertyDescriptor","getPrototypeOf","errorMessage","BaseScormValidationError","detailedMessage","_detailedMessage","_errorMessage","ValidationError","global_errors","INITIALIZATION_FAILED","TERMINATION_FAILURE","ARGUMENT_ERROR","GENERAL_GET_FAILURE","GENERAL_COMMIT_FAILURE","UNIMPLEMENTED_ELEMENT","MULTIPLE_TERMINATIONS","validationService","scoreRange","_time","_student_response","time","student_response","designations","D","H","M","S","getSecondsAsHHMMSS","memoize","totalSeconds","hours","Math","floor","dateObj","minutes","getUTCMinutes","getSeconds","ms","msStr","countDecimals","toFixed","getSecondsAsISODuration","duration","remainder","designationsKey","current_seconds","getTimeAsSeconds","timeString","timeRegex","regexStr","getDurationAsSeconds","durationRegex","exec","addTwoDurations","first","second","regex","addHHMMSSTimeStrings","flatten","recurse","cur","prop","isArray","keys","isEmpty","unflatten","m","num","formatMessage","paddedFunction","padEnd","messageString","stringMatches","str","tester","fn","keyFn","cache","args","check12ValidFormat","check12ValidRange","aicc_errors","AICCValidationError","checkAICCValidFormat","comments","CMIEvaluationComments","_content","_lesson_type","_text_color","_text_location","_text_size","_video","windows","lesson_type","text_color","text_location","text_size","video","_city","_class","_company","_country","_experience","_familiar_name","_instructor_name","_native_language","_state","_street_address","_telephone","_years_experience","city","clazz","company","country","experience","familiar_name","instructor_name","native_language","state","street_address","telephone","years_experience","class","_lesson_status","lesson_status","_tries_during_lesson","tries","CMITries","attempt_records","CMIAttemptRecords","tries_during_lesson","_location_id","_date","_why_left","_time_in_element","location_id","date","why_left","time_in_element","student_preference","AICCStudentPreferences","student_data","AICCCMIStudentData","student_demographics","CMIStudentDemographics","evaluation","CMIEvaluation","paths","CMIPaths","core","CMIEvaluationCommentsObject","CMITriesObject","CMIAttemptRecordsObject","CMIPathsObject","Scorm12API","statusSetByModule","LMSInitialize","LMSFinish","LMSGetValue","LMSSetValue","LMSCommit","LMSGetLastError","LMSGetErrorString","LMSGetDiagnostic","totalTimeHHMMSS","lessonStatus","originalStatus","lesson_mode","_student_id","_student_name","_lesson_location","_lesson_mode","student_id","student_name","lesson_location","_comments","_comments_from_lms","CMICore","C","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","o","defineProperty","enumerable"],"sourceRoot":""}