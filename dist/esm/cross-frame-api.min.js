class e{constructor(e="*"){return this._cache=new Map,this._lastError="0",this._pending=new Map,this._counter=0,this._handler={get:(e,t,r)=>{if("string"!=typeof t||t in e){const s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}const s=t,n=s.endsWith("GetValue"),i=s.startsWith("LMSSet")||s.endsWith("SetValue"),a="Initialize"===s||"LMSInitialize"===s,o="Terminate"===s||"LMSFinish"===s,c="Commit"===s||"LMSCommit"===s,h="GetErrorString"===s||"LMSGetErrorString"===s,g="GetDiagnostic"===s||"LMSGetDiagnostic"===s;return(...t)=>{if(i&&t.length>=2&&(e._cache.set(t[0],t[1]+""),e._lastError="0"),e._post(s,t).then((r=>{n&&t.length>=1&&(e._cache.set(t[0],r+""),e._lastError="0"),h&&t.length>=1&&e._cache.set("error_"+t[0],r+""),g&&t.length>=1&&e._cache.set("diag_"+t[0],r+""),"GetLastError"!==s&&"LMSGetLastError"!==s||(e._lastError=r+"")})).catch((t=>e._capture(s,t))),n&&t.length>=1)return e._cache.get(t[0])??"";if(h&&t.length>=1)return e._cache.get("error_"+t[0])??"";if(g&&t.length>=1)return e._cache.get("diag_"+t[0])??"";if(a||o||c||i){const result="true";return e._post("getFlattenedCMI",[]).then((t=>{Object.entries(t).forEach((([t,r])=>{e._cache.set(t,r)})),e._lastError="0"})).catch((t=>e._capture("getFlattenedCMI",t))),result}return"GetLastError"===s||"LMSGetLastError"===s?e._lastError:""}}},this._origin=e,window.addEventListener("message",this._onMessage.bind(this)),new Proxy(this,this._handler)}_post(e,t){const r=`cfapi-${Date.now()}-${this._counter++}`,s=t.map((t=>{if("function"!=typeof t)return t;console.warn("Dropping function param when posting SCORM call:",e)}));return new Promise(((t,n)=>{this._pending.set(r,{resolve:t,reject:n}),window.parent.postMessage({messageId:r,method:e,params:s},this._origin),setTimeout((()=>{this._pending.has(r)&&(this._pending.delete(r),n(Error("Timeout calling "+e)))}),5e3)}))}_onMessage(e){const t=e.data;if(!t?.messageId)return;const r=this._pending.get(t.messageId);r&&(this._pending.delete(t.messageId),t.error?r.reject(t.error):r.resolve(t.result))}_capture(e,t){console.error(`CrossFrameAPI ${e} error:`,t);const r=(/(\d{3})/.exec(t.message)||[])[1]||101;this._lastError=r+"",this._cache.set("error_"+r,t.message)}}export{e as CrossFrameAPI};
//# sourceMappingURL=cross-frame-api.min.js.map
