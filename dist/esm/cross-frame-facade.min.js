function t(t,e,r,n){return new(r||(r=Promise))((function(s,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))}function e(t,e){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&s[3]>a[1])){i.label=a[1];break}if(6===a[0]&&s[1]>i.label){i.label=s[1],s=a;break}if(s&&s[2]>i.label){i.label=s[2],i.ops.push(a);break}s[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function r(t,e,r){if(r||2===arguments.length)for(var n,s=0,i=e.length;i>s;s++)!n&&s in e||(n||(n=[].slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||[].slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var n=function(){function t(t,e){this._targetOrigin="*",this._api=t,e&&(this._targetOrigin=e),window.addEventListener("message",this._handleMessage.bind(this)),this._setupEventForwarding()}return t.prototype._handleMessage=function(t){var e=t.data;e&&e.messageId&&e.method&&this._processMessage(e,t.source,t.origin)},t.prototype._processMessage=function(t,e,r){var n,s,i,o=t.messageId,a=t.method,c=t.params;try{if("function"!=typeof this._api[a])throw Error("Method ".concat(a," not found on API"));s=(n=this._api)[a].apply(n,c)}catch(t){i=t instanceof Error?{message:t.message,stack:t.stack}:{message:t+""}}e.postMessage({messageId:o,result:s,error:i},this._targetOrigin)},t.prototype._setupEventForwarding=function(){var t=this,e=Array.from(document.querySelectorAll("iframe"));this._api.on("*",(function(r){for(var n=[],s=1;arguments.length>s;s++)n[s-1]=arguments[s];e.forEach((function(e){e.contentWindow&&e.contentWindow.postMessage({event:r,args:n},t._targetOrigin)}))}))},t}(),s=function(){function n(t){this._targetOrigin="*",this._pendingRequests=new Map,this._eventListeners=new Map,this._messageIdCounter=0,this._childFrames=new Set,this._isInitialized=!1,this._lastError="0",this._cache=new Map,t&&(this._targetOrigin=t),window.addEventListener("message",this._handleMessage.bind(this))}return n.prototype._handleMessage=function(t){var e=this,n=t.data,s=t.source,i=s!==window.parent&&s!==window;if(!n.messageId||void 0===n.result&&void 0===n.error||i||this._handleMethodResponse(n),n.messageId&&n.method&&i){this._childFrames.add(s);var o=n.messageId,a=n.method,c=n.params,u="forwarded-".concat(o);this._pendingRequests.set(u,{resolve:function(t){s.postMessage({messageId:o,result:t},e._targetOrigin)},reject:function(t){s.postMessage({messageId:o,error:t},e._targetOrigin)},source:s}),window.parent.postMessage({messageId:u,method:a,params:c},this._targetOrigin),setTimeout((function(){if(e._pendingRequests.has(u)){var t=e._pendingRequests.get(u);e._pendingRequests.delete(u),(null==t?void 0:t.source)&&t.source.postMessage({messageId:o,error:{message:"Timeout waiting for response to method ".concat(a)}},e._targetOrigin)}}),5e3)}n.event&&!i&&(this._handleEvent.apply(this,r([n.event],n.args||[],!1)),this._forwardEventToChildFrames(n.event,n.args||[]))},n.prototype._handleMethodResponse=function(t){var e=t.messageId,r=t.result,n=t.error,s=this._pendingRequests.get(e);if(s){var i=s.resolve;n?(0,s.reject)(n):i(r),this._pendingRequests.delete(e)}},n.prototype._handleEvent=function(t){for(var e=[],n=1;arguments.length>n;n++)e[n-1]=arguments[n];var s=this._eventListeners.get(t);s&&s.forEach((function(r){try{r.apply(void 0,e)}catch(e){console.error("Error in event listener for ".concat(t,":"),e)}}));var i=this._eventListeners.get("*");i&&i.forEach((function(n){try{n.apply(void 0,r([t],e,!1))}catch(e){console.error('Error in "*" event listener for '.concat(t,":"),e)}}))},n.prototype._forwardEventToChildFrames=function(t,e){var r=this;this._childFrames.forEach((function(n){try{n.postMessage({event:t,args:e},r._targetOrigin)}catch(t){console.error("Error forwarding event to child frame:",t)}}))},n.prototype._sendMessage=function(t,e){var r=this;return void 0===e&&(e=[]),new Promise((function(n,s){var i="".concat(Date.now(),"-").concat(r._messageIdCounter++);r._pendingRequests.set(i,{resolve:n,reject:s}),window.parent.postMessage({messageId:i,method:t,params:e},r._targetOrigin),setTimeout((function(){r._pendingRequests.has(i)&&(r._pendingRequests.delete(i),s(Error("Timeout waiting for response to method ".concat(t))))}),5e3)}))},n.prototype.initialize=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,this._sendMessage("lmsInitialize")];case 1:return t=e.sent(),this._isInitialized="true"===t,[2,this._isInitialized]}}))}))},n.prototype.lmsInitialize=function(){return this._isInitialized?(this._lastError="101","false"):(t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.initialize()];case 1:return t=e.sent(),this._isInitialized=t,this._lastError=t?"0":"101",[3,3];case 2:return r=e.sent(),this._lastError="101",this._isInitialized=!1,console.error("Error in lmsInitialize:",r),[3,3];case 3:return[2]}}))})),this._isInitialized=!0,this._lastError="0","true")},n.prototype.Initialize=function(){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.initialize()]}))}))},n.prototype.LMSInitialize=function(){return this.lmsInitialize()},n.prototype.terminate=function(){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return[4,this._sendMessage("lmsFinish")];case 1:return t=e.sent(),(r="true"===t)&&(this._isInitialized=!1),[2,r]}}))}))},n.prototype.lmsFinish=function(){return this._isInitialized?(t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.terminate()];case 1:return e.sent()?(this._isInitialized=!1,this._lastError="0"):this._lastError="101",[3,3];case 2:return t=e.sent(),this._lastError="101",console.error("Error in lmsFinish:",t),[3,3];case 3:return[2]}}))})),this._isInitialized=!1,this._lastError="0","true"):(this._lastError="301","false")},n.prototype.Terminate=function(){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.terminate()]}))}))},n.prototype.LMSFinish=function(){return this.lmsFinish()},n.prototype.getValue=function(r){return t(this,void 0,void 0,(function(){var t,n,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsGetValue",[r])];case 1:return t=e.sent(),this._cache.set(r,n=t+""),[2,n];case 2:return s=e.sent(),this._lastError="101",console.error("Error in getValue(".concat(r,"):"),s),[2,""];case 3:return[2]}}))}))},n.prototype.lmsGetValue=function(r){t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getValue(r)];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),this._lastError="101",console.error("Error in lmsGetValue(".concat(r,"):"),t),[3,3];case 3:return[2]}}))}));var n=this._cache.get(r);return this._lastError="0",n||""},n.prototype.GetValue=function(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.getValue(r)]}))}))},n.prototype.LMSGetValue=function(t){return this.lmsGetValue(t)},n.prototype.setValue=function(r,n){return t(this,void 0,void 0,(function(){var t,s,i;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsSetValue",[r,n])];case 1:return t=e.sent(),(s="true"===t)&&this._cache.set(r,n+""),[2,s];case 2:return i=e.sent(),this._lastError="101",console.error("Error in setValue(".concat(r,", ").concat(n,"):"),i),[2,!1];case 3:return[2]}}))}))},n.prototype.lmsSetValue=function(r,n){return this._isInitialized?r&&""!==r?(this._cache.set(r,n+""),t(this,void 0,void 0,(function(){var t,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.setValue(r,n)];case 1:return t=e.sent(),this._lastError=t?"0":"201",[3,3];case 2:return s=e.sent(),this._lastError="101",console.error("Error in lmsSetValue(".concat(r,", ").concat(n,"):"),s),[3,3];case 3:return[2]}}))})),this._lastError="0","true"):(this._lastError="201","false"):(this._lastError="301","false")},n.prototype.SetValue=function(r,n){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.setValue(r,n)]}))}))},n.prototype.LMSSetValue=function(t,e){return this.lmsSetValue(t,e)},n.prototype.commit=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsCommit")];case 1:return[2,"true"===e.sent()];case 2:return t=e.sent(),this._lastError="101",console.error("Error in commit:",t),[2,!1];case 3:return[2]}}))}))},n.prototype.lmsCommit=function(){return this._isInitialized?(t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.commit()];case 1:return t=e.sent(),this._lastError=t?"0":"101",[3,3];case 2:return r=e.sent(),this._lastError="101",console.error("Error in lmsCommit:",r),[3,3];case 3:return[2]}}))})),this._lastError="0","true"):(this._lastError="301","false")},n.prototype.Commit=function(){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.commit()]}))}))},n.prototype.LMSCommit=function(){return this.lmsCommit()},n.prototype.getLastError=function(){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsGetLastError")];case 1:return t=e.sent(),this._lastError=t+"",[2,this._lastError];case 2:return r=e.sent(),console.error("Error in getLastError:",r),[2,"101"];case 3:return[2]}}))}))},n.prototype.lmsGetLastError=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getLastError()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),console.error("Error in lmsGetLastError:",t),[3,3];case 3:return[2]}}))})),this._lastError},n.prototype.GetLastError=function(){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.getLastError()]}))}))},n.prototype.LMSGetLastError=function(){return this.lmsGetLastError()},n.prototype.getErrorString=function(r){return t(this,void 0,void 0,(function(){var t,n,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsGetErrorString",[r])];case 1:return t=e.sent(),n=t+"",this._cache.set("error_".concat(r),n),[2,n];case 2:return s=e.sent(),console.error("Error in getErrorString(".concat(r,"):"),s),[2,""];case 3:return[2]}}))}))},n.prototype.lmsGetErrorString=function(r){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getErrorString(r)];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),console.error("Error in lmsGetErrorString(".concat(r,"):"),t),[3,3];case 3:return[2]}}))})),this._cache.get("error_".concat(r))||"No error"},n.prototype.GetErrorString=function(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.getErrorString(r)]}))}))},n.prototype.LMSGetErrorString=function(t){return this.lmsGetErrorString(t)},n.prototype.getDiagnostic=function(r){return t(this,void 0,void 0,(function(){var t,n,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("lmsGetDiagnostic",[r])];case 1:return t=e.sent(),n=t+"",this._cache.set("diagnostic_".concat(r),n),[2,n];case 2:return s=e.sent(),console.error("Error in getDiagnostic(".concat(r,"):"),s),[2,""];case 3:return[2]}}))}))},n.prototype.lmsGetDiagnostic=function(r){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getDiagnostic(r)];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),console.error("Error in lmsGetDiagnostic(".concat(r,"):"),t),[3,3];case 3:return[2]}}))})),this._cache.get("diagnostic_".concat(r))||"No diagnostic information available"},n.prototype.GetDiagnostic=function(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,this.getDiagnostic(r)]}))}))},n.prototype.LMSGetDiagnostic=function(t){return this.lmsGetDiagnostic(t)},n.prototype.isInitialized=function(){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._sendMessage("isInitialized")];case 1:return t=e.sent(),this._isInitialized=!!t,[2,this._isInitialized];case 2:return r=e.sent(),console.error("Error in isInitialized:",r),[2,this._isInitialized];case 3:return[2]}}))}))},n.prototype.getIsInitialized=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.isInitialized()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),console.error("Error in getIsInitialized:",t),[3,3];case 3:return[2]}}))})),this._isInitialized},n.prototype.on=function(t,e){this._eventListeners.has(t)||this._eventListeners.set(t,new Set);var r=this._eventListeners.get(t);r&&r.add(e)},n.prototype.off=function(t,e){var r=this._eventListeners.get(t);r&&(r.delete(e),0===r.size&&this._eventListeners.delete(t))},n}();function i(t,e){return new n(t,e)}function o(t){return new s(t)}export{s as CrossFrameClient,n as CrossFrameServer,o as createCrossFrameClient,i as createCrossFrameServer};